System.register(["./json-asset-7bb011fd.js","./index-07e0e256.js","./spot-light-44c8b89f.js","./texture-buffer-pool-2b0fe4d4.js","./deprecated-229f0693.js","./renderable-component-0ffd84e0.js","./transform-utils-ec8404a7.js","./index-b755abba.js","./create-mesh-a2b1066e.js","./mesh-12590811.js","./mesh-renderer-f61cfd03.js","./skeleton-5498f045.js"],(function(t){"use strict";var e,i,r,a,n,o,s,l,u,h,c,_,d,p,f,m,y,v,b,g,M,w,S,T,x,O,z,R,E,C,A,P,D,F,I,B,L,U,V,H,k,N,G,W,X,j,K,Y,Z,q,Q,J,$,tt,et,it,rt,at,nt,ot,st,lt,ut,ht,ct,_t,dt,pt,ft,mt,yt,vt,bt,gt,Mt,wt,St,Tt,xt,Ot,zt,Rt,Et,Ct,At,Pt,Dt;return{setters:[function(t){e=t.eq,i=t.ev,r=t.dl,a=t.fT,n=t.ew,o=t.a4,s=t.ci,l=t.aL,u=t.b7,h=t.x,c=t.l,_=t.dp,d=t.dQ,p=t.ej,f=t.er,m=t.fV,y=t.fW,v=t.fS,b=t.es,g=t.ey,M=t.c6,w=t.cr,S=t.cq,T=t.dO,x=t.et,O=t.c4,z=t.t,R=t.b8,E=t.au,C=t.z,A=t.G,P=t.dg,D=t.ay,F=t.aw,I=t.bc,B=t.cI,L=t.dU,U=t.cp,V=t.f0,H=t.h6,k=t.ez,N=t.dk,G=t.fH,W=t.gE,X=t.h7,j=t.cz,K=t.eN,Y=t.c2,Z=t.eu,q=t.gx,Q=t.c8,J=t.cb,$=t.cv,tt=t.cs,et=t.ct,it=t.cu,rt=t.h8,at=t.h9,nt=t.gy,ot=t.cA,st=t.cn,lt=t.gG,ut=t.R,ht=t.bR,ct=t.f,_t=t.F,dt=t.P,pt=t.fU,ft=t.ha,mt=t.ed,yt=t.eg,vt=t.gF,bt=t.gg,gt=t.g7,Mt=t.d2,wt=t.dH,St=t.cR,Tt=t.cQ,xt=t.fj},function(t){Ot=t.d,zt=t.D},function(t){Rt=t.i,Et=t.M,Ct=t.o},function(){},function(){},function(t){At=t.R},function(){},function(){},function(t){Pt=t.c},function(t){Dt=t.M},function(){},function(){}],execute:function(){var Ft,It,Bt,Lt,Ut,Vt,Ht,kt,Nt,Gt,Wt,Xt,jt,Kt,Yt,Zt,qt,Qt,Jt,$t,te,ee,ie,re,ae,ne,oe,se,le,ue,he,ce,_e,de,pe,fe,me,ye,ve,be,ge,Me,we,Se,Te,xe,Oe,ze,Re,Ee=(Ft=e("cc.Billboard"),It=m(),Bt=y(),Lt=i(r),Ut=i(r),Vt=v(),Ht=v(),kt=v(),Nt=v(),qt=Ft(Gt=It(Gt=Bt(Gt=a((Zt=function(t){function e(){var e;return e=t.call(this)||this,b(e,"_texture",Xt,g(e)),b(e,"_height",jt,g(e)),b(e,"_width",Kt,g(e)),b(e,"_rotation",Yt,g(e)),e._model=null,e._mesh=null,e._material=null,e._uniform=new M(1,1,0,0),e}n(e,t);var i=e.prototype;return i.onLoad=function(){this.createModel()},i.onEnable=function(){this.attachToScene(),this._model.enabled=!0,this.width=this._width,this.height=this._height,this.rotation=this.rotation,this.texture=this.texture},i.onDisable=function(){this.detachFromScene()},i.attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this.detachFromScene(),this._getRenderScene().addModel(this._model))},i.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i.createModel=function(){this._mesh=Pt({primitiveMode:o.TRIANGLE_LIST,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[s.WHITE.r,s.WHITE.g,s.WHITE.b,s.WHITE.a,s.WHITE.r,s.WHITE.g,s.WHITE.b,s.WHITE.a,s.WHITE.r,s.WHITE.g,s.WHITE.b,s.WHITE.a,s.WHITE.r,s.WHITE.g,s.WHITE.b,s.WHITE.a],attributes:[new l(u.ATTR_POSITION,h.RGB32F),new l(u.ATTR_TEX_COORD,h.RG32F),new l(u.ATTR_COLOR,h.RGBA8UI,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});var t=this._model=c.director.root.createModel(Rt,this.node);t.node=t.transform=this.node,null==this._material&&(this._material=new _,this._material.copy(d.get("default-billboard-material"))),t.initSubModel(0,this._mesh.renderingSubMeshes[0],this._material)},p(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._material&&this._material.setProperty("mainTexture",t)}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._material&&(this._uniform.y=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._material&&(this._uniform.x=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"rotation",get:function(){return Math.round(100*w(this._rotation))/100},set:function(t){this._rotation=S(t),this._material&&(this._uniform.z=this._rotation,this._material.setProperty("cc_size_rotation",this._uniform))}}]),e}(T),Xt=f((Wt=Zt).prototype,"_texture",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Wt.prototype,"texture",[Ut,Vt],Object.getOwnPropertyDescriptor(Wt.prototype,"texture"),Wt.prototype),jt=f(Wt.prototype,"_height",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(Wt.prototype,"height",[Ht],Object.getOwnPropertyDescriptor(Wt.prototype,"height"),Wt.prototype),Kt=f(Wt.prototype,"_width",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(Wt.prototype,"width",[kt],Object.getOwnPropertyDescriptor(Wt.prototype,"width"),Wt.prototype),Yt=f(Wt.prototype,"_rotation",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(Wt.prototype,"rotation",[Nt],Object.getOwnPropertyDescriptor(Wt.prototype,"rotation"),Wt.prototype),Gt=Wt))||Gt)||Gt)||Gt)||Gt,t({Billboard:qt,BillboardComponent:qt}),qt),Ce=[new l(u.ATTR_POSITION,h.RGB32F),new l(u.ATTR_TEX_COORD,h.RGBA32F),new l(u.ATTR_TEX_COORD1,h.RGB32F),new l(u.ATTR_COLOR,h.RGBA8,!0)],Ae=new O,Pe=new O,De=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=null,e._vertCount=0,e._indexCount=0,e._material=null,e.type=Et.LINE,e._capacity=100,e._iaInfo=new D([new F]),e._iaInfoBuffer=e._device.createBuffer(new E(C.INDIRECT,A.DEVICE,I,I)),e}n(e,t);var i=e.prototype;return i.setCapacity=function(t){this._capacity=t,this.createBuffer()},i.createBuffer=function(){this._vertSize=0;for(var t,e=z(Ce);!(t=e()).done;){var i=t.value;i.offset=this._vertSize,this._vertSize+=R[i.format].size}this._vertAttrsFloatCount=this._vertSize/4,this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.updateMaterial=function(e){this._material=e,t.prototype.setSubModelMaterial.call(this,0,e)},i.createSubMeshData=function(){this._subMeshData&&this.destroySubMeshData(),this._vertCount=2,this._indexCount=6;var t=this._device.createBuffer(new E(C.VERTEX|C.TRANSFER_DST,A.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);t.update(e);for(var i=new Uint16Array((this._capacity-1)*this._indexCount),r=0,a=0;a<this._capacity-1;++a){var n=2*a;i[r++]=n,i[r++]=n+1,i[r++]=n+2,i[r++]=n+3,i[r++]=n+2,i[r++]=n+1}var s=this._device.createBuffer(new E(C.INDEX|C.TRANSFER_DST,A.DEVICE,(this._capacity-1)*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return s.update(i),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=(this._capacity-1)*this._indexCount,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new P([t],Ce,o.TRIANGLE_LIST,s,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.addLineVertexData=function(t,e,i){if(t.length>1){var r=0;O.subtract(Ae,t[1],t[0]),this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=0,this._vdataF32[r++]=Ae.x,this._vdataF32[r++]=Ae.y,this._vdataF32[r++]=Ae.z,this._vdataUint32[r++]=i.evaluate(0,1)._val,this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=1,this._vdataF32[r++]=Ae.x,this._vdataF32[r++]=Ae.y,this._vdataF32[r++]=Ae.z,this._vdataUint32[r++]=i.evaluate(0,1)._val;for(var a=1;a<t.length-1;a++){O.subtract(Ae,t[a-1],t[a]),O.subtract(Pe,t[a+1],t[a]),O.subtract(Pe,Pe,Ae);var n=a/t.length;this._vdataF32[r++]=t[a].x,this._vdataF32[r++]=t[a].y,this._vdataF32[r++]=t[a].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(n,1),this._vdataF32[r++]=n,this._vdataF32[r++]=0,this._vdataF32[r++]=Pe.x,this._vdataF32[r++]=Pe.y,this._vdataF32[r++]=Pe.z,this._vdataUint32[r++]=i.evaluate(n,1)._val,this._vdataF32[r++]=t[a].x,this._vdataF32[r++]=t[a].y,this._vdataF32[r++]=t[a].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(n,1),this._vdataF32[r++]=n,this._vdataF32[r++]=1,this._vdataF32[r++]=Pe.x,this._vdataF32[r++]=Pe.y,this._vdataF32[r++]=Pe.z,this._vdataUint32[r++]=i.evaluate(n,1)._val}O.subtract(Ae,t[t.length-1],t[t.length-2]),this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=0,this._vdataF32[r++]=Ae.x,this._vdataF32[r++]=Ae.y,this._vdataF32[r++]=Ae.z,this._vdataUint32[r++]=i.evaluate(1,1)._val,this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=1,this._vdataF32[r++]=Ae.x,this._vdataF32[r++]=Ae.y,this._vdataF32[r++]=Ae.z,this._vdataUint32[r++]=i.evaluate(1,1)._val}this.updateIA(Math.max(0,t.length-1))},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(Rt),Fe=[["mode","constant","multiplier"],["mode","spline","multiplier"],["mode","splineMin","splineMax","multiplier"],["mode","constantMin","constantMax","multiplier"]],Ie=B({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),Be=t("CurveRange",(Qt=e("cc.CurveRange"),Jt=i(Ie),$t=i(L),te=i(L),ee=i(L),Qt((de=_e=function(){function t(){b(this,"mode",ae,this),b(this,"spline",ne,this),b(this,"splineMin",oe,this),b(this,"splineMax",se,this),b(this,"constant",le,this),b(this,"constantMin",ue,this),b(this,"constantMax",he,this),b(this,"multiplier",ce,this),this._curve=new V(this.spline),this._curveMin=new V(this.splineMin),this._curveMax=new V(this.splineMax)}var e=t.prototype;return e.evaluate=function(t,e){switch(this.mode){default:case Ie.Constant:return this.constant;case Ie.Curve:return this.spline.evaluate(t)*this.multiplier;case Ie.TwoCurves:return U(this.splineMin.evaluate(t),this.splineMax.evaluate(t),e)*this.multiplier;case Ie.TwoConstants:return U(this.constantMin,this.constantMax,e)}},e.getMax=function(){switch(this.mode){default:case Ie.Constant:return this.constant;case Ie.Curve:return this.multiplier;case Ie.TwoConstants:return this.constantMax;case Ie.TwoCurves:return this.multiplier}},e._onBeforeSerialize=function(){return Fe[this.mode]},p(t,[{key:"curve",get:function(){return this._curve},set:function(t){this._curve=t,this.spline=t._internalCurve}},{key:"curveMin",get:function(){return this._curveMin},set:function(t){this._curveMin=t,this.splineMin=t._internalCurve}},{key:"curveMax",get:function(){return this._curveMax},set:function(t){this._curveMax=t,this.splineMax=t._internalCurve}}]),t}(),_e.Mode=Ie,ae=f((re=de).prototype,"mode",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ie.Constant}}),ne=f(re.prototype,"spline",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H()}}),oe=f(re.prototype,"splineMin",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H()}}),se=f(re.prototype,"splineMax",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return H()}}),le=f(re.prototype,"constant",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ue=f(re.prototype,"constantMin",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),he=f(re.prototype,"constantMax",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ce=f(re.prototype,"multiplier",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ie=re))||ie));function Le(t,e,i){switch(t.mode){case Ie.Constant:return t.constant;case Ie.Curve:return t.spline.evaluate(e)*t.multiplier;case Ie.TwoCurves:return 0===i?t.splineMin.evaluate(e)*t.multiplier:t.splineMax.evaluate(e)*t.multiplier;case Ie.TwoConstants:return 0===i?t.constantMin:t.constantMax;default:return 0}}function Ue(t){switch(t.mode){case Ie.TwoConstants:case Ie.TwoCurves:return 2;default:return 1}}function Ve(t,e,i){var a=new N({width:e,height:i,_data:t,_compressed:!1,format:G.RGBA32F}),n=new r;return n.setFilters(W.NEAREST,W.NEAREST),n.setMipFilter(W.NONE),n.setWrapMode(X.CLAMP_TO_EDGE,X.CLAMP_TO_EDGE,X.CLAMP_TO_EDGE),n.image=a,n}function He(t,e,i,r,a){for(var n=Math.max(Ue(e),Ue(i),Ue(r)),o=new Float32Array(t*n*4),s=[e,i,r],l=1/(t-1),u=0;u<n;u++)for(var h=0;h<3;h++)for(var c=s[h],_=0,d=0,p=0;p<t;p++){var f=Le(c,l*p,u);d=a?f:(_+=f)/(p+1),o[4*p+h]=d}return Ve(o,t,n)}var ke,Ne,Ge,We,Xe,je,Ke,Ye,Ze,qe,Qe,Je,$e,ti,ei,ii,ri,ai,ni,oi,si,li,ui,hi,ci,_i,di,pi,fi,mi,yi,vi,bi,gi,Mi,wi,Si,Ti,xi,Oi,zi,Ri,Ei,Ci,Ai,Pi,Di,Fi,Ii,Bi,Li,Ui,Vi,Hi,ki,Ni=B({Blend:0,Fixed:1}),Gi=(t("ColorKey",e("cc.ColorKey")((me=f((fe=function(){b(this,"color",me,this),b(this,"time",ye,this)}).prototype,"color",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.WHITE.clone()}}),ye=f(fe.prototype,"time",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pe=fe))||pe),t("AlphaKey",e("cc.AlphaKey")((ge=f((be=function(){b(this,"alpha",ge,this),b(this,"time",Me,this)}).prototype,"alpha",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Me=f(be.prototype,"time",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ve=be))||ve),t("Gradient",e("cc.Gradient")((Re=ze=function(){function t(){b(this,"colorKeys",Te,this),b(this,"alphaKeys",xe,this),b(this,"mode",Oe,this),this._color=void 0,this._color=s.WHITE.clone()}var e=t.prototype;return e.setKeys=function(t,e){this.colorKeys=t,this.alphaKeys=e},e.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,e){return t.time-e.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,e){return t.time-e.time}))},e.evaluate=function(t){return this.getRGB(t),this._color._set_a_unsafe(this.getAlpha(t)),this._color},e.randomColor=function(){var t=this.colorKeys[Math.trunc(Math.random()*this.colorKeys.length)],e=this.alphaKeys[Math.trunc(Math.random()*this.alphaKeys.length)];return this._color.set(t.color),this._color._set_a_unsafe(e.alpha),this._color},e.getRGB=function(t){if(!(this.colorKeys.length>1))return 1===this.colorKeys.length?(this._color.set(this.colorKeys[0].color),this._color):(this._color.set(s.WHITE),this._color);t=j(t,1);for(var e=1;e<this.colorKeys.length;++e){var i=this.colorKeys[e-1].time,r=this.colorKeys[e].time;if(t>=i&&t<r){if(this.mode===Ni.Fixed)return this.colorKeys[e].color;var a=(t-i)/(r-i);return s.lerp(this._color,this.colorKeys[e-1].color,this.colorKeys[e].color,a),this._color}}var n=this.colorKeys.length-1;t<this.colorKeys[0].time?s.lerp(this._color,s.BLACK,this.colorKeys[0].color,t/this.colorKeys[0].time):t>this.colorKeys[n].time&&s.lerp(this._color,this.colorKeys[n].color,s.BLACK,(t-this.colorKeys[n].time)/(1-this.colorKeys[n].time))},e.getAlpha=function(t){if(!(this.alphaKeys.length>1))return 1===this.alphaKeys.length?this.alphaKeys[0].alpha:255;t=j(t,1);for(var e=1;e<this.alphaKeys.length;++e){var i=this.alphaKeys[e-1].time,r=this.alphaKeys[e].time;if(t>=i&&t<r){if(this.mode===Ni.Fixed)return this.alphaKeys[e].alpha;var a=(t-i)/(r-i);return U(this.alphaKeys[e-1].alpha,this.alphaKeys[e].alpha,a)}}var n=this.alphaKeys.length-1;return t<this.alphaKeys[0].time?U(0,this.alphaKeys[0].alpha,t/this.alphaKeys[0].time):t>this.alphaKeys[n].time?U(this.alphaKeys[n].alpha,0,(t-this.alphaKeys[n].time)/(1-this.alphaKeys[n].time)):void 0},t}(),ze.Mode=Ni,Te=f((Se=Re).prototype,"colorKeys",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),xe=f(Se.prototype,"alphaKeys",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),Oe=f(Se.prototype,"mode",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ni.Blend}}),we=Se))||we)),Wi=K,Xi=B({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),ji=t("GradientRange",(ke=e("cc.GradientRange"),Ne=i(Xi),Ge=i(Gi),We=i(Gi),Xe=i(Gi),je=i(Xi),ke((ri=ii=function(){function t(){b(this,"color",Ze,this),b(this,"colorMin",qe,this),b(this,"colorMax",Qe,this),b(this,"gradient",Je,this),b(this,"gradientMin",$e,this),b(this,"gradientMax",ti,this),b(this,"_mode",ei,this),this._color=s.WHITE.clone()}var e=t.prototype;return e.evaluate=function(t,e){switch(this._mode){case Xi.Color:return this.color;case Xi.TwoColors:return s.lerp(this._color,this.colorMin,this.colorMax,e),this._color;case Xi.RandomColor:return this.gradient.randomColor();case Xi.Gradient:return this.gradient.evaluate(t);case Xi.TwoGradients:return s.lerp(this._color,this.gradientMin.evaluate(t),this.gradientMax.evaluate(t),e),this._color;default:return this.color}},e._onBeforeSerialize=function(){return Wi[this._mode]},p(t,[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}]),t}(),ii.Mode=Xi,f((Ye=ri).prototype,"mode",[Ne],Object.getOwnPropertyDescriptor(Ye.prototype,"mode"),Ye.prototype),Ze=f(Ye.prototype,"color",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.WHITE.clone()}}),qe=f(Ye.prototype,"colorMin",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.WHITE.clone()}}),Qe=f(Ye.prototype,"colorMax",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.WHITE.clone()}}),Je=f(Ye.prototype,"gradient",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gi}}),$e=f(Ye.prototype,"gradientMin",[We],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gi}}),ti=f(Ye.prototype,"gradientMax",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gi}}),ei=f(Ye.prototype,"_mode",[je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xi.Color}}),Ke=Ye))||Ke));function Ki(t,e,i){switch(t.mode){case Xi.Color:return t.color;case Xi.TwoColors:return 0===i?t.colorMin:t.colorMax;case Xi.RandomColor:return t.gradient.randomColor();case Xi.Gradient:return t.gradient.evaluate(e);case Xi.TwoGradients:return 0===i?t.gradientMin.evaluate(e):t.gradientMax.evaluate(e);default:return t.color}}var Yi={parent:null,owner:null,subModelIdx:0},Zi={CC_USE_WORLD_SPACE:!1},qi=function(e){return t({Line:e,LineComponent:e}),e}((ai=e("cc.Line"),ni=m(),oi=y(),si=i(r),li=i(r),ui=Z(),hi=v(),ci=Z(),_i=v(),di=i([O]),pi=i([O]),fi=Z(),mi=v(),yi=i(Be),vi=i(Be),bi=q(),gi=Z(),Mi=v(),wi=i(Y),Si=Z(),Ti=v(),xi=i(Y),Oi=Z(),zi=v(),Ri=i(ji),Ei=i(ji),Ci=Z(),Ai=v(),ai(Pi=ni(Pi=oi(Pi=a((ki=function(t){function e(){var e;return e=t.call(this)||this,b(e,"_texture",Fi,g(e)),e._material=null,e._materialInstance=null,b(e,"_worldSpace",Ii,g(e)),b(e,"_positions",Bi,g(e)),b(e,"_width",Li,g(e)),b(e,"_tile",Ui,g(e)),b(e,"_offset",Vi,g(e)),b(e,"_color",Hi,g(e)),e._model=null,e._tile_offset=new M,e}n(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._model=c.director.root.createModel(De);t.node=t.transform=this.node,null===this._material&&(this._material=new _,this._material.copy(d.get("default-trail-material")),Zi.CC_USE_WORLD_SPACE=this.worldSpace,Yi.parent=this._material,Yi.subModelIdx=0,this._materialInstance=new Ct(Yi),Yi.parent=null,Yi.subModelIdx=0,this._materialInstance.recompileShaders(Zi)),t.updateMaterial(this._materialInstance),t.setCapacity(100)},i.onEnable=function(){this._model&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._model.addLineVertexData(this._positions,this._width,this._color))},i.onDisable=function(){this._model&&this._detachFromScene()},i._attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this._detachFromScene(),this._getRenderScene().addModel(this._model))},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},p(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._materialInstance&&this._materialInstance.setProperty("mainTexture",t)}},{key:"worldSpace",get:function(){return this._worldSpace},set:function(t){this._worldSpace=t,this._materialInstance&&(Zi.CC_USE_WORLD_SPACE=this.worldSpace,this._materialInstance.recompileShaders(Zi),this._model&&this._model.setSubModelMaterial(0,this._materialInstance))}},{key:"positions",get:function(){return this._positions},set:function(t){this._positions=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"tile",get:function(){return this._tile},set:function(t){this._tile.set(t),this._materialInstance&&(this._tile_offset.x=this._tile.x,this._tile_offset.y=this._tile.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this._materialInstance&&(this._tile_offset.z=this._offset.x,this._tile_offset.w=this._offset.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}}]),e}(T),Fi=f((Di=ki).prototype,"_texture",[si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Di.prototype,"texture",[li,ui,hi],Object.getOwnPropertyDescriptor(Di.prototype,"texture"),Di.prototype),Ii=f(Di.prototype,"_worldSpace",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(Di.prototype,"worldSpace",[ci,_i],Object.getOwnPropertyDescriptor(Di.prototype,"worldSpace"),Di.prototype),Bi=f(Di.prototype,"_positions",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f(Di.prototype,"positions",[pi,fi,mi],Object.getOwnPropertyDescriptor(Di.prototype,"positions"),Di.prototype),Li=f(Di.prototype,"_width",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),f(Di.prototype,"width",[vi,bi,gi,Mi],Object.getOwnPropertyDescriptor(Di.prototype,"width"),Di.prototype),Ui=f(Di.prototype,"_tile",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Y(1,1)}}),f(Di.prototype,"tile",[wi,Si,Ti],Object.getOwnPropertyDescriptor(Di.prototype,"tile"),Di.prototype),Vi=f(Di.prototype,"_offset",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Y(0,0)}}),f(Di.prototype,"offset",[xi,Oi,zi],Object.getOwnPropertyDescriptor(Di.prototype,"offset"),Di.prototype),Hi=f(Di.prototype,"_color",[Ri],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ji}}),f(Di.prototype,"color",[Ei,Ci,Ai],Object.getOwnPropertyDescriptor(Di.prototype,"color"),Di.prototype),Pi=Di))||Pi)||Pi)||Pi)||Pi)),Qi=function(){function t(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startEuler=void 0,this.startRotation=void 0,this.startRotated=void 0,this.deltaQuat=void 0,this.deltaMat=void 0,this.localMat=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.loopCount=void 0,this.lastLoop=void 0,this.trailDelay=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new O(0,0,0),this.velocity=new O(0,0,0),this.animatedVelocity=new O(0,0,0),this.ultimateVelocity=new O(0,0,0),this.angularVelocity=new O(0,0,0),this.axisOfRotation=new O(0,0,0),this.rotation=new O(0,0,0),this.startEuler=new O(0,0,0),this.startRotation=new Q,this.startRotated=!1,this.deltaQuat=new Q,this.deltaMat=new J,this.localMat=new J,this.startSize=new O(0,0,0),this.size=new O(0,0,0),this.startColor=s.WHITE.clone(),this.color=s.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.loopCount=0,this.lastLoop=0,this.trailDelay=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0}return t.prototype.reset=function(){this.rotation.set(0,0,0),this.startEuler.set(0,0,0),this.startRotation.set(0,0,0,1),this.startRotated=!1,this.deltaQuat.set(0,0,0,1),this.deltaMat.identity(),this.localMat.identity()},t}();Qi.INDENTIFY_NEG_QUAT=10,Qi.R2D=180/Math.PI;var Ji,$i,tr,er,ir,rr,ar,nr,or,sr,lr,ur,hr,cr,_r,dr,pr,fr,mr,yr,vr,br,gr,Mr,wr,Sr,Tr,xr,Or,zr,Rr,Er,Cr,Ar,Pr="colorModule",Dr="rotationModule",Fr="sizeModule",Ir="textureModule",Br=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule"],Lr=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_trailModule"],Ur=function(){function t(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}var e=t.prototype;return e.bindTarget=function(t){this.target=t},e.update=function(){},t}(),Vr=B({World:0,Local:1,Custom:2}),Hr=B({Pause:0,PauseAndCatchup:1,AlwaysSimulate:2}),kr=B({World:0,Local:1,View:2}),Nr=B({Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4}),Gr=B({Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4}),Wr=B({Base:0,Edge:1,Shell:2,Volume:3}),Xr=B({Random:0,Loop:1,PingPong:2}),jr=B({Particles:0}),Kr=B({Stretch:0}),Yr=(Ji=e("cc.ColorOvertimeModule"),$i=Z(),tr=i(ji),er=Z(),Ji((or=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,b(e,"_enable",ar,g(e)),b(e,"color",nr,g(e)),e.name=Pr,e}return n(e,t),e.prototype.animate=function(t){t.color.set(t.startColor),t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,$(t.randomSeed+91041)))},p(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(Ur),ar=f((rr=or).prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(rr.prototype,"enable",[$i],Object.getOwnPropertyDescriptor(rr.prototype,"enable"),rr.prototype),nr=f(rr.prototype,"color",[tr,x,er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ji}}),ir=rr))||ir),Zr=new O(0,0,-1);function qr(t,e,i,r){return e!==t?(t===Vr.World||J.invert(i,i),J.getRotation(r,i),!0):(Q.set(r,0,0,0,1),!1)}function Qr(t,e){Y.set(t,Math.cos(e),Math.sin(e))}function Jr(t){var e=et(-1,1),i=et(0,2*Math.PI),r=Math.sqrt(1-e*e),a=r*Math.cos(i),n=r*Math.sin(i);O.set(t,a,n,e)}function $r(t,e,i){Jr(t),O.multiplyScalar(t,t,e+(i-e)*tt())}function ta(t,e,i,r){Qr(t,r),t.z=0,O.multiplyScalar(t,t,e+(i-e)*tt())}function ea(t){for(var e=0;e<t.length;e++){var i=e+it(0,t.length-e),r=t[i];t[i]=t[e],t[e]=r}}function ia(){var t=et(-1,1);return 0===t&&t++,rt(t)}var ra,aa,na,oa,sa,la,ua,ha,ca,_a,da,pa,fa,ma,ya,va,ba,ga,Ma,wa,Sa,Ta,xa,Oa,za,Ra,Ea,Ca,Aa,Pa,Da,Fa,Ia,Ba,La,Ua,Va,Ha,ka,Na,Ga,Wa,Xa,ja,Ka,Ya,Za,qa,Qa,Ja,$a,tn,en,rn,an,nn,on,sn,ln,un,hn=212165,cn=new O,_n=(sr=e("cc.ForceOvertimeModule"),lr=Z(),ur=i(Be),hr=q(),cr=Z(),_r=v(),dr=i(Be),pr=q(),fr=Z(),mr=v(),yr=i(Be),vr=q(),br=Z(),gr=v(),Mr=i(Vr),wr=Z(),Sr=v(),sr((Ar=function(t){function e(){var e;return e=t.call(this)||this,b(e,"_enable",Or,g(e)),b(e,"x",zr,g(e)),b(e,"y",Rr,g(e)),b(e,"z",Er,g(e)),b(e,"space",Cr,g(e)),e.randomized=!1,e.rotation=void 0,e.needTransform=void 0,e.name="forceModule",e.rotation=new Q,e.needTransform=!1,e.needUpdate=!0,e}n(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=qr(t,this.space,e,this.rotation)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,r=O.set(cn,this.x.evaluate(i,$(t.randomSeed+hn)),this.y.evaluate(i,$(t.randomSeed+hn)),this.z.evaluate(i,$(t.randomSeed+hn)));this.needTransform&&O.transformQuat(r,r,this.rotation),O.scaleAndAdd(t.velocity,t.velocity,r,e),O.copy(t.ultimateVelocity,t.velocity)},p(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(Ur),Or=f((xr=Ar).prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(xr.prototype,"enable",[lr],Object.getOwnPropertyDescriptor(xr.prototype,"enable"),xr.prototype),zr=f(xr.prototype,"x",[ur,x,hr,cr,_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Rr=f(xr.prototype,"y",[dr,x,pr,fr,mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Er=f(xr.prototype,"z",[yr,x,vr,br,gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Cr=f(xr.prototype,"space",[Mr,x,wr,Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vr.Local}}),Tr=xr))||Tr),dn=23541,pn=new O,fn=new O,mn=(ra=e("cc.LimitVelocityOvertimeModule"),aa=Z(),na=i(Be),oa=q(),sa=Z(),la=v(),ua=i(Be),ha=q(),ca=Z(),_a=v(),da=i(Be),pa=q(),fa=Z(),ma=v(),ya=i(Be),va=q(),ba=Z(),ga=v(),Ma=Z(),wa=v(),Sa=Z(),Ta=v(),xa=i(Vr),Oa=Z(),za=v(),ra((Ua=function(t){function e(){var e;return e=t.call(this)||this,b(e,"_enable",Ca,g(e)),b(e,"limitX",Aa,g(e)),b(e,"limitY",Pa,g(e)),b(e,"limitZ",Da,g(e)),b(e,"limit",Fa,g(e)),b(e,"dampen",Ia,g(e)),b(e,"separateAxes",Ba,g(e)),b(e,"space",La,g(e)),e.drag=null,e.multiplyDragByParticleSize=!1,e.multiplyDragByParticleVelocity=!1,e.name="limitModule",e.rotation=void 0,e.needTransform=void 0,e.rotation=new Q,e.needTransform=!1,e.needUpdate=!0,e}n(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=qr(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=pn;this.separateAxes?(O.set(fn,this.limitX.evaluate(e,$(t.randomSeed+dn)),this.limitY.evaluate(e,$(t.randomSeed+dn)),this.limitZ.evaluate(e,$(t.randomSeed+dn))),this.needTransform&&O.transformQuat(fn,fn,this.rotation),O.set(i,yn(t.ultimateVelocity.x,fn.x,this.dampen),yn(t.ultimateVelocity.y,fn.y,this.dampen),yn(t.ultimateVelocity.z,fn.z,this.dampen))):(O.normalize(i,t.ultimateVelocity),O.multiplyScalar(i,i,yn(t.ultimateVelocity.length(),this.limit.evaluate(e,$(t.randomSeed+dn)),this.dampen))),O.copy(t.ultimateVelocity,i)},p(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(Ur),Ca=f((Ea=Ua).prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(Ea.prototype,"enable",[aa],Object.getOwnPropertyDescriptor(Ea.prototype,"enable"),Ea.prototype),Aa=f(Ea.prototype,"limitX",[na,x,oa,sa,la],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Pa=f(Ea.prototype,"limitY",[ua,x,ha,ca,_a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Da=f(Ea.prototype,"limitZ",[da,x,pa,fa,ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Fa=f(Ea.prototype,"limit",[ya,x,va,ba,ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Ia=f(Ea.prototype,"dampen",[x,Ma,wa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),Ba=f(Ea.prototype,"separateAxes",[x,Sa,Ta],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),La=f(Ea.prototype,"space",[xa,x,Oa,za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vr.Local}}),Ra=Ea))||Ra);function yn(t,e,i){var r=Math.sign(t),a=Math.abs(t);return a>e&&(a=U(a,e,i)),a*r}var vn,bn,gn,Mn,wn,Sn,Tn,xn,On,zn,Rn,En,Cn,An,Pn,Dn,Fn,In,Bn,Ln,Un,Vn,Hn,kn,Nn,Gn,Wn,Xn,jn,Kn,Yn,Zn,qn,Qn,Jn,$n,to,eo,io,ro,ao,no,oo,so,lo,uo,ho,co,_o,po,fo,mo,yo,vo,bo,go,Mo,wo,So,To,xo,Oo,zo,Ro,Eo,Co,Ao,Po,Do,Fo,Io,Bo,Lo,Uo,Vo,Ho,ko,No,Go,Wo,Xo,jo,Ko,Yo,Zo,qo,Qo,Jo,$o,ts,es,is,rs,as,ns,os,ss,ls,us,hs,cs,_s,ds,ps,fs,ms,ys,vs,bs,gs,Ms,ws,Ss,Ts,xs,Os,zs,Rs,Es,Cs,As,Ps,Ds,Fs,Is,Bs,Ls,Us,Vs,Hs,ks,Ns,Gs,Ws,Xs,js,Ks,Ys,Zs,qs,Qs,Js,$s,tl,el,il,rl,al,nl,ol,sl,ll,ul,hl,cl,_l,dl,pl,fl,ml,yl,vl,bl,gl,Ml,wl,Sl,Tl,xl,Ol,zl,Rl,El,Cl,Al,Pl,Dl,Fl,Il,Bl,Ll,Ul,Vl,Hl=(Va=e("cc.RotationOvertimeModule"),Ha=Z(),ka=Z(),Na=v(),Ga=i(Be),Wa=q(),Xa=Z(),ja=v(),Ka=i(Be),Ya=q(),Za=Z(),qa=v(),Qa=i(Be),Ja=q(),$a=Z(),tn=v(),Va((un=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,b(e,"_enable",an,g(e)),b(e,"_separateAxes",nn,g(e)),b(e,"x",on,g(e)),b(e,"y",sn,g(e)),b(e,"z",ln,g(e)),e.name=Dr,e._startMat=new J,e._matRot=new J,e._quatRot=new Q,e._otherEuler=new O,e}n(e,t);var i=e.prototype;return i._processRotation=function(t){var e=t.particleSystem.processor.getInfo().renderMode;e!==Nr.Mesh&&e===Nr.StrecthedBillboard&&this._quatRot.set(0,0,0,1),Q.normalize(this._quatRot,this._quatRot),this._quatRot.w<0&&(this._quatRot.x+=Qi.INDENTIFY_NEG_QUAT)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,r=$(t.randomSeed+125292),a=t.particleSystem.processor.getInfo().renderMode;this._separateAxes&&a!==Nr.VerticalBillboard&&a!==Nr.HorizontalBillboard?Q.fromEuler(t.deltaQuat,this.x.evaluate(i,r)*e*Qi.R2D,this.y.evaluate(i,r)*e*Qi.R2D,this.z.evaluate(i,r)*e*Qi.R2D):Q.fromEuler(t.deltaQuat,0,0,this.z.evaluate(i,r)*e*Qi.R2D),t.deltaMat=J.fromQuat(t.deltaMat,t.deltaQuat),t.localMat=t.localMat.multiply(t.deltaMat),t.startRotated||(a!==Nr.Mesh&&(a===Nr.StrecthedBillboard?t.startEuler.set(0,0,0):a!==Nr.Billboard&&t.startEuler.set(0,0,t.startEuler.z)),Q.fromEuler(t.startRotation,t.startEuler.x*Qi.R2D,t.startEuler.y*Qi.R2D,t.startEuler.z*Qi.R2D),t.startRotated=!0),this._startMat=J.fromQuat(this._startMat,t.startRotation),this._matRot=this._startMat.multiply(t.localMat),J.getRotation(this._quatRot,this._matRot),this._processRotation(t,Qi.R2D),t.rotation.set(this._quatRot.x,this._quatRot.y,this._quatRot.z)},p(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}]),e}(Ur),an=f((rn=un).prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(rn.prototype,"enable",[Ha],Object.getOwnPropertyDescriptor(rn.prototype,"enable"),rn.prototype),nn=f(rn.prototype,"_separateAxes",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(rn.prototype,"separateAxes",[ka,Na],Object.getOwnPropertyDescriptor(rn.prototype,"separateAxes"),rn.prototype),on=f(rn.prototype,"x",[Ga,x,Wa,at,Xa,ja],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),sn=f(rn.prototype,"y",[Ka,x,Ya,at,Za,qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),ln=f(rn.prototype,"z",[Qa,x,Ja,at,$a,tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),en=rn))||en),kl=(vn=e("cc.SizeOvertimeModule"),bn=Z(),gn=Z(),Mn=v(),wn=i(Be),Sn=q(),Tn=Z(),xn=v(),On=i(Be),zn=q(),Rn=Z(),En=v(),Cn=i(Be),An=q(),Pn=Z(),Dn=v(),Fn=i(Be),In=q(),Bn=Z(),Ln=v(),vn((jn=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,b(e,"_enable",Hn,g(e)),b(e,"separateAxes",kn,g(e)),b(e,"size",Nn,g(e)),b(e,"x",Gn,g(e)),b(e,"y",Wn,g(e)),b(e,"z",Xn,g(e)),e.name=Fr,e}return n(e,t),e.prototype.animate=function(t){if(this.separateAxes){var e=1-t.remainingLifetime/t.startLifetime,i=$(t.randomSeed+39825);t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,i),t.size.z=t.startSize.z*this.z.evaluate(e,i)}else O.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,$(t.randomSeed+39825)))},p(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(Ur),Hn=f((Vn=jn).prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(Vn.prototype,"enable",[bn],Object.getOwnPropertyDescriptor(Vn.prototype,"enable"),Vn.prototype),kn=f(Vn.prototype,"separateAxes",[x,gn,Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Nn=f(Vn.prototype,"size",[wn,x,Sn,Tn,xn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Gn=f(Vn.prototype,"x",[On,x,zn,Rn,En],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Wn=f(Vn.prototype,"y",[Cn,x,An,Pn,Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Xn=f(Vn.prototype,"z",[Fn,x,In,Bn,Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Un=Vn))||Un),Nl=90794,Gl=B({Grid:0}),Wl=B({WholeSheet:0,SingleRow:1}),Xl=(Kn=e("cc.TextureAnimationModule"),Yn=nt("numTilesX"),Zn=nt("numTilesY"),qn=Z(),Qn=i(Gl),Jn=i(Gl),$n=Z(),to=v(),eo=Z(),io=v(),ro=Z(),ao=v(),no=i(Wl),oo=Z(),so=v(),lo=i(Be),uo=q(),ho=Z(),co=v(),_o=i(Be),po=q(),fo=Z(),mo=v(),yo=Z(),vo=v(),bo=Z(),go=v(),Mo=Z(),wo=v(),Kn((Uo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,b(e,"_enable",xo,g(e)),b(e,"_numTilesX",Oo,g(e)),b(e,"_numTilesY",zo,g(e)),b(e,"_mode",Ro,g(e)),b(e,"animation",Eo,g(e)),b(e,"frameOverTime",Co,g(e)),b(e,"startFrame",Ao,g(e)),b(e,"cycleCount",Po,g(e)),b(e,"_flipU",Do,g(e)),b(e,"_flipV",Fo,g(e)),b(e,"_uvChannelMask",Io,g(e)),b(e,"randomRow",Bo,g(e)),b(e,"rowIndex",Lo,g(e)),e.name=Ir,e}n(e,t);var i=e.prototype;return i.init=function(t){t.startRow=Math.floor(Math.random()*this.numTilesY)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=this.startFrame.evaluate(e,$(t.randomSeed+Nl))/(this.numTilesX*this.numTilesY);if(this.animation===Wl.WholeSheet)t.frameIndex=j(this.cycleCount*(this.frameOverTime.evaluate(e,$(t.randomSeed+Nl))+i),1);else if(this.animation===Wl.SingleRow){var r=1/this.numTilesY;if(this.randomRow){var a=j(this.cycleCount*(this.frameOverTime.evaluate(e,$(t.randomSeed+Nl))+i),1),n=t.startRow*r,o=n+r;t.frameIndex=U(n,o,a)}else{var s=this.rowIndex*r,l=s+r;t.frameIndex=U(s,l,j(this.cycleCount*(this.frameOverTime.evaluate(e,$(t.randomSeed+Nl))+i),1))}}},p(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}},{key:"mode",get:function(){return this._mode},set:function(t){t!==Gl.Grid&&console.error("particle texture animation's sprites is not supported!")}},{key:"numTilesX",get:function(){return this._numTilesX},set:function(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}},{key:"numTilesY",get:function(){return this._numTilesY},set:function(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}},{key:"flipU",get:function(){return this._flipU},set:function(){console.error("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(){console.error("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(){console.error("particle texture animation's uvChannelMask is not supported!")}}]),e}(Ur),xo=f((To=Uo).prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Oo=f(To.prototype,"_numTilesX",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zo=f(To.prototype,"_numTilesY",[Zn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(To.prototype,"enable",[qn],Object.getOwnPropertyDescriptor(To.prototype,"enable"),To.prototype),Ro=f(To.prototype,"_mode",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gl.Grid}}),f(To.prototype,"mode",[Jn,$n,to],Object.getOwnPropertyDescriptor(To.prototype,"mode"),To.prototype),f(To.prototype,"numTilesX",[eo,io],Object.getOwnPropertyDescriptor(To.prototype,"numTilesX"),To.prototype),f(To.prototype,"numTilesY",[ro,ao],Object.getOwnPropertyDescriptor(To.prototype,"numTilesY"),To.prototype),Eo=f(To.prototype,"animation",[no,x,oo,so],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wl.WholeSheet}}),Co=f(To.prototype,"frameOverTime",[lo,x,uo,ho,co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Ao=f(To.prototype,"startFrame",[_o,x,po,fo,mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Po=f(To.prototype,"cycleCount",[x,yo,vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Do=f(To.prototype,"_flipU",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fo=f(To.prototype,"_flipV",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Io=f(To.prototype,"_uvChannelMask",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Bo=f(To.prototype,"randomRow",[x,bo,go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Lo=f(To.prototype,"rowIndex",[x,Mo,wo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),So=To))||So),jl=197866,Kl=new O,Yl=(Vo=e("cc.VelocityOvertimeModule"),Ho=Z(),ko=i(Be),No=q(),Go=Z(),Wo=v(),Xo=i(Be),jo=q(),Ko=Z(),Yo=v(),Zo=i(Be),qo=q(),Qo=Z(),Jo=v(),$o=i(Be),ts=q(),es=Z(),is=v(),rs=i(Vr),as=Z(),ns=v(),Vo((ps=function(t){function e(){var e;return e=t.call(this)||this,b(e,"_enable",ls,g(e)),b(e,"x",us,g(e)),b(e,"y",hs,g(e)),b(e,"z",cs,g(e)),b(e,"speedModifier",_s,g(e)),b(e,"space",ds,g(e)),e.rotation=void 0,e.needTransform=void 0,e.name="velocityModule",e.rotation=new Q,e.speedModifier.constant=1,e.needTransform=!1,e.needUpdate=!0,e}n(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=qr(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=O.set(Kl,this.x.evaluate(e,$(t.randomSeed^jl)),this.y.evaluate(e,$(156497^t.randomSeed)),this.z.evaluate(e,$(984136^t.randomSeed)));this.needTransform&&O.transformQuat(i,i,this.rotation),O.add(t.animatedVelocity,t.animatedVelocity,i),O.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),O.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,$(t.randomSeed+jl)))},p(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(Ur),ls=f((ss=ps).prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(ss.prototype,"enable",[Ho],Object.getOwnPropertyDescriptor(ss.prototype,"enable"),ss.prototype),us=f(ss.prototype,"x",[ko,x,No,Go,Wo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),hs=f(ss.prototype,"y",[Xo,x,jo,Ko,Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),cs=f(ss.prototype,"z",[Zo,x,qo,Qo,Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),_s=f(ss.prototype,"speedModifier",[$o,x,ts,es,is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),ds=f(ss.prototype,"space",[rs,x,as,ns],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vr.Local}}),os=ss))||os),Zl=t("Burst",(fs=e("cc.Burst"),ms=i(Be),ys=q(),fs((Ts=function(){function t(){b(this,"_time",gs,this),b(this,"_repeatCount",Ms,this),b(this,"repeatInterval",ws,this),b(this,"count",Ss,this),this._remainingCount=void 0,this._curTime=void 0,this._remainingCount=0,this._curTime=0}var e=t.prototype;return e.update=function(t,e){if(0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),this._remainingCount>0){var i=j(t._time-t.startDelay.evaluate(0,1),t.duration)-e;i=i>0?i:0;var r=j(t.time-t.startDelay.evaluate(0,1),t.duration);this._curTime>=i&&this._curTime<r&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(r-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount)}},e.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},p(t,[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this._curTime=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._remainingCount=t}}]),t}(),gs=f((bs=Ts).prototype,"_time",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(bs.prototype,"time",[k],Object.getOwnPropertyDescriptor(bs.prototype,"time"),bs.prototype),Ms=f(bs.prototype,"_repeatCount",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),f(bs.prototype,"repeatCount",[k],Object.getOwnPropertyDescriptor(bs.prototype,"repeatCount"),bs.prototype),ws=f(bs.prototype,"repeatInterval",[x,k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ss=f(bs.prototype,"count",[ms,x,ys],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),vs=bs))||vs)),ql=new O(0,0,0),Ql=[],Jl=new O(.5,.5,.5),$l=(xs=e("cc.ShapeModule"),Os=Z(),zs=v(),Rs=Z(),Es=v(),Cs=Z(),As=v(),Ps=Z(),Ds=v(),Fs=Z(),Is=v(),Bs=Z(),Ls=i(Gr),Us=nt("shapeType"),Vs=Z(),Hs=i(Gr),ks=v(),Ns=i(Wr),Gs=Z(),Ws=v(),Xs=Z(),js=v(),Ks=Z(),Ys=v(),Zs=Z(),qs=v(),Qs=Z(),Js=v(),$s=Z(),tl=v(),el=Z(),il=v(),rl=i(Xr),al=Z(),nl=v(),ol=lt(),sl=Z(),ll=v(),ul=i(Be),hl=lt(),cl=q(),_l=Z(),dl=v(),pl=Z(),fl=v(),ml=Z(),yl=v(),xs((Vl=function(){function t(){b(this,"_enable",gl,this),b(this,"_shapeType",Ml,this),b(this,"emitFrom",wl,this),b(this,"alignToDirection",Sl,this),b(this,"randomDirectionAmount",Tl,this),b(this,"sphericalDirectionAmount",xl,this),b(this,"randomPositionAmount",Ol,this),b(this,"radius",zl,this),b(this,"radiusThickness",Rl,this),b(this,"arcMode",El,this),b(this,"arcSpread",Cl,this),b(this,"arcSpeed",Al,this),b(this,"length",Pl,this),b(this,"boxThickness",Dl,this),b(this,"_position",Fl,this),b(this,"_rotation",Il,this),b(this,"_scale",Bl,this),b(this,"_arc",Ll,this),b(this,"_angle",Ul,this),this.mat=void 0,this.quat=void 0,this.particleSystem=void 0,this.lastTime=void 0,this.totalAngle=void 0,this.mat=new J,this.quat=new Q,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}var e=t.prototype;return e.onInit=function(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem._time},e.emit=function(t){switch(this.shapeType){case Gr.Box:!function(t,e,i,r){switch(t){case Wr.Volume:a=i,n=Jl,O.set(a,et(-n.x,n.x),et(-n.y,n.y),et(-n.z,n.z));break;case Wr.Shell:Ql.splice(0,Ql.length),Ql.push(et(-.5,.5)),Ql.push(et(-.5,.5)),Ql.push(.5*ia()),ea(Ql),tu(Ql,e),O.set(i,Ql[0],Ql[1],Ql[2]);break;case Wr.Edge:Ql.splice(0,Ql.length),Ql.push(et(-.5,.5)),Ql.push(.5*ia()),Ql.push(.5*ia()),ea(Ql),tu(Ql,e),O.set(i,Ql[0],Ql[1],Ql[2]);break;default:console.warn(t+" is not supported for box emitter.")}var a,n;O.copy(r,Zr)}(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case Gr.Circle:e=this.radius,i=this.radiusThickness,r=this.generateArcAngle(),a=t.position,n=t.velocity,ta(a,e*(1-i),e,r),O.normalize(n,a);break;case Gr.Cone:!function(t,e,i,r,a,n,o,s){switch(t){case Wr.Base:ta(o,e*(1-i),e,r),Y.multiplyScalar(s,o,Math.sin(a)),s.z=-Math.cos(a)*e,O.normalize(s,s),o.z=0;break;case Wr.Shell:Qr(o,r),Y.multiplyScalar(s,o,Math.sin(a)),s.z=-Math.cos(a),O.normalize(s,s),Y.multiplyScalar(o,o,e),o.z=0;break;case Wr.Volume:ta(o,e*(1-i),e,r),Y.multiplyScalar(s,o,Math.sin(a)),s.z=-Math.cos(a)*e,O.normalize(s,s),o.z=0,O.add(o,o,O.multiplyScalar(ql,s,n*tt()/-s.z));break;default:console.warn(t+" is not supported for cone emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(),this._angle,this.length,t.position,t.velocity);break;case Gr.Sphere:!function(t,e,i,r,a){switch(t){case Wr.Volume:$r(r,e*(1-i),e),O.normalize(a,r);break;case Wr.Shell:Jr(r),O.multiplyScalar(r,r,e),O.normalize(a,r);break;default:console.warn(t+" is not supported for sphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case Gr.Hemisphere:!function(t,e,i,r,a){switch(t){case Wr.Volume:$r(r,e*(1-i),e),r.z>0&&(r.z*=-1),O.normalize(a,r);break;case Wr.Shell:Jr(r),O.multiplyScalar(r,r,e),r.z>0&&(r.z*=-1),O.normalize(a,r);break;default:console.warn(t+" is not supported for hemisphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}var e,i,r,a,n;if(this.randomPositionAmount>0&&(t.position.x+=et(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=et(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=et(-this.randomPositionAmount,this.randomPositionAmount)),O.transformQuat(t.velocity,t.velocity,this.quat),O.transformMat4(t.position,t.position,this.mat),this.sphericalDirectionAmount>0){var o=O.normalize(ql,t.position);O.lerp(t.velocity,t.velocity,o,this.sphericalDirectionAmount)}this.lastTime=this.particleSystem._time},e.constructMat=function(){Q.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),J.fromRTS(this.mat,this.quat,this._position,this._scale)},e.generateArcAngle=function(){if(this.arcMode===Xr.Random)return et(0,this._arc);var t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem._time,1)*(this.particleSystem._time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case Xr.Loop:return j(t,this._arc);case Xr.PingPong:return ot(t,this._arc);default:return j(t,this._arc)}},p(t,[{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.constructMat()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.constructMat()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.constructMat()}},{key:"arc",get:function(){return w(this._arc)},set:function(t){this._arc=S(t)}},{key:"angle",get:function(){return Math.round(100*w(this._angle))/100},set:function(t){this._angle=S(t)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case Gr.Box:this.emitFrom===Wr.Base&&(this.emitFrom=Wr.Volume);break;case Gr.Cone:this.emitFrom===Wr.Edge&&(this.emitFrom=Wr.Base);break;case Gr.Sphere:case Gr.Hemisphere:this.emitFrom!==Wr.Base&&this.emitFrom!==Wr.Edge||(this.emitFrom=Wr.Volume)}}}]),t}(),f((bl=Vl).prototype,"position",[Os,zs],Object.getOwnPropertyDescriptor(bl.prototype,"position"),bl.prototype),f(bl.prototype,"rotation",[Rs,Es],Object.getOwnPropertyDescriptor(bl.prototype,"rotation"),bl.prototype),f(bl.prototype,"scale",[Cs,As],Object.getOwnPropertyDescriptor(bl.prototype,"scale"),bl.prototype),f(bl.prototype,"arc",[Ps,Ds],Object.getOwnPropertyDescriptor(bl.prototype,"arc"),bl.prototype),f(bl.prototype,"angle",[Fs,Is],Object.getOwnPropertyDescriptor(bl.prototype,"angle"),bl.prototype),gl=f(bl.prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(bl.prototype,"enable",[Bs],Object.getOwnPropertyDescriptor(bl.prototype,"enable"),bl.prototype),Ml=f(bl.prototype,"_shapeType",[Ls,Us,Vs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gr.Cone}}),f(bl.prototype,"shapeType",[Hs,ks],Object.getOwnPropertyDescriptor(bl.prototype,"shapeType"),bl.prototype),wl=f(bl.prototype,"emitFrom",[Ns,x,Gs,Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wr.Volume}}),Sl=f(bl.prototype,"alignToDirection",[x,Xs,js],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tl=f(bl.prototype,"randomDirectionAmount",[x,Ks,Ys],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xl=f(bl.prototype,"sphericalDirectionAmount",[x,Zs,qs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ol=f(bl.prototype,"randomPositionAmount",[x,Qs,Js],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zl=f(bl.prototype,"radius",[x,$s,tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Rl=f(bl.prototype,"radiusThickness",[x,el,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),El=f(bl.prototype,"arcMode",[rl,x,al,nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xr.Random}}),Cl=f(bl.prototype,"arcSpread",[ol,x,sl,ll],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Al=f(bl.prototype,"arcSpeed",[ul,hl,cl,x,_l,dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Pl=f(bl.prototype,"length",[x,pl,fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Dl=f(bl.prototype,"boxThickness",[x,ml,yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(0,0,0)}}),Fl=f(bl.prototype,"_position",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(0,0,0)}}),Il=f(bl.prototype,"_rotation",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(0,0,0)}}),Bl=f(bl.prototype,"_scale",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new O(1,1,1)}}),Ll=f(bl.prototype,"_arc",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S(360)}}),Ul=f(bl.prototype,"_angle",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S(25)}}),vl=bl))||vl);function tu(t,e){e.x>0&&(t[0]+=.5*et(-e.x,e.x),t[0]=st(t[0],-.5,.5)),e.y>0&&(t[1]+=.5*et(-e.y,e.y),t[1]=st(t[1],-.5,.5)),e.z>0&&(t[2]+=.5*et(-e.z,e.z),t[2]=st(t[2],-.5,.5))}var eu,iu,ru,au,nu,ou,su,lu,uu,hu,cu,_u,du,pu,fu,mu,yu,vu,bu,gu,Mu,wu,Su,Tu,xu,Ou,zu,Ru,Eu,Cu,Au,Pu,Du,Fu,Iu=[0,0,1,0,0,1,1,1],Bu=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertAttrs=void 0,e._vertSize=void 0,e._vBuffer=void 0,e._vertAttrsFloatCount=void 0,e._vdataF32=void 0,e._vdataUint32=void 0,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=void 0,e._mesh=void 0,e._vertCount=0,e._indexCount=0,e._startTimeOffset=0,e._lifeTimeOffset=0,e._material=null,e.type=Et.PARTICLE_BATCH,e._capacity=0,e._vertAttrs=null,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=new D([new F]),e._iaInfoBuffer=e._device.createBuffer(new E(C.INDIRECT,A.HOST|A.DEVICE,I,I)),e._subMeshData=null,e._mesh=null,e}n(e,t);var i=e.prototype;return i.setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._subMeshData&&e&&this.rebuild()},i.setVertexAttributes=function(t,e){if(this._mesh!==t||this._vertAttrs!==e){this._mesh=t,this._vertAttrs=e,this._vertSize=0;for(var i,r=z(this._vertAttrs);!(i=r()).done;){var a=i.value;a.offset=this._vertSize,this._vertSize+=R[a.format].size}this._vertAttrsFloatCount=this._vertSize/4,this.rebuild()}},i.createSubMeshData=function(){this.destroySubMeshData(),this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new E(C.VERTEX|C.TRANSFER_DST,A.HOST|A.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);if(this._mesh){var i=this._vertAttrs[this._vertAttrs.findIndex((function(t){return t.name===u.ATTR_TEX_COORD}))].offset;this._mesh.copyAttribute(0,u.ATTR_TEX_COORD,e,this._vertSize,i);var r=this._vertAttrs.findIndex((function(t){return t.name===u.ATTR_TEX_COORD3}));if(i=this._vertAttrs[r++].offset,this._mesh.copyAttribute(0,u.ATTR_POSITION,e,this._vertSize,i),i=this._vertAttrs[r++].offset,this._mesh.copyAttribute(0,u.ATTR_NORMAL,e,this._vertSize,i),i=this._vertAttrs[r++].offset,!this._mesh.copyAttribute(0,u.ATTR_COLOR,e,this._vertSize,i))for(var a=new Uint32Array(e),n=0;n<this._vertCount;++n)a[n*this._vertAttrsFloatCount+i/4]=s.WHITE._val;for(var l=new Float32Array(e),h=1;h<this._capacity;h++)l.copyWithin(h*this._vertSize*this._vertCount/4,0,this._vertSize*this._vertCount/4)}t.update(e);var c=new Uint16Array(this._capacity*this._indexCount);if(this._mesh){this._mesh.copyIndices(0,c);for(var _=1;_<this._capacity;_++)for(var d=0;d<this._indexCount;d++)c[_*this._indexCount+d]=c[d]+_*this._vertCount}else for(var p=0,f=0;f<this._capacity;++f){var m=4*f;c[p++]=m,c[p++]=m+1,c[p++]=m+2,c[p++]=m+3,c[p++]=m+2,c[p++]=m+1}var y=this._device.createBuffer(new E(C.INDEX|C.TRANSFER_DST,A.DEVICE,this._capacity*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return y.update(c),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=this._capacity*this._indexCount,this._iaInfoBuffer||(this._iaInfoBuffer=this._device.createBuffer(new E(C.INDIRECT,A.HOST|A.DEVICE,I,I))),this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new P([t],this._vertAttrs,o.TRIANGLE_LIST,y,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.updateMaterial=function(t){this._material=t,this.setSubModelMaterial(0,t)},i.addParticleVertexData=function(t,e){if(this._mesh)for(var i=0;i<this._vertCount;i++){var r=(t*this._vertCount+i)*this._vertAttrsFloatCount;this._vdataF32[r++]=e[0].x,this._vdataF32[r++]=e[0].y,this._vdataF32[r++]=e[0].z,r+=2,this._vdataF32[r++]=e[1].z,this._vdataF32[r++]=e[2].x,this._vdataF32[r++]=e[2].y,this._vdataF32[r++]=e[2].z,this._vdataF32[r++]=e[3].x,this._vdataF32[r++]=e[3].y,this._vdataF32[r++]=e[3].z,this._vdataUint32[r++]=e[4]}else{var a=t*this._vertAttrsFloatCount;this._vdataF32[a++]=e[0].x,this._vdataF32[a++]=e[0].y,this._vdataF32[a++]=e[0].z,this._vdataF32[a++]=e[1].x,this._vdataF32[a++]=e[1].y,this._vdataF32[a++]=e[1].z,this._vdataF32[a++]=e[2].x,this._vdataF32[a++]=e[2].y,this._vdataF32[a++]=e[2].z,this._vdataF32[a++]=e[3].x,this._vdataF32[a++]=e[3].y,this._vdataF32[a++]=e[3].z,this._vdataUint32[a++]=e[4],e[5]&&(this._vdataF32[a++]=e[5].x,this._vdataF32[a++]=e[5].y,this._vdataF32[a++]=e[5].z)}},i.addGPUParticleVertexData=function(t,e,i){for(var r=e*this._vertAttrsFloatCount*this._vertCount,a=0;a<this._vertCount;a++){var n=r;this._vdataF32[n++]=t.position.x,this._vdataF32[n++]=t.position.y,this._vdataF32[n++]=t.position.z,this._vdataF32[n++]=i,this._vdataF32[n++]=t.startSize.x,this._vdataF32[n++]=t.startSize.y,this._vdataF32[n++]=t.startSize.z,this._vdataF32[n++]=Iu[2*a],this._vdataF32[n++]=t.rotation.x,this._vdataF32[n++]=t.rotation.y,this._vdataF32[n++]=t.rotation.z,this._vdataF32[n++]=Iu[2*a+1],this._vdataF32[n++]=t.startColor.r/255,this._vdataF32[n++]=t.startColor.g/255,this._vdataF32[n++]=t.startColor.b/255,this._vdataF32[n++]=t.startColor.a/255,this._vdataF32[n++]=t.velocity.x,this._vdataF32[n++]=t.velocity.y,this._vdataF32[n++]=t.velocity.z,this._vdataF32[n++]=t.startLifetime,this._vdataF32[n++]=t.randomSeed,r+=this._vertAttrsFloatCount}},i.updateGPUParticles=function(t,e,i){for(var r=this._vertAttrsFloatCount*this._vertCount,a=0,n=0,o=0,s=0;s<t;++s)a=s*r,n=this._vdataF32[a+this._startTimeOffset],this._vdataF32[a+this._lifeTimeOffset]-(e-n)<i&&(o=--t*r,this._vdataF32.copyWithin(a,o,o+r),s--);return t},i.constructAttributeIndex=function(){if(this._vertAttrs){var t=this._vertAttrs.findIndex((function(t){return"a_position_starttime"===t.name})),e=this._vertAttrs[t].offset;this._startTimeOffset=e/4+3,t=this._vertAttrs.findIndex((function(t){return"a_dir_life"===t.name})),e=this._vertAttrs[t].offset,this._lifeTimeOffset=e/4+3}},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.clear=function(){this._subModels[0].inputAssembler.indexCount=0},i.destroy=function(){t.prototype.destroy.call(this),this._vBuffer=null,this._vdataF32=null,this.destroySubMeshData(),this._iaInfoBuffer&&(this._iaInfoBuffer.destroy(),this._iaInfoBuffer=null)},i.rebuild=function(){this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null,this._iaInfoBuffer=null)},e}(Rt),Lu=function(){function t(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._renderInfo=t}var e=t.prototype;return e.getInfo=function(){return this._renderInfo},e.onInit=function(t){this._particleSystem=t},e.onEnable=function(){if(this._particleSystem){this.attachToScene();var t=this._model;t&&(t.node=t.transform=this._particleSystem.node,t.enabled=this._particleSystem.enabledInHierarchy)}},e.onDisable=function(){this.detachFromScene()},e.onDestroy=function(){this._model&&(c.director.root.destroyModel(this._model),this._model=null)},e.attachToScene=function(){this._model&&(this._model.scene&&this.detachFromScene(),this._particleSystem._getRenderScene().addModel(this._model))},e.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e.setVertexAttributes=function(){this._model&&this._model.setVertexAttributes(this._renderInfo.renderMode===Nr.Mesh?this._renderInfo.mesh:null,this._vertAttrs)},e.clear=function(){this._model&&(this._model.enabled=!1)},e.getModel=function(){return this._model},e._initModel=function(){this._model||(this._model=c.director.root.createModel(Bu),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)},e.updateTrailMaterial=function(){},e.getDefaultTrailMaterial=function(){return null},t}(),Uu=new O,Vu=new J,Hu=new Q,ku=(new O,["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"]),Nu=[0,0,1,0,0,1,1,1],Gu=[new l(u.ATTR_POSITION,h.RGB32F),new l(u.ATTR_TEX_COORD,h.RGB32F),new l(u.ATTR_TEX_COORD1,h.RGB32F),new l(u.ATTR_TEX_COORD2,h.RGB32F),new l(u.ATTR_COLOR,h.RGBA8,!0)],Wu=[new l(u.ATTR_POSITION,h.RGB32F),new l(u.ATTR_TEX_COORD,h.RGB32F),new l(u.ATTR_TEX_COORD1,h.RGB32F),new l(u.ATTR_TEX_COORD2,h.RGB32F),new l(u.ATTR_COLOR,h.RGBA8,!0),new l(u.ATTR_COLOR1,h.RGB32F)],Xu=[new l(u.ATTR_POSITION,h.RGB32F),new l(u.ATTR_TEX_COORD,h.RGB32F),new l(u.ATTR_TEX_COORD1,h.RGB32F),new l(u.ATTR_TEX_COORD2,h.RGB32F),new l(u.ATTR_COLOR,h.RGBA8,!0),new l(u.ATTR_TEX_COORD3,h.RGB32F),new l(u.ATTR_NORMAL,h.RGB32F),new l(u.ATTR_COLOR1,h.RGBA8,!0)],ju={parent:null,owner:null,subModelIdx:0},Ku=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._trailDefines=void 0,i._frameTile_velLenScale=void 0,i._tmp_velLenScale=void 0,i._defaultMat=null,i._node_scale=void 0,i._attrs=void 0,i._particles=null,i._defaultTrailMat=null,i._updateList=new Map,i._animateList=new Map,i._runAnimateList=new Array,i._fillDataFunc=null,i._uScaleHandle=0,i._uLenHandle=0,i._uNodeRotHandle=0,i._alignSpace=kr.View,i._inited=!1,i._localMat=new J,i._gravity=new M,i._model=null,i._frameTile_velLenScale=new M(1,1,0,0),i._tmp_velLenScale=i._frameTile_velLenScale.clone(),i._node_scale=new M,i._attrs=new Array(5),i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},i._trailDefines={CC_USE_WORLD_SPACE:!0},i}n(e,t);var i=e.prototype;return i.onInit=function(e){var i=this;t.prototype.onInit.call(this,e),this._particles=new ut((function(){return new Qi(i)}),16),this._setVertexAttrib(),this._setFillFunc(),this._initModuleList(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this._inited=!0},i.clear=function(){t.prototype.clear.call(this),this._particles.reset(),this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData(),this._model.enabled=!1},i.updateRenderMode=function(){this._setVertexAttrib(),this._setFillFunc(),this.updateMaterialParams(),this.setVertexAttributes()},i.getFreeParticle=function(){return this._particles.length>=this._particleSystem.capacity?null:this._particles.add()},i.getDefaultTrailMaterial=function(){return this._defaultTrailMat},i.setNewParticle=function(){},i._initModuleList=function(){var t=this;ku.forEach((function(e){var i=t._particleSystem[e];i&&i.enable&&(i.needUpdate&&(t._updateList[i.name]=i),i.needAnimate&&(t._animateList[i.name]=i))})),this._runAnimateList.length=0;for(var e=0,i=Br.length;e<i;e++){var r=this._animateList[Br[e]];r&&this._runAnimateList.push(r)}},i.enableModule=function(t,e,i){e?(i.needUpdate&&(this._updateList[i.name]=i),i.needAnimate&&(this._animateList[i.name]=i)):(delete this._animateList[t],delete this._updateList[t]),this._runAnimateList.length=0;for(var r=0,a=Br.length;r<a;r++){var n=this._animateList[Br[r]];n&&this._runAnimateList.push(n)}this.updateMaterialParams()},i.updateAlignSpace=function(t){this._alignSpace=t},i.updateRotation=function(){var t=this._particleSystem;if(t){var e=(t.getMaterialInstance(0)||this._defaultMat).passes[0];this.doUpdateRotation(e)}},i.doUpdateRotation=function(t){if(this._alignSpace===kr.Local)this._particleSystem.node.getRotation(Hu);else if(this._alignSpace===kr.World)this._particleSystem.node.getWorldRotation(Hu);else if(this._alignSpace===kr.View){var e;Hu.set(0,0,0,1);var i=null===(e=this._particleSystem.node.scene.renderScene)||void 0===e?void 0:e.cameras;if(void 0!==i)for(var r=0;r<(null==i?void 0:i.length);++r){var a=i[r];if((a.visibility&this._particleSystem.node.layer)===this._particleSystem.node.layer){Q.fromViewUp(Hu,a.forward);break}}}else Hu.set(0,0,0,1);t.setUniform(this._uNodeRotHandle,Hu)},i.updateScale=function(){var t=this._particleSystem;if(t){var e=(t.getMaterialInstance(0)||this._defaultMat).passes[0];this.doUpdateScale(e)}},i.doUpdateScale=function(t){switch(this._particleSystem.scaleSpace){case Vr.Local:this._particleSystem.node.getScale(this._node_scale);break;case Vr.World:this._particleSystem.node.getWorldScale(this._node_scale)}t.setUniform(this._uScaleHandle,this._node_scale)},i.updateParticles=function(t){var e=this,i=this._particleSystem;if(!i)return this._particles.length;i.node.getWorldMatrix(Vu);var r=(i.getMaterialInstance(0)||this._defaultMat).passes[0];this.doUpdateScale(r),this.doUpdateRotation(r),this._updateList.forEach((function(t){t.update(i._simulationSpace,Vu)}));var a=i._trailModule,n=a&&a.enable;if(n&&a.update(),i.simulationSpace===Vr.Local){var o=i.node.getRotation();J.fromQuat(this._localMat,o),this._localMat.transpose()}for(var s=function(r){var o=e._particles.data[r];if(o.remainingLifetime-=t,O.set(o.animatedVelocity,0,0,0),o.remainingLifetime<0)return n&&a.removeParticle(o),e._particles.removeAt(r),--r,l=r,"continue";if(i.simulationSpace===Vr.Local){var s=9.8*-i.gravityModifier.evaluate(1-o.remainingLifetime/o.startLifetime,$(o.randomSeed))*t;e._gravity.x=0,e._gravity.y=s,e._gravity.z=0,e._gravity.w=1,e._gravity=e._gravity.transformMat4(e._localMat),o.velocity.x+=e._gravity.x,o.velocity.y+=e._gravity.y,o.velocity.z+=e._gravity.z}else o.velocity.y-=9.8*i.gravityModifier.evaluate(1-o.remainingLifetime/o.startLifetime,$(o.randomSeed))*t;O.copy(o.ultimateVelocity,o.velocity),e._runAnimateList.forEach((function(e){e.animate(o,t)})),O.scaleAndAdd(o.position,o.position,o.ultimateVelocity,t),n&&a.animate(o,t),l=r},l=0;l<this._particles.length;++l)s(l);return this._model.enabled=this._particles.length>0,this._particles.length},i.updateRenderData=function(){for(var t=0,e=0;e<this._particles.length;++e){var i=this._particles.data[e],r=0,a=this._particleSystem._textureAnimationModule;a&&a.enable&&(r=i.frameIndex),t=4*e,this._fillDataFunc(i,t,r)}},i.beforeRender=function(){this._model.updateIA(this._particles.length)},i.getParticleCount=function(){return this._particles.length},i.onMaterialModified=function(t){this._inited&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e);var i=this._particleSystem._trailModule;i&&i._trailModel&&1===t&&i._trailModel.setSubModelMaterial(0,e)},i._setFillFunc=function(){this._renderInfo.renderMode===Nr.Mesh?this._fillDataFunc=this._fillMeshData:this._renderInfo.renderMode===Nr.StrecthedBillboard?this._fillDataFunc=this._fillStrecthedData:this._fillDataFunc=this._fillNormalData},i._fillMeshData=function(t,e,i){var r=e/4;this._attrs[0]=t.position,Uu.z=i,this._attrs[1]=Uu,this._attrs[2]=t.size,this._attrs[3]=t.rotation,this._attrs[4]=t.color._val,this._model.addParticleVertexData(r,this._attrs)},i._fillStrecthedData=function(t,e,i){for(var r=0;r<4;++r)this._attrs[0]=t.position,Uu.x=Nu[2*r],Uu.y=Nu[2*r+1],Uu.z=i,this._attrs[1]=Uu,this._attrs[2]=t.size,this._attrs[3]=t.rotation,this._attrs[4]=t.color._val,this._attrs[5]=t.ultimateVelocity,this._attrs[6]=null,this._model.addParticleVertexData(e++,this._attrs)},i._fillNormalData=function(t,e,i){for(var r=0;r<4;++r)this._attrs[0]=t.position,Uu.x=Nu[2*r],Uu.y=Nu[2*r+1],Uu.z=i,this._attrs[1]=Uu,this._attrs[2]=t.size,this._attrs[3]=t.rotation,this._attrs[4]=t.color._val,this._attrs[5]=null,this._model.addParticleVertexData(e++,this._attrs)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case Nr.StrecthedBillboard:this._vertAttrs=Wu.slice();break;case Nr.Mesh:this._vertAttrs=Xu.slice();break;default:this._vertAttrs=Gu.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!=e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1!==i.indexOf("particle")&&-1===i.indexOf("particle-gpu")||t.setMaterial(null,0)}null==t.sharedMaterial&&null==this._defaultMat&&(ju.parent=d.get("default-particle-material"),ju.owner=this._particleSystem,ju.subModelIdx=0,this._defaultMat=new Ct(ju),ju.parent=null,ju.owner=null,ju.subModelIdx=0,null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;t._simulationSpace===Vr.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var a=r.passes[0];this._uScaleHandle=a.getHandle("scale"),this._uLenHandle=a.getHandle("frameTile_velLenScale"),this._uNodeRotHandle=a.getHandle("nodeRotation");var n=this._renderInfo.renderMode,o=this._frameTile_velLenScale;n===Nr.Billboard?this._defines.CC_RENDER_MODE=0:n===Nr.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,o.z=this._renderInfo.velocityScale,o.w=this._renderInfo.lengthScale):n===Nr.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:n===Nr.VerticalBillboard?this._defines.CC_RENDER_MODE=3:n===Nr.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+n+" not support.");var s=t._textureAnimationModule;s&&s.enable?(M.copy(this._tmp_velLenScale,o),Y.set(this._tmp_velLenScale,s.numTilesX,s.numTilesY),a.setUniform(this._uLenHandle,this._tmp_velLenScale)):a.setUniform(this._uLenHandle,o);var l,u=this._particleSystem._rotationOvertimeModule;l=u&&u.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=l,r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},i.updateTrailMaterial=function(){if(this._particleSystem){var t=this._particleSystem,e=t._trailModule;if(e&&e.enable){t.simulationSpace===Vr.World||e.space===Vr.World?this._trailDefines.CC_USE_WORLD_SPACE=!0:this._trailDefines.CC_USE_WORLD_SPACE=!1;var i=t.getMaterialInstance(1);null===i&&null===this._defaultTrailMat&&(ju.parent=d.get("default-trail-material"),ju.owner=this._particleSystem,ju.subModelIdx=1,this._defaultTrailMat=new Ct(ju),ju.parent=null,ju.owner=null,ju.subModelIdx=0),(i=i||this._defaultTrailMat).recompileShaders(this._trailDefines),e.updateMaterial()}}},e}(Lu),Yu=new J,Zu=new M,qu=new Q,Qu=new Q,Ju=(new O,32),$u="a_position_starttime",th="a_size_uv",eh="a_rotation_uv",ih="a_color",rh="a_dir_life",ah="a_rndSeed",nh=[new l($u,h.RGBA32F),new l(th,h.RGBA32F),new l(eh,h.RGBA32F),new l(ih,h.RGBA32F),new l(rh,h.RGBA32F),new l(ah,h.R32F)],oh=[new l($u,h.RGBA32F),new l(th,h.RGBA32F),new l(eh,h.RGBA32F),new l(ih,h.RGBA32F),new l(rh,h.RGBA32F),new l(ah,h.R32F),new l(u.ATTR_TEX_COORD,h.RGB32F),new l(u.ATTR_TEX_COORD3,h.RGB32F),new l(u.ATTR_NORMAL,h.RGB32F),new l(u.ATTR_COLOR1,h.RGBA8,!0)],sh={parent:null,owner:null,subModelIdx:0},lh=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._frameTile_velLenScale=void 0,i._unifrom_velLenScale=void 0,i._tmp_velLenScale=void 0,i._node_scale=void 0,i._vertAttrs=[],i._defaultMat=null,i._particleNum=0,i._tempParticle=null,i._colorTexture=null,i._forceTexture=null,i._velocityTexture=null,i._rotationTexture=null,i._sizeTexture=null,i._animTexture=null,i._uTimeHandle=0,i._uRotHandle=0,i._uNodeRotHandle=0,i._alignSpace=kr.View,i._inited=!1,i._frameTile_velLenScale=new M(1,1,0,0),i._unifrom_velLenScale=i._frameTile_velLenScale.clone(),i._tmp_velLenScale=i._frameTile_velLenScale.clone(),i._node_scale=new M,i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},i._tempParticle=new Qi(null),i._particleNum=0,i}n(e,t);var i=e.prototype;return i.onInit=function(e){t.prototype.onInit.call(this,e),this._setVertexAttrib(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this._inited=!0},i.updateRenderMode=function(){this._setVertexAttrib(),this.updateMaterialParams(),this.setVertexAttributes()},i.setVertexAttributes=function(){t.prototype.setVertexAttributes.call(this),this._model.constructAttributeIndex()},i.clear=function(){t.prototype.clear.call(this),this._particleNum=0,this.updateRenderData()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._forceTexture&&this._forceTexture.destroy(),this._velocityTexture&&this._velocityTexture.destroy(),this._colorTexture&&this._colorTexture.destroy(),this._sizeTexture&&this._sizeTexture.destroy(),this._rotationTexture&&this._rotationTexture.destroy(),this._animTexture&&this._animTexture.destroy()},i.enableModule=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;t&&(this.initShaderUniform(t),t.recompileShaders(this._defines),this._model&&this._model.setSubModelMaterial(0,t))},i.getFreeParticle=function(){return this._particleNum>=this._particleSystem._capacity?null:this._tempParticle},i.setNewParticle=function(t){this._model.addGPUParticleVertexData(t,this._particleNum,this._particleSystem._time),this._particleNum++},i.updateRotation=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(t){var e=t.passes[0];this.doUpdateRotation(e)}},i.doUpdateRotation=function(t){if(this._alignSpace===kr.Local)this._particleSystem.node.getRotation(Qu);else if(this._alignSpace===kr.World)this._particleSystem.node.getWorldRotation(Qu);else if(this._alignSpace===kr.View){var e;Qu.set(0,0,0,1);var i=null===(e=this._particleSystem.node.scene.renderScene)||void 0===e?void 0:e.cameras;if(void 0!==i)for(var r=0;r<(null==i?void 0:i.length);++r){var a=i[r];if((a.visibility&this._particleSystem.node.layer)===this._particleSystem.node.layer){Q.fromViewUp(Qu,a.forward);break}}}else Qu.set(0,0,0,1);t.setUniform(this._uNodeRotHandle,Qu)},i.updateScale=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(t){var e=t.passes[0];this.doUpdateScale(e)}},i.doUpdateScale=function(t){switch(this._particleSystem.scaleSpace){case Vr.Local:this._particleSystem.node.getScale(this._node_scale);break;case Vr.World:this._particleSystem.node.getWorldScale(this._node_scale)}t.setUniform(t.getHandle("scale"),this._node_scale)},i.updateParticles=function(t){return this._particleNum=this._model.updateGPUParticles(this._particleNum,this._particleSystem._time,t),this.updateShaderUniform(t),this._model.enabled=this._particleNum>0,this._particleNum},i.updateRenderData=function(){},i.beforeRender=function(){this._model.updateIA(this._particleNum)},i.updateAlignSpace=function(t){this._alignSpace=t},i.updateShaderUniform=function(t){var e=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(e){var i=e.passes[0];Zu.x=this._particleSystem._time,Zu.y=t,i.setUniform(this._uTimeHandle,Zu),this._particleSystem.node.getWorldRotation(qu),i.setUniform(this._uRotHandle,qu),this.doUpdateRotation(i)}},i.initShaderUniform=function(t){var e=t.passes[0];this._uTimeHandle=e.getHandle("u_timeDelta"),this._uRotHandle=e.getHandle("u_worldRot"),this._uNodeRotHandle=e.getHandle("nodeRotation"),this.doUpdateScale(e),e.setUniform(e.getHandle("frameTile_velLenScale"),this._unifrom_velLenScale),Zu.x=Ju,Zu.y=.03125,e.setUniform(e.getHandle("u_sampleInfo"),Zu);var i=!1,a=this._particleSystem._forceOvertimeModule;if(i=a&&a.enable,this._defines.FORCE_OVER_TIME_MODULE_ENABLE=i,i){this._forceTexture&&this._forceTexture.destroy(),this._forceTexture=He(Ju,a.x,a.y,a.z);var n=e.getHandle("force_over_time_tex0"),o=ht.getBindingFromHandle(n);e.bindSampler(o,this._forceTexture.getGFXSampler()),e.bindTexture(o,this._forceTexture.getGFXTexture());var s=e.getHandle("u_force_space");e.setUniform(s,a.space);var l=e.getHandle("u_force_mode");e.setUniform(l,this._forceTexture.height)}var u=this._particleSystem._velocityOvertimeModule;if(i=u&&u.enable,this._defines.VELOCITY_OVER_TIME_MODULE_ENABLE=i,i){this._velocityTexture&&this._velocityTexture.destroy(),this._velocityTexture=function(t,e,i,r,a){for(var n=Math.max(Ue(e),Ue(i),Ue(r),Ue(a)),o=new Float32Array(t*n*4),s=[e,i,r,a],l=1/(t-1),u=0;u<n;u++)for(var h=0;h<4;h++)for(var c=s[h],_=0,d=0,p=0;p<t;p++){var f=Le(c,l*p,u);d=(_+=f)/(p+1),o[4*p+h]=d}return Ve(o,t,n)}(Ju,u.x,u.y,u.z,u.speedModifier);var h=e.getHandle("velocity_over_time_tex0"),c=ht.getBindingFromHandle(h);e.bindSampler(c,this._velocityTexture.getGFXSampler()),e.bindTexture(c,this._velocityTexture.getGFXTexture());var _=e.getHandle("u_velocity_space");e.setUniform(_,u.space);var d=e.getHandle("u_velocity_mode");e.setUniform(d,this._velocityTexture.height)}var p=this._particleSystem._colorOverLifetimeModule;if(i=p&&p.enable,this._defines.COLOR_OVER_TIME_MODULE_ENABLE=i,i){this._colorTexture&&this._colorTexture.destroy(),this._colorTexture=function(t,e){for(var i=function(t){switch(t.mode){case Xi.TwoColors:case Xi.TwoGradients:return 2;default:return 1}}(e),a=new Uint8Array(t*i*4),n=1/(t-1),o=0,s=0;s<i;s++)for(var l=0;l<t;l++){var u=Ki(e,n*l,s);a[o]=u.r,a[o+1]=u.g,a[o+2]=u.b,a[o+3]=u.a,o+=4}var h=new r;return h.create(t,i,G.RGBA8888),h.setFilters(W.LINEAR,W.LINEAR),h.setWrapMode(X.CLAMP_TO_EDGE,X.CLAMP_TO_EDGE),h.uploadData(a),h}(Ju,p.color);var f=e.getHandle("color_over_time_tex0"),m=ht.getBindingFromHandle(f);e.bindSampler(m,this._colorTexture.getGFXSampler()),e.bindTexture(m,this._colorTexture.getGFXTexture());var y=e.getHandle("u_color_mode");e.setUniform(y,this._colorTexture.height)}var v=this._particleSystem._rotationOvertimeModule;if(i=v&&v.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=i,i){this._rotationTexture&&this._rotationTexture.destroy(),v.separateAxes?this._rotationTexture=He(Ju,v.x,v.y,v.z):this._rotationTexture=function(t,e){for(var i=Ue(e),r=new Float32Array(t*i*4),a=1/(t-1),n=0,o=0;o<i;o++)for(var s=0;s<t;s++){var l=Le(e,a*s,o);r[n+2]=l,n+=4}return Ve(r,t,i)}(Ju,v.z);var b=e.getHandle("rotation_over_time_tex0"),g=ht.getBindingFromHandle(b);e.bindSampler(g,this._rotationTexture.getGFXSampler()),e.bindTexture(g,this._rotationTexture.getGFXTexture());var M=e.getHandle("u_rotation_mode");e.setUniform(M,this._rotationTexture.height)}var w=this._particleSystem._sizeOvertimeModule;if(i=w&&w.enable,this._defines.SIZE_OVER_TIME_MODULE_ENABLE=i,i){this._sizeTexture&&this._sizeTexture.destroy(),w.separateAxes?this._sizeTexture=He(Ju,w.x,w.y,w.z,!0):this._sizeTexture=function(t,e){for(var i=Ue(e),r=new Float32Array(t*i*4),a=1/(t-1),n=0,o=0,s=0;s<i;s++){0;for(var l=0;l<t;l++){var u=Le(e,a*l,s);n=u,r[o]=n,r[o+1]=n,r[o+2]=n,o+=4}}return Ve(r,t,i)}(Ju,w.size);var S=e.getHandle("size_over_time_tex0"),T=ht.getBindingFromHandle(S);e.bindSampler(T,this._sizeTexture.getGFXSampler()),e.bindTexture(T,this._sizeTexture.getGFXTexture());var x=e.getHandle("u_size_mode");e.setUniform(x,this._sizeTexture.height)}var O=this._particleSystem._textureAnimationModule;if(i=O&&O.enable,this._defines.TEXTURE_ANIMATION_MODULE_ENABLE=i,i){this._animTexture&&this._animTexture.destroy(),this._animTexture=function(t,e,i){for(var r=Math.max(Ue(e),Ue(i)),a=new Float32Array(t*r*4),n=[e,i],o=1/(t-1),s=0;s<r;s++)for(var l=0;l<2;l++)for(var u=n[l],h=0,c=0,_=0;_<t;_++){var d=Le(u,o*_,s);c=(h+=d)/(_+1),a[4*_+l]=c}return Ve(a,t,r)}(Ju,O.startFrame,O.frameOverTime);var z=e.getHandle("texture_animation_tex0"),R=ht.getBindingFromHandle(z);e.bindSampler(R,this._animTexture.getGFXSampler()),e.bindTexture(R,this._animTexture.getGFXTexture());var E=e.getHandle("u_anim_info");Zu.x=this._animTexture.height,Zu.y=O.numTilesX*O.numTilesY,Zu.z=O.cycleCount,e.setUniform(E,Zu)}},i.getParticleCount=function(){return this._particleNum},i.onMaterialModified=function(){this._inited&&this.updateMaterialParams()},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case Nr.StrecthedBillboard:this._vertAttrs=nh.slice();break;case Nr.Mesh:this._vertAttrs=oh.slice();break;default:this._vertAttrs=nh.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!==e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1===i.indexOf("particle-gpu")&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0),this._particleSystem.setMaterial(null,0))}null==t.sharedMaterial&&null==this._defaultMat&&(sh.parent=d.get("default-particle-gpu-material"),sh.owner=t,sh.subModelIdx=0,this._defaultMat=new Ct(sh),sh.parent=null,sh.owner=null,sh.subModelIdx=0,null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;t.node.getWorldMatrix(Yu),t._simulationSpace===Vr.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var a=this._renderInfo.renderMode;a===Nr.Billboard?this._defines.CC_RENDER_MODE=0:a===Nr.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,this._frameTile_velLenScale.z=this._renderInfo.velocityScale,this._frameTile_velLenScale.w=this._renderInfo.lengthScale):a===Nr.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:a===Nr.VerticalBillboard?this._defines.CC_RENDER_MODE=3:a===Nr.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+a+" not support.");var n=t._textureAnimationModule;n&&n.enable?(Y.set(this._frameTile_velLenScale,n.numTilesX,n.numTilesY),M.copy(this._unifrom_velLenScale,this._frameTile_velLenScale)):(this._tmp_velLenScale.z=this._frameTile_velLenScale.z,this._tmp_velLenScale.w=this._frameTile_velLenScale.w,M.copy(this._unifrom_velLenScale,this._tmp_velLenScale)),this.initShaderUniform(r),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},e}(Lu);function uh(){var t=Ot.root.device;return!!(t.capabilities.maxVertexTextureUnits>=8&&t.hasFeature(_t.TEXTURE_FLOAT))||(c.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}var hh,ch,_h,dh,ph,fh,mh,yh,vh,bh,gh,Mh,wh,Sh,Th,xh,Oh,zh,Rh,Eh,Ch,Ah,Ph,Dh,Fh,Ih,Bh,Lh,Uh,Vh,Hh,kh,Nh,Gh,Wh,Xh,jh,Kh,Yh,Zh,qh,Qh,Jh,$h,tc,ec,ic,rc,ac,nc,oc,sc,lc,uc,hc,cc,_c,dc,pc,fc,mc,yc,vc,bc,gc,Mc,wc,Sc,Tc,xc,Oc,zc,Rc,Ec,Cc,Ac,Pc,Dc,Fc,Ic,Bc,Lc,Uc,Vc,Hc,kc,Nc,Gc,Wc,Xc,jc,Kc,Yc,Zc,qc,Qc,Jc,$c,t_,e_,i_,r_,a_,n_,o_,s_,l_,u_,h_,c_,__,d_,p_,f_,m_,y_,v_,b_,g_,M_,w_,S_,T_,x_,O_,z_,R_,E_,C_,A_,P_,D_,F_,I_,B_,L_,U_,V_,H_,k_,N_,G_,W_,X_,j_,K_,Y_,Z_,q_,Q_,J_,$_,td,ed,id,rd,ad,nd,od,sd,ld,ud,hd,cd,_d,dd,pd,fd,md,yd,vd,bd,gd,Md,wd,Sd,Td,xd,Od,zd,Rd,Ed,Cd,Ad,Pd,Dd,Fd,Id,Bd,Ld,Ud,Vd,Hd,kd,Nd,Gd,Wd,Xd,jd,Kd,Yd,Zd,qd,Qd,Jd,$d,tp,ep,ip,rp,ap,np,op,sp,lp,up,hp,cp,_p,dp,pp,fp,mp,yp,vp,bp,gp,Mp,wp,Sp,Tp,xp,Op,zp,Rp=(eu=e("cc.ParticleSystemRenderer"),iu=i(Nr),ru=Z(),au=v(),nu=Z(),ou=v(),su=Z(),lu=v(),uu=i(Nr),hu=i(Dt),cu=Z(),_u=v(),du=i(_),pu=Z(),fu=v(),mu=i(_),yu=Z(),vu=v(),bu=Z(),gu=v(),Mu=i(kr),wu=Z(),Su=v(),eu((Fu=Du=function(){function t(){b(this,"_renderMode",Ou,this),b(this,"_velocityScale",zu,this),b(this,"_lengthScale",Ru,this),b(this,"_mesh",Eu,this),b(this,"_mainTexture",Cu,this),b(this,"_useGPU",Au,this),b(this,"_alignSpace",Pu,this),this._particleSystem=null}var e=t.prototype;return e.create=function(t){null===this._particleSystem?this._particleSystem=t:this._particleSystem!==t&&ct(6033)},e.onInit=function(t){if(this.create(t),this._particleSystem.processor)ct(6034);else{var e=this._useGPU&&uh();this._particleSystem.processor=e?new lh(this):new Ku(this),this._particleSystem.processor.updateAlignSpace(this.alignSpace),this._particleSystem.processor.onInit(t)}},e._switchProcessor=function(){this._particleSystem&&(this._particleSystem.processor&&(this._particleSystem.processor.detachFromScene(),this._particleSystem.processor.clear(),this._particleSystem.processor=null),this._particleSystem.processor=this._useGPU?new lh(this):new Ku(this),this._particleSystem.processor.onInit(this._particleSystem),this._particleSystem.processor.onEnable(),this._particleSystem.bindModule())},p(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this._particleSystem&&this._particleSystem.processor.updateRenderMode())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this._particleSystem&&this._particleSystem.processor.setVertexAttributes()}},{key:"particleMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(0):null},set:function(t){this._particleSystem&&this._particleSystem.setMaterial(t,0)}},{key:"trailMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(1):null},set:function(t){this._particleSystem&&this._particleSystem.setMaterial(t,1)}},{key:"mainTexture",get:function(){return this._mainTexture},set:function(t){this._mainTexture=t}},{key:"useGPU",get:function(){return this._useGPU},set:function(t){this._useGPU!==t&&(uh()?this._useGPU=t:this._useGPU=!1,this._switchProcessor())}},{key:"alignSpace",get:function(){return this._alignSpace},set:function(t){this._alignSpace=t,this._particleSystem.processor.updateAlignSpace(this._alignSpace)}}]),t}(),Du.AlignmentSpace=kr,f((xu=Fu).prototype,"renderMode",[iu,ru,au],Object.getOwnPropertyDescriptor(xu.prototype,"renderMode"),xu.prototype),f(xu.prototype,"velocityScale",[nu,ou],Object.getOwnPropertyDescriptor(xu.prototype,"velocityScale"),xu.prototype),f(xu.prototype,"lengthScale",[su,lu],Object.getOwnPropertyDescriptor(xu.prototype,"lengthScale"),xu.prototype),Ou=f(xu.prototype,"_renderMode",[uu,x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Nr.Billboard}}),zu=f(xu.prototype,"_velocityScale",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ru=f(xu.prototype,"_lengthScale",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Eu=f(xu.prototype,"_mesh",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(xu.prototype,"mesh",[hu,cu,_u],Object.getOwnPropertyDescriptor(xu.prototype,"mesh"),xu.prototype),f(xu.prototype,"particleMaterial",[du,pu,fu],Object.getOwnPropertyDescriptor(xu.prototype,"particleMaterial"),xu.prototype),f(xu.prototype,"trailMaterial",[mu,yu,vu],Object.getOwnPropertyDescriptor(xu.prototype,"trailMaterial"),xu.prototype),Cu=f(xu.prototype,"_mainTexture",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Au=f(xu.prototype,"_useGPU",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(xu.prototype,"useGPU",[bu,gu],Object.getOwnPropertyDescriptor(xu.prototype,"useGPU"),xu.prototype),f(xu.prototype,"alignSpace",[Mu,wu,Su],Object.getOwnPropertyDescriptor(xu.prototype,"alignSpace"),xu.prototype),Pu=f(xu.prototype,"_alignSpace",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kr.View}}),Tu=xu))||Tu),Ep=Math.cos(S(100)),Cp={position:new O,velocity:new O},Ap=new Q,Pp=new J,Dp=new O,Fp=new O,Ip=new s,Bp=function(){function t(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new O,lifetime:0,width:0,velocity:new O,direction:0,color:new s})}var e=t.prototype;return e.getElement=function(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},e.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new O,lifetime:0,width:0,velocity:new O,direction:0,color:new s}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},e.iterateElement=function(t,e,i,r){for(var a=this.start>=this.end?this.end+this.trailElements.length:this.end,n=this.start;n<a;n++)e(t,this.trailElements[n%this.trailElements.length],i,r)&&(this.start++,this.start%=this.trailElements.length);this.start===a&&(this.start=-1,this.end=-1)},e.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},e.clear=function(){this.start=-1,this.end=-1},t}(),Lp=(hh=e("cc.TrailModule"),ch=Z(),_h=i(jr),dh=Z(),ph=v(),fh=i(Be),mh=q(),yh=Z(),vh=v(),bh=Z(),gh=v(),Mh=i(Vr),wh=Z(),Sh=v(),Th=i(Kr),xh=Z(),Oh=v(),zh=Z(),Rh=v(),Eh=i(Be),Ch=q(),Ah=Z(),Ph=v(),Dh=Z(),Fh=v(),Ih=i(ji),Bh=Z(),Lh=v(),Uh=i(ji),Vh=Z(),Hh=v(),kh=i(Vr),hh((rc=function(){function t(){b(this,"_enable",Wh,this),b(this,"mode",Xh,this),b(this,"lifeTime",jh,this),b(this,"_minParticleDistance",Kh,this),b(this,"existWithParticles",Yh,this),b(this,"textureMode",Zh,this),b(this,"widthFromParticle",qh,this),b(this,"widthRatio",Qh,this),b(this,"colorFromParticle",Jh,this),b(this,"colorOverTrail",$h,this),b(this,"colorOvertime",tc,this),b(this,"_space",ec,this),b(this,"_particleSystem",ic,this),this._minSquaredDistance=0,this._vertSize=void 0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=void 0,this._trailModel=null,this._iaInfo=void 0,this._iaInfoBuffer=null,this._subMeshData=null,this._vertAttrs=void 0,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=!1,this._material=null,this._iaInfo=new D([new F]),this._vertAttrs=[new l(u.ATTR_POSITION,h.RGB32F),new l(u.ATTR_TEX_COORD,h.RGBA32F),new l(u.ATTR_TEX_COORD1,h.RGB32F),new l(u.ATTR_COLOR,h.RGBA8,!0)],this._vertSize=0;for(var t,e=z(this._vertAttrs);!(t=e()).done;){var i=t.value;this._vertSize+=R[i.format].size}this._particleTrail=new Map}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var e=0,i=t.startLifetime.getMax(),r=t.rateOverTime.getMax(),a=t.duration,n=0,o=t.bursts.length;n<o;n++)e+=t.bursts[n].getMaxCount(t)*Math.ceil(i/a);this._trailNum=Math.ceil(i*this.lifeTime.getMax()*60*(r*a+e)),this._trailSegments=new dt((function(){return new Bp(10)}),Math.ceil(r*a),(function(t){return t.trailElements.length=0})),this._enable&&(this.enable=this._enable)},e.onEnable=function(){this._attachToScene()},e.onDisable=function(){this._particleTrail.clear(),this._detachFromScene()},e._attachToScene=function(){this._trailModel&&(this._trailModel.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this._trailModel))},e._detachFromScene=function(){this._trailModel&&this._trailModel.scene&&this._trailModel.scene.removeModel(this._trailModel)},e.destroy=function(){this.destroySubMeshData(),this._trailModel&&(Ot.root.destroyModel(this._trailModel),this._trailModel=null),this._trailSegments&&(this._trailSegments.destroy(),this._trailSegments=null)},e.play=function(){this._trailModel&&this._enable&&(this._trailModel.enabled=!0)},e.clear=function(){if(this.enable){for(var t=this._particleTrail.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateRenderData(),this._trailModel&&(this._trailModel.enabled=!1)}},e.updateMaterial=function(){this._particleSystem&&(this._material=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor._defaultTrailMat,this._trailModel&&this._trailModel.setSubModelMaterial(0,this._material))},e.update=function(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem._time,1),this.space===Vr.World&&this._particleSystem._simulationSpace===Vr.Local?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(Pp),this._particleSystem.node.getWorldRotation(Ap)):this._needTransform=!1},e.animate=function(t,e){if(this._trailSegments)if(t.loopCount>t.lastLoop)t.trailDelay>1?(t.lastLoop=t.loopCount,t.trailDelay=0):t.trailDelay++;else{var i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);var r=i.getElement(i.end-1);if(this._needTransform?O.transformMat4(Dp,t.position,Pp):O.copy(Dp,t.position),!(r&&(i.iterateElement(this,this._updateTrailElement,t,e),O.squaredDistance(r.position,Dp)<this._minSquaredDistance))&&(r=i.addElement())){O.copy(r.position,Dp),r.lifetime=0,this.widthFromParticle?r.width=t.size.x*this.widthRatio.evaluate(0,1):r.width=this.widthRatio.evaluate(0,1);var a=i.count();if(2===a){var n=i.getElement(i.end-2);O.subtract(n.velocity,r.position,n.position)}else if(a>2){var o=i.getElement(i.end-2),s=i.getElement(i.end-3);O.subtract(Dp,s.position,o.position),O.subtract(Fp,r.position,o.position),O.subtract(o.velocity,Fp,Dp),O.equals(O.ZERO,o.velocity)&&O.copy(o.velocity,Dp),O.normalize(o.velocity,o.velocity),this._checkDirectionReverse(o,s)}this.colorFromParticle?r.color.set(t.color):r.color.set(this.colorOvertime.evaluate(0,1))}}},e.removeParticle=function(t){var e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))},e.updateRenderData=function(){this.vbOffset=0,this.ibOffset=0;for(var t,e=z(this._particleTrail.keys());!(t=e()).done;){var i=t.value,r=this._particleTrail.get(i);if(-1!==r.start){var a=4*this.vbOffset/this._vertSize,n=r.start>=r.end?r.end+r.trailElements.length:r.end,o=n-r.start,s=1/o,l=r.trailElements[r.start];this._fillVertexBuffer(l,this.colorOverTrail.evaluate(1,1),a,1,0,4);for(var u=r.start+1;u<n;u++){var h=r.trailElements[u%r.trailElements.length],c=u-r.start;this._fillVertexBuffer(h,this.colorOverTrail.evaluate(1-c/o,1),a,1-c*s,c,5)}this._needTransform?O.transformMat4(Cp.position,i.position,Pp):O.copy(Cp.position,i.position);var _=this._trailModel;if(_&&_.node.invalidateChildren(pt.POSITION),1===o||2===o){var d=r.getElement(r.end-1);O.subtract(d.velocity,Cp.position,d.position),this._vbF32[this.vbOffset-this._vertSize/4-4]=d.velocity.x,this._vbF32[this.vbOffset-this._vertSize/4-3]=d.velocity.y,this._vbF32[this.vbOffset-this._vertSize/4-2]=d.velocity.z,this._vbF32[this.vbOffset-4]=d.velocity.x,this._vbF32[this.vbOffset-3]=d.velocity.y,this._vbF32[this.vbOffset-2]=d.velocity.z,O.subtract(Cp.velocity,Cp.position,d.position),this._checkDirectionReverse(Cp,d)}else if(o>2){var p=r.getElement(r.end-1),f=r.getElement(r.end-2);O.subtract(Dp,f.position,p.position),O.subtract(Fp,Cp.position,p.position),O.normalize(Dp,Dp),O.normalize(Fp,Fp),O.subtract(p.velocity,Fp,Dp),O.normalize(p.velocity,p.velocity),this._checkDirectionReverse(p,f),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(p,this.colorOverTrail.evaluate(s,1),a,s,o-1,5),O.subtract(Cp.velocity,Cp.position,p.position),O.normalize(Cp.velocity,Cp.velocity),this._checkDirectionReverse(Cp,p)}this.widthFromParticle?Cp.width=i.size.x*this.widthRatio.evaluate(0,1):Cp.width=this.widthRatio.evaluate(0,1),Cp.color=i.color,O.equals(Cp.velocity,O.ZERO)?this.ibOffset-=3:this._fillVertexBuffer(Cp,this.colorOverTrail.evaluate(0,1),a,0,o,1)}}this._trailModel.enabled=this.ibOffset>0},e.updateIA=function(t){var e=this._trailModel&&this._trailModel.subModels;if(e&&e.length>0){var i=e[0];i.inputAssembler.vertexBuffers[0].update(this._vbF32),i.inputAssembler.indexBuffer.update(this._iBuffer),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=t,this._iaInfoBuffer.update(this._iaInfo)}},e.beforeRender=function(){this.updateIA(this.ibOffset)},e._createModel=function(){this._trailModel||(this._trailModel=c.director.root.createModel(Rt))},e.rebuild=function(){var t=Ot.root.device,e=t.createBuffer(new E(C.VERTEX|C.TRANSFER_DST,A.HOST|A.DEVICE,this._vertSize*(this._trailNum+1)*2,this._vertSize)),i=new ArrayBuffer(this._vertSize*(this._trailNum+1)*2);this._vbF32=new Float32Array(i),this._vbUint32=new Uint32Array(i),e.update(i);var r=t.createBuffer(new E(C.INDEX|C.TRANSFER_DST,A.HOST|A.DEVICE,6*Math.max(1,this._trailNum)*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));this._iBuffer=new Uint16Array(6*Math.max(1,this._trailNum)),r.update(this._iBuffer),this._iaInfoBuffer=t.createBuffer(new E(C.INDIRECT,A.HOST|A.DEVICE,I,I)),this._iaInfo.drawInfos[0].vertexCount=2*(this._trailNum+1),this._iaInfo.drawInfos[0].indexCount=6*this._trailNum,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new P([e],this._vertAttrs,o.TRIANGLE_LIST,r,this._iaInfoBuffer);var a=this._trailModel;a&&(a.node=a.transform=this._particleSystem.node,a.visFlags=this._particleSystem.visibility,a.initSubModel(0,this._subMeshData,this._material),a.enabled=!0)},e._updateTrailElement=function(t,e,i,r){return e.lifetime+=r,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime},e._fillVertexBuffer=function(t,e,i,r,a,n){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,Ip.set(t.color),Ip.multiply(e),this._vbUint32[this.vbOffset++]=Ip._val,this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1-t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=Ip._val,1&n&&(this._iBuffer[this.ibOffset++]=i+2*a,this._iBuffer[this.ibOffset++]=i+2*a-1,this._iBuffer[this.ibOffset++]=i+2*a+1),4&n&&(this._iBuffer[this.ibOffset++]=i+2*a,this._iBuffer[this.ibOffset++]=i+2*a+1,this._iBuffer[this.ibOffset++]=i+2*a+2)},e._checkDirectionReverse=function(t,e){O.dot(t.velocity,e.velocity)<Ep?t.direction=1-e.direction:t.direction=e.direction},e.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},p(t,[{key:"enable",get:function(){return this._enable},set:function(t){t===this._enable&&this._trailModel||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor&&this._particleSystem.processor.updateTrailMaterial()),t&&!this._trailModel&&(this._createModel(),this.rebuild()),this._enable=t,this._trailModel&&(this._trailModel.enabled=t),t?this.onEnable():this.onDisable())}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t;var e=this._particleSystem;e&&e.processor&&e.processor.updateTrailMaterial()}}]),t}(),f((Gh=rc).prototype,"enable",[ch],Object.getOwnPropertyDescriptor(Gh.prototype,"enable"),Gh.prototype),Wh=f(Gh.prototype,"_enable",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xh=f(Gh.prototype,"mode",[_h,x,dh,ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jr.Particles}}),jh=f(Gh.prototype,"lifeTime",[fh,x,mh,yh,vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Kh=f(Gh.prototype,"_minParticleDistance",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),f(Gh.prototype,"minParticleDistance",[bh,gh],Object.getOwnPropertyDescriptor(Gh.prototype,"minParticleDistance"),Gh.prototype),f(Gh.prototype,"space",[Mh,wh,Sh],Object.getOwnPropertyDescriptor(Gh.prototype,"space"),Gh.prototype),Yh=f(Gh.prototype,"existWithParticles",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Zh=f(Gh.prototype,"textureMode",[Th,x,xh,Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kr.Stretch}}),qh=f(Gh.prototype,"widthFromParticle",[x,zh,Rh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Qh=f(Gh.prototype,"widthRatio",[Eh,x,Ch,Ah,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Jh=f(Gh.prototype,"colorFromParticle",[x,Dh,Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$h=f(Gh.prototype,"colorOverTrail",[Ih,x,Bh,Lh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ji}}),tc=f(Gh.prototype,"colorOvertime",[Uh,x,Vh,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ji}}),ec=f(Gh.prototype,"_space",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vr.World}}),ic=f(Gh.prototype,"_particleSystem",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nh=Gh))||Nh),Up=new J,Vp=new Q,Hp=new O,kp=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"],Np=function(){function t(t){this._particleSystem=void 0,this._processor=void 0,this._node=void 0,this._particlesAll=void 0,this._updateList=new Map,this._animateList=new Map,this._runAnimateList=new Array,this._localMat=new J,this._gravity=new M,this.minPos=new O,this.maxPos=new O,this._nodePos=new O,this._nodeSize=new O,this._particleSystem=t,this._processor=this._particleSystem.processor,this._node=t.node,this._particlesAll=[],this._initModuleList()}var e=t.prototype;return e._updateBoundingNode=function(){this._nodeSize.set(this.maxPos.x-this.minPos.x,this.maxPos.y-this.minPos.y,this.maxPos.z-this.minPos.z),this._nodePos.set(this.minPos.x+.5*this._nodeSize.x,this.minPos.y+.5*this._nodeSize.y,this.minPos.z+.5*this._nodeSize.z)},e.setBoundingBoxSize=function(t){this.maxPos.x=this._nodePos.x+t.x,this.maxPos.y=this._nodePos.y+t.y,this.maxPos.z=this._nodePos.z+t.z,this.minPos.x=this._nodePos.x-t.x,this.minPos.y=this._nodePos.y-t.y,this.minPos.z=this._nodePos.z-t.z,this._updateBoundingNode()},e.setBoundingBoxCenter=function(t,e,i){this.maxPos.x=t+.5*this._nodeSize.x,this.maxPos.y=e+.5*this._nodeSize.y,this.maxPos.z=i+.5*this._nodeSize.z,this.minPos.x=t-.5*this._nodeSize.x,this.minPos.y=e-.5*this._nodeSize.y,this.minPos.z=i-.5*this._nodeSize.z,this._updateBoundingNode()},e._initModuleList=function(){var t=this;kp.forEach((function(e){var i=t._particleSystem[e];i&&i.enable&&(i.needUpdate&&(t._updateList[i.name]=i),i.needAnimate&&(t._animateList[i.name]=i))})),this._runAnimateList.length=0;for(var e=0,i=Br.length;e<i;e++){var r=this._animateList[Br[e]];r&&this._runAnimateList.push(r)}},e._emit=function(t,e,i){var r=this._particleSystem,a=this._node,n=r.time%r.duration/r.duration;a.invalidateChildren(pt.POSITION),r.simulationSpace===Vr.World&&(a.getWorldMatrix(Up),a.getWorldRotation(Vp));for(var o=0;o<t;++o){var s=new Qi(r);s.particleSystem=r,s.reset();var l=$(it(0,ft));r._shapeModule&&r._shapeModule.enable?r._shapeModule.emit(s):(O.set(s.position,0,0,0),O.copy(s.velocity,Zr)),r._textureAnimationModule&&r._textureAnimationModule.enable&&r._textureAnimationModule.init(s);var u=r.startSpeed.evaluate(n,l);O.multiplyScalar(s.velocity,s.velocity,u),r.simulationSpace===Vr.World&&(O.transformMat4(s.position,s.position,Up),O.transformQuat(s.velocity,s.velocity,Vp)),O.copy(s.ultimateVelocity,s.velocity),O.set(s.rotation,0,0,0),r.startSize3D?O.set(s.startSize,r.startSizeX.evaluate(n,l),r.startSizeY.evaluate(n,l),r.startSizeZ.evaluate(n,l)):(O.set(s.startSize,r.startSizeX.evaluate(n,l),1,1),s.startSize.y=s.startSize.x),O.copy(s.size,s.startSize),s.startLifetime=r.startLifetime.evaluate(n,l)+e,s.remainingLifetime=s.startLifetime,i.push(s)}},e._updateParticles=function(t,e){var i=this,r=this._particleSystem;switch(r.node.getWorldMatrix(Up),r.scaleSpace){case Vr.Local:r.node.getScale(Hp);break;case Vr.World:r.node.getWorldScale(Hp)}if(this._updateList.forEach((function(t){t.update(r.simulationSpace,Up)})),r.simulationSpace===Vr.Local){var a=r.node.getRotation();J.fromQuat(this._localMat,a),this._localMat.transpose()}for(var n=function(a){var n=e[a];if(n.remainingLifetime-=t,O.set(n.animatedVelocity,0,0,0),r.simulationSpace===Vr.Local){var o=9.8*-r.gravityModifier.evaluate(1-n.remainingLifetime/n.startLifetime,$(n.randomSeed))*t;i._gravity.x=0,i._gravity.y=o,i._gravity.z=0,i._gravity.w=1,i._gravity=i._gravity.transformMat4(i._localMat),n.velocity.x+=i._gravity.x,n.velocity.y+=i._gravity.y,n.velocity.z+=i._gravity.z}else n.velocity.y-=9.8*r.gravityModifier.evaluate(1-n.remainingLifetime/n.startLifetime,$(n.randomSeed))*t;O.copy(n.ultimateVelocity,n.velocity),i._runAnimateList.forEach((function(e){e.animate(n,t)})),O.scaleAndAdd(n.position,n.position,n.ultimateVelocity,t)},o=0;o<e.length;++o)n(o)},e._calculateBounding=function(t){var e=new O,i=new O,r=new O,a=new O,n=new O(1,1,1);if(this._processor.getInfo().renderMode===Nr.Mesh){var o=this._processor.getInfo().mesh;if(o&&o.struct.minPosition&&o.struct.maxPosition){var s=new mt;mt.fromPoints(s,o.struct.minPosition,o.struct.maxPosition);var l=Math.max(s.halfExtents.x,s.halfExtents.y,s.halfExtents.z);n.set(l,l,l)}}for(var u=0;u<this._particlesAll.length;++u){var h=this._particlesAll[u];O.multiply(e,Hp,h.size),O.multiply(e,e,n),i.set(h.position),this._particleSystem.simulationSpace!==Vr.World&&O.transformMat4(i,i,this._particleSystem.node._mat),t&&0===u?(O.subtract(this.minPos,i,e),O.add(this.maxPos,i,e)):(O.subtract(r,i,e),O.add(a,i,e),O.min(this.minPos,this.minPos,r),O.max(this.maxPos,this.maxPos,a))}},e.calculatePositions=function(){this._emit(this._particleSystem.capacity,0,this._particlesAll);var t=$(it(0,ft));this._updateParticles(0,this._particlesAll),this._calculateBounding(!0),this._updateParticles(this._particleSystem.startLifetime.evaluate(0,t),this._particlesAll),this._calculateBounding(!1),this._updateBoundingNode()},e.clear=function(){this._particlesAll.length=0},e.destroy=function(){},t}(),Gp=new J,Wp=new Q,Xp=Object.getOwnPropertyDescriptor(At.prototype,"sharedMaterials"),jp=function(e){return t({ParticleSystem:e,ParticleSystemComponent:e}),e}((ac=e("cc.ParticleSystem"),nc=m(),oc=y(),sc=bt(99),lc=Z(),uc=v(),hc=i(ji),cc=Z(),_c=v(),dc=i(Vr),pc=Z(),fc=v(),mc=Z(),yc=v(),vc=nt("startSize"),bc=q(),gc=i(Be),Mc=Z(),wc=v(),Sc=i(Be),Tc=q(),xc=Z(),Oc=v(),zc=i(Be),Rc=q(),Ec=Z(),Cc=v(),Ac=i(Be),Pc=q(),Dc=Z(),Fc=v(),Ic=Z(),Bc=v(),Lc=i(Be),Uc=q(),Vc=Z(),Hc=v(),kc=i(Be),Nc=q(),Gc=Z(),Wc=v(),Xc=i(Be),jc=nt("startRotation"),Kc=q(),Yc=Z(),Zc=v(),qc=i(Be),Qc=q(),Jc=Z(),$c=v(),t_=i(Be),e_=q(),i_=Z(),r_=v(),a_=Z(),n_=v(),o_=Z(),s_=v(),l_=Z(),u_=v(),h_=i(Vr),c_=Z(),__=v(),d_=Z(),p_=v(),f_=Z(),m_=v(),y_=i(Be),v_=q(),b_=Z(),g_=v(),M_=i(Be),w_=q(),S_=Z(),T_=v(),x_=i(Be),O_=q(),z_=Z(),R_=v(),E_=i([Zl]),C_=Z(),A_=v(),P_=i(Boolean),D_=Z(),F_=v(),I_=i(Hr),B_=Z(),L_=v(),U_=i(Number),V_=Z(),H_=v(),k_=i(Number),N_=Z(),G_=v(),W_=i(Number),X_=Z(),j_=v(),K_=Z(),Y_=v(),Z_=nt("enableCulling"),q_=lt(),Q_=i(_),J_=gt(),$_=i(Yr),td=i(Yr),ed=Z(),id=v(),rd=i($l),ad=i($l),nd=Z(),od=v(),sd=i(kl),ld=i(kl),ud=Z(),hd=v(),cd=i(Yl),_d=i(Yl),dd=Z(),pd=v(),fd=i(_n),md=i(_n),yd=Z(),vd=v(),bd=i(mn),gd=i(mn),Md=Z(),wd=v(),Sd=i(Hl),Td=i(Hl),xd=Z(),Od=v(),zd=i(Xl),Rd=i(Xl),Ed=Z(),Cd=v(),Ad=i(Lp),Pd=i(Lp),Dd=Z(),Fd=v(),Id=i(Rp),Bd=Z(),Ld=v(),ac(Ud=nc(Ud=oc(Ud=sc(Ud=a((zp=Op=function(t){function e(){var e;return e=t.call(this)||this,b(e,"startColor",Hd,g(e)),b(e,"scaleSpace",kd,g(e)),b(e,"startSize3D",Nd,g(e)),b(e,"startSizeX",Gd,g(e)),b(e,"startSizeY",Wd,g(e)),b(e,"startSizeZ",Xd,g(e)),b(e,"startSpeed",jd,g(e)),b(e,"startRotation3D",Kd,g(e)),b(e,"startRotationX",Yd,g(e)),b(e,"startRotationY",Zd,g(e)),b(e,"startRotationZ",qd,g(e)),b(e,"startDelay",Qd,g(e)),b(e,"startLifetime",Jd,g(e)),b(e,"duration",$d,g(e)),b(e,"loop",tp,g(e)),b(e,"simulationSpeed",ep,g(e)),b(e,"playOnAwake",ip,g(e)),b(e,"gravityModifier",rp,g(e)),b(e,"rateOverTime",ap,g(e)),b(e,"rateOverDistance",np,g(e)),b(e,"bursts",op,g(e)),b(e,"_renderCulling",sp,g(e)),b(e,"_cullingMode",lp,g(e)),b(e,"_aabbHalfX",up,g(e)),b(e,"_aabbHalfY",hp,g(e)),b(e,"_aabbHalfZ",cp,g(e)),b(e,"_dataCulling",_p,g(e)),b(e,"_colorOverLifetimeModule",dp,g(e)),b(e,"_shapeModule",pp,g(e)),b(e,"_sizeOvertimeModule",fp,g(e)),b(e,"_velocityOvertimeModule",mp,g(e)),b(e,"_forceOvertimeModule",yp,g(e)),b(e,"_limitVelocityOvertimeModule",vp,g(e)),b(e,"_rotationOvertimeModule",bp,g(e)),b(e,"_textureAnimationModule",gp,g(e)),b(e,"_trailModule",Mp,g(e)),b(e,"renderer",wp,g(e)),e._isPlaying=void 0,e._isPaused=void 0,e._isStopped=void 0,e._isEmitting=void 0,e._needRefresh=void 0,e._time=void 0,e._emitRateTimeCounter=void 0,e._emitRateDistanceCounter=void 0,e._oldWPos=void 0,e._curWPos=void 0,e._boundingBox=void 0,e._culler=void 0,e._oldPos=void 0,e._curPos=void 0,e._isCulled=void 0,e._customData1=void 0,e._customData2=void 0,e._subEmitters=void 0,b(e,"_prewarm",Sp,g(e)),b(e,"_capacity",Tp,g(e)),b(e,"_simulationSpace",xp,g(e)),e.processor=null,e.rateOverTime.constant=10,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e._isPlaying=!1,e._isPaused=!1,e._isStopped=!0,e._isEmitting=!1,e._needRefresh=!0,e._time=0,e._emitRateTimeCounter=0,e._emitRateDistanceCounter=0,e._oldWPos=new O,e._curWPos=new O,e._boundingBox=null,e._culler=null,e._oldPos=null,e._curPos=null,e._isCulled=!1,e._customData1=new Y,e._customData2=new Y,e._subEmitters=[],e}n(e,t);var i=e.prototype;return i.onFocusInEditor=function(){this.renderer.create(this)},i.onLoad=function(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&this._trailModule.onInit(this),this.bindModule(),this._resetPosition()},i._onMaterialModified=function(t,e){null!==this.processor&&this.processor.onMaterialModified(t,e)},i._onRebuildPSO=function(t,e){this.processor.onRebuildPSO(t,e)},i._collectModels=function(){return this._models.length=0,this._models.push(this.processor._model),this._trailModule&&this._trailModule.enable&&this._trailModule._trailModel&&this._models.push(this._trailModule._trailModel),this._models},i._attachToScene=function(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()},i._detachFromScene=function(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene(),this._boundingBox&&(this._boundingBox=null),this._culler&&(this._culler.clear(),this._culler.destroy(),this._culler=null)},i.bindModule=function(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor)},i.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem(),this._trailModule&&this._trailModule.play()},i.pause=function(){this._isStopped?console.warn("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)},i.stop=function(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._isStopped=!0,this._needRefresh=!0},i.clear=function(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear()),this._calculateBounding(!0)},i.getParticleCount=function(){return this.processor.getParticleCount()},i.setCustomData1=function(t,e){Y.set(this._customData1,t,e)},i.setCustomData2=function(t,e){Y.set(this._customData2,t,e)},i.onDestroy=function(){c.director.off(c.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy(),this._culler&&(this._culler.clear(),this._culler.destroy(),this._culler=null)},i.onEnable=function(){c.director.on(c.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()},i.onDisable=function(){c.director.off(c.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable(),this._boundingBox&&(this._boundingBox=null),this._culler&&(this._culler.clear(),this._culler.destroy(),this._culler=null)},i._calculateBounding=function(t){this._boundingBox&&(this._culler||(this._culler=new Np(this)),this._culler.calculatePositions(),mt.fromPoints(this._boundingBox,this._culler.minPos,this._culler.maxPos),t?(this.aabbHalfX=this._boundingBox.halfExtents.x,this.aabbHalfY=this._boundingBox.halfExtents.y,this.aabbHalfZ=this._boundingBox.halfExtents.z):(this.aabbHalfX?this.setBoundingX(this.aabbHalfX):this.aabbHalfX=this._boundingBox.halfExtents.x,this.aabbHalfY?this.setBoundingY(this.aabbHalfY):this.aabbHalfY=this._boundingBox.halfExtents.y,this.aabbHalfZ?this.setBoundingZ(this.aabbHalfZ):this.aabbHalfZ=this._boundingBox.halfExtents.z),this._culler.clear())},i.update=function(t){var e=t*this.simulationSpeed;if(this.renderCulling){var i;if(this._boundingBox||(this._boundingBox=new mt,this._calculateBounding(!1)),this._curPos||(this._curPos=new O),this.node.getWorldPosition(this._curPos),this._oldPos||(this._oldPos=new O,this._oldPos.set(this._curPos)),!this._curPos.equals(this._oldPos)&&this._boundingBox&&this._culler){var r=this._curPos.x-this._oldPos.x,a=this._curPos.y-this._oldPos.y,n=this._curPos.z-this._oldPos.z,o=this._boundingBox.center;o.x+=r,o.y+=a,o.z+=n,this._culler.setBoundingBoxCenter(o.x,o.y,o.z),this._oldPos.set(this._curPos)}var s=null===(i=this.node.scene.renderScene)||void 0===i?void 0:i.cameras,l=!0;if(void 0!==s&&this._boundingBox)for(var u=0;u<s.length;++u){var h=s[u];if((h.visibility&this.node.layer)===this.node.layer&&yt.aabbFrustum(this._boundingBox,h.frustum)){l=!1;break}}if(l){if(this._cullingMode!==Hr.AlwaysSimulate&&this.pause(),this._isCulled||(this.processor.detachFromScene(),this._isCulled=!0),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene(),this._cullingMode===Hr.PauseAndCatchup&&(this._time+=e),this._cullingMode!==Hr.AlwaysSimulate)return}else this._isCulled&&(this._attachToScene(),this._isCulled=!1),this._isPlaying||this.play()}else this._boundingBox&&(this._boundingBox=null),this._culler&&(this._culler.clear(),this._culler.destroy(),this._culler=null);this._isPlaying?(this._time+=e,this._emit(e),0!==this.processor.updateParticles(e)||this._isEmitting||this.stop()):(this.processor.updateRotation(),this.processor.updateScale()),this.processor.updateRenderData(),this._trailModule&&this._trailModule.enable&&this._trailModule.updateRenderData()},i.beforeRender=function(){this._isPlaying&&(this.processor.beforeRender(),this._trailModule&&this._trailModule.enable&&this._trailModule.beforeRender())},i._onVisibilityChange=function(t){this.processor._model&&(this.processor._model.visFlags=t)},i.emit=function(t,e){var i=this._time%this.duration/this.duration;this._needRefresh&&(this.node.invalidateChildren(pt.POSITION),this._needRefresh=!1),this._simulationSpace===Vr.World&&(this.node.getWorldMatrix(Gp),this.node.getWorldRotation(Wp));for(var r=0;r<t;++r){var a=this.processor.getFreeParticle();if(null===a)return;a.particleSystem=this,a.reset();var n=$(it(0,ft));this._shapeModule&&this._shapeModule.enable?this._shapeModule.emit(a):(O.set(a.position,0,0,0),O.copy(a.velocity,Zr)),this._textureAnimationModule&&this._textureAnimationModule.enable&&this._textureAnimationModule.init(a);var o=this.startSpeed.evaluate(i,n);O.multiplyScalar(a.velocity,a.velocity,o),this._simulationSpace===Vr.World&&(O.transformMat4(a.position,a.position,Gp),O.transformQuat(a.velocity,a.velocity,Wp)),O.copy(a.ultimateVelocity,a.velocity),this.startRotation3D?a.startEuler.set(this.startRotationX.evaluate(i,n),this.startRotationY.evaluate(i,n),this.startRotationZ.evaluate(i,n)):a.startEuler.set(0,0,this.startRotationZ.evaluate(i,n)),O.set(a.rotation,a.startEuler.x,a.startEuler.y,a.startEuler.z),this.startSize3D?O.set(a.startSize,this.startSizeX.evaluate(i,n),this.startSizeY.evaluate(i,n),this.startSizeZ.evaluate(i,n)):(O.set(a.startSize,this.startSizeX.evaluate(i,n),1,1),a.startSize.y=a.startSize.x),O.copy(a.size,a.startSize),a.startColor.set(this.startColor.evaluate(i,n)),a.color.set(a.startColor),a.startLifetime=this.startLifetime.evaluate(i,n)+e,a.remainingLifetime=a.startLifetime,a.randomSeed=it(0,233280),a.loopCount++,this.processor.setNewParticle(a)}},i._prewarmSystem=function(){this.startDelay.mode=Ie.Constant,this.startDelay.constant=0;for(var t=this.duration/1,e=0;e<t;++e)this._time+=1,this._emit(1),this.processor.updateParticles(1)},i._emit=function(t){var e=this.startDelay.evaluate(0,1);if(this._time>e){if(this._time>this.duration+e&&!this.loop)return void(this._isEmitting=!1);if(this._emitRateTimeCounter+=this.rateOverTime.evaluate(this._time/this.duration,1)*t,this._emitRateTimeCounter>1&&this._isEmitting){var i=Math.floor(this._emitRateTimeCounter);this._emitRateTimeCounter-=i,this.emit(i,t)}this.node.getWorldPosition(this._curWPos);var r=O.distance(this._curWPos,this._oldWPos);if(O.copy(this._oldWPos,this._curWPos),this._emitRateDistanceCounter+=r*this.rateOverDistance.evaluate(this._time/this.duration,1),this._emitRateDistanceCounter>1&&this._isEmitting){var a=Math.floor(this._emitRateDistanceCounter);this._emitRateDistanceCounter-=a,this.emit(a,t)}for(var n,o=z(this.bursts);!(n=o()).done;)n.value.update(this,t)}},i._resetPosition=function(){this.node.getWorldPosition(this._oldWPos),O.copy(this._curWPos,this._oldWPos)},i.addSubEmitter=function(t){this._subEmitters.push(t)},i.removeSubEmitter=function(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)},i.addBurst=function(t){this.bursts.push(t)},i.removeBurst=function(t){this.bursts.splice(this.bursts.indexOf(t),1)},i.getBoundingX=function(){return this._aabbHalfX},i.getBoundingY=function(){return this._aabbHalfY},i.getBoundingZ=function(){return this._aabbHalfZ},i.setBoundingX=function(t){this._boundingBox&&this._culler&&(this._boundingBox.halfExtents.x=t,this._culler.setBoundingBoxSize(this._boundingBox.halfExtents),this._aabbHalfX=t)},i.setBoundingY=function(t){this._boundingBox&&this._culler&&(this._boundingBox.halfExtents.y=t,this._culler.setBoundingBoxSize(this._boundingBox.halfExtents),this._aabbHalfY=t)},i.setBoundingZ=function(t){this._boundingBox&&this._culler&&(this._boundingBox.halfExtents.z=t,this._culler.setBoundingBoxSize(this._boundingBox.halfExtents),this._aabbHalfZ=t)},i._onBeforeSerialize=function(t){var e=this;return this.dataCulling?t.filter((function(t){return!Lr.includes(t)||e[t]&&e[t].enable})):t},p(e,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=Math.floor(t),this.processor&&this.processor._model&&this.processor._model.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}},{key:"renderCulling",get:function(){return this._renderCulling},set:function(t){this._renderCulling=t,t&&(this._boundingBox||(this._boundingBox=new mt,this._calculateBounding(!1)))}},{key:"cullingMode",get:function(){return this._cullingMode},set:function(t){this._cullingMode=t}},{key:"aabbHalfX",get:function(){return this.getBoundingX()||0},set:function(t){this.setBoundingX(t)}},{key:"aabbHalfY",get:function(){return this.getBoundingY()||0},set:function(t){this.setBoundingY(t)}},{key:"aabbHalfZ",get:function(){return this.getBoundingZ()||0},set:function(t){this.setBoundingZ(t)}},{key:"dataCulling",get:function(){return this._dataCulling},set:function(t){this._dataCulling=t}},{key:"sharedMaterials",get:function(){return Xp.get.call(this)},set:function(t){Xp.set.call(this,t)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){t&&(this._colorOverLifetimeModule=t)}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){t&&(this._shapeModule=t)}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){t&&(this._sizeOvertimeModule=t)}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){t&&(this._velocityOvertimeModule=t)}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){t&&(this._forceOvertimeModule=t)}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){t&&(this._limitVelocityOvertimeModule=t)}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){t&&(this._rotationOvertimeModule=t)}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){t&&(this._textureAnimationModule=t)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){t&&(this._trailModule=t)}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isStopped",get:function(){return this._isStopped}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"time",get:function(){return this._time}}]),e}(At),Op.CullingMode=Hr,f((Vd=zp).prototype,"capacity",[lc,uc],Object.getOwnPropertyDescriptor(Vd.prototype,"capacity"),Vd.prototype),Hd=f(Vd.prototype,"startColor",[hc,x,cc,_c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ji}}),kd=f(Vd.prototype,"scaleSpace",[dc,x,pc,fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vr.Local}}),Nd=f(Vd.prototype,"startSize3D",[x,mc,yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Gd=f(Vd.prototype,"startSizeX",[vc,bc,gc,Mc,wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Wd=f(Vd.prototype,"startSizeY",[Sc,x,Tc,xc,Oc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Xd=f(Vd.prototype,"startSizeZ",[zc,x,Rc,Ec,Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),jd=f(Vd.prototype,"startSpeed",[Ac,x,Pc,Dc,Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Kd=f(Vd.prototype,"startRotation3D",[x,Ic,Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yd=f(Vd.prototype,"startRotationX",[Lc,x,Uc,at,Vc,Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Zd=f(Vd.prototype,"startRotationY",[kc,x,Nc,at,Gc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),qd=f(Vd.prototype,"startRotationZ",[Xc,jc,Kc,at,Yc,Zc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Qd=f(Vd.prototype,"startDelay",[qc,x,Qc,Jc,$c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),Jd=f(Vd.prototype,"startLifetime",[t_,x,e_,i_,r_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),$d=f(Vd.prototype,"duration",[x,a_,n_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),tp=f(Vd.prototype,"loop",[x,o_,s_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),f(Vd.prototype,"prewarm",[l_,u_],Object.getOwnPropertyDescriptor(Vd.prototype,"prewarm"),Vd.prototype),f(Vd.prototype,"simulationSpace",[h_,x,c_,__],Object.getOwnPropertyDescriptor(Vd.prototype,"simulationSpace"),Vd.prototype),ep=f(Vd.prototype,"simulationSpeed",[x,d_,p_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ip=f(Vd.prototype,"playOnAwake",[x,f_,m_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rp=f(Vd.prototype,"gravityModifier",[y_,x,v_,b_,g_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),ap=f(Vd.prototype,"rateOverTime",[M_,x,w_,S_,T_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),np=f(Vd.prototype,"rateOverDistance",[x_,x,O_,z_,R_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Be}}),op=f(Vd.prototype,"bursts",[E_,x,C_,A_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f(Vd.prototype,"renderCulling",[P_,D_,F_],Object.getOwnPropertyDescriptor(Vd.prototype,"renderCulling"),Vd.prototype),sp=f(Vd.prototype,"_renderCulling",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(Vd.prototype,"cullingMode",[I_,B_,L_],Object.getOwnPropertyDescriptor(Vd.prototype,"cullingMode"),Vd.prototype),lp=f(Vd.prototype,"_cullingMode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hr.Pause}}),f(Vd.prototype,"aabbHalfX",[U_,V_,H_],Object.getOwnPropertyDescriptor(Vd.prototype,"aabbHalfX"),Vd.prototype),up=f(Vd.prototype,"_aabbHalfX",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(Vd.prototype,"aabbHalfY",[k_,N_,G_],Object.getOwnPropertyDescriptor(Vd.prototype,"aabbHalfY"),Vd.prototype),hp=f(Vd.prototype,"_aabbHalfY",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(Vd.prototype,"aabbHalfZ",[W_,X_,j_],Object.getOwnPropertyDescriptor(Vd.prototype,"aabbHalfZ"),Vd.prototype),cp=f(Vd.prototype,"_aabbHalfZ",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f(Vd.prototype,"dataCulling",[K_,Y_],Object.getOwnPropertyDescriptor(Vd.prototype,"dataCulling"),Vd.prototype),_p=f(Vd.prototype,"_dataCulling",[x,Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f(Vd.prototype,"sharedMaterials",[vt,q_,Q_,x,J_],Object.getOwnPropertyDescriptor(Vd.prototype,"sharedMaterials"),Vd.prototype),dp=f(Vd.prototype,"_colorOverLifetimeModule",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"colorOverLifetimeModule",[td,ed,id],Object.getOwnPropertyDescriptor(Vd.prototype,"colorOverLifetimeModule"),Vd.prototype),pp=f(Vd.prototype,"_shapeModule",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"shapeModule",[ad,nd,od],Object.getOwnPropertyDescriptor(Vd.prototype,"shapeModule"),Vd.prototype),fp=f(Vd.prototype,"_sizeOvertimeModule",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"sizeOvertimeModule",[ld,ud,hd],Object.getOwnPropertyDescriptor(Vd.prototype,"sizeOvertimeModule"),Vd.prototype),mp=f(Vd.prototype,"_velocityOvertimeModule",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"velocityOvertimeModule",[_d,dd,pd],Object.getOwnPropertyDescriptor(Vd.prototype,"velocityOvertimeModule"),Vd.prototype),yp=f(Vd.prototype,"_forceOvertimeModule",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"forceOvertimeModule",[md,yd,vd],Object.getOwnPropertyDescriptor(Vd.prototype,"forceOvertimeModule"),Vd.prototype),vp=f(Vd.prototype,"_limitVelocityOvertimeModule",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"limitVelocityOvertimeModule",[gd,Md,wd],Object.getOwnPropertyDescriptor(Vd.prototype,"limitVelocityOvertimeModule"),Vd.prototype),bp=f(Vd.prototype,"_rotationOvertimeModule",[Sd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"rotationOvertimeModule",[Td,xd,Od],Object.getOwnPropertyDescriptor(Vd.prototype,"rotationOvertimeModule"),Vd.prototype),gp=f(Vd.prototype,"_textureAnimationModule",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"textureAnimationModule",[Rd,Ed,Cd],Object.getOwnPropertyDescriptor(Vd.prototype,"textureAnimationModule"),Vd.prototype),Mp=f(Vd.prototype,"_trailModule",[Ad],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(Vd.prototype,"trailModule",[Pd,Dd,Fd],Object.getOwnPropertyDescriptor(Vd.prototype,"trailModule"),Vd.prototype),wp=f(Vd.prototype,"renderer",[Id,x,Bd,Ld],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rp}}),Sp=f(Vd.prototype,"_prewarm",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tp=f(Vd.prototype,"_capacity",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),xp=f(Vd.prototype,"_simulationSpace",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vr.Local}}),Ud=Vd))||Ud)||Ud)||Ud)||Ud)||Ud)),Kp=t("ParticleUtils",function(){function t(){}return t.instantiate=function(t){return this.registeredSceneEvent||(Ot.on(zt.EVENT_BEFORE_SCENE_LAUNCH,this.onSceneUnload,this),this.registeredSceneEvent=!0),this.particleSystemPool.has(t._uuid)||this.particleSystemPool.set(t._uuid,new dt((function(){return Mt(t)||new wt}),1,(function(t){return t.destroy()}))),this.particleSystemPool.get(t._uuid).alloc()},t.destroy=function(t){this.particleSystemPool.has(t._prefab.asset._uuid)&&(this.stop(t),this.particleSystemPool.get(t._prefab.asset._uuid).free(t))},t.play=function(t){for(var e,i=z(t.getComponentsInChildren(jp));!(e=i()).done;)e.value.play()},t.stop=function(t){for(var e,i=z(t.getComponentsInChildren(jp));!(e=i()).done;)e.value.stop()},t.onSceneUnload=function(){this.particleSystemPool.forEach((function(t){return t.destroy()})),this.particleSystemPool.clear()},t}());Kp.particleSystemPool=new Map,Kp.registeredSceneEvent=!1,St(Zl.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),Tt(jp.prototype,"ParticleSystem.prototype",[{name:"enableCulling",newName:"dataCulling"}]),c.ParticleSystemComponent=jp,xt.setClassAlias(jp,"cc.ParticleSystemComponent"),c.BillboardComponent=Ee,xt.setClassAlias(Ee,"cc.BillboardComponent"),c.LineComponent=qi,xt.setClassAlias(qi,"cc.LineComponent"),c.ParticleUtils=Kp}}}));

System.register(["./json-asset-7bb011fd.js","./spot-light-44c8b89f.js","./deprecated-229f0693.js","./renderable-component-0ffd84e0.js","./transform-utils-ec8404a7.js"],(function(e,t){"use strict";var i,n,r,a,s,o,u,c,l,h,f,d,p,_,m,g,v,y,b,w,T,E,S,A,N,x,I,R,C,P,k,M,D,O,F,L,B,U,z,W,j,V,H,G,q,Y,X,Q,Z,J,K,$,ee,te,ie,ne,re,ae,se,oe,ue,ce,le,he,fe,de,pe,_e,me,ge,ve,ye,be,we,Te,Ee,Se,Ae,Ne,xe,Ie,Re,Ce,Pe,ke,Me,De,Oe,Fe,Le,Be,Ue,ze,We,je,Ve,He,Ge,qe,Ye,Xe,Qe,Ze,Je,Ke,$e,et,tt,it,nt,rt,at,st,ot,ut,ct,lt,ht,ft,dt,pt,_t,mt,gt,vt,yt,bt,wt,Tt,Et,St,At,Nt,xt,It,Rt,Ct,Pt,kt,Mt,Dt,Ot,Ft,Lt,Bt,Ut,zt,Wt,jt,Vt,Ht,Gt,qt,Yt,Xt,Qt,Zt,Jt,Kt,$t,ei,ti,ii,ni,ri,ai,si,oi,ui,ci,li,hi,fi,di,pi,_i,mi,gi,vi,yi,bi,wi,Ti,Ei,Si,Ai,Ni,xi,Ii,Ri,Ci,Pi,ki,Mi,Di,Oi,Fi,Li,Bi,Ui,zi,Wi,ji,Vi,Hi,Gi,qi,Yi,Xi,Qi,Zi,Ji,Ki,$i,en,tn,nn,rn,an,sn,on,un,cn,ln,hn,fn,dn,pn,_n,mn,gn,vn,yn;return{setters:[function(e){i=e.c1,n=e.c2,r=e.c3,a=e.c4,s=e.c5,o=e.c6,u=e.c7,c=e.c8,l=e.c9,h=e.ca,f=e.cb,d=e.cc,p=e.cd,_=e.ce,m=e.cf,g=e.cg,v=e.ch,y=e.ci,b=e.cj,w=e.ck,T=e.cl,E=e.cm,S=e.cn,A=e.co,N=e.cp,x=e.cq,I=e.cr,R=e.cs,C=e.ct,P=e.cu,k=e.cv,M=e.cw,D=e.cx,O=e.cy,F=e.cz,L=e.cA,B=e.cB,U=e.cC,z=e.cD,W=e.cE,j=e.cF,V=e.cG,H=e.eT,G=e.eU,q=e.eg,Y=e.eV,X=e.eW,Q=e.eX,Z=e.eY,J=e.ee,K=e.ed,$=e.eZ,ee=e.e_,te=e.ef,ie=e.e$,ne=e.f0,re=e.f1,ae=e.f2,se=e.f3,oe=e.f4,ue=e.f5,ce=e.f6,le=e.f7,he=e.f8,fe=e.f9,de=e.fa,pe=e.e,_e=e.aq,me=e.l,ge=e.ai,ve=e.au,ye=e.z,be=e.G,we=e.aL,Te=e.x,Ee=e.aN,Se=e.dp,Ae=e.aB,Ne=e.N,xe=e.az,Ie=e.H,Re=e.I,Ce=e.dE,Pe=e.eA,ke=e.ej,Me=e.fb,De=e.v,Oe=e.ao,Fe=e.cI,Le=e.ew,Be=e.g,Ue=e.f,ze=e.d,We=e.c,je=e.fc,Ve=e.fd,He=e.eR,Ge=e.aV,qe=e.eS,Ye=e.t,Xe=e.aO,Qe=e.aP,Ze=e.a0,Je=e.aS,Ke=e.dQ,$e=e.F,et=e.P,tt=e.dh,it=e.dI,nt=e.cZ,rt=e.fe,at=e.e8,st=e.dH,ot=e.ff,ut=e.fg,ct=e.dL,lt=e.ey,ht=e.db,ft=e.cQ,dt=e.cR,pt=e.cS,_t=e.fh,mt=e.fi,gt=e.fj,vt=e.fk,yt=e.fl,bt=e.fm,wt=e.dd,Tt=e.fn,Et=e.c_,St=e.fo,At=e.fp,Nt=e.fq,xt=e.fr,It=e.fs,Rt=e.ft,Ct=e.dx,Pt=e.fu,kt=e.fv,Mt=e.eN,Dt=e.dA,Ot=e.fw,Ft=e.m,Lt=e.fx,Bt=e.k,Ut=e.fy,zt=e.dk,Wt=e.dj,jt=e.di,Vt=e.de,Ht=e.fz,Gt=e.fA,qt=e.dl,Yt=e.fB,Xt=e.fC,Qt=e.fD,Zt=e.fE,Jt=e.fF,Kt=e.fG,$t=e.fH,ei=e.fI,ti=e.fJ,ii=e.fK,ni=e.fL,ri=e.fM,ai=e.fN,si=e.i,oi=e.fO,ui=e.fP,ci=e.fQ,li=e.o,hi=e.dB,fi=e.fR,di=e.n,pi=e.eq,_i=e.ev,mi=e.er,gi=e.es,vi=e.et,yi=e.ez,bi=e.fS,wi=e.ae,Ti=e.dJ,Ei=e.dq,Si=e.fT,Ai=e.fU,Ni=e.fV,xi=e.fW,Ii=e.eu,Ri=e.dO,Ci=e.fX,Pi=e.bR,ki=e.T,Mi=e.bO,Di=e.w,Oi=e.fY,Fi=e.fZ,Li=e.f_,Bi=e.f$,Ui=e.g0,zi=e.d2,Wi=e.g1,ji=e.g2,Vi=e.g3,Hi=e.g4,Gi=e.cJ,qi=e.g5,Yi=e.g6,Xi=e.dR},function(e){Qi=e.L,Zi=e.R,Ji=e.e,Ki=e.m,$i=e.a,en=e.C,tn=e.b,nn=e.d,rn=e.c,an=e.S},function(e){sn=e.F,on=e.D,un=e.g,cn=e.G,ln=e.v},function(){},function(e){hn=e.q,fn=e.A,dn=e.j,pn=e.k,_n=e.r,mn=e.t,gn=e.u,vn=e.H,yn=e.c}],execute:function(){e({V:void 0,e:Tn,q:oh,s:uh,t:ch});var bn=Object.freeze({__proto__:null,bits:i,Vec2:n,v2:r,Vec3:a,v3:s,Vec4:o,v4:u,Quat:c,quat:l,Mat3:h,Mat4:f,mat4:d,AffineTransform:p,Size:_,size:m,Rect:g,rect:v,Color:y,color:b,EPSILON:w,equals:T,approx:E,clamp:S,clamp01:A,lerp:N,toRadian:x,toDegree:I,random:R,randomRange:C,randomRangeInt:P,pseudoRandom:k,pseudoRandomRange:M,pseudoRandomRangeInt:D,nextPow2:O,repeat:F,pingPong:L,inverseLerp:B,absMaxComponent:U,absMax:z,enumerableProps:W,MATH_FLOAT_ARRAY:j,MathBase:V});e("m",bn);var wn=Object.freeze({__proto__:null,distance:H,enums:G,intersect:q,Line:Y,Plane:X,Ray:Q,Triangle:Z,Sphere:J,AABB:K,OBB:$,Capsule:ee,Frustum:te,Keyframe:ie,AnimationCurve:ne,get ERaycastMode(){return re},line:ae,plane:se,ray:oe,triangle:ue,sphere:ce,aabb:le,obb:he,capsule:fe,frustum:de});function Tn(){var e=new sn;return e.initialize({flows:[]}),e}e("g",wn);var En=new n,Sn=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.isPause=!1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.pauseRendering=function(){this.isPause=!0},e.resumeRendering=function(){this.isPause=!1},e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.settings=window._CCSettings.splashScreen;t.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,t.base64src=this.settings.base64src||"",t.effect=this.settings.effect||"FADE-INOUT",t.clearColor=this.settings.clearColor||new _e(.88,.88,.88,1),t.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,t.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new _e(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{me.view.resizeWithBrowserSize(!0);var i=window._CCSettings.designResolution;i?me.view.setDesignResolutionSize(i.width,i.height,i.policy):me.view.setDesignResolutionSize(960,640,4),this.device=e.device,this.swapchain=e.mainWindow.swapchain,this.framebuffer=e.mainWindow.framebuffer,me.game.once(me.Game.EVENT_GAME_INITED,(function(){me.director._lateUpdate=performance.now()}),me.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else pe("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),me.game.resume())},e.preInit=function(){var e=this.settings.clearColor;this.clearColors=[new _e(e.x,e.y,e.z,e.w)];var t=this.device,i=this.swapchain;this.renderArea=new ge(0,0,i.width,i.height),this.cmdBuff=t.commandBuffer;var n=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),r=4*Float32Array.BYTES_PER_ELEMENT,a=4*r;this.vertexBuffers=t.createBuffer(new ve(ye.VERTEX|ye.TRANSFER_DST,be.DEVICE,a,r)),this.vertexBuffers.update(n);var s=new Uint16Array([0,1,2,1,3,2]),o=Uint16Array.BYTES_PER_ELEMENT,u=6*o;this.indicesBuffers=t.createBuffer(new ve(ye.INDEX|ye.TRANSFER_DST,be.DEVICE,u,o)),this.indicesBuffers.update(s);var c=[new we("a_position",Te.RG32F),new we("a_texCoord",Te.RG32F)],l=new Ee(c,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=t.createInputAssembler(l),this.projection=new f,f.ortho(this.projection,-1,1,-1,1,-1,1,t.capabilities.clipSpaceMinZ,t.capabilities.clipSpaceSignY,i.surfaceTransform)},e.init=function(){var e=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),me.game.pause(),this.handle=requestAnimationFrame((function t(i){if(!e.cancelAnimate){var n=e.settings,r=e.device,a=e.swapchain;f.ortho(e.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,a.surfaceTransform);var s=a.width,o=a.height,u=s<o?s:o;e.startTime<0&&(e.startTime=i);var c=i-e.startTime,l=A(c/n.totalTime),h=Me(l);"NONE"===n.effect&&(h=1);var d=e.logoTexture.width,p=e.logoTexture.height,_=u*n.displayRatio,m=_*d/p,g=_;if(a.surfaceTransform!==De.ROTATE_90&&a.surfaceTransform!==De.ROTATE_270||(m=_*s/o,g=_*p/d*o/s),e.logoMat.setProperty("resolution",En.set(s,o),0),e.logoMat.setProperty("scale",En.set(m,g),0),e.logoMat.setProperty("translate",En.set(.5*s,.5*o),0),e.logoMat.setProperty("percent",h),e.logoMat.setProperty("u_projection",e.projection),e.logoMat.passes[0].update(),n.displayWatermark&&e.watermarkMat){var v=.5*u,y=e.watermarkTexture.width,b=v,w=v*e.watermarkTexture.height/y;a.surfaceTransform!==De.ROTATE_90&&a.surfaceTransform!==De.ROTATE_270||(b=.5*v,w=v*s/o*.5),e.watermarkMat.setProperty("resolution",En.set(s,o),0),e.watermarkMat.setProperty("scale",En.set(b,w),0),e.watermarkMat.setProperty("translate",En.set(.5*s,.1*o),0),e.watermarkMat.setProperty("percent",h),e.watermarkMat.setProperty("u_projection",e.projection),e.watermarkMat.passes[0].update()}e.isPause||(e.frame(),c>n.totalTime&&(e.splashFinish=!0)),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.initLogo=function(){var e=this.device;this.logoMat=new Se,this.logoMat.initialize({effectName:"splash-screen"});var t=new Ae;t.addressU=Ne.CLAMP,t.addressV=Ne.CLAMP,t.addressW=Ne.CLAMP,this.sampler=e.getSampler(t),this.logoTexture=e.createTexture(new xe(Ie.TEX2D,Re.SAMPLED|Re.TRANSFER_DST,Te.RGBA8,this.logoImage.width,this.logoImage.height));var i=this.logoMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.logoTexture),this.shader=i.getShaderVariant();var r=i.descriptorSet;r.bindSampler(n,this.sampler),r.update();var a=new Oe;a.texExtent.width=this.logoImage.width,a.texExtent.height=this.logoImage.height,a.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[a])},e.initWarterMark=function(){var e=document.createElement("canvas");e.width=330,e.height=30,e.style.width=""+e.width,e.style.height=""+e.height;var t=e.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var i="Powered by Cocos Creator",n=t.measureText(i);t.fillText(i,(330-n.width)/2,6);var r=new Oe;r.texExtent.width=e.width,r.texExtent.height=e.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new xe(Ie.TEX2D,Re.SAMPLED|Re.TRANSFER_DST,Te.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[r]),this.watermarkMat=new Se,this.watermarkMat.initialize({effectName:"splash-screen"});var a=this.watermarkMat.passes[0],s=a.getBinding("mainTexture");a.bindTexture(s,this.watermarkTexture),a.descriptorSet.update()},e.frame=function(){var e=this.device,t=this.swapchain;e.acquire([t]);var i=this.cmdBuff,n=this.framebuffer,r=this.renderArea;r.width=t.width,r.height=t.height,i.begin(),i.beginRenderPass(n.renderPass,n,r,this.clearColors,1,0);var a=this.logoMat.passes[0],s=Ce.getOrCreatePipelineState(e,a,this.shader,n.renderPass,this.quadAssmebler);if(i.bindPipelineState(s),i.bindDescriptorSet(Pe.MATERIAL,a.descriptorSet),i.bindInputAssembler(this.quadAssmebler),i.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var o=this.watermarkMat.passes[0],u=Ce.getOrCreatePipelineState(e,o,this.shader,n.renderPass,this.quadAssmebler);i.bindPipelineState(u),i.bindDescriptorSet(Pe.MATERIAL,o.descriptorSet),i.bindInputAssembler(this.quadAssmebler),i.draw(this.quadAssmebler)}i.endRenderPass(),i.end(),e.flushCommands([i]),e.queue.submit([i]),e.present()},e.destroy=function(){this.callBack=null,this.device=null,this.swapchain=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,t._ins=void 0},ke(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();Sn._ins=void 0,me.internal.SplashScreen=Sn;var An=e("j",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},ke(e,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}}]),e}());An.Priority=Fe({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:1<<31>>>0});var Nn=new Ve("Scheduler"),xn=function(e,t,i,n){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=i,this.markedForDeletion=n};xn.get=function(e,t,i,n){var r=xn._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=i,r.markedForDeletion=n):r=new xn(e,t,i,n),r},xn.put=function(e){xn._listEntries.length<20&&(e.target=null,xn._listEntries.push(e))},xn._listEntries=[];var In=function(e,t,i,n){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=i,this.callback=n};In.get=function(e,t,i,n){var r=In._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=i,r.callback=n):r=new In(e,t,i,n),r},In.put=function(e){In._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,In._hashUpdateEntries.push(e))},In._hashUpdateEntries=[];var Rn=function(e,t,i,n,r,a){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=a};Rn.get=function(e,t,i,n,r,a){var s=Rn._hashTimerEntries.pop();return s?(s.timers=e,s.target=t,s.timerIndex=i,s.currentTimer=n,s.currentTimerSalvaged=r,s.paused=a):s=new Rn(e,t,i,n,r,a),s},Rn.put=function(e){Rn._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,Rn._hashTimerEntries.push(e))},Rn._hashTimerEntries=[];var Cn=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,i,n,r,a){return this._lock=!1,this._scheduler=e,this._target=i,this._callback=t,this._elapsed=-1,this._interval=n,this._delay=a,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===me.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();Cn._timers=[],Cn.get=function(){return Cn._timers.pop()||new Cn},Cn.put=function(e){Cn._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,Cn._timers.push(e))};var Pn,kn=e("c",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=je(!0),t._hashForTimers=je(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}Le(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?ze(1513):e.id=Nn.getNewId())};var i=t.prototype;return i.setTimeScale=function(e){this._timeScale=e},i.getTimeScale=function(){return this._timeScale},i.update=function(e){var t,i,n,r,a;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,n=(i=this._updatesNegList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updates0List).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updatesPosList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);var s=this._arrayForTimers;for(t=0;t<s.length;t++){if(a=s[t],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(e),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,i=this._updatesNegList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updates0List;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updatesPosList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(e,t,i,n,r,a){if("function"!=typeof e){var s=e;e=t,t=s}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!n,n=me.macro.REPEAT_FOREVER,r=0),Be(t,1502);var o=t.uuid||t.id;if(o){var u,c,l=this._hashForTimers[o];if(l?l.paused!==a&&ze(1511):(l=Rn.get(null,t,0,null,null,a),this._arrayForTimers.push(l),this._hashForTimers[o]=l),null==l.timers)l.timers=[];else for(c=0;c<l.timers.length;++c)if((u=l.timers[c])&&e===u._callback)return We(1507,u.getInterval(),i),void(u._interval=i);(u=Cn.get()).initWithCallback(this,e,t,i,n,r),l.timers.push(u),this._currentTarget===l&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else Ue(1510)},i.scheduleUpdate=function(e,t,i){var n=e.uuid||e.id;if(n){var r=this._hashForUpdates[n];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return We(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(e)}var a,s=xn.get(e,t,i,!1);0===t?(a=this._updates0List,this._appendIn(a,s)):(a=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,s,t)),this._hashForUpdates[n]=In.get(a,s,e,null)}else Ue(1510)},i.unschedule=function(e,t){if(t&&e){var i=t.uuid||t.id;if(i){var n=this._hashForTimers[i];if(n)for(var r=n.timers,a=0,s=r.length;a<s;a++){var o=r[a];if(e===o._callback)return o!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(a,1),Cn.put(o),n.timerIndex>=a&&n.timerIndex--,void(0===r.length&&(this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)))}}else Ue(1510)}},i.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForUpdates[t];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else Ue(1510)}},i.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];if(i){var n=i.timers;n.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var r=0,a=n.length;r<a;r++)Cn.put(n[r]);n.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(e)}else Ue(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(An.Priority.SCHEDULER)},i.unscheduleAllWithMinPriority=function(e){var t,i,n,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)i=r[t],this.unscheduleAllForTarget(i.target);var a=0;if(e<0)for(t=0;t<this._updatesNegList.length;)a=this._updatesNegList.length,(n=this._updatesNegList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),a===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)a=this._updates0List.length,(n=this._updates0List[t])&&this.unscheduleUpdate(n.target),a===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)a=this._updatesPosList.length,(n=this._updatesPosList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),a===this._updatesPosList.length&&t++},i.isScheduled=function(e,t){Be(e,1508),Be(t,1509);var i=t.uuid||t.id;if(!i)return Ue(1510),!1;var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,a=0;a<r.length;++a)if(e===r[a]._callback)return!0;return!1},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(An.Priority.SCHEDULER)},i.pauseAllTargetsWithMinPriority=function(e){var t,i,n,r,a=[],s=this._arrayForTimers;for(i=0,n=s.length;i<n;i++)(t=s[i])&&(t.paused=!0,a.push(t.target));if(e<0)for(i=0;i<this._updatesNegList.length;i++)(r=this._updatesNegList[i])&&r.priority>=e&&(r.paused=!0,a.push(r.target));if(e<=0)for(i=0;i<this._updates0List.length;i++)(r=this._updates0List[i])&&(r.paused=!0,a.push(r.target));for(i=0;i<this._updatesPosList.length;i++)(r=this._updatesPosList[i])&&r.priority>=e&&(r.paused=!0,a.push(r.target));return a},i.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},i.pauseTarget=function(e){Be(e,1503);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!0);var n=this._hashForUpdates[t];n&&(n.entry.paused=!0)}else Ue(1510)},i.resumeTarget=function(e){Be(e,1504);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!1);var n=this._hashForUpdates[t];n&&(n.entry.paused=!1)}else Ue(1510)},i.isTargetPaused=function(e){Be(e,1505);var t=e.uuid||e.id;if(!t)return Ue(1510),!1;var i=this._hashForTimers[t];if(i)return i.paused;var n=this._hashForUpdates[t];return!!n&&n.entry.paused},i._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var i=this._arrayForTimers,n=0,r=i.length;n<r;n++)if(i[n]===e){i.splice(n,1);break}Rn.put(e)},i._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,i=this._hashForUpdates[t];if(i){for(var n=i.list,r=i.entry,a=0,s=n.length;a<s;a++)if(n[a]===r){n.splice(a,1);break}delete this._hashForUpdates[t],xn.put(r),In.put(i)}},i._priorityIn=function(e,t,i){for(var n=0;n<e.length;n++)if(i<e[n].priority)return void e.splice(n,0,t);e.push(t)},i._appendIn=function(e,t){e.push(t)},t}(An));kn.ID="scheduler",me.Scheduler=kn;var Mn=((Pn={})[He.PORTRAIT]=De.IDENTITY,Pn[He.LANDSCAPE_RIGHT]=De.ROTATE_90,Pn[He.PORTRAIT_UPSIDE_DOWN]=De.ROTATE_180,Pn[He.LANDSCAPE_LEFT]=De.ROTATE_270,Pn),Dn=function(){function e(){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}};var t=e.prototype;return t.initialize=function(e,t){if(this._init(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchain&&(this._swapchain=t.swapchain),this._width=t.width,this._height=t.height,this._renderPass=e.createRenderPass(t.renderPassInfo),t.swapchain)this._setSwapchain(t.swapchain),this._colorTextures.push(t.swapchain.colorTexture),this._depthStencilTexture=t.swapchain.depthStencilTexture;else{for(var i=0;i<t.renderPassInfo.colorAttachments.length;i++)this._colorTextures.push(e.createTexture(new xe(Ie.TEX2D,Re.COLOR_ATTACHMENT|Re.SAMPLED|Re.TRANSFER_SRC,t.renderPassInfo.colorAttachments[i].format,this._width,this._height)));t.renderPassInfo.depthStencilAttachment.format!==Te.UNKNOWN&&(this._depthStencilTexture=e.createTexture(new xe(Ie.TEX2D,Re.DEPTH_STENCIL_ATTACHMENT|Re.SAMPLED,t.renderPassInfo.depthStencilAttachment.format,this._width,this._height)))}return this._setFrameBuffer(e.createFramebuffer(new Ge(this._renderPass,this._colorTextures,this._depthStencilTexture))),!0},t.destroy=function(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._destroy()},t.resize=function(e,t){if(this._swapchain)this._swapchain.resize(e,t,Mn[qe.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(var i=0;i<this._colorTextures.length;i++)this._colorTextures[i].resize(e,t);this._depthStencilTexture&&this._depthStencilTexture.resize(e,t),this._width=e,this._height=t}this.framebuffer&&(this.framebuffer.destroy(),this.framebuffer.initialize(new Ge(this._renderPass,this._colorTextures,this._depthStencilTexture)));for(var n,r=Ye(this._cameras);!(n=r()).done;)n.value.resize(e,t)},t.extractRenderCameras=function(e){for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t];i.enabled&&(i.update(),e.push(i))}},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},t._init=function(){},t._destroy=function(){},t._setSwapchain=function(e){this._swapchain=e},t._setFrameBuffer=function(e){this._framebuffer=e},ke(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"swapchain",get:function(){return this._swapchain}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"cameras",get:function(){return this._cameras}},{key:"native",get:function(){return this._nativeObj}}]),e}(),On=function(){var e=t.prototype;function t(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._useDeferredPipeline=!1,this._fixedFPSFrameTime=0,this._cumulativeTime=0,this._frameTime=0,this._device=e,this._dataPoolMgr=me.internal.DataPoolManager&&new me.internal.DataPoolManager(e),Zi.registerCreateFunc(this),Dn.registerCreateFunc(this),this._cameraPool=new et((function(){return new Ji(t._device)}),4,(function(e){return e.destroy()}))}return e._init=function(){},e._destroy=function(){},e._setCumulativeTime=function(e){this._cumulativeTime+=e},e._setFrameTime=function(e){this._frameTime=e},e.initialize=function(){this._init();var e=me.game._swapchain,t=new Xe;t.format=e.colorTexture.format;var i=new Qe;i.format=e.depthStencilTexture.format,i.depthStoreOp=Ze.DISCARD,i.stencilStoreOp=Ze.DISCARD;var n=new Je([t],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:e.width,height:e.height,renderPassInfo:n,swapchain:e}),this._curWindow=this._mainWindow,Promise.resolve(Ke.initBuiltinRes(this._device))},e.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._destroy()},e.resize=function(e,t){for(var i,n=Ye(this._windows);!(i=n()).done;){var r=i.value;r.swapchain&&r.resize(e,t)}},e.setRenderPipeline=function(e){e instanceof on&&(this._useDeferredPipeline=!0);var t=!1;if(e||(e=Tn(),t=!0),this._pipeline=e,this._useDeferredPipeline&&this.device.hasFeature($e.COMPUTE_SHADER)||(this._pipeline.clusterEnabled=!1),this._pipeline.bloomEnabled=!1,!this._pipeline.activate(this._mainWindow.swapchain))return t&&this._pipeline.destroy(),this._pipeline=null,!1;var i=me.director.getScene();return i&&i.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&me.internal.Batcher2D&&(this._batcher=new me.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},e.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.onGlobalPipelineStateChanged()},e.activeWindow=function(e){this._curWindow=e},e.resetCumulativeTime=function(){this._setCumulativeTime(0)},e.frameMove=function(e){this._setFrameTime(e),++this._frameCount,this._setCumulativeTime(e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var t=0;t<this._scenes.length;++t)this._scenes[t].removeBatches();this._batcher&&this._batcher.update();for(var i=this._windows,n=[],r=0;r<i.length;r++)i[r].extractRenderCameras(n);if(this._pipeline&&n.length>0){this._device.acquire([me.game._swapchain]);var a=this._scenes,s=me.director.getTotalFrames();this._batcher&&this._batcher.uploadBuffers();for(var o=0;o<a.length;o++)a[o].update(s);me.director.emit(me.Director.EVENT_BEFORE_COMMIT),n.sort((function(e,t){return e.priority-t.priority})),this._pipeline.render(n),this._device.present()}this._batcher&&this._batcher.reset()},e.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},e.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},e.destroyWindows=function(){for(var e,t=Ye(this._windows);!(e=t()).done;)e.value.destroy();this._windows.length=0},e.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},e.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},e.destroyScenes=function(){for(var e,t=Ye(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes.length=0},e.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new et((function(){return new e}),10,(function(e){return e.destroy()}))),t=this._modelPools.get(e));var i=t.alloc();return i.initialize(),i},e.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):ze(1300,e.constructor.name)},e.createCamera=function(){return this._cameraPool.alloc()},e.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new et((function(){return new e}),4,(function(e){return e.destroy()}))),t=this._lightPools.get(e));var i=t.alloc();return i.initialize(),i},e.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case Qi.SPHERE:e.scene.removeSphereLight(e);break;case Qi.SPOT:e.scene.removeSpotLight(e)}},ke(t,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(e){this._curWindow=e}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(e){this._tempWindow=e}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return this._cumulativeTime}},{key:"frameTime",get:function(){return this._frameTime}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),t}();me.Root=On;var Fn=e("D",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._scheduler=new kn,t._compScheduler=new ut,t._nodeActivator=new ct,t._systems=[],un.once(cn.EVENT_RENDERER_INITED,t._initOnRendererInitialized,lt(t)),t}Le(t,e);var i=t.prototype;return i.calculateDeltaTime=function(){},i.end=function(){var e=this;this.once(t.EVENT_END_FRAME,(function(){e.purgeDirector()}))},i.pause=function(){this._paused||(this._paused=!0)},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),me.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),me.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),this.startAnimation()},i.runSceneImmediate=function(e,t,i){e instanceof tt&&(e=e.scene),Be(e instanceof it,1216),e._load();for(var n=Object.keys(un._persistRootNodes).map((function(e){return un._persistRootNodes[e]})),r=0;r<n.length;r++){var a=n[r];a.emit(me.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var s=e.uuid===a._originalSceneId&&e.getChildByUuid(a.uuid);if(s){var o=s.getSiblingIndex();s._destroyImmediate(),e.insertChild(a,o)}else a.parent=e}var u=this._scene;me.isValid(u)&&u.destroy(),me.assetManager._releaseManager._autoRelease(u,e,un._persistRootNodes),this._scene=null,nt._deferredDestroy(),t&&t(),this.emit(me.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,e),this.emit(me.Director.EVENT_AFTER_SCENE_LAUNCH,e)},i.runScene=function(e,t,i){var n=this;e instanceof tt&&(e=e.scene),Be(e,1205),Be(e instanceof it,1216),e._load(),this.once(me.Director.EVENT_END_FRAME,(function(){n.runSceneImmediate(e,t,i)}))},i.loadScene=function(e,t,i){var n=this;if(this._loadingScene)return ze(1208,e,this._loadingScene),!1;var r=me.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));return r?(this.emit(me.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,a){console.timeEnd("LoadScene "+e),n._loadingScene="",r?(pe(r),t&&t(r)):n.runSceneImmediate(a,i,t)})),!0):(Ue(1209,e),!1)},i.preloadScene=function(e,t,i){var n=me.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));if(n)n.preloadScene(e,null,t,i);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';i&&i(new Error(r)),pe("preloadScene: "+r)}},i.resume=function(){this._paused&&(this._paused=!1)},i.getScene=function(){return this._scene},i.getDeltaTime=function(){return un.deltaTime},i.getTotalTime=function(){return un.totalTime},i.getCurrentTime=function(){return un.frameStartTime},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(kn.ID,e,200))},i.registerSystem=function(e,t,i){t.id=e,t.priority=i,t.init(),this._systems.push(t),this._systems.sort(An.sortByPriority)},i.unregisterSystem=function(e){rt.fastRemove(this._systems,e),this._systems.sort(An.sortByPriority)},i.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},i.getAnimationManager=function(){return this.getSystem(me.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(e){var t;t=un._calculateDT(e),this.tick(t)},i.tick=function(e){if(!this._invalid){if(this.emit(t.EVENT_BEGIN_FRAME),at._frameDispatchEvents(),!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(e);for(var i=0;i<this._systems.length;++i)this._systems[i].update(e);this._compScheduler.lateUpdatePhase(e),this.emit(t.EVENT_AFTER_UPDATE),nt._deferredDestroy();for(var n=0;n<this._systems.length;++n)this._systems[n].postUpdate(e)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(e),this.emit(t.EVENT_AFTER_DRAW),st.resetHasChangedFlags(),st.clearNodeArray(),ot.update(e),this.emit(t.EVENT_END_FRAME),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._paused=!1,this.registerSystem(kn.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},i._init=function(){return this._root=new On(un._gfxDevice),this._root.initialize({}).catch((function(e){return Ue(1217),Promise.reject(e)}))},ke(t,[{key:"root",get:function(){return this._root}}]),t}(ht));Fn.EVENT_INIT="director_init",Fn.EVENT_RESET="director_reset",Fn.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",Fn.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",Fn.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",Fn.EVENT_BEFORE_UPDATE="director_before_update",Fn.EVENT_AFTER_UPDATE="director_after_update",Fn.EVENT_BEFORE_DRAW="director_before_draw",Fn.EVENT_AFTER_DRAW="director_after_draw",Fn.EVENT_BEFORE_COMMIT="director_before_commit",Fn.EVENT_BEFORE_PHYSICS="director_before_physics",Fn.EVENT_AFTER_PHYSICS="director_after_physics",Fn.EVENT_BEGIN_FRAME="director_begin_frame",Fn.EVENT_END_FRAME="director_end_frame",Fn.instance=void 0,me.Director=Fn;var Ln=e("d",Fn.instance=me.director=new Fn),Bn={};ft(Bn,"vmath",[{name:"vec2",newName:"Vec2",target:bn,targetName:"math"},{name:"vec3",newName:"Vec3",target:bn,targetName:"math"},{name:"vec4",newName:"Vec4",target:bn,targetName:"math"},{name:"quat",newName:"Quat",target:bn,targetName:"math"},{name:"mat3",newName:"Mat3",target:bn,targetName:"math"},{name:"mat4",newName:"Mat4",target:bn,targetName:"math"},{name:"color4",newName:"Color",target:bn,targetName:"math"},{name:"rect",newName:"Rect",target:bn,targetName:"math"},{name:"approx",newName:"approx",target:bn,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:bn,targetName:"math"},{name:"equals",newName:"equals",target:bn,targetName:"math"},{name:"clamp",newName:"clamp",target:bn,targetName:"math"},{name:"clamp01",newName:"clamp01",target:bn,targetName:"math"},{name:"lerp",newName:"lerp",target:bn,targetName:"math"},{name:"toRadian",newName:"toRadian",target:bn,targetName:"math"},{name:"toDegree",newName:"toDegree",target:bn,targetName:"math"},{name:"random",newName:"random",target:bn,targetName:"math"},{name:"randomRange",newName:"randomRange",target:bn,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:bn,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:bn,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:bn,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:bn,targetName:"math"},{name:"repeat",newName:"repeat",target:bn,targetName:"math"},{name:"pingPong",newName:"pingPong",target:bn,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:bn,targetName:"math"}]),me.vmath=Bn,ft(kn.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:kn,targetName:"Scheduler"}]),ft(kn,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:function(){return An.Priority.SCHEDULER}}]),dt(kn,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),ft(Ki.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),dt(Ki.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),ft(On.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),pt(un,"game",[{name:"collisionMatrix"},{name:"groupList"}]),pt(Fn.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),dt(Fn.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]);var Un=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new _t,this.scenes=new _t,this.paths=new _t}var t=e.prototype;return t.init=function(e){var t=this;!function(e){var t=e.uuids,i=e.paths,n=e.types,r=e.deps,a=e.paths=Object.create(null);if(!1===e.debug){for(var s=0,o=t.length;s<o;s++)t[s]=vt(t[s]);for(var u in i){var c=i[u],l=c[1];c[1]=n[l]}}else{for(var h=Object.create(null),f=0,d=t.length;f<d;f++){var p=t[f];t[f]=h[p]=vt(p)}t=h}for(var _ in i){var m=i[_];a[t[_]]=m}var g=e.scenes;for(var v in g){var y=g[v];g[v]=t[y]}var b=e.packs;for(var w in b)for(var T=b[w],E=0;E<T.length;++E)T[E]=t[T[E]];var S=e.versions;if(S)for(var A in S)for(var N=S[A],x=0;x<N.length;x+=2){var I=N[x];N[x]=t[I]||I}var R=e.redirect;if(R)for(var C=0;C<R.length;C+=2)R[C]=t[R[C]],R[C+1]=r[R[C+1]];if(e.extensionMap){var P=function(i){if(!Object.prototype.hasOwnProperty.call(e.extensionMap,i))return"continue";e.extensionMap[i].forEach((function(n,r){e.extensionMap[i][r]=t[n]||n}))};for(var k in e.extensionMap)P(k)}}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect);var i=function(i){if(!Object.prototype.hasOwnProperty.call(e.extensionMap,i))return"continue";e.extensionMap[i].forEach((function(e){var n=t.assetInfos.get(e);n&&(n.extension=i)}))};for(var n in e.extensionMap)i(n)},t.getInfoWithPath=function(e,t){if(!e)return null;e=mt(e);var i=this.paths.get(e);if(i){if(!t)return i[0];for(var n=0,r=i.length;n<r;n++){var a=i[n];if(gt.isChildClassOf(a.ctor,t))return a}}return null},t.getDirWithPath=function(e,t,i){"/"===(e=mt(e))[e.length-1]&&(e=e.slice(0,-1));var n=i||[];return this.paths.forEach((function(i,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var a=0,s=i.length;a<s;a++){var o=i[a];t&&!gt.isChildClassOf(o.ctor,t)||n.push(o)}})),n},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,i){return i.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,i=e.length;t<i;t++){var n=e[t];this.assetInfos.add(n,{uuid:n})}}},t._initPath=function(e){if(e){var t=this.paths;for(var i in t.clear(),e){var n=e[i],r=n[0],a=n[1],s=3===n.length,o=this.assetInfos.get(i);o.path=r,o.ctor=gt._getClassById(a),t.has(r)?s?t.get(r).push(o):t.get(r).unshift(o):t.add(r,[o])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var i=this.assetInfos;for(var n in e){var r=e[n],a=i.get(r);a.url=n,t.add(n,a)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var i in e){var n=e[i],r={uuid:i,packedUuids:n,ext:".json"};t.add(i,r);for(var a=0,s=n.length;a<s;a++){var o=n[a],u=t.get(o),c=u.packs;c?1===s?c.unshift(r):c.push(r):u.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,i=e.import;if(i)for(var n=0,r=i.length;n<r;n+=2){var a=i[n];t.get(a).ver=i[n+1]}if(i=e.native)for(var s=0,o=i.length;s<o;s+=2){var u=i[s];t.get(u).nativeVer=i[s+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,i=0,n=e.length;i<n;i+=2){var r=e[i];t.get(r).redirect=e[i+1]}},e}();function zn(e,t){e._uuid&&t.push(e._uuid)}function Wn(e,t){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n];if("node"!==r&&"__eventTargets"!==r){var a=e[r];if("object"==typeof a&&a)if(Array.isArray(a))for(var s=0;s<a.length;s++){var o=a[s];o instanceof wt&&zn(o,t)}else if(a.constructor&&a.constructor!==Object)a instanceof wt&&zn(a,t);else for(var u=Object.getOwnPropertyNames(a),c=0;c<u.length;c++){var l=a[u[c]];l instanceof wt&&zn(l,t)}}}}function jn(e,t){for(var i=0;i<e._components.length;i++)Wn(e._components[i],t);for(var n=0;n<e._children.length;n++)jn(e._children[n],t)}function Vn(e,t,i,n){i.push(e._uuid);for(var r=bt.getDeps(e._uuid),a=0,s=r.length;a<s;a++){var o=yt.get(r[a]);if(o){var u=o._uuid;u in t?t[u]+=n:t[u]=o.refCount+n,i.includes(u)||Vn(o,t,i,n)}}}var Hn=[],Gn=new(function(){function e(){this._persistNodeDeps=new _t,this._toDelete=new _t,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];jn(e,t);for(var i=0,n=t.length;i<n;i++){var r=yt.get(t[i]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),i=0,n=t.length;i<n;i++){var r=yt.get(t[i]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,i){if(e){for(var n=bt.getDeps(e.uuid),r=0,a=n.length;r<a;r++){var s=yt.get(n[r]);s&&s.decRef(e.autoReleaseAssets)}var o=bt._depends.get(e.uuid);if(o&&o.persistDeps)for(var u=o.persistDeps,c=0,l=u.length;c<l;c++){var h=yt.get(u[c]);h&&h.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&bt.remove(e.uuid)}var f=bt._depends.get(t.uuid);for(var d in f&&(f.persistDeps=[]),i){for(var p,_,m=i[d],g=this._persistNodeDeps.get(m.uuid),v=Ye(g);!(_=v()).done;){var y=_.value,b=yt.get(y);b&&b.addRef()}f&&(p=f.persistDeps).push.apply(p,g)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof wt&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,Tt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var i=e._uuid;if(this._toDelete.remove(i),Et(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,Vn(e,t,Hn,-1),Hn.length=0,0!==t[e._uuid])return t[e._uuid];for(var i in t)0!==t[i]&&Vn(yt.get(i),t,Hn,1);return Hn.length=0,t[e._uuid]}(e)>0)){yt.remove(i);for(var n=bt.getDeps(i),r=0,a=n.length;r<a;r++){var s=yt.get(n[r]);s&&(s.decRef(!1),this._free(s,!1))}e.destroy(),bt.remove(i)}},e}()),qn=null;function Yn(e,t){for(var i=0,n=e.input.length;i<n;i++){var r=e.input[i];t&&!r.isNative&&r.content instanceof wt&&r.content.decRef(!1),r.recycle()}e.input=null}function Xn(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function Qn(e,t,i,n,r){void 0===r&&(r=0),e(r,(function(a,s){r++,!a||r>t?n&&n(a,s):setTimeout((function(){Qn(e,t,i,n,r)}),i)}))}function Zn(e,t,i,n,r){try{for(var a=bt.parse(e,t),s=0,o=a.deps.length;s<o;s++){var u=a.deps[s];u in i||(i[u]=!0,n.push({uuid:u,bundle:r&&r.name}))}a.nativeDep&&(r&&(a.nativeDep.bundle=r.name),n.push(St({},a.nativeDep)))}catch(e){pe(e.message,e.stack)}}function Jn(e,t,i){t&&(i=void 0!==i?i:me.assetManager.cacheAsset,At(t)||!i||t.isDefault||yt.add(e,t))}function Kn(e,t,i){var n=0,r=[],a=e.length;0===a&&i&&i(r);for(var s=function(e){e&&r.push(e),++n===a&&i&&i(r)},o=0;o<a;o++)t(e[o],s)}function $n(e,t,i){var n=e,r=t,a=i;if(void 0===i){var s="function"==typeof e;t?(a=t,s||(r=null)):void 0===t&&s&&(a=e,n=null,r=null),void 0!==t&&s&&(r=e,n=null)}return{options:n||Object.create(null),onProgress:r,onComplete:a}}function er(e,t,i){var n=e,r=t,a=i;if(void 0===i){var s=gt.isChildClassOf(e,wt);t?(a=t,s&&(r=null)):void 0!==t||s||(a=e,r=null,n=null),void 0===t||s||(r=e,n=null)}return{type:n,onProgress:r||qn,onComplete:a}}function tr(e,t,i,n){if(void 0===n&&(n={}),!i[t]||n[t])return!1;n[t]=!0;var r=!1,a=bt.getDeps(t);if(a)for(var s=0,o=a.length;s<o;s++){var u=a[s];if(u===e||tr(e,u,i,n)){r=!0;break}}return r}function ir(e){return function(t,i){if(e){var n=[];Array.isArray(i)?i.forEach((function(e){return e instanceof wt&&n.push(e.addRef())})):i instanceof wt&&n.push(i.addRef()),Tt((function(){n.forEach((function(e){return e.decRef(!1)})),e(t,i)}))}}}var nr=function(){function e(){this._config=new Un}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,i){return this._config.getDirWithPath(e,t,i)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),It.add(e.name,this)},t.load=function(e,t,i,n){var r=er(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete,u={__requestType__:Rt.PATH,type:a,bundle:this.name,__outputAsArray__:Array.isArray(e)};me.assetManager.loadAny(e,u,s,o)},t.preload=function(e,t,i,n){var r=er(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete;me.assetManager.preloadAny(e,{__requestType__:Rt.PATH,type:a,bundle:this.name},s,o)},t.loadDir=function(e,t,i,n){var r=er(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete;me.assetManager.loadAny(e,{__requestType__:Rt.DIR,type:a,bundle:this.name,__outputAsArray__:!0},s,o)},t.preloadDir=function(e,t,i,n){var r=er(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete;me.assetManager.preloadAny(e,{__requestType__:Rt.DIR,type:a,bundle:this.name},s,o)},t.loadScene=function(e,t,i,n){var r=$n(t,i,n),a=r.options,s=r.onProgress,o=r.onComplete;a.preset=a.preset||"scene",a.bundle=this.name,me.assetManager.loadAny({scene:e},a,s,(function(e,t){if(e)pe(e.message,e.stack);else if(t instanceof tt&&t.scene){var i=t.scene;i._id=t._uuid,i.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");o&&o(e,t)}))},t.preloadScene=function(e,t,i,n){var r=$n(t,i,n),a=r.options,s=r.onProgress,o=r.onComplete;a.bundle=this.name,me.assetManager.preloadAny({scene:e},a,s,(function(t){t&&Ue(1210,e,t.message),o&&o(t)}))},t.get=function(e,t){var i=this.getInfoWithPath(e,t);return i&&yt.get(i.uuid)||null},t.release=function(e,t){var i=this.get(e,t);i&&Gn.tryRelease(i,!0)},t.releaseUnusedAssets=function(){var e=this;yt.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&Gn.tryRelease(t)}))},t.releaseAll=function(){var e=this;yt.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&Gn.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},ke(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),rr=e("r",new nr);function ar(e,t,i){var n=new Image;function r(){n.removeEventListener("load",r),n.removeEventListener("error",a),i&&i(null,n)}function a(){n.removeEventListener("load",r),n.removeEventListener("error",a),i&&i(new Error(Ct(4930,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.addEventListener("load",r),n.addEventListener("error",a),n.src=e,n}function sr(e,t,i,n){var r=new XMLHttpRequest,a="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var s in t.xhrHeader)r.setRequestHeader(s,t.xhrHeader[s]);return r.onload=function(){200===r.status||0===r.status?n&&n(null,r.response):n&&n(new Error(""+a+r.status+"(no response)"))},i&&(r.onprogress=function(e){e.lengthComputable&&i(e.loaded,e.total)}),r.onerror=function(){n&&n(new Error(""+a+r.status+"(error)"))},r.ontimeout=function(){n&&n(new Error(""+a+r.status+"(time out)"))},r.onabort=function(){n&&n(new Error(""+a+r.status+"(abort)"))},r.send(null),r}me.resources=rr;var or={};function ur(e,t,i){if(or[e])return i&&i(null),null;var n=document.createElement("script");function r(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",a,!1),or[e]=!0,i&&i(null)}function a(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",a,!1),i&&i(new Error(Ct(4928,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.async=t.scriptAsyncLoading||!1,n.src=e,n.addEventListener("load",r,!1),n.addEventListener("error",a,!1),document.body.appendChild(n),n}var cr=/^(?:\w+:\/\/|\.+\/).+/,lr=function(e,t,i){(Dt.hasFeature(Dt.Feature.IMAGE_BITMAP)&&me.assetManager.allowImageBitmap?hr:ar)(e,t,i)},hr=function(e,t,i){t.xhrResponseType="blob",sr(e,t,t.onFileProgress,i)},fr=function(e,t,i){t.xhrResponseType="json",sr(e,t,t.onFileProgress,i)},dr=function(e,t,i){t.xhrResponseType="arraybuffer",sr(e,t,t.onFileProgress,i)},pr=function(e,t,i){fr(e,t,(function(t,n){if(t)i(t);else{var r=Ot(n);Promise.all(r.chunks.map((function(i){return new Promise((function(n,r){dr(""+Ft(e)+i,{},(function(e,i){t?r(t):n(new Uint8Array(i))}))}))}))).then((function(e){var t=new Ut(r.document,e);i(null,t)})).catch((function(e){i(e)}))}}))},_r=function(e,t,i){dr(e,t,(function(e,t){if(e)i(e);else try{var n=Lt(new Uint8Array(t));i(null,n)}catch(e){i(e)}}))},mr=function(e,t,i){t.xhrResponseType="text",sr(e,t,t.onFileProgress,i)},gr=function(e,t,i){var n=Bt(e),r=e;cr.test(r)||(r=-1!==yr.remoteBundles.indexOf(n)?yr.remoteServerAddress+"remote/"+n:"assets/"+n);var a=t.version||yr.bundleVers[n],s=0,o=null,u=null;fr(r+"/config."+(a?a+".":"")+"json",t,(function(e,t){u=e,(o=t)&&(o.base=r+"/"),2==++s&&i(u,o)})),ur(r+"/index."+(a?a+".":"")+"js",t,(function(e){u=e,2==++s&&i(e,o)}))},vr=function(){function e(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!!Mt,this.limited=!Mt,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=ar,this.downloadDomAudio=null,this.downloadFile=sr,this.downloadScript=ur,this._downloaders={".png":lr,".jpg":lr,".bmp":lr,".jpeg":lr,".gif":lr,".ico":lr,".tiff":lr,".webp":lr,".image":lr,".pvr":dr,".pkm":dr,".astc":dr,".txt":mr,".xml":mr,".vsh":mr,".fsh":mr,".atlas":mr,".tmx":mr,".tsx":mr,".json":fr,".ExportJson":fr,".plist":mr,".ccon":pr,".cconb":_r,".fnt":mr,".binary":dr,".bin":dr,".dbbin":dr,".skel":dr,".js":ur,bundle:gr,default:mr},this._downloading=new _t,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var t=e.prototype;return t.init=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=i},t.register=function(e,t){"object"==typeof e?Pt(this._downloaders,e):this._downloaders[e]=t},t.download=function(e,t,i,n,r){var a=this,s=kt.get(e);if(s)r(null,s);else{var o=this._downloading.get(e);if(o){o.push(r);var u=this._queue.find((function(t){return t.id===e}));if(!u)return;var c=n.priority||0;u.priority<c&&(u.priority=c,this._queueDirty=!0)}else{var l=void 0!==n.maxRetryCount?n.maxRetryCount:this.maxRetryCount,h=void 0!==n.maxConcurrency?n.maxConcurrency:this.maxConcurrency,f=void 0!==n.maxRequestsPerFrame?n.maxRequestsPerFrame:this.maxRequestsPerFrame,d=this._downloaders[i]||this._downloaders.default;Qn((function(i,s){if(0===i&&a._downloading.add(e,[r]),a.limited){a._updateTime();var o=function(e,t){a._totalNum--,a._handleQueueInNextFrame(h,f),s(e,t)};a._totalNum<h&&a._totalNumThisPeriod<f?(d(Xn(t,a.appendTimeStamp),n,o),a._totalNum++,a._totalNumThisPeriod++):(a._queue.push({id:e,priority:n.priority||0,url:t,options:n,done:o,handler:d}),a._queueDirty=!0,a._totalNum<h&&a._handleQueueInNextFrame(h,f))}else d(Xn(t,a.appendTimeStamp),n,s)}),l,this.retryInterval,(function(t,i){t||kt.add(e,i);for(var n=a._downloading.remove(e),r=0,s=n.length;r<s;r++)n[r](t,i)}))}}},t.loadSubpackage=function(e,t){me.assetManager.loadBundle(e,null,t)},t._updateTime=function(){var e=performance.now(),t=me.game.deltaTime,i=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=e)},t._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(Xn(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(e,t)},t._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(Tt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},ke(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}(),yr=e("w",new vr);function br(e,t,i,n){var r=null,a=null;try{(r=new zt)._nativeUrl=e,r._nativeAsset=t}catch(e){a=e}n(a,r)}function wr(e,t,i,n){var r=new Wt;r.json=t,n(null,r)}function Tr(e,t,i,n){var r=new jt;r.text=t,n(null,r)}function Er(e,t,i,n){var r=new Vt;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function Sr(e,t,i,n){var r=new wt;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function Ar(e,i,n,r){var a=It.get(i.name);a||(a=i.name===Ht.RESOURCES?rr:new nr,i.base=i.base||e+"/",a.init(i)),t.import("virtual:///prerequisite-imports/"+a.name).then((function(){r(null,a)})).catch(r)}var Nr=function(){function e(){this._creating=new _t,this._producers={".png":br,".jpg":br,".bmp":br,".jpeg":br,".gif":br,".ico":br,".tiff":br,".webp":br,".image":br,".pvr":br,".pkm":br,".txt":Tr,".xml":Tr,".vsh":Tr,".fsh":Tr,".atlas":Tr,".tmx":Tr,".tsx":Tr,".fnt":Tr,".json":wr,".ExportJson":wr,".binary":Er,".bin":Er,".dbbin":Er,".skel":Er,bundle:Ar,default:Sr}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?gt.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,i,n,r){var a=this,s=this._producers[i]||this._producers.default,o=yt.get(e);if(n.reloadAsset||!o){var u=this._creating.get(e);u?u.push(r):(this._creating.add(e,[r]),s(e,t,n,(function(t,i){!t&&i instanceof wt&&(i._uuid=e,Jn(e,i,n.cacheAsset));for(var r=a._creating.remove(e),s=0,o=r.length;s<o;s++)r[s](t,i)})))}else r(null,o)},e}(),xr=e("x",new Nr),Ir=new(function(){function e(){this._loading=new _t,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,i,n){var r=gt.createMap(!0),a=null;if(Array.isArray(t)){(t=Gt(t)).length!==e.length&&Ue(4915);for(var s=0;s<e.length;s++)r[e[s]+"@import"]=t[s]}else{var o=gt._getClassId(qt),u=gt._getClassId(zt);if(t.type===o&&t.data){var c=t.data;c.length!==e.length&&Ue(4915);for(var l=0;l<e.length;l++)r[e[l]+"@import"]=Yt(o,{base:c[l][0],mipmaps:c[l][1]})}else if(t.type===u&&t.data){var h=t.data;h.length!==e.length&&Ue(4915);for(var f=0;f<e.length;f++)r[e[f]+"@import"]=h[f]}else a=new Error("unmatched type pack!"),r=null}n(a,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?gt.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,i,n,r){t?(0,this._unpackers[i])(e,t,n,r):r(new Error("package data is wrong!"))},t.load=function(e,t,i){var n=this;if(!e.isNative&&e.info&&e.info.packs)if(kt.has(e.id))i(null,kt.get(e.id));else{var r=e.info.packs,a=r.find((function(e){return n._loading.has(e.uuid)}));if(a)this._loading.get(a.uuid).push({onComplete:i,id:e.id});else{a=r[0],this._loading.add(a.uuid,[{onComplete:i,id:e.id}]);var s=Xt(a.uuid,{ext:a.ext,bundle:e.config.name});yr.download(a.uuid,s,a.ext,e.options,(function(t,i){kt.remove(a.uuid),t&&pe(t.message,t.stack),n.unpack(a.packedUuids,i,a.ext,e.options,(function(e,i){if(!e)for(var r in i)kt.add(r,i[r]);for(var s=n._loading.remove(a.uuid),o=0,u=s.length;o<u;o++){var c=s[o];if(t||e)c.onComplete(t||e);else{var l=i[c.id];l?c.onComplete(null,l):c.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else yr.download(e.id,e.url,e.ext,e.options,i)},e}());function Rr(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress,a=[],s=r.total,o=n.__exclude__=n.__exclude__||Object.create(null);e.output=[],Kn(e.input,(function(n,u){if(!n.isNative&&yt.has(n.uuid)){var c=yt.get(n.uuid);return n.content=c.addRef(),e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n),void u()}Ir.load(n,e.options,(function(c,l){c?e.isFinish||(!me.assetManager.force||i?(pe(c.message,c.stack),r.canInvoke=!1,t(c)):(e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n))):e.isFinish||(n.file=l,e.output.push(n),n.isNative||(o[n.uuid]=!0,Zn(n.uuid,l,o,a,n.config),r.total=s+a.length),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n)),u()}))}),(function(){if(e.isFinish)return Yn(e,!0),void e.dispatch("error");if(a.length>0){var s=Qt.create({input:a,progress:r,options:n,onProgress:e.onProgress,onError:Qt.prototype.recycle,onComplete:function(n){var r;n||((r=e.output).push.apply(r,s.output),s.recycle()),i&&Cr(e),t(n)}});Zt.async(s)}else i&&Cr(e),t()}))}function Cr(e){for(var t=e.output,i=0,n=t.length;i<n;i++)t[i].content&&t[i].content.decRef(!1)}var Pr=new(function(e){function t(){return e.apply(this,arguments)||this}Le(t,e);var i=t.prototype;return i.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return ze(5100),{};for(var i=null,n=0,r=t.childNodes.length;n<r&&1!==(i=t.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(e){var t=null,i=e.tagName;if("dict"===i)t=this._parseDict(e);else if("array"===i)t=this._parseArray(e);else if("string"===i)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(e.firstChild.nodeValue):"integer"===i&&(t=parseInt(e.firstChild.nodeValue,10));return t},i._parseArray=function(e){for(var t=[],i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&t.push(this._parseNode(r))}return t},i._parseDict=function(e){for(var t={},i="",n=0,r=e.childNodes.length;n<r;n++){var a=e.childNodes[n];1===a.nodeType&&("key"===a.tagName?i=a.firstChild.nodeValue:t[i]=this._parseNode(a))}return t},t}(e("y",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function kr(e,t){return e[t]<<8|e[t+1]}var Mr=new(function(){function e(){this._parsing=new _t,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,i){e instanceof HTMLImageElement?i(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){i(null,e)}),(function(e){i(e,null)}))},t.parsePVRTex=function(e,t,i){var n=null,r=null;try{var a=e instanceof ArrayBuffer?e:e.buffer,s=new Int32Array(a,0,13);if(55727696===s[0]){var o=s[7],u=s[6],c=s[12]+52;r={_data:new Uint8Array(a,c),_compressed:!0,width:o,height:u,format:0}}else{if(559044176!==s[11])throw new Error("Invalid magic number in PVR header");var l=s[0],h=s[1],f=s[2];r={_data:new Uint8Array(a,l),_compressed:!0,width:f,height:h,format:0}}}catch(e){n=e}i(n,r)},t.parsePKMTex=function(e,t,i){var n=null,r=null;try{var a=e instanceof ArrayBuffer?e:e.buffer,s=new Uint8Array(a),o=kr(s,6);if(0!==o&&1!==o&&3!==o)throw new Error("Invalid magic number in ETC header");var u=kr(s,12),c=kr(s,14);kr(s,8),kr(s,10),r={_data:new Uint8Array(a,16),_compressed:!0,width:u,height:c,format:0}}catch(e){n=e}i(n,r)},t.parseASTCTex=function(e,t,i){var n=null,r=null;try{var a=e instanceof ArrayBuffer?e:e.buffer,s=new Uint8Array(a);if(1554098963!==s[0]+(s[1]<<8)+(s[2]<<16)+(s[3]<<24))throw new Error("Invalid magic number in ASTC header");var o=s[4],u=s[5],c=s[6];if((o<3||o>6||u<3||u>6||c<3||c>6)&&(o<4||7===o||9===o||11===o||o>12||u<4||7===u||9===u||11===u||u>12||1!==c))throw new Error("Invalid block number in ASTC header");var l=function(e,t){return 4===e?$t.RGBA_ASTC_4x4:5===e?4===t?$t.RGBA_ASTC_5x4:$t.RGBA_ASTC_5x5:6===e?5===t?$t.RGBA_ASTC_6x5:$t.RGBA_ASTC_6x6:8===e?5===t?$t.RGBA_ASTC_8x5:6===t?$t.RGBA_ASTC_8x6:$t.RGBA_ASTC_8x8:10===e?5===t?$t.RGBA_ASTC_10x5:6===t?$t.RGBA_ASTC_10x6:8===t?$t.RGBA_ASTC_10x8:$t.RGBA_ASTC_10x10:10===t?$t.RGBA_ASTC_12x10:$t.RGBA_ASTC_12x12}(o,u),h=s[7]+(s[8]<<8)+(s[9]<<16),f=s[10]+(s[11]<<8)+(s[12]<<16);s[13],s[14],s[15],r={_data:new Uint8Array(a,16),_compressed:!0,width:h,height:f,format:l}}catch(e){n=e}i(n,r)},t.parsePlist=function(e,t,i){var n=null,r=Pr.parse(e);r||(n=new Error("parse failed")),i(n,r)},t.parseImport=function(e,t,i){if(e){var n=null,r=null;try{n=Jt(e,t)}catch(e){r=e}i(r,n)}else i(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Pt(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,i,n,r){var a=this,s=Kt.get(e);if(s)r(null,s);else{var o=this._parsing.get(e);if(o)o.push(r);else{var u=this._parsers[i];u?(this._parsing.add(e,[r]),u(t,n,(function(t,i){t?kt.remove(e):At(i)||Kt.add(e,i);for(var n=a._parsing.remove(e),r=0,s=n.length;r<s;r++)n[r](t,i)}))):r(null,t)}}},e}());function Dr(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress;n.__exclude__=n.__exclude__||Object.create(null),e.output=[],Kn(e.input,(function(a,s){var o=Qt.create({input:a,onProgress:e.onProgress,options:n,progress:r,onComplete:function(n,u){n&&!e.isFinish&&(!me.assetManager.force||i?(pe(n.message,n.stack),r.canInvoke=!1,t(n)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,a)),e.output.push(u),o.recycle(),s(null)}});Or.async(o)}),(function(){if(n.__exclude__=null,e.isFinish)return Yn(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var i=e.output=[],n=0,r=t.length;n<r;n++)i.push(t[n].content);else e.output=t[0].content}(e),Yn(e,!0),t()}))}var Or=new ei("loadOneAsset",[function(e,t){var i=e.output=e.input,n=i.options,r=i.isNative,a=i.uuid,s=i.file,o=n.reloadAsset;s||!o&&!r&&yt.has(a)?t():Ir.load(i,e.options,(function(e,n){i.file=n,t(e)}))},function(e,t){var i=e.output=e.input,n=e.progress,r=e.options.__exclude__,a=i.id,s=i.file,o=i.options;if(i.isNative)Mr.parse(a,s,i.ext,o,(function(r,s){r?t(r):(i.content=s,n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),kt.remove(a),Kt.remove(a),t())}));else{var u=i.uuid;if(u in r){var c=r[u],l=c.finish,h=c.content,f=c.err,d=c.callbacks;n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),l||tr(u,u,r)?(h&&h.addRef(),i.content=h,t(f)):d.push({done:t,item:i})}else if(!o.reloadAsset&&yt.has(u)){var p=yt.get(u);i.content=p.addRef(),n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),t()}else o.__uuid__=u,Mr.parse(a,s,"import",o,(function(i,n){i?t(i):function(e,t,i){var n=e.input,r=e.progress,a=n,s=a.uuid,o=a.id,u=a.options,c=a.config,l=u.cacheAsset,h=[];t.addRef&&t.addRef(),Zn(s,t,Object.create(null),h,c),r.canInvoke&&e.dispatch("progress",++r.finish,r.total+=h.length,n);var f=e.options.__exclude__[s]={content:t,finish:!1,callbacks:[{done:i,item:n}]},d=Qt.create({input:h,options:e.options,onProgress:e.onProgress,onError:Qt.prototype.recycle,progress:r,onComplete:function(e){if(t.decRef&&t.decRef(!1),f.finish=!0,f.err=e,!e){for(var i,n=Array.isArray(d.output)?d.output:[d.output],r=Object.create(null),a=Ye(n);!(i=a()).done;){var u=i.value;u&&(r[u instanceof wt?u._uuid+"@import":s+"@native"]=u)}!function(e,t,i){var n=Nt.get(t);if(n){for(var r=0,a=n.length;r<a;r++){var s=n[r],o=i[s.uuid+"@import"];if(o)s.owner[s.prop]=o.addRef();else{if(pe("The asset "+s.uuid+" is missing!"),s.type&&s.type!==wt){var u=new s.type;u.initDefault(s.uuid),s.owner[s.prop]=u}!0}}Nt.delete(t)}xt.has(t)&&(i[e+"@native"]?t._nativeAsset=i[e+"@native"]:(!0,console.error("the native asset of "+e+" is missing!")),xt.delete(t))}(s,t,r);try{"function"!=typeof t.onLoaded||ti.has(t)||xt.has(t)||(t.onLoaded(),ti.add(t))}catch(e){pe("The asset "+s+" is invalid for some reason, detail message: "+e.message+", stack: "+e.stack)}kt.remove(o),Kt.remove(o),Jn(s,t,l),d.recycle()}for(var c=f.callbacks,h=0,p=c.length;h<p;h++){var _=c[h];t.addRef&&t.addRef(),_.item.content=t,_.done(e)}c.length=0}});ii.async(d)}(e,n,t)}))}}]);function Fr(e,t){var i=e.options,n=Object.create(null),r=Object.create(null);for(var a in i)switch(a){case Rt.PATH:case Rt.UUID:case Rt.DIR:case Rt.SCENE:case Rt.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[a]=i[a];break;case"__exclude__":case"__outputAsArray__":r[a]=i[a];break;default:n[a]=i[a],r[a]=i[a]}e.options=r;var s=Qt.create({input:e.input,options:n}),o=null;try{e.output=e.source=ni.sync(s)}catch(e){o=e;for(var u=0,c=s.output.length;u<c;u++)s.output[u].recycle()}s.recycle(),t(o)}var Lr=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},ke(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();Lr.MAX_DEAD_NUM=500,Lr._deadPool=[];var Br=[];function Ur(e){var t=e.options,i=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var n=function(n){var r,a=i[n],s=Lr.create(),o=null,u=null;if("string"==typeof a&&((a=Object.create(null))[t.__requestType__||Rt.UUID]=i[n]),"object"==typeof a)for(var c in ri(a,t),a.preset&&ri(a,ai[a.preset]),a){switch(c){case Rt.UUID:if("break"===function(){var e,t=s.uuid=vt(a.uuid);if(!a.bundle){var i=It.find((function(e){return!!e.getAssetInfo(t)}));a.bundle=i&&i.name}if(It.has(a.bundle)){if(o=It.get(a.bundle).config,(u=o.getAssetInfo(t))&&u.redirect){if(!It.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");o=It.get(u.redirect).config,u=o.getAssetInfo(t)}s.config=o,s.info=u}return s.ext=a.ext||(null===(e=u)||void 0===e?void 0:e.extension)||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Rt.DIR:if(It.has(a.bundle)){It.get(a.bundle).config.getDirWithPath(a.dir,a.type,Br);for(var l,h=Ye(Br);!(l=h()).done;){var f=l.value;i.push({uuid:f.uuid,__isNative__:!1,ext:f.extension||".json",bundle:a.bundle})}Br.length=0}s.recycle(),s=null;break;case Rt.PATH:if(It.has(a.bundle)){if(o=It.get(a.bundle).config,(u=o.getInfoWithPath(a.path,a.type))&&u.redirect){if(!It.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");o=It.get(u.redirect).config,u=o.getAssetInfo(u.uuid)}if(!u)throw s.recycle(),new Error("Bundle "+a.bundle+" doesn't contain "+a.path);s.config=o,s.uuid=u.uuid,s.info=u}s.ext=a.ext||(null===(r=u)||void 0===r?void 0:r.extension)||".json";break;case Rt.SCENE:if(!a.bundle){var d=It.find((function(e){return!!e.getSceneInfo(a.scene)}));a.bundle=d&&d.name}if(It.has(a.bundle)){if(o=It.get(a.bundle).config,(u=o.getSceneInfo(a.scene))&&u.redirect){if(!It.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");o=It.get(u.redirect).config,u=o.getAssetInfo(u.uuid)}if(!u)throw s.recycle(),new Error("Bundle "+o.name+" doesn't contain scene "+a.scene);s.config=o,s.uuid=u.uuid,s.info=u}break;case"__isNative__":s.isNative=a.__isNative__;break;case Rt.URL:s.url=a.url,s.uuid=a.uuid||a.url,s.ext=a.ext||si(a.url),s.isNative=void 0===a.__isNative__||a.__isNative__;break;default:s.options[c]=a[c]}if(!s)break}if(!s)return"continue";if(e.output.push(s),!s.uuid&&!s.url)throw new Error("Can not parse this input:"+JSON.stringify(a))},r=0;r<i.length;r++)n(r);return null}function zr(e){for(var t=e.output=e.input,i=0;i<t.length;i++){var n=t[i];if(!n.url){var r,a,s=n.config;a=n.isNative?s&&s.nativeBase?s.base+s.nativeBase:me.assetManager.generalNativeBase:s&&s.importBase?s.base+s.importBase:me.assetManager.generalImportBase;var o=n.uuid,u="";n.info&&(u=n.isNative?n.info.nativeVer?"."+n.info.nativeVer:"":n.info.ver?"."+n.info.ver:""),r=".ttf"===n.ext?a+"/"+o.slice(0,2)+"/"+o+u+"/"+n.options.__nativeName__:a+"/"+o.slice(0,2)+"/"+o+u+n.ext,n.url=r}}return null}var Wr=e("h",function(){function e(){this.pipeline=ii.append(Fr).append(Dr),this.fetchPipeline=Zt.append(Fr).append(Rr),this.transformPipeline=ni.append(Ur).append(zr),this.bundles=It,this.assets=yt,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=bt,this.force=oi,this.allowImageBitmap=!Dt.isMobile,this.utils=ui,this.downloader=yr,this.parser=Mr,this.packManager=Ir,this.cacheAsset=!0,this.cacheManager=null,this.presets=ai,this.factory=xr,this.preprocessPipe=Fr,this.fetchPipe=Rr,this.loadPipe=Dr,this.references=ci,this._releaseManager=Gn,this._files=kt,this._parsed=Kt,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var i=e.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=t,this.generalNativeBase=i},t.getBundle=function(e){return It.get(e)||null},t.removeBundle=function(e){e._destroy(),It.remove(e.name)},t.loadAny=function(e,t,i,n){var r=$n(t,i,n),a=r.options,s=r.onProgress,o=r.onComplete;a.preset=a.preset||"default",e=Array.isArray(e)?e.slice():e;var u=Qt.create({input:e,onProgress:s,onComplete:ir(o),options:a});ii.async(u)},t.preloadAny=function(e,t,i,n){var r=$n(t,i,n),a=r.options,s=r.onProgress,o=r.onComplete;a.preset=a.preset||"preload",e=Array.isArray(e)?e.slice():e;var u=Qt.create({input:e,onProgress:s,onComplete:ir(o),options:a});Zt.async(u)},t.loadRemote=function(e,t,i){var n=$n(t,void 0,i),r=n.options,a=n.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,i){t?(pe(t.message,t.stack),a&&a(t,i)):xr.create(e,i,r.ext||si(e),r,(function(e,t){a&&a(e,t)}))}))):ir(a)(null,this.assets.get(e))},t.loadBundle=function(e,t,i){var n=$n(t,void 0,i),r=n.options,a=n.onComplete,s=Bt(e);this.bundles.has(s)?ir(a)(null,this.getBundle(s)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,i){t?(pe(t.message,t.stack),a&&a(t,i)):xr.create(e,i,"bundle",r,(function(e,t){a&&a(e,t)}))})))},t.releaseAsset=function(e){Gn.tryRelease(e,!0)},t.releaseUnusedAssets=function(){yt.forEach((function(e){Gn.tryRelease(e)}))},t.releaseAll=function(){yt.forEach((function(e){Gn.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},ke(e,[{key:"main",get:function(){return It.get(Ht.MAIN)||null}},{key:"resources",get:function(){return It.get(Ht.RESOURCES)||null}}]),e}());Wr.Pipeline=ei,Wr.Task=Qt,Wr.Cache=_t,Wr.RequestItem=Lr,Wr.Bundle=nr,Wr.BuiltinBundleName=Ht;var jr=e("f",me.assetManager=new Wr);me.AssetManager=Wr;var Vr=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],Hr=[".mp3",".ogg",".wav",".m4a"];function Gr(){return!0}var qr={transformURL:function(e){var t=fi(e);if(!t)return e;var i=It.find((function(e){return!!e.getAssetInfo(t)}));if(!i)return e;var n,r=i.getAssetInfo(t);if(!(n=e.startsWith(i.base+i.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(n))return e;var a=!1;if(".ttf"===si(e)&&(a=!0),a){var s=di(e),o=Bt(e);e=s+"."+n+"/"+o}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,})/,(function(e){return e+"."+n}));return e}},Yr=e("C",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=er}var t=e.prototype;return t.load=function(e,t,i){void 0===i&&void 0!==t&&(i=t,t=null);for(var n=Array.isArray(e)?e:[e],r=0;r<n.length;r++){var a=n[r];"string"==typeof a?n[r]={url:a,__isNative__:!0}:(a.type&&(a.ext="."+a.type,a.type=void 0),a.url&&(a.__isNative__=!0))}var s=[],o=[];jr.loadAny(n,null,(function(e,i,n){n.content&&(Vr.includes(n.ext)?s.push(n.content):Hr.includes(n.ext)&&o.push(n.content)),t&&t(e,i,n)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var a=function(e){var i=t[e];if(!(i instanceof wt)){var r=i,a=n[e].url;s.includes(r)?xr.create(a,i,".png",{},(function(i,n){r=t[e]=n})):o.includes(r)&&xr.create(a,i,".mp3",{},(function(i,n){r=t[e]=n})),yt.add(a,r)}},u=0;u<t.length;u++)a(u);if(t.length>1){var c=Object.create(null);t.forEach((function(e){c[e._uuid]=e})),r={isCompleted:Gr,_map:c}}else r=t[0]}i&&i(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return jr.assets.has(e)?{content:jr.assets.get(e)}:null},t.loadRes=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete,u=si(e);u&&!rr.getInfoWithPath(e,a)&&(e=e.slice(0,-u.length)),rr.load(e,a,s,o)},t.loadResArray=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete;e.forEach((function(t,i){var n=si(t);n&&!rr.getInfoWithPath(t,a)&&(e[i]=t.slice(0,-n.length))})),rr.load(e,a,s,o)},t.loadResDir=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),a=r.type,s=r.onProgress,o=r.onComplete;rr.loadDir(e,a,s,(function(t,i){var n=[];t||(n=rr.getDirWithPath(e,a).map((function(e){return e.path}))),o&&o(t,i,n)}))},t.getRes=function(e,t){return yt.has(e)?yt.get(e):rr.get(e,t)},t.getResCount=function(){return yt.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return bt.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({url:e},i)}};for(var n in e)i(n);yr.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({content:e},i)}};for(var n in e)i(n);Mr.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];"string"==typeof i&&(i=yt.get(i)),jr.releaseAsset(i)}else e&&("string"==typeof e&&(e=yt.get(e)),jr.releaseAsset(e))},t.releaseAsset=function(e){jr.releaseAsset(e)},t.releaseRes=function(e,t){rr.release(e,t)},t.releaseAll=function(){jr.releaseAll(),yt.clear()},t.removeItem=function(e){return!!yt.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var i=bt.getDepsRecursively(e),n=0;n<i.length;n++)this._autoReleaseSetting[i[n]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},ke(e,[{key:"onProgress",set:function(e){qn=e}},{key:"_cache",get:function(){if(yt instanceof _t)return yt._map;var e={};return yt.forEach((function(t,i){e[i]=t})),e}},{key:"md5Pipe",get:function(){return qr}},{key:"downloader",get:function(){return yr}},{key:"loader",get:function(){return jr.parser}}]),e}()),Xr=e("l",new Yr),Qr=e("i",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,jr.init(e),e.rawAssets&&rr.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:Ht.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets),extensionMap:{}})},loadAsset:function(e,t){jr.loadAny(e,t)}}),Zr=e("u",{});ft(Zr,"url",[{name:"normalize",target:jr.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?Xt({path:li(e.substr(10)),bundle:Ht.RESOURCES,__isNative__:!0,ext:si(e)}):""}}]),dt(Qr,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),dt(Xr,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),ft(me,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return Xr}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return Qr}},{name:"Pipeline",target:Wr,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return Zr}}]),dt(me,"cc",[{name:"LoadingItems",suggest:Ct(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),ft(hi,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:yr,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),ft(Ln,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return jr.main?null===(t=jr.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),ft(un,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return jr.main&&jr.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var Jr,Kr,$r,ea,ta,ia,na,ra,aa,sa,oa,ua,ca,la,ha=Gn._autoRelease;Gn._autoRelease=function(e,t,i){ha.call(Gn,e,t,i);for(var n=Xr._autoReleaseSetting,r=Object.keys(n),a=0;a<r.length;a++){var s=r[a];if(!0===n[s]){var o=yt.get(s);o&&Gn.tryRelease(o)}}};var fa,da,pa,_a,ma,ga,va,ya,ba,wa,Ta,Ea,Sa,Aa,Na,xa,Ia,Ra,Ca,Pa,ka,Ma,Da,Oa,Fa,La,Ba,Ua,za,Wa,ja,Va,Ha,Ga,qa,Ya,Xa,Qa,Za,Ja,Ka,$a,es,ts,is,ns,rs,as,ss,os,us,cs,ls,hs,fs,ds,ps,_s,ms,gs,vs,ys,bs,ws,Ts,Es,Ss,As=e("E",(Jr=pi("cc.ClickEvent"),Kr=_i(me.Node),$r=bi(),ea=bi(),ta=bi(),ia=bi(),Jr((la=function(){function e(){gi(this,"target",aa,this),gi(this,"component",sa,this),gi(this,"_componentId",oa,this),gi(this,"handler",ua,this),gi(this,"customEventData",ca,this)}e.emitEvents=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var a=0,s=t.length;a<s;a++){var o=t[a];o instanceof e&&o.emit(n)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(me.isValid(t)){this._genCompIdIfNeeded();var i=me.js._getClassById(this._componentId),n=t.getComponent(i);if(me.isValid(n)){var r=n[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(n,e))}}},t._compName2Id=function(e){var t=me.js.getClassByName(e);return me.js._getClassId(t)},t._compId2Name=function(e){var t=me.js._getClassById(e);return me.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},ke(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),aa=mi((ra=la).prototype,"target",[vi,Kr,vi,$r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sa=mi(ra.prototype,"component",[vi,yi,ea],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oa=mi(ra.prototype,"_componentId",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ua=mi(ra.prototype,"handler",[vi,yi,ta],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ca=mi(ra.prototype,"customEventData",[vi,yi,ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),na=ra))||na));me.Component.EventHandler=As;var Ns,xs,Is,Rs,Cs,Ps,ks=new a,Ms=Fe($i),Ds=Fe(en),Os=Fe(tn),Fs=Fe(nn),Ls=Fe(rn),Bs=Fe({SKYBOX:an|wi.DEPTH_STENCIL,SOLID_COLOR:wi.ALL,DEPTH_ONLY:wi.DEPTH_STENCIL,DONT_CLEAR:wi.NONE}),Us=e("k",(fa=pi("cc.Camera"),da=Ni(),pa=xi(),_a=Ii(),ma=bi(),ga=_i(Ti.BitMask),va=Ii(),ya=bi(),ba=_i(Bs),wa=Ii(),Ta=bi(),Ea=Ii(),Sa=bi(),Aa=Ii(),Na=bi(),xa=Ii(),Ia=bi(),Ra=_i(Ms),Ca=Ii(),Pa=bi(),ka=_i(Ds),Ma=Ii(),Da=bi(),Oa=Ii(),Fa=bi(),La=Ii(),Ba=bi(),Ua=Ii(),za=bi(),Wa=Ii(),ja=bi(),Va=_i(Os),Ha=Ii(),Ga=bi(),qa=_i(Fs),Ya=Ii(),Xa=bi(),Qa=_i(Ls),Za=Ii(),Ja=bi(),Ka=Ii(),$a=bi(),es=_i(Ei),ts=Ii(),is=bi(),fa(ns=da(ns=pa(ns=Si((Ss=Es=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"_projection",as,lt(t)),gi(t,"_priority",ss,lt(t)),gi(t,"_fov",os,lt(t)),gi(t,"_fovAxis",us,lt(t)),gi(t,"_orthoHeight",cs,lt(t)),gi(t,"_near",ls,lt(t)),gi(t,"_far",hs,lt(t)),gi(t,"_color",fs,lt(t)),gi(t,"_depth",ds,lt(t)),gi(t,"_stencil",ps,lt(t)),gi(t,"_clearFlags",_s,lt(t)),gi(t,"_rect",ms,lt(t)),gi(t,"_aperture",gs,lt(t)),gi(t,"_shutter",vs,lt(t)),gi(t,"_iso",ys,lt(t)),gi(t,"_screenScale",bs,lt(t)),gi(t,"_visibility",ws,lt(t)),gi(t,"_targetTexture",Ts,lt(t)),t._camera=null,t._inEditorMode=!1,t._flows=void 0,t}Le(t,e);var i=t.prototype;return i.onLoad=function(){this._createCamera()},i.onEnable=function(){this.node.hasChangedFlags|=Ai.POSITION,this._camera&&this._attachToScene()},i.onDisable=function(){this._camera&&this._detachFromScene()},i.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},i.screenPointToRay=function(e,t,i){return i||(i=Q.create()),this._camera&&this._camera.screenPointToRay(i,e,t),i},i.worldToScreen=function(e,t){return t||(t=new a),this._camera&&this._camera.worldToScreen(t,e),t},i.screenToWorld=function(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t},i.convertToUINode=function(e,t,i){if(i||(i=new a),!this._camera)return i;this.worldToScreen(e,ks);var n=t.getComponent("cc.UITransform"),r=ln.getVisibleSize(),s=ks.x-.5*this._camera.width,o=ks.y-.5*this._camera.height;return ks.x=s/me.view.getScaleX()+.5*r.width,ks.y=o/me.view.getScaleY()+.5*r.height,n&&n.convertToNodeSpaceAR(ks,i),i},i._createCamera=function(){this._camera||(this._camera=me.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?me.director.root&&me.director.root.mainWindow:me.director.root&&me.director.root.tempWindow,priority:this._priority}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=x(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},i._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},i._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},i._checkTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},i._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}},ke(t,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=e)}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}},{key:"clearColor",get:function(){return this._color},set:function(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}},{key:"clearStencil",get:function(){return this._stencil},set:function(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}},{key:"projection",get:function(){return this._projection},set:function(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===en.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._camera&&(this._camera.fov=x(e))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._camera&&(this._camera.nearClip=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._camera&&(this._camera.farClip=e)}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._camera&&(this._camera.iso=e)}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect=e,this._camera&&this._camera.setViewportInOrientedSpace(e)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var i=this._targetTexture;this._targetTexture=e,this._checkTargetTextureEvent(i),this._updateTargetTexture(),!e&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(t.TARGET_TEXTURE_CHANGE,this)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?me.director.root&&me.director.root.mainWindow:me.director.root&&me.director.root.tempWindow)}}]),t}(Ri),Es.ProjectionType=Ms,Es.FOVAxis=Ds,Es.ClearFlag=Bs,Es.Aperture=Os,Es.Shutter=Fs,Es.ISO=Ls,Es.TARGET_TEXTURE_CHANGE="tex-change",as=mi((rs=Ss).prototype,"_projection",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ms.PERSPECTIVE}}),ss=mi(rs.prototype,"_priority",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),os=mi(rs.prototype,"_fov",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),us=mi(rs.prototype,"_fovAxis",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ds.VERTICAL}}),cs=mi(rs.prototype,"_orthoHeight",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),ls=mi(rs.prototype,"_near",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hs=mi(rs.prototype,"_far",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),fs=mi(rs.prototype,"_color",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y("#333333")}}),ds=mi(rs.prototype,"_depth",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ps=mi(rs.prototype,"_stencil",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_s=mi(rs.prototype,"_clearFlags",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bs.SOLID_COLOR}}),ms=mi(rs.prototype,"_rect",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new g(0,0,1,1)}}),gs=mi(rs.prototype,"_aperture",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Os.F16_0}}),vs=mi(rs.prototype,"_shutter",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fs.D125}}),ys=mi(rs.prototype,"_iso",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ls.ISO100}}),bs=mi(rs.prototype,"_screenScale",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ws=mi(rs.prototype,"_visibility",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci}}),Ts=mi(rs.prototype,"_targetTexture",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mi(rs.prototype,"priority",[_a,ma],Object.getOwnPropertyDescriptor(rs.prototype,"priority"),rs.prototype),mi(rs.prototype,"visibility",[ga,va,ya],Object.getOwnPropertyDescriptor(rs.prototype,"visibility"),rs.prototype),mi(rs.prototype,"clearFlags",[ba,wa,Ta],Object.getOwnPropertyDescriptor(rs.prototype,"clearFlags"),rs.prototype),mi(rs.prototype,"clearColor",[Ea,Sa],Object.getOwnPropertyDescriptor(rs.prototype,"clearColor"),rs.prototype),mi(rs.prototype,"clearDepth",[Aa,Na],Object.getOwnPropertyDescriptor(rs.prototype,"clearDepth"),rs.prototype),mi(rs.prototype,"clearStencil",[xa,Ia],Object.getOwnPropertyDescriptor(rs.prototype,"clearStencil"),rs.prototype),mi(rs.prototype,"projection",[Ra,Ca,Pa],Object.getOwnPropertyDescriptor(rs.prototype,"projection"),rs.prototype),mi(rs.prototype,"fovAxis",[ka,Ma,Da],Object.getOwnPropertyDescriptor(rs.prototype,"fovAxis"),rs.prototype),mi(rs.prototype,"fov",[Oa,Fa],Object.getOwnPropertyDescriptor(rs.prototype,"fov"),rs.prototype),mi(rs.prototype,"orthoHeight",[La,Ba],Object.getOwnPropertyDescriptor(rs.prototype,"orthoHeight"),rs.prototype),mi(rs.prototype,"near",[Ua,za],Object.getOwnPropertyDescriptor(rs.prototype,"near"),rs.prototype),mi(rs.prototype,"far",[Wa,ja],Object.getOwnPropertyDescriptor(rs.prototype,"far"),rs.prototype),mi(rs.prototype,"aperture",[Va,Ha,Ga],Object.getOwnPropertyDescriptor(rs.prototype,"aperture"),rs.prototype),mi(rs.prototype,"shutter",[qa,Ya,Xa],Object.getOwnPropertyDescriptor(rs.prototype,"shutter"),rs.prototype),mi(rs.prototype,"iso",[Qa,Za,Ja],Object.getOwnPropertyDescriptor(rs.prototype,"iso"),rs.prototype),mi(rs.prototype,"rect",[Ka,$a],Object.getOwnPropertyDescriptor(rs.prototype,"rect"),rs.prototype),mi(rs.prototype,"targetTexture",[es,ts,is],Object.getOwnPropertyDescriptor(rs.prototype,"targetTexture"),rs.prototype),ns=rs))||ns)||ns)||ns)||ns));me.Camera=Us,ft(Us,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),ft(Us.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),me.CameraComponent=Us,gt.setClassAlias(Us,"cc.CameraComponent");var zs,Ws,js,Vs,Hs,Gs,qs,Ys,Xs,Qs,Zs=e("U",pi("cc.animation.UniformProxyFactory")((Ps=function(){function e(e,t){gi(this,"passIndex",Is,this),gi(this,"uniformName",Rs,this),gi(this,"channelIndex",Cs,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],i=t.getHandle(this.uniformName);if(!i)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');if(Pi.getTypeFromHandle(i)<ki.SAMPLER1D){var n=void 0===this.channelIndex?i:t.getHandle(this.uniformName,this.channelIndex,ki.FLOAT);if(!n)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var i,n=Ye(e.shaderInfo.blocks);!(i=n()).done;)for(var r,a=i.value,s=Ye(a.members);!(r=s()).done;){var o=r.value;if(o.name===t)return o.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(n,e)}}:{set:function(e){t.setUniform(n,e)}}}var r=Pi.getBindingFromHandle(i),a=t.properties[this.uniformName],s=a&&a.value?a.value+"-texture":Mi(a.type),o=Ke.get(s);return o||(Di("Illegal texture default value: "+s+"."),o=Ke.get("default-texture")),{set:function(e){e||(e=o);var i=e.getGFXTexture();i&&i.width&&i.height&&(t.bindTexture(r,i),e instanceof Oi&&t.bindSampler(r,me.game._gfxDevice.getSampler(e.getSamplerInfo())))}}},e}(),Is=mi((xs=Ps).prototype,"passIndex",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rs=mi(xs.prototype,"uniformName",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Cs=mi(xs.prototype,"channelIndex",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Ns=xs))||Ns);e("M",pi("cc.animation.MorphWeightValueProxy")((Hs=function(){function e(){gi(this,"subMeshIndex",js,this),gi(this,"shapeIndex",Vs,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(i){e.setWeight(i,t.subMeshIndex,t.shapeIndex)}}},e}(),js=mi((Ws=Hs).prototype,"subMeshIndex",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vs=mi(Ws.prototype,"shapeIndex",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zs=Ws))||zs),e("a",pi("cc.animation.MorphWeightsValueProxy")((Xs=function(){function e(){gi(this,"subMeshIndex",Ys,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(i){e.setWeights(i,t.subMeshIndex)}}},e}(),Ys=mi((qs=Xs).prototype,"subMeshIndex",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gs=qs))||Gs),e("b",pi("cc.animation.MorphWeightsAllValueProxy")(Qs=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var i,n,r=null!==(i=null===(n=e.mesh)||void 0===n?void 0:n.struct.primitives.length)&&void 0!==i?i:0,a=0;a<r;++a)e.setWeights(t,a)}}},e}())||Qs);var Js=Symbol("[[Owner]]");function Ks(e,t){Li(e[Js]===t)}var $s,eo,to,io,no,ro,ao,so,oo,uo,co,lo,ho,fo,po,_o,mo,go,vo,yo=function(e){function t(t){var i;return(i=e.call(this,t+" transition is invalid")||this).name="TransitionRejectError",i}return Le(t,e),t}(Bi(Error)),bo=function(e){function t(t){return e.call(this,"Graph variable "+t+" is not defined")||this}return Le(t,e),t}(Bi(Error)),wo=function(e){function t(t,i,n){return e.call(this,"Expect graph variable "+t+" to have type '"+i+"' instead of received '"+(null!=n?n:typeof n)+"'")||this}return Le(t,e),t}(Bi(Error)),To=Symbol("[[createEval]]"),Eo=Symbol("[[Outgoing transitions]]"),So=Symbol("[[Incoming transitions]]"),Ao=pi("cc.animation.State")((io=function(e){function t(){var t;return t=e.call(this)||this,gi(t,"name",to,lt(t)),t[Eo]=[],t[So]=[],t}return Le(t,e),t}(Wi),to=mi((eo=io).prototype,"name",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$s=eo))||$s,No=pi(hn+"InteractiveState")((so=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"_components",ao,lt(t)),t}Le(t,e);var i=t.prototype;return i.addComponent=function(e){var t=new e;return this._components.push(t),t},i.removeComponent=function(e){Ui(this._components,e)},i.instantiateComponents=function(){return this._components.map((function(e){return zi(e)}))},ke(t,[{key:"components",get:function(){return this._components}}]),t}(Ao),ao=mi((ro=so).prototype,"_components",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),no=ro))||no;!function(e){e[e.FLOAT=0]="FLOAT",e[e.BOOLEAN=1]="BOOLEAN",e[e.TRIGGER=2]="TRIGGER",e[e.INTEGER=3]="INTEGER"}(vo||(vo=e("V",{})));var xo,Io,Ro,Co,Po,ko=pi(hn+"BindableNumber")((ho=function(){function e(e){void 0===e&&(e=0),gi(this,"variable",co,this),gi(this,"value",lo,this),this.value=e}return e.prototype.clone=function(){var t=new e;return t.value=this.value,t.variable=this.variable,t},e}(),co=mi((uo=ho).prototype,"variable",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),lo=mi(uo.prototype,"value",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oo=uo))||oo,Mo=pi(hn+"BindableBoolean")((go=function(){function e(e){void 0===e&&(e=!1),gi(this,"variable",_o,this),gi(this,"value",mo,this),this.value=e}return e.prototype.clone=function(){var t=new e;return t.value=this.value,t.variable=this.variable,t},e}(),_o=mi((po=go).prototype,"variable",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),mo=mi(po.prototype,"value",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fo=po))||fo;function Do(e,t,i,n,r){var a=t.variable,s=t.value;if(!a)return s;var o=e.getVar(a);if(!Fo(o,a))return s;if(o.type!==i)throw new wo(a,"number");for(var u=arguments.length,c=new Array(u>5?u-5:0),l=5;l<u;l++)c[l-5]=arguments[l];var h=o.bind.apply(o,[n,r].concat(c));return h}function Oo(e,t,i,n,r){var a=t.variable,s=t.value;if(!a)return s;var o=e.getVar(a);if(!Fo(o,a))return s;if(i!==vo.FLOAT&&i!==vo.INTEGER)throw new wo(a,"number or integer");for(var u=arguments.length,c=new Array(u>5?u-5:0),l=5;l<u;l++)c[l-5]=arguments[l];var h=o.bind.apply(o,[n,r].concat(c));return h}function Fo(e,t){if(e)return!0;throw new bo(t)}var Lo,Bo,Uo,zo,Wo,jo,Vo,Ho,Go,qo,Yo,Xo,Qo,Zo,Jo,Ko,$o,eu,tu,iu,nu,ru,au,su,ou,uu,cu,lu,hu,fu,du,pu,_u,mu,gu,vu,yu,bu,wu,Tu,Eu,Su,Au,Nu=pi("cc.animation.Motion")((Po=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"motion",Ro,lt(t)),gi(t,"speed",Co,lt(t)),t}return Le(t,e),t.prototype.clone=function(){var e,i,n=new t;return n.motion=null!==(e=null===(i=this.motion)||void 0===i?void 0:i.clone())&&void 0!==e?e:null,n.speed=this.speed.clone(),n},t}(No),Ro=mi((Io=Po).prototype,"motion",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Co=mi(Io.prototype,"speed",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ko(1)}}),xo=Io))||xo,xu=Symbol("[[OnAfterDeserialized]]"),Iu=pi(hn+"Transition")((jo=function(e){function t(t,i,n){var r;return r=e.call(this)||this,gi(r,"from",Uo,lt(r)),gi(r,"to",zo,lt(r)),gi(r,"conditions",Wo,lt(r)),r[Js]=void 0,r.from=t,r.to=i,n&&(r.conditions=n),r}return Le(t,e),t}(Wi),Uo=mi((Bo=jo).prototype,"from",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zo=mi(Bo.prototype,"to",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wo=mi(Bo.prototype,"conditions",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Lo=Bo))||Lo,Ru=pi(hn+"AnimationTransition")((Qo=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"duration",Go,lt(t)),gi(t,"relativeDuration",qo,lt(t)),gi(t,"exitConditionEnabled",Yo,lt(t)),gi(t,"_exitCondition",Xo,lt(t)),t}return Le(t,e),ke(t,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(e){this._exitCondition=e}}]),t}(Iu),Go=mi((Ho=Qo).prototype,"duration",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),qo=mi(Ho.prototype,"relativeDuration",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yo=mi(Ho.prototype,"exitConditionEnabled",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xo=mi(Ho.prototype,"_exitCondition",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Vo=Ho))||Vo;function Cu(e){return e instanceof Ru}var Pu,ku=pi("cc.animation.StateMachine")((nu=function(e){Le(i,e);var t=i.prototype;function i(){var t;return t=e.call(this)||this,gi(t,"_states",Ko,lt(t)),gi(t,"_transitions",$o,lt(t)),gi(t,"_entryState",eu,lt(t)),gi(t,"_exitState",tu,lt(t)),gi(t,"_anyState",iu,lt(t)),t._entryState=t._addState(new Ao),t._entryState.name="Entry",t._exitState=t._addState(new Ao),t._exitState.name="Exit",t._anyState=t._addState(new Ao),t._anyState.name="Any",t}return t.__callOnAfterDeserializeRecursive=function(){this[xu]();for(var e=this._states.length,t=0;t<e;++t){var i=this._states[t];i instanceof Mu&&i.stateMachine.__callOnAfterDeserializeRecursive()}},t[xu]=function(){this._states.forEach((function(){})),this._transitions.forEach((function(e){e.from[Eo].push(e),e.to[So].push(e)}))},t[To]=function(){throw new Error("Method not implemented.")},t.states=function(){return this._states},t.transitions=function(){return this._transitions},t.getTransitionsBetween=function(e,t){return Ks(e,this),Ks(t,this),e[Eo].filter((function(e){return e.to===t}))},t.getOutgoings=function(e){return Ks(e,this),e[Eo]},t.getIncomings=function(e){return Ks(e,this),e[So]},t.addMotion=function(){return this._addState(new Nu)},t.addSubStateMachine=function(){return this._addState(new Mu)},t.remove=function(e){Ks(e,this),e!==this.entryState&&e!==this.exitState&&e!==this.anyState&&(this.eraseTransitionsIncludes(e),Ui(this._states,e))},t.connect=function(e,t,i){if(Ks(e,this),Ks(t,this),t===this.entryState)throw new yo("to-entry");if(t===this.anyState)throw new yo("to-any");if(e===this.exitState)throw new yo("from-exit");var n=e instanceof Nu||e===this._anyState?new Ru(e,t,i):new Iu(e,t,i);return this._transitions.push(n),e[Eo].push(n),t[So].push(n),n},t.disconnect=function(e,t){Ks(e,this),Ks(t,this);for(var i=e[Eo],n=t[So],r=this._transitions,a=i.filter((function(e){return e.to===t})),s=a.length,o=function(e){var t=a[e];Ui(i,t),Li(Ui(r,t)),Vi(Hi(n,(function(e){return e===t})))},u=0;u<s;++u)o(u)},t.removeTransition=function(e){Li(Ui(this._transitions,e)),Vi(Hi(e.from[Eo],(function(t){return t===e}))),Vi(Hi(e.to[So],(function(t){return t===e})))},t.eraseOutgoings=function(e){var t=this;Ks(e,this);for(var i=e[Eo],n=function(e){var n=i[e],r=n.to;Li(Ui(t._transitions,n)),Vi(Hi(r[So],(function(e){return e===n})))},r=0;r<i.length;++r)n(r);i.length=0},t.eraseIncomings=function(e){var t=this;Ks(e,this);for(var i=e[So],n=function(e){var n=i[e],r=n.from;Li(Ui(t._transitions,n)),Vi(Hi(r[Eo],(function(e){return e===n})))},r=0;r<i.length;++r)n(r);i.length=0},t.eraseTransitionsIncludes=function(e){this.eraseIncomings(e),this.eraseOutgoings(e)},t.clone=function(){for(var e,t=new i,n=new Map,r=Ye(this._states);!(e=r()).done;){var a=e.value;switch(a){case this._entryState:n.set(a,t._entryState);break;case this._exitState:n.set(a,t._exitState);break;case this._anyState:n.set(a,t._anyState);break;default:if(a instanceof Nu||a instanceof Mu){var s=a.clone();t._addState(s),n.set(a,s)}}}for(var o,u=Ye(this._transitions);!(o=u()).done;){var c=o.value,l=n.get(c.from),h=n.get(c.to),f=t.connect(l,h);f.conditions=c.conditions.map((function(e){return e.clone()})),f instanceof Ru&&(f.duration=c.duration,f.exitConditionEnabled=c.exitConditionEnabled,f.exitCondition=c.exitCondition)}return t},t._addState=function(e){return this._states.push(e),e},ke(i,[{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),i}(Wi),Ko=mi((Jo=nu).prototype,"_states",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$o=mi(Jo.prototype,"_transitions",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eu=mi(Jo.prototype,"_entryState",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu=mi(Jo.prototype,"_exitState",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iu=mi(Jo.prototype,"_anyState",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zo=Jo))||Zo,Mu=pi("cc.animation.SubStateMachine")((ou=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"_stateMachine",su,lt(t)),t}return Le(t,e),t.prototype.clone=function(){var e=new t;return e._stateMachine=this._stateMachine.clone(),e},ke(t,[{key:"stateMachine",get:function(){return this._stateMachine}}]),t}(No),su=mi((au=ou).prototype,"_stateMachine",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ku}}),ru=au))||ru,Du=pi("cc.animation.Layer")((_u=function(){function e(){this[Js]=void 0,gi(this,"_stateMachine",lu,this),gi(this,"name",hu,this),gi(this,"weight",fu,this),gi(this,"mask",du,this),gi(this,"blending",pu,this),this._stateMachine=new ku}return ke(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(),lu=mi((cu=_u).prototype,"_stateMachine",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hu=mi(cu.prototype,"name",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fu=mi(cu.prototype,"weight",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),du=mi(cu.prototype,"mask",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pu=mi(cu.prototype,"blending",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pu.additive}}),uu=cu))||uu;!function(e){e[e.override=0]="override",e[e.additive=1]="additive"}(Pu||(Pu={}));var Ou,Fu,Lu,Bu,Uu,zu=pi("cc.animation.Variable")((bu=function(){function e(e){if(gi(this,"_type",vu,this),gi(this,"_value",yu,this),void 0!==e)switch(this._type=e,e){default:break;case vo.FLOAT:case vo.INTEGER:this._value=0;break;case vo.BOOLEAN:case vo.TRIGGER:this._value=!1}}return ke(e,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(e){this._value=e}}]),e}(),vu=mi((gu=bu).prototype,"_type",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vo.FLOAT}}),yu=mi(gu.prototype,"_value",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mu=gu))||mu,Wu=pi("cc.animation.AnimationGraph")((Au=function(e){function t(){var t;return t=e.call(this)||this,gi(t,"_layers",Eu,lt(t)),gi(t,"_variables",Su,lt(t)),t}Le(t,e);var i=t.prototype;return i.onLoaded=function(){for(var e=this._layers,t=e.length,i=0;i<t;++i)e[i].stateMachine.__callOnAfterDeserializeRecursive()},i.addLayer=function(){var e=new Du;return this._layers.push(e),e},i.removeLayer=function(e){rt.removeAt(this._layers,e)},i.moveLayer=function(e,t){!function(e,t,i){if(ji(e,t),ji(e,i),t===i)return e;var n=e[t];if(t<i)for(var r=t+1;r<=i;++r)e[r-1]=e[r];else for(var a=t;a!==i;--a)e[a]=e[a-1];e[i]=n}(this._layers,e,t)},i.addVariable=function(e,t,i){var n=new zu(t);void 0!==i&&(n.value=i),this._variables[e]=n},i.removeVariable=function(e){delete this._variables[e]},i.getVariable=function(e){return this._variables[e]},ke(t,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),t}(wt),Eu=mi((Tu=Au).prototype,"_layers",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Su=mi(Tu.prototype,"_variables",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),wu=Tu))||wu,ju=Hu,Vu=Hu;function Hu(){}Ou=pi("cc.animation.ClipMotion"),Fu=_i(fn),Ou((Uu=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"clip",Bu,lt(t)),t}Le(t,e);var i=t.prototype;return i[To]=function(e){return this.clip?new lc(e,this.clip):null},i.clone=function(){var e=new t;return e.clip=this.clip,e},t}(Wi),Bu=mi((Lu=Uu).prototype,"clip",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lu));var Gu,qu,Yu,Xu,Qu,Zu,Ju,Ku,$u,ec,tc,ic,nc,rc,ac,sc,oc,uc,cc,lc=function(){function e(e,t){this.duration=t.duration,this._state=new dn(t),this._state.initialize(e.node,e.blendBuffer)}var t=e.prototype;return t.getClipStatuses=function(e){var t=this,i=!1;return{next:function(){return i?{done:!0,value:void 0}:(i=!0,{done:!1,value:{__DEBUG_ID__:t.__DEBUG__ID__,clip:t._state.clip,weight:e}})}}},t.sample=function(e,t){if(0!==t){this._state.name;var i=this._state.duration*e;this._state.time=i,this._state.weight=t,this._state.sample(),this._state.weight=0}},ke(e,[{key:"progress",get:function(){return this._state.time/this.duration}}]),e}(),hc=pi(hn+"AnimationBlendItem")((Xu=function(){function e(){gi(this,"motion",Yu,this)}var t=e.prototype;return t.clone=function(){var t=new e;return this._assign(t),t},t._assign=function(e){var t,i;return e.motion=null!==(t=null===(i=this.motion)||void 0===i?void 0:i.clone())&&void 0!==t?t:null,e},e}(),Yu=mi((qu=Xu).prototype,"motion",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gu=qu))||Gu,fc=pi(hn+"AnimationBlend")((Ku=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"name",Ju,lt(t)),t}return Le(t,e),t}(Wi),Ju=mi((Zu=Ku).prototype,"name",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qu=Zu))||Qu,dc=function(){function e(e,t,i){this._childEvaluators=t.map((function(t){var i,n;return null!==(i=null===(n=t.motion)||void 0===n?void 0:n[To](e))&&void 0!==i?i:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[].concat(i)}var t=e.prototype;return t.getClipStatuses=function(e){var t,i=this._childEvaluators,n=this._weights,r=i.length,a=0;return{next:function(){for(;;){if(t){var s=t.next();if(!s.done)return s}if(a>=r)return{done:!0,value:void 0};var o=i[a];t=null==o?void 0:o.getClipStatuses(e*n[a]),++a}}}},t.sample=function(e,t){for(var i=0;i<this._childEvaluators.length;++i){var n;null===(n=this._childEvaluators[i])||void 0===n||n.sample(e,t*this._weights[i])}},t.setInput=function(e,t){this._inputs[t]=e,this.doEval()},t.doEval=function(){this.eval(this._weights,this._inputs)},t.eval=function(){},ke(e,[{key:"duration",get:function(){for(var e=0,t=0;t<this._childEvaluators.length;++t){var i,n;e+=(null!==(i=null===(n=this._childEvaluators[t])||void 0===n?void 0:n.duration)&&void 0!==i?i:0)*this._weights[t]}return e}}]),e}(),pc=pi(hn+"AnimationBlend1DItem")((ic=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"threshold",tc,lt(t)),t}Le(t,e);var i=t.prototype;return i.clone=function(){var e=new t;return this._assign(e),e},i._assign=function(t){return e.prototype._assign.call(this,t),t.threshold=this.threshold,t},t}(hc),tc=mi((ec=ic).prototype,"threshold",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$u=ec))||$u,_c=(pi("cc.animation.AnimationBlend1D")((oc=sc=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"_items",rc,lt(t)),gi(t,"param",ac,lt(t)),t}Le(t,e);var i=t.prototype;return i.clone=function(){var e=new t;return e._items=this._items.map((function(e){return e.clone()})),e.param=this.param.clone(),e},i[To]=function(e){var t=new _c(e,this._items,this._items.map((function(e){return e.threshold})),0),i=Do(e,this.param,vo.FLOAT,t.setInput,t,0);return t.setInput(i,0),t},ke(t,[{key:"items",get:function(){return this._items},set:function(e){this._items=Array.from(e).sort((function(e,t){return e.threshold-t.threshold}))}}]),t}(fc),sc.Item=pc,rc=mi((nc=oc).prototype,"_items",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ac=mi(nc.prototype,"param",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ko}}),nc)),function(e){function t(t,i,n,r){var a;return(a=e.call(this,t,i,[r])||this)._thresholds=n,a.doEval(),a}return Le(t,e),t.prototype.eval=function(e,t){var i=t[0];!function(e,t,i){if(e.fill(0),0===t.length);else if(i<=t[0])e[0]=1;else if(i>=t[t.length-1])e[e.length-1]=1;else{for(var n=0,r=1;r<t.length;++r)if(t[r]>i){n=r;break}var a=t[n-1],s=t[n],o=s-a;e[n-1]=(s-i)/o,e[n]=(i-a)/o}}(e,this._thresholds,i)},t}(dc)),mc=(uc=new n,cc={wA:0,wB:0},function(e,t,i){if(Li(e.length===t.length),0!==t.length)if(1!==t.length)if(n.strictEquals(i,n.ZERO)){var r=t.findIndex((function(e){return n.strictEquals(e,n.ZERO)}));r>=0?e[r]=1:e.fill(1/t.length)}else{for(var a=-1,s=-1,o=-1,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=i.x,h=i.y,f=0;f<t.length;++f){var d=t[f];if(n.equals(d,n.ZERO))o=f;else{var p=n.normalize(uc,d),_=n.dot(p,i);p.x*h-p.y*l>0?_>=c&&(c=_,a=f):_>=u&&(u=_,s=f)}}var m=0;if(a<0||s<0)m=1;else{var g=(A=t[a],N=t[s],x=i,I=cc,(R=n.cross(A,N))?(I.wA=n.cross(x,N)/R,I.wB=n.cross(x,A)/-R):(I.wA=0,I.wB=0),I),v=g.wA,y=g.wB,b=0,w=0,T=v+y;T>1?(b=v/T,w=y/T):T<0?(b=0,w=0,m=1):(b=v,w=y,m=1-T),e[a]=b,e[s]=w}if(m>0)if(o>=0)e[o]=m;else for(var E=m/e.length,S=0;S<e.length;++S)e[S]+=E}else e[0]=1;var A,N,x,I,R});function gc(e,t,i,r){e.fill(0);for(var a=new n(0,0),s=new n(0,0),o=0,u=t.length,c=0;c<u;++c){for(var l=Number.MAX_VALUE,h=!1,f=0;f<u;++f)if(c!==f){r(t[c],t[f],i,a,s);var d=1-n.dot(a,s)/n.lengthSqr(s);if(d<0){h=!0;break}l=Math.min(l,d)}h||(e[c]=l,o+=l)}o>0&&e.forEach((function(t,i){return e[i]=t/o}))}var vc,yc,bc,wc,Tc,Ec,Sc,Ac,Nc,xc,Ic,Rc,Cc,Pc,kc,Mc,Dc,Oc,Fc=function(e,t,i,r,a){n.subtract(r,i,e),n.subtract(a,t,e)},Lc=(vc=new a(0,0,0),yc=new a(0,0,0),bc=new a(0,0,0),wc=new a(0,0,0),Tc=new a(0,0,0),Ec=new a(0,0,0),function(e,t,i,r,s){var o=0,u=0,c=2;a.set(bc,i.x,i.y,0),n.equals(e,n.ZERO)?(o=n.angle(i,t),u=0,c=1):n.equals(t,n.ZERO)?(u=o=n.angle(i,e),c=1):(o=n.angle(e,t))<=0?u=0:n.equals(i,n.ZERO)?u=o:(a.set(wc,e.x,e.y,0),a.set(Tc,t.x,t.y,0),a.set(Ec,i.x,i.y,0),a.cross(vc,wc,Tc),a.projectOnPlane(bc,Ec,vc),u=a.angle(wc,bc),o<.99*Math.PI&&a.dot(a.cross(yc,wc,bc),vc)<0&&(u=-u));var l=n.len(e),h=n.len(t),f=(h+l)/2;n.set(s,(h-l)/f,o*c),n.set(r,(a.len(bc)-l)/f,u*c)});!function(e){e[e.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",e[e.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",e[e.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(Oc||(Oc={})),Gi(Oc);var Bc,Uc,zc,Wc,jc,Vc,Hc,Gc,qc,Yc,Xc,Qc,Zc,Jc,Kc,$c,el,tl,il,nl,rl,al,sl,ol,ul=pi(hn+"AnimationBlend2DItem")((xc=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"threshold",Nc,lt(t)),t}Le(t,e);var i=t.prototype;return i.clone=function(){var e=new t;return this._assign(e),e},i._assign=function(t){return e.prototype._assign.call(this,t),n.copy(t.threshold,this.threshold),t},t}(hc),Nc=mi((Ac=xc).prototype,"threshold",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new n}}),Sc=Ac))||Sc,cl=(pi("cc.animation.AnimationBlend2D")((Dc=Mc=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"algorithm",Rc,lt(t)),gi(t,"_items",Cc,lt(t)),gi(t,"paramX",Pc,lt(t)),gi(t,"paramY",kc,lt(t)),t}Le(t,e);var i=t.prototype;return i.clone=function(){var e=new t;return e._items=this._items.map((function(e){var t;return null!==(t=null==e?void 0:e.clone())&&void 0!==t?t:null})),e.paramX=this.paramX.clone(),e.paramY=this.paramY.clone(),e},i[To]=function(e){var t=new cl(e,this._items,this._items.map((function(e){return e.threshold})),this.algorithm,[0,0]),i=Do(e,this.paramX,vo.FLOAT,t.setInput,t,0),n=Do(e,this.paramY,vo.FLOAT,t.setInput,t,1);return t.setInput(i,0),t.setInput(n,1),t},ke(t,[{key:"items",get:function(){return this._items},set:function(e){this._items=Array.from(e)}}]),t}(fc),Mc.Algorithm=Oc,Mc.Item=ul,Rc=mi((Ic=Dc).prototype,"algorithm",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oc.SIMPLE_DIRECTIONAL}}),Cc=mi(Ic.prototype,"_items",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Pc=mi(Ic.prototype,"paramX",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ko}}),kc=mi(Ic.prototype,"paramY",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ko}}),Ic)),function(e){function t(t,i,r,a,s){var o;return(o=e.call(this,t,i,s)||this)._thresholds=void 0,o._algorithm=void 0,o._value=new n,o._thresholds=r,o._algorithm=a,o.doEval(),o}return Le(t,e),t.prototype.eval=function(e,t){var i=t[0],r=t[1];switch(n.set(this._value,i,r),e.fill(0),this._algorithm){case Oc.SIMPLE_DIRECTIONAL:mc(e,this._thresholds,this._value);break;case Oc.FREEFORM_CARTESIAN:!function(e,t,i){gc(e,t,i,Fc)}(e,this._thresholds,this._value);break;case Oc.FREEFORM_DIRECTIONAL:!function(e,t,i){gc(e,t,i,Lc)}(e,this._thresholds,this._value)}},t}(dc)),ll=pi(hn+"AnimationBlendDirectItem")((Wc=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"weight",zc,lt(t)),t}Le(t,e);var i=t.prototype;return i.clone=function(){var e=new t;return this._assign(e),e},i._assign=function(t){return e.prototype._assign.call(this,t),t.weight=this.weight,t},t}(hc),zc=mi((Uc=Wc).prototype,"weight",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bc=Uc))||Bc,hl=(pi("cc.animation.AnimationBlendDirect")((Gc=Hc=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"_items",Vc,lt(t)),t}Le(t,e);var i=t.prototype;return i.clone=function(){var e=new t;return e._items=this._items.map((function(e){var t;return null!==(t=null==e?void 0:e.clone())&&void 0!==t?t:null})),e},i[To]=function(e){return new hl(e,this._items,this._items.map((function(e){return e.weight})))},ke(t,[{key:"items",get:function(){return this._items},set:function(e){this._items=Array.from(e)}}]),t}(fc),Hc.Item=ll,Vc=mi((jc=Gc).prototype,"_items",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jc)),function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).doEval(),t}return Le(t,e),t.prototype.eval=function(e,t){for(var i=e.length,n=0;n<i;++n)e[n]=t[n]},t}(dc));!function(e){e[e.EQUAL_TO=0]="EQUAL_TO",e[e.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",e[e.LESS_THAN=2]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(ol||(ol={})),pi(hn+"BinaryCondition")((Jc=Zc=function(){function e(){gi(this,"operator",Yc,this),gi(this,"lhs",Xc,this),gi(this,"rhs",Qc,this)}var t=e.prototype;return t.clone=function(){var t=new e;return t.operator=this.operator,t.lhs=this.lhs.clone(),t.rhs=this.rhs.clone(),t},t[To]=function(e){var t=this.operator,i=this.lhs,n=this.rhs,r=new dl(t,0,0),a=Oo(e,i,vo.FLOAT,r.setLhs,r),s=Oo(e,n,vo.FLOAT,r.setRhs,r);return r.reset(a,s),r},e}(),Zc.Operator=ol,Yc=mi((qc=Jc).prototype,"operator",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ol.EQUAL_TO}}),Xc=mi(qc.prototype,"lhs",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ko}}),Qc=mi(qc.prototype,"rhs",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ko}}),qc));var fl,dl=function(){function e(e,t,i){this._operator=e,this._lhs=t,this._rhs=i,this._eval()}var t=e.prototype;return t.reset=function(e,t){this._lhs=e,this._rhs=t,this._eval()},t.setLhs=function(e){this._lhs=e,this._eval()},t.setRhs=function(e){this._rhs=e,this._eval()},t.eval=function(){return this._result},t._eval=function(){var e=this._lhs,t=this._rhs;switch(this._operator){default:case ol.EQUAL_TO:this._result=e===t;break;case ol.NOT_EQUAL_TO:this._result=e!==t;break;case ol.LESS_THAN:this._result=e<t;break;case ol.LESS_THAN_OR_EQUAL_TO:this._result=e<=t;break;case ol.GREATER_THAN:this._result=e>t;break;case ol.GREATER_THAN_OR_EQUAL_TO:this._result=e>=t}},e}();!function(e){e[e.TRUTHY=0]="TRUTHY",e[e.FALSY=1]="FALSY"}(fl||(fl={})),pi(hn+"UnaryCondition")((il=tl=function(){function e(){gi(this,"operator",$c,this),gi(this,"operand",el,this)}var t=e.prototype;return t.clone=function(){var t=new e;return t.operator=this.operator,t.operand=this.operand.clone(),t},t[To]=function(e){var t=this.operator,i=this.operand,n=new gl(t,!1),r=Do(e,i,vo.BOOLEAN,n.setOperand,n);return n.reset(r),n},e}(),tl.Operator=fl,$c=mi((Kc=il).prototype,"operator",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fl.TRUTHY}}),el=mi(Kc.prototype,"operand",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mo}}),Kc));var pl,_l,ml,gl=function(){function e(e,t){this._operator=e,this._operand=t,this._eval()}var t=e.prototype;return t.reset=function(e){this.setOperand(e)},t.setOperand=function(e){this._operand=e,this._eval()},t.eval=function(){return this._result},t._eval=function(){var e=this._operand;switch(this._operator){default:case fl.TRUTHY:this._result=!!e;break;case fl.FALSY:this._result=!e}},e}(),vl=pi(hn+"TriggerCondition")((sl=function(){function e(){gi(this,"trigger",al,this)}var t=e.prototype;return t.clone=function(){var t=new e;return t.trigger=this.trigger,t},t[To]=function(e){var t=new yl(!1),i=e.getVar(this.trigger);return Fo(i,this.trigger)&&(function(e,t,i){if(e!==t)throw new wo(i,"number")}(i.type,vo.TRIGGER,this.trigger),t.setTrigger(i.bind(t.setTrigger,t))),t},e}(),al=mi((rl=sl).prototype,"trigger",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),nl=rl))||nl,yl=function(){function e(e){this._triggered=!1,this._triggered=e}var t=e.prototype;return t.setTrigger=function(e){this._triggered=e},t.eval=function(){return this._triggered},e}(),bl=function(){function e(){this._nodeBlendStates=new Map}var t=e.prototype;return t.createWriter=function(e,t,i,n){var r=this.ref(e,t);return new wl(e,t,r,i,n)},t.destroyWriter=function(e){var t=e;this.deRef(t.node,t.property)},t.ref=function(e,t){var i=this._nodeBlendStates.get(e);return i||(i=new Al,this._nodeBlendStates.set(e,i)),i.refProperty(t)},t.deRef=function(e,t){var i=this._nodeBlendStates.get(e);i&&(i.deRefProperty(t),i.empty&&this._nodeBlendStates.delete(e))},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){e.apply(t)}))},e}(),wl=function(){function e(e,t,i,n,r){this._node=e,this._property=t,this._propertyBlendState=i,this._host=n,this._constants=r}var t=e.prototype;return t.getValue=function(){return this._node[this._property]},t.setValue=function(e){var t=this._propertyBlendState,i=this._host.weight;t.blend(e,i)},ke(e,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),e}(),Tl=function(e){this.blendedWeight=0,this.blendedValue=void 0,this.refCount=0,this.blendedValue=e},El=function(e){function t(){return e.call(this,new a)||this}Le(t,e);var i=t.prototype;return i.blend=function(e,t){var i=this.blendedValue;1===t?a.copy(i,e):a.scaleAndAdd(i,i,e,t),this.blendedWeight+=t},i.reset=function(){this.blendedWeight=0,a.zero(this.blendedValue)},t}(Tl),Sl=function(e){function t(){return e.call(this,new c)||this}Le(t,e);var i=t.prototype;return i.blend=function(e,t){if(0!==t){var i=this.blendedValue,n=this.blendedWeight;if(1===t)c.copy(i,e);else{var r=t/(n+t);c.slerp(i,i,e,r)}this.blendedWeight+=t}},i.reset=function(){this.blendedWeight=0,c.identity(this.blendedValue)},t}(Tl),Al=function(){function e(){this._properties={}}var t=e.prototype;return t.refProperty=function(e){var t,i,n,r=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":n=null!==(t=r[e])&&void 0!==t?t:r[e]=new El;break;case"rotation":n=null!==(i=r[e])&&void 0!==i?i:r[e]=new Sl}return++n.refCount,n},t.deRefProperty=function(e){var t=this._properties,i=t[e];i&&(--i.refCount,i.refCount>0||delete t[e])},t.apply=function(e){var t,i,n,r=this._properties,a=r.position,s=r.scale,o=r.rotation,u=r.eulerAngles,c=!1,l=!1,h=!1,f=!1;a&&a.blendedWeight&&(c=!0,a.blendedWeight<1&&a.blend(e.position,1-a.blendedWeight),t=a.blendedValue),s&&s.blendedWeight&&(l=!0,s.blendedWeight<1&&s.blend(e.scale,1-s.blendedWeight),i=s.blendedValue),u&&u.blendedWeight&&(f=!0,u.blendedWeight<1&&u.blend(e.eulerAngles,1-u.blendedWeight),n=u.blendedValue),o&&o.blendedWeight&&(h=!0,o.blendedWeight<1&&o.blend(e.rotation,1-o.blendedWeight),n=o.blendedValue),(n||t||i)&&e.setRTS(n,t,i),c&&a.reset(),l&&s.reset(),h&&o.reset(),f&&u.reset()},ke(e,[{key:"empty",get:function(){var e=this._properties;return!(e.position||e.rotation||e.eulerAngles||e.scale)}}]),e}(),Nl=e("S",pi(hn+"StateMachineComponent")(pl=function(){function e(){}var t=e.prototype;return t.onMotionStateEnter=function(){},t.onMotionStateExit=function(){},t.onMotionStateUpdate=function(){},t.onStateMachineEnter=function(){},t.onStateMachineExit=function(){},e}())||pl),xl=function(){function e(e,t,i){var n=this;this._blendBuffer=new bl,this._currentTransitionCache={duration:0,time:0},this._varInstances={};for(var r,a=Ye(e.variables);!(r=a()).done;){var s=r.value,o=s[0],u=s[1],c=u.type,l=u.value;this._varInstances[o]=new Jl(c,l)}var h={controller:i,blendBuffer:this._blendBuffer,node:t,getVar:function(e){return n._varInstances[e]},triggerResetFn:function(e){n.setValue(e,!1)}};this._layerEvaluations=Array.from(e.layers).map((function(e){var t;return new Il(e,St({},h,{mask:null!==(t=e.mask)&&void 0!==t?t:void 0}))}))}var t=e.prototype;return t.update=function(e){for(var t,i=Ye(this._layerEvaluations);!(t=i()).done;)t.value.update(e);this._blendBuffer.apply()},t.getVariables=function(){return Object.entries(this._varInstances)},t.getCurrentStateStatus=function(e){return this._layerEvaluations[e].getCurrentStateStatus()},t.getCurrentClipStatuses=function(e){return this._layerEvaluations[e].getCurrentClipStatuses()},t.getCurrentTransition=function(e){var t=this._layerEvaluations,i=this._currentTransitionCache;return t[e].getCurrentTransition(i)?i:null},t.getNextStateStatus=function(e){return this._layerEvaluations[e].getNextStateStatus()},t.getNextClipStatuses=function(e){return Vi(this.getCurrentTransition(e)),this._layerEvaluations[e].getNextClipStatuses()},t.getValue=function(e){var t=this._varInstances[e];return t?t.value:void 0},t.setValue=function(e,t){var i=this._varInstances[e];i&&(i.value=t)},e}(),Il=function(){function e(e,t){this._weight=void 0,this._nodes=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._currentTransitionToNode=null,this._currentTransitionPath=[],this._transitionProgress=0,this._fromWeight=0,this._toWeight=0,this._fromUpdated=!1,this._toUpdated=!1,this.name=e.name,this._controller=t.controller,this._weight=e.weight;var i=this._addStateMachine(e.stateMachine,null,St({},t),e.name),n=i.entry,r=i.exit;this._topLevelEntry=n,this._topLevelExit=r,this._currentNode=n,this._resetTrigger=t.triggerResetFn}var t=e.prototype;return t.update=function(e){this.exited||(this._fromWeight=1,this._toWeight=0,this._eval(e),this._sample())},t.getCurrentStateStatus=function(){var e=this._currentNode;return e.kind===ml.animation?e.getFromPortStatus():null},t.getCurrentClipStatuses=function(){var e=this._currentNode;return e.kind===ml.animation?e.getClipStatuses(this._fromWeight):Cl},t.getCurrentTransition=function(e){var t=this._currentTransitionPath;if(0!==t.length){if(t[t.length-1].to.kind!==ml.animation)return!1;var i=t[0],n=i.duration,r=i.normalizedDuration,a=e.duration=r?n*(this._currentNode.kind===ml.animation?this._currentNode.duration:0):n;return e.time=this._transitionProgress*a,!0}return!1},t.getNextStateStatus=function(){return Li(this._currentTransitionToNode),this._currentTransitionToNode.getToPortStatus()},t.getNextClipStatuses=function(){var e,t=this._currentTransitionPath,i=t[t.length-1].to;return Li(i.kind===ml.animation),null!==(e=i.getClipStatuses(this._toWeight))&&void 0!==e?e:Cl},t._addStateMachine=function(e,t,i,n){for(var r,a,s,o=this,u=Array.from(e.states()),c=u.map((function(t){return t instanceof Nu?new Ll(t,i):t===e.entryState?r=new Zl(t,ml.entry,t.name):t===e.exitState?s=new Zl(t,ml.exit,t.name):t===e.anyState?a=new Zl(t,ml.any,t.name):null})),l={components:null,parent:t,entry:r,exit:s,any:a},h=0;h<u.length;++h){var f=c[h];f&&(f.stateMachine=l)}for(var d=u.map((function(e){if(e instanceof Mu){var t=o._addStateMachine(e.stateMachine,l,i,n+"/"+e.name);return t.components=new Fl(e),t}return null})),p=0;p<u.length;++p){var _=u[p],m=e.getOutgoings(_),g=[],v=void 0;v=_ instanceof Mu?d[p].exit:c[p];for(var y,b=function(){var e=y.value,t=e.to,n=u.findIndex((function(t){return t===e.to})),r={to:t instanceof Mu?d[n].entry:c[n],conditions:e.conditions.map((function(e){return e[To](i)})),duration:Cu(e)?e.duration:0,normalizedDuration:!!Cu(e)&&e.relativeDuration,exitConditionEnabled:!!Cu(e)&&e.exitConditionEnabled,exitCondition:Cu(e)?e.exitCondition:0,triggers:void 0};r.conditions.forEach((function(t,i){var n,a=e.conditions[i];a instanceof vl&&a.trigger&&(null!==(n=r.triggers)&&void 0!==n?n:r.triggers=[]).push(a.trigger)})),g.push(r)},w=Ye(m);!(y=w()).done;)b();v.outgoingTransitions=g}return l},t._eval=function(e){if(Li(!this.exited),Vu("[Layer "+this.name+"]: UpdateStart "+e+"s"),this._continueDanglingTransition())return 0;for(var t=e,i=!0,n=0;i||t>0;){if(i=!1,100===n){ze(14e3,100);break}if(++n,this._currentTransitionPath.length>0){if(t-=this._updateCurrentTransition(t),this._currentNode.kind===ml.exit)break;0===this._currentTransitionPath.length&&(i=!0)}else{var r=this._currentNode,a=this._matchCurrentNodeTransition(t);if(a){var s=a.transition,o=a.requires;if(ju("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+r.name),t-=o,r.kind===ml.animation&&(r.updateFromPort(o),this._fromUpdated=!0),this._switchTo(s))break;i=!0}else ju("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+r.name),r.kind===ml.animation&&(r.updateFromPort(t),this._fromUpdated=!0,t=0)}}return ju("[SubStateMachine "+this.name+"]: UpdateEnd"),this._fromUpdated&&this._currentNode.kind===ml.animation&&(this._fromUpdated=!1,this._currentNode.triggerFromPortUpdate(this._controller)),this._currentTransitionToNode&&this._toUpdated&&this._currentNode.kind===ml.animation&&(this._toUpdated=!1,this._currentTransitionToNode.triggerToPortUpdate(this._controller)),t},t._sample=function(){var e=this._currentNode,t=this._currentTransitionToNode,i=this._fromWeight;e.kind===ml.animation&&e.sampleFromPort(i),t&&t.kind===ml.animation&&t.sampleToPort(this._toWeight)},t._matchCurrentNodeTransition=function(e){var t=this._currentNode,i=1/0,n=null,r=this._matchTransition(t,t,e,Ml);if(r&&(i=r.requires,n=r.transition),t.kind===ml.animation)for(var a=t.stateMachine;null!==a;a=a.parent){var s=this._matchTransition(a.any,t,e,Dl);s&&s.requires<i&&(i=s.requires,n=s.transition)}return n?kl.set(n,i):null},t._matchTransition=function(e,t,i,n){Li(e===t||e.kind===ml.any);for(var r=e.outgoingTransitions,a=r.length,s=1/0,o=null,u=0;u<a;++u){var c=r[u],l=c.conditions,h=l.length;if(0===h){if(e.kind===ml.entry||e.kind===ml.exit)return n.set(c,0);if(!c.exitConditionEnabled)continue}var f=0;if(t.kind===ml.animation&&c.exitConditionEnabled){var d=t.duration*c.exitCondition;if((f=Math.max(d-t.fromPortTime,0))>i)continue}for(var p=!0,_=0;_<h;++_)if(!l[_].eval()){p=!1;break}if(p){if(0===f)return n.set(c,0);f<s&&(s=f,o=c)}}return o?n.set(o,s):null},t._switchTo=function(e){var t=this._currentNode;Vu("[SubStateMachine "+this.name+"]: STARTED "+t.name+" -> "+e.to.name+".");var i=this._currentTransitionPath;this._consumeTransition(e),i.push(e);var n=this._matchTransitionPathUntilMotion();return!n||(this._doTransitionToMotion(n),!1)},t._continueDanglingTransition=function(){var e=this._currentTransitionPath,t=e.length;if(0===t)return!1;if(e[t-1].to.kind!==ml.animation){var i=this._matchTransitionPathUntilMotion();return!i||(this._doTransitionToMotion(i),!1)}return!1},t._matchTransitionPathUntilMotion=function(){for(var e=this._currentTransitionPath,t=e[e.length-1].to;t.kind!==ml.animation;){var i=this._matchTransition(t,t,0,kl);if(!i)break;var n=i.transition;this._consumeTransition(n),e.push(n),t=n.to}return t.kind===ml.animation?t:null},t._consumeTransition=function(e){var t=e.to;t.kind===ml.entry&&this._callEnterMethods(t)},t._resetTriggersAlongThePath=function(){for(var e=this._currentTransitionPath,t=e.length,i=0;i<t;++i){var n=e[i];this._resetTriggersOnTransition(n)}},t._doTransitionToMotion=function(e){this._resetTriggersAlongThePath(),this._transitionProgress=0,this._currentTransitionToNode=e,this._toUpdated=!1,e.resetToPort(),this._callEnterMethods(e)},t._updateCurrentTransition=function(e){var t,i=this._currentTransitionPath,n=this._currentTransitionToNode;Vi(i.length>0);var r=i[0],a=r.duration,s=r.normalizedDuration,o=this._currentNode,u=n,c=0,l=0;if(a<=0)c=0,l=1;else{Li(o.kind===ml.animation);var h=this._transitionProgress,f=s?a*o.duration:a,d=h*f,p=f-d;c=Math.min(p,e),l=this._transitionProgress=(d+c)/f}var _=null!==(t=null==u?void 0:u.name)&&void 0!==t?t:"<Empty>",m=this._weight;Vu("[SubStateMachine "+this.name+"]: TransitionUpdate: "+o.name+" -> "+_+"with ratio "+l+" in base weight "+this._weight+"."),this._fromWeight=m*(1-l),this._toWeight=m*l;var g=0!==c,v=1===l;if(o.kind===ml.animation&&g&&(Vu("Update "+o.name),o.updateFromPort(c),this._fromUpdated=!0),u&&g&&(Vu("Update "+u.name),u.updateToPort(c),this._toUpdated=!0),v){ju("[SubStateMachine "+this.name+"]: Transition finished:  "+o.name+" -> "+_+"."),this._callExitMethods(o);for(var y=this._currentTransitionPath,b=y.length,w=0;w<b;++w){var T=y[w].to;T.kind===ml.exit&&this._callExitMethods(T)}this._fromUpdated=this._toUpdated,this._toUpdated=!1,u.finishTransition(),this._currentNode=u,this._currentTransitionToNode=null,this._currentTransitionPath.length=0,this._fromWeight=1,this._toWeight=0}return c},t._resetTriggersOnTransition=function(e){var t=e.triggers;if(t)for(var i=t.length,n=0;n<i;++n){var r=t[n];this._resetTrigger(r)}},t._resetTrigger=function(e){(0,this._triggerReset)(e)},t._callEnterMethods=function(e){var t,i=this._controller;switch(e.kind){default:break;case ml.animation:e.components.callMotionStateEnterMethods(i,e.getToPortStatus());break;case ml.entry:null===(t=e.stateMachine.components)||void 0===t||t.callStateMachineEnterMethods(i)}},t._callExitMethods=function(e){var t,i=this._controller;switch(e.kind){default:break;case ml.animation:e.components.callMotionStateExitMethods(i,e.getFromPortStatus());break;case ml.exit:null===(t=e.stateMachine.components)||void 0===t||t.callStateMachineExitMethods(i)}},ke(e,[{key:"exited",get:function(){return this._currentNode===this._topLevelExit}}]),e}(),Rl=Object.freeze({next:function(){return{done:!0,value:void 0}}}),Cl=Object.freeze(((_l={})[Symbol.iterator]=function(){return Rl},_l)),Pl=function(){function e(){this.transition=null,this.requires=0}return e.prototype.set=function(e,t){return this.transition=e,this.requires=t,this},e}(),kl=new Pl,Ml=new Pl,Dl=new Pl;!function(e){e[e.entry=0]="entry",e[e.exit=1]="exit",e[e.any=2]="any",e[e.animation=3]="animation"}(ml||(ml={}));var Ol=function(e){this.name=void 0,this.outgoingTransitions=[],this.name=e.name},Fl=function(){function e(e){this._components=e.instantiateComponents()}var t=e.prototype;return t.callMotionStateEnterMethods=function(e,t){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",e,t)},t.callMotionStateUpdateMethods=function(e,t){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",e,t)},t.callMotionStateExitMethods=function(e,t){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",e,t)},t.callStateMachineEnterMethods=function(e){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",e)},t.callStateMachineExitMethods=function(e){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",e)},t._callMotionStateCallbackIfNonDefault=function(e,t,i){for(var n=this._components,r=n.length,a=0;a<r;++a){var s=n[a];s[e]!==Nl.prototype[e]&&s[e](t,i)}},t._callStateMachineCallbackIfNonDefault=function(e,t){for(var i=this._components,n=i.length,r=0;r<n;++r){var a=i[r];a[e]!==Nl.prototype[e]&&a[e](t)}},e}(),Ll=function(e){function t(t,i){var n,r,a;(a=e.call(this,t)||this).kind=ml.animation,a._source=null,a._speed=1,a._fromPort={progress:0,statusCache:{progress:0}},a._toPort={progress:0,statusCache:{progress:0}};var s=Do(i,t.speed,vo.FLOAT,a._setSpeed,lt(a));a._speed=s;var o=St({},i),u=null!==(n=null===(r=t.motion)||void 0===r?void 0:r[To](o))&&void 0!==n?n:null;return u&&Object.defineProperty(u,"__DEBUG_ID__",{value:a.name}),a._source=u,a.components=new Fl(t),a}Le(t,e);var i=t.prototype;return i.updateFromPort=function(e){this._fromPort.progress=Bl(this._fromPort.progress,this.duration,e*this._speed)},i.updateToPort=function(e){this._toPort.progress=Bl(this._toPort.progress,this.duration,e*this._speed)},i.triggerFromPortUpdate=function(e){this.components.callMotionStateUpdateMethods(e,this.getFromPortStatus())},i.triggerToPortUpdate=function(e){this.components.callMotionStateUpdateMethods(e,this.getToPortStatus())},i.getFromPortStatus=function(){var e=this._fromPort.statusCache;return e.progress=Ul(this._fromPort.progress),e},i.getToPortStatus=function(){var e=this._toPort.statusCache;return e.progress=Ul(this._toPort.progress),e},i.resetToPort=function(){this._toPort.progress=0},i.finishTransition=function(){this._fromPort.progress=this._toPort.progress},i.sampleFromPort=function(e){var t;null===(t=this._source)||void 0===t||t.sample(this._fromPort.progress,e)},i.sampleToPort=function(e){var t;null===(t=this._source)||void 0===t||t.sample(this._toPort.progress,e)},i.getClipStatuses=function(e){var t,i=this._source;return i?((t={})[Symbol.iterator]=function(){return i.getClipStatuses(e)},t):Cl},i._setSpeed=function(e){this._speed=e},ke(t,[{key:"duration",get:function(){var e,t;return null!==(e=null===(t=this._source)||void 0===t?void 0:t.duration)&&void 0!==e?e:0}},{key:"fromPortTime",get:function(){return this._fromPort.progress*this.duration}}]),t}(Ol);function Bl(e,t,i){return 0===t?0:e+i/t}function Ul(e){return e-Math.trunc(e)}var zl,Wl,jl,Vl,Hl,Gl,ql,Yl,Xl,Ql,Zl=function(e){function t(t,i){var n;return(n=e.call(this,t)||this).kind=void 0,n.kind=i,n}return Le(t,e),t}(Ol),Jl=function(){function e(e,t){this.type=void 0,this._value=void 0,this._refs=[],this.type=e,this._value=t}return e.prototype.bind=function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return this._refs.push({fn:e,thisArg:t,args:n}),this._value},ke(e,[{key:"value",get:function(){return this._value},set:function(e){this._value=e;for(var t,i=Ye(this._refs);!(t=i()).done;){var n=t.value,r=n.fn,a=n.thisArg,s=n.args;r.call.apply(r,[a,e].concat(s))}}}]),e}();e("A",(zl=pi("cc.animation.AnimationController"),Wl=xi(),jl=qi(Wu),zl(Vl=Wl((ql=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,gi(t,"graph",Gl,lt(t)),t._graphEval=null,t}Le(t,e);var i=t.prototype;return i.start=function(){this.graph&&(this._graphEval=new xl(this.graph,this.node,this))},i.update=function(e){var t;null===(t=this._graphEval)||void 0===t||t.update(e)},i.getVariables=function(){return this._graphEval.getVariables()},i.setValue=function(e,t){this._graphEval.setValue(e,t)},i.getValue=function(e){return this._graphEval.getValue(e)},i.getCurrentStateStatus=function(e){return this._graphEval.getCurrentStateStatus(e)},i.getCurrentClipStatuses=function(e){return this._graphEval.getCurrentClipStatuses(e)},i.getCurrentTransition=function(e){return this._graphEval.getCurrentTransition(e)},i.getNextStateStatus=function(e){return this._graphEval.getNextStateStatus(e)},i.getNextClipStatuses=function(e){return this._graphEval.getNextClipStatuses(e)},t}(Ri),Gl=mi((Hl=ql).prototype,"graph",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vl=Hl))||Vl)||Vl)),ft(pn.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return pn.prototype.removeState.call(this,e.name)}}]),me.AnimationComponent=pn,gt.setClassAlias(pn,"cc.AnimationComponent");var Kl,$l,eh,th,ih=e("v",pi((Ql=Xl=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._anims=new Yi([]),t._crossFades=new Yi([]),t._delayEvents=[],t._blendStateBuffer=new bl,t._sockets=[],t}Le(t,e);var i=t.prototype;return i.addCrossFade=function(e){-1===this._crossFades.array.indexOf(e)&&this._crossFades.push(e)},i.removeCrossFade=function(e){var t=this._crossFades.array.indexOf(e);t>=0?this._crossFades.fastRemoveAt(t):Ue(3907)},i.update=function(e){var t=this._delayEvents,i=this._crossFades,n=this._sockets,r=i.array;for(i.i=0;i.i<r.length;++i.i)r[i.i].update(e);var a=this._anims,s=a.array;for(a.i=0;a.i<s.length;++a.i){var o=s[a.i];o.isMotionless||o.update(e)}this._blendStateBuffer.apply();for(var u=me.director.getTotalFrames(),c=0,l=n.length;c<l;c++){var h=n[c],f=h.target,d=h.transform;f.matrix=_n(d,u)}for(var p=0,_=t.length;p<_;p++){var m=t[p];m.fn.apply(m.thisArg,m.args)}t.length=0},i.destruct=function(){},i.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},i.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):Ue(3907)},i.pushDelayEvent=function(e,t,i){this._delayEvents.push({fn:e,thisArg:t,args:i})},i.addSockets=function(e,t){for(var i=this,n=function(n){var r=t[n];if(i._sockets.find((function(e){return e.target===r.target})))return"continue";var a=e.getChildByPath(r.path),s=r.target&&a&&gn(a,e);s&&i._sockets.push({target:r.target,transform:s})},r=0;r<t.length;++r)n(r)},i.removeSockets=function(e,t){for(var i=0;i<t.length;++i)for(var n=t[i],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===n.target){mn(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},ke(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(An),Xl.ID="animation",Yl=Ql))||Yl);Ln.on(Fn.EVENT_INIT,(function(){var e=new ih;Ln.registerSystem(ih.ID,e,An.Priority.HIGH)})),me.AnimationManager=ih,me.easing=Xi;var nh=e("H",pi("cc.HierachyModifier")(Kl=function(e){function t(){return e.apply(this,arguments)||this}return Le(t,e),t}(vn))||Kl);me.HierachyModifier=nh;var rh=e("n",pi("cc.ComponentModifier")($l=function(e){function t(){return e.apply(this,arguments)||this}return Le(t,e),t}(yn))||$l);me.ComponentModifier=rh;var ah=e("o",pi("cc.CurveValueAdapter")(eh=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||eh);me.CurveValueAdapter=ah;var sh=e("p",pi("cc.UniformCurveValueAdapter")(th=function(e){function t(){return e.apply(this,arguments)||this}return Le(t,e),t}(Zs))||th);function oh(e){return"string"==typeof e}function uh(e){return"number"==typeof e}function ch(e,t){return e instanceof t}me.UniformCurveValueAdapter=sh,me.isPropertyModifier=oh,me.isElementModifier=uh,me.isCustomTargetModifier=ch,me.math=bn,me.geometry=wn}}}));

System.register(["./json-asset-7bb011fd.js","./index-07e0e256.js","./spot-light-44c8b89f.js","./deprecated-229f0693.js","./renderable-component-0ffd84e0.js","./transform-utils-ec8404a7.js","./mesh-12590811.js","./skeleton-5498f045.js","./index-809e7472.js","./collision-matrix-c53e6e00.js","./capsule-c827c0f3.js","./terrain-asset-0aafabc0.js","split:/physx.release.asm.js","./tuple-dictionary-5e20c301.js"],(function(){"use strict";var t,e,i,s,n,o,r,a,c,l,h,d,u,p,_,y,E,f,m,S,g,T,C,A,v,R,I,O;return{setters:[function(p){t=p.c4,e=p.c8,i=p.l,s=p.ed,n=p.hf,o=p.fU,r=p.ej,a=p.ew,c=p.e,l=p.ey,h=p.cC,d=p.cD,u=p.b7},function(){},function(){},function(t){p=t.g,_=t.G},function(){},function(){},function(){},function(){},function(t){y=t.n,E=t.P,f=t.V,m=t.o,S=t.q,g=t.l,T=t.m},function(t){C=t.a,A=t.P,v=t.E},function(t){R=t.c},function(){},function(t){I=t.default},function(t){O=t.T}],execute:function(){var P,M,B,L,D,F,N=function(){};N.foundation=void 0,N.physics=void 0,N.cooking=void 0,N.pvd=void 0,N.queryfilterData=void 0,N.singleResult=void 0,N.mutipleResults=void 0,N.simulationCB=void 0,N.queryFilterCB=void 0,N.mutipleResultSize=12,function(t){t[t.QUERY_FILTER=1]="QUERY_FILTER",t[t.QUERY_CHECK_TRIGGER=2]="QUERY_CHECK_TRIGGER",t[t.QUERY_SINGLE_HIT=4]="QUERY_SINGLE_HIT",t[t.DETECT_TRIGGER_EVENT=8]="DETECT_TRIGGER_EVENT",t[t.DETECT_CONTACT_EVENT=16]="DETECT_CONTACT_EVENT",t[t.DETECT_CONTACT_POINT=32]="DETECT_CONTACT_POINT",t[t.DETECT_CONTACT_CCD=64]="DETECT_CONTACT_CCD"}(P||(P={})),function(t){t[t.ePOSITION=1]="ePOSITION",t[t.eNORMAL=2]="eNORMAL",t[t.eUV=8]="eUV",t[t.eASSUME_NO_INITIAL_OVERLAP=16]="eASSUME_NO_INITIAL_OVERLAP",t[t.eMESH_MULTIPLE=32]="eMESH_MULTIPLE",t[t.eMESH_ANY=64]="eMESH_ANY",t[t.eMESH_BOTH_SIDES=128]="eMESH_BOTH_SIDES",t[t.ePRECISE_SWEEP=256]="ePRECISE_SWEEP",t[t.eMTD=512]="eMTD",t[t.eFACE_INDEX=1024]="eFACE_INDEX",t[t.eDEFAULT=t.ePOSITION|t.eNORMAL|t.eFACE_INDEX]="eDEFAULT",t[t.eMODIFIABLE_FLAGS=t.eMESH_MULTIPLE|t.eMESH_BOTH_SIDES|t.eASSUME_NO_INITIAL_OVERLAP|t.ePRECISE_SWEEP]="eMODIFIABLE_FLAGS"}(M||(M={})),function(t){t[t.eSTATIC=1]="eSTATIC",t[t.eDYNAMIC=2]="eDYNAMIC",t[t.ePREFILTER=4]="ePREFILTER",t[t.ePOSTFILTER=8]="ePOSTFILTER",t[t.eANY_HIT=16]="eANY_HIT",t[t.eNO_BLOCK=32]="eNO_BLOCK",t[t.eRESERVED=32768]="eRESERVED"}(B||(B={})),function(t){t[t.eSOLVE_CONTACT=1]="eSOLVE_CONTACT",t[t.eMODIFY_CONTACTS=2]="eMODIFY_CONTACTS",t[t.eNOTIFY_TOUCH_FOUND=4]="eNOTIFY_TOUCH_FOUND",t[t.eNOTIFY_TOUCH_PERSISTS=8]="eNOTIFY_TOUCH_PERSISTS",t[t.eNOTIFY_TOUCH_LOST=16]="eNOTIFY_TOUCH_LOST",t[t.eNOTIFY_TOUCH_CCD=32]="eNOTIFY_TOUCH_CCD",t[t.eNOTIFY_THRESHOLD_FORCE_FOUND=64]="eNOTIFY_THRESHOLD_FORCE_FOUND",t[t.eNOTIFY_THRESHOLD_FORCE_PERSISTS=128]="eNOTIFY_THRESHOLD_FORCE_PERSISTS",t[t.eNOTIFY_THRESHOLD_FORCE_LOST=256]="eNOTIFY_THRESHOLD_FORCE_LOST",t[t.eNOTIFY_CONTACT_POINTS=512]="eNOTIFY_CONTACT_POINTS",t[t.eDETECT_DISCRETE_CONTACT=1024]="eDETECT_DISCRETE_CONTACT",t[t.eDETECT_CCD_CONTACT=2048]="eDETECT_CCD_CONTACT",t[t.ePRE_SOLVER_VELOCITY=4096]="ePRE_SOLVER_VELOCITY",t[t.ePOST_SOLVER_VELOCITY=8192]="ePOST_SOLVER_VELOCITY",t[t.eCONTACT_EVENT_POSE=16384]="eCONTACT_EVENT_POSE",t[t.eNEXT_FREE=32768]="eNEXT_FREE",t[t.eCONTACT_DEFAULT=1025]="eCONTACT_DEFAULT",t[t.eTRIGGER_DEFAULT=1044]="eTRIGGER_DEFAULT"}(L||(L={})),function(t){t[t.eREMOVED_SHAPE_0=1]="eREMOVED_SHAPE_0",t[t.eREMOVED_SHAPE_1=2]="eREMOVED_SHAPE_1",t[t.eACTOR_PAIR_HAS_FIRST_TOUCH=4]="eACTOR_PAIR_HAS_FIRST_TOUCH",t[t.eACTOR_PAIR_LOST_TOUCH=8]="eACTOR_PAIR_LOST_TOUCH",t[t.eINTERNAL_HAS_IMPULSES=16]="eINTERNAL_HAS_IMPULSES",t[t.eINTERNAL_CONTACTS_ARE_FLIPPED=32]="eINTERNAL_CONTACTS_ARE_FLIPPED"}(D||(D={})),function(t){t[t.eREMOVED_SHAPE_TRIGGER=1]="eREMOVED_SHAPE_TRIGGER",t[t.eREMOVED_SHAPE_OTHER=2]="eREMOVED_SHAPE_OTHER",t[t.eNEXT_FREE=4]="eNEXT_FREE"}(F||(F={}));var w={},G=i._global,H=!!G.PHYSX;p.once(_.EVENT_ENGINE_INITED,(function(){console.info("[PHYSICS]:","Use PhysX js or wasm Libs."),G.PhysX=G.PHYSX?G.PHYSX:I,null!=G.PhysX?G.PhysX().then((function(t){var e;console.info("[PHYSICS]:",(H?"External":"Internal")+" PhysX libs loaded."),(e=t).VECTOR_MAT=new e.PxMaterialVector,e.MeshScale=e.PxMeshScale,e.ShapeFlag=e.PxShapeFlag,e.ActorFlag=e.PxActorFlag,e.ForceMode=e.PxForceMode,e.CombineMode=e.PxCombineMode,e.BoxGeometry=e.PxBoxGeometry,e.QueryHitType=e.PxQueryHitType,e.RigidBodyFlag=e.PxRigidBodyFlag,e.PlaneGeometry=e.PxPlaneGeometry,e.SphereGeometry=e.PxSphereGeometry,e.CapsuleGeometry=e.PxCapsuleGeometry,e.ConvexMeshGeometry=e.PxConvexMeshGeometry,e.TriangleMeshGeometry=e.PxTriangleMeshGeometry,e.RigidDynamicLockFlag=e.PxRigidDynamicLockFlag,e.createRevoluteJoint=function(t,i,s,n){return e.PxRevoluteJointCreate(w.physics,t,i,s,n)},e.createDistanceJoint=function(t,i,s,n){return e.PxDistanceJointCreate(w.physics,t,i,s,n)},function(t){G.PhysX=t,t.EPSILON=.001,t.MULTI_THREAD=!1,t.SUB_THREAD_COUNT=1,t.CACHE_MAT={},t.IMPL_PTR={},t.MESH_CONVEX={},t.MESH_STATIC={},t.TERRAIN_STATIC={}}(t),Object.assign(w,t)}),(function(t){console.error("[PHYSICS]:","PhysX load failed: "+t)})):console.error("[PHYSICS]:","Not Found PhysX js or wasm Libs.")}));var x={x:0,y:0,z:0},k={x:0,y:0,z:0,w:1},Y={translation:x,rotation:k,p:x,q:k},b=Y;function U(t){return w.IMPL_PTR[t.$$.ptr]}function V(i,s){return t.copy(b.translation,i),e.copy(b.rotation,s),b}function K(i,s){return t.copy(Y.p,i),e.copy(Y.q,s),Y}function X(t,e){t.addActor(e,null)}function $(t,e,i){t.setActors(e,i)}function Q(t,e){t.setMassAndUpdateInertia(e)}function W(e,i){var s=e.translation;return t.equals(s,i,w.EPSILON)}function J(t,i){var s=t.rotation;return e.equals(s,i,w.EPSILON)}function z(t,e,i,s){t?e.applyImpulse(i,s):e.applyLocalImpulse(i,s)}function q(t,e,i,s){t?e.applyForce(i,s):e.applyLocalForce(i,s)}function j(t,e){t.addTorque(e)}function Z(t,e,i){for(var s=y(t),n=s.length,o=new w.PxVec3Vector,r=0;r<n;r+=3)o.push_back({x:s[r],y:s[r+1],z:s[r+2]});var a=e.createConvexMesh(o,i);return o.delete(),a}function tt(t,e){return e?new w.PxConvexMeshGeometryFlags(t):new w.PxMeshGeometryFlags(t)}function et(e,i){t.copy(i,e.position)}function it(e,i){t.copy(i,e.normal)}function st(t,e){var i=w.getGContacts(),s=i.get(t+e);return i.delete(),s}var nt=function(){function i(t,e){this.id=void 0,this.node=void 0,this.wrappedWorld=void 0,this.wrappedShapes=[],this.wrappedJoints0=[],this.wrappedJoints1=[],this._index=-1,this._ref=0,this._isStatic=!1,this._isKinematic=!1,this._wrappedBody=null,this._filterData=void 0,this.id=i.idCounter++,this.node=t,this.wrappedWorld=e,this._filterData={word0:1,word1:1,word2:0,word3:0}}i.getSharedBody=function(t,e,s){var n,o=t.uuid;if(i.sharedBodesMap.has(o)?n=i.sharedBodesMap.get(o):((n=new i(t,e)).filterData.word0=A.DEFAULT,n.filterData.word1=E.instance.collisionMatrix[A.DEFAULT],i.sharedBodesMap.set(t.uuid,n)),s){n._wrappedBody=s;var r=s.rigidBody.group,a=E.instance.collisionMatrix[r];n.filterData.word0=r,n.filterData.word1=a}return n};var s=i.prototype;return s._initActor=function(){var t=this._isStatic,e=this.wrappedBody;e?e.rigidBody.type===C.STATIC?(this._isStatic=!0,this._isKinematic=!1,this._initStaticActor()):(this._isStatic=!1,this._initDynamicActor()):(this._isStatic=!0,this._isKinematic=!1,this._initStaticActor()),t!==this._isStatic&&this._switchActor(t)},s._initStaticActor=function(){if(!this._staticActor){var t=V(this.node.worldPosition,this.node.worldRotation);this._staticActor=N.physics.createRigidStatic(t),this._staticActor.$$&&(w.IMPL_PTR[this._staticActor.$$.ptr]=this)}},s._initDynamicActor=function(){if(!this._dynamicActor){var t=V(this.node.worldPosition,this.node.worldRotation);this._dynamicActor=N.physics.createRigidDynamic(t),this._dynamicActor.$$&&(w.IMPL_PTR[this._dynamicActor.$$.ptr]=this);var e=this.wrappedBody;if(e){var i=e.rigidBody;this._dynamicActor.setMass(i.mass),this._dynamicActor.setActorFlag(w.ActorFlag.eDISABLE_GRAVITY,!i.useGravity),this.setLinearDamping(i.linearDamping),this.setAngularDamping(i.angularDamping),this.setRigidBodyFlag(w.RigidBodyFlag.eKINEMATIC,i.isKinematic);var s=i.linearFactor;this._dynamicActor.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_LINEAR_X,!s.x),this._dynamicActor.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_LINEAR_Y,!s.y),this._dynamicActor.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_LINEAR_Z,!s.z);var n=i.angularFactor;this._dynamicActor.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_ANGULAR_X,!n.x),this._dynamicActor.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_ANGULAR_Y,!n.y),this._dynamicActor.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_ANGULAR_Z,!n.z)}}},s._switchActor=function(t){if(this._staticActor&&this._dynamicActor){var i=t?this._staticActor:this._dynamicActor,s=t?this._dynamicActor:this._staticActor;this._index>=0&&(this.wrappedWorld.scene.removeActor(i,!1),X(this.wrappedWorld.scene,s));for(var n=0;n<this.wrappedShapes.length;n++){var o=this.wrappedShapes[n];i.detachShape(o.impl,!1),s.attachShape(o.impl)}if(t){var r=this._dynamicActor;Q(r,this._wrappedBody.rigidBody.mass);var a=f;a.set(0,0,0);for(var c=0;c<this.wrappedShapes.length;c++){var l=this.wrappedShapes[c].collider;l.isTrigger||a.subtract(l.center)}r.setCMassLocalPose(V(a,e.IDENTITY))}}},s.addShape=function(e){this.wrappedShapes.indexOf(e)<0&&(e.setIndex(this.wrappedShapes.length),e.updateFilterData(this._filterData),this.impl.attachShape(e.impl),this.wrappedShapes.push(e),e.collider.isTrigger||(t.strictEquals(e.collider.center,t.ZERO)||this.updateCenterOfMass(),this.isDynamic&&Q(this.impl,this._wrappedBody.rigidBody.mass)))},s.removeShape=function(e){var i=this.wrappedShapes.indexOf(e);i>=0&&(e.setIndex(-1),this.impl.detachShape(e.impl,!0),n(this.wrappedShapes,i),e.collider.isTrigger||(t.strictEquals(e.collider.center,t.ZERO)||this.updateCenterOfMass(),this.isDynamic&&Q(this.impl,this._wrappedBody.rigidBody.mass)))},s.addJoint=function(t,e){e?this.wrappedJoints1.indexOf(t)<0&&this.wrappedJoints1.push(t):this.wrappedJoints0.indexOf(t)<0&&this.wrappedJoints0.push(t)},s.removeJoint=function(t,e){if(e){var i=this.wrappedJoints1.indexOf(t);i>=0&&n(this.wrappedJoints1,i)}else{var s=this.wrappedJoints0.indexOf(t);s>=0&&n(this.wrappedJoints0,s)}},s.setLinearDamping=function(t){if(this._dynamicActor){var e=E.instance.fixedTimeStep;this._dynamicActor.setLinearDamping((1-Math.pow(1-t,e))/e)}},s.setAngularDamping=function(t){if(this._dynamicActor){var e=E.instance.fixedTimeStep;this._dynamicActor.setAngularDamping((1-Math.pow(1-t,e))/e)}},s.setMass=function(t){t<=0||this.isDynamic&&Q(this.impl,t)},s.setType=function(t){if(this._initActor(),!this.isStatic)switch(t){case C.DYNAMIC:this.setRigidBodyFlag(w.RigidBodyFlag.eKINEMATIC,!1);break;case C.KINEMATIC:default:this.setRigidBodyFlag(w.RigidBodyFlag.eKINEMATIC,!0)}},s.setRigidBodyFlag=function(t,e){t===w.RigidBodyFlag.eKINEMATIC&&(this._isKinematic=e),this.impl.setRigidBodyFlag(t,e)},s.syncSceneToPhysics=function(){var t=this.node;if(t.hasChangedFlags)if(t.hasChangedFlags&o.SCALE&&this.syncScale(),this._isKinematic){var e=V(t.worldPosition,t.worldRotation);this.impl.setKinematicTarget(e)}else{var i=K(t.worldPosition,t.worldRotation);this.impl.setGlobalPose(i,!0)}},s.syncSceneWithCheck=function(){var t=this.node;if(t.hasChangedFlags){t.hasChangedFlags&o.SCALE&&this.syncScale();var e=t.worldPosition,i=t.worldRotation,s=this.impl.getGlobalPose();if(!W(s,e)||!J(s,i))if(this._isKinematic){var n=V(t.worldPosition,t.worldRotation);this.impl.setKinematicTarget(n)}else{var r=K(t.worldPosition,t.worldRotation);this.impl.setGlobalPose(r,!0)}}},s.syncPhysicsToScene=function(){var t,e;this.isDynamic&&(t=this._dynamicActor,e=this.node,t.isSleeping()||function(t,e){var i=t.worldPosition,s=t.worldRotation;W(e,i)&&J(e,s)||(t.setWorldPosition(e.translation),t.setWorldRotation(e.rotation))}(e,t.getGlobalPose()))},s.syncScale=function(){for(var t=0;t<this.wrappedShapes.length;t++)this.wrappedShapes[t].updateScale();for(var e=0;e<this.wrappedJoints0.length;e++)this.wrappedJoints0[e].updateScale0();for(var i=0;i<this.wrappedJoints1.length;i++)this.wrappedJoints1[i].updateScale1()},s.setGroup=function(t){this._filterData.word0=t,this.updateFilterData()},s.getGroup=function(){return this._filterData.word0},s.addGroup=function(t){this._filterData.word0|=t,this.updateFilterData()},s.removeGroup=function(t){this._filterData.word0&=~t,this.updateFilterData()},s.setMask=function(t){-1===t&&(t=4294967295),this._filterData.word1=t,this.updateFilterData()},s.getMask=function(){return this._filterData.word1},s.addMask=function(t){this._filterData.word1|=t,this.updateFilterData()},s.removeMask=function(t){this._filterData.word1&=~t,this.updateFilterData()},s.updateFilterData=function(){for(var t=0;t<this.wrappedShapes.length;t++)this.wrappedShapes[t].updateFilterData(this._filterData)},s.updateCenterOfMass=function(){if(this._initActor(),!this._isStatic){var t=f;t.set(0,0,0);for(var i=0;i<this.wrappedShapes.length;i++){var s=this.wrappedShapes[i].collider;s.isTrigger||t.subtract(s.center)}this.impl.setCMassLocalPose(V(t,e.IDENTITY))}},s.clearForces=function(){this._isStatic||this._isKinematic||(this.impl.clearForce(w.ForceMode.eFORCE),this.impl.clearForce(w.ForceMode.eIMPULSE),this.impl.clearTorque(w.ForceMode.eFORCE),this.impl.clearTorque(w.ForceMode.eIMPULSE))},s.clearVelocity=function(){this._isStatic||this._isKinematic||(this.impl.setLinearVelocity(t.ZERO,!1),this.impl.setAngularVelocity(t.ZERO,!1))},s.destroy=function(){this._dynamicActor&&(this._dynamicActor.$$&&(w.IMPL_PTR[this._dynamicActor.$$.ptr]=null,delete w.IMPL_PTR[this._dynamicActor.$$.ptr]),this._dynamicActor.release(),this._dynamicActor=null),this._staticActor&&(this._staticActor.$$&&(w.IMPL_PTR[this._staticActor.$$.ptr]=null,delete w.IMPL_PTR[this._staticActor.$$.ptr]),this._staticActor.release(),this._staticActor=null),i.sharedBodesMap.delete(this.node.uuid)},r(i,[{key:"isStatic",get:function(){return this._isStatic}},{key:"isKinematic",get:function(){return this._isKinematic}},{key:"isDynamic",get:function(){return!this._isStatic&&!this._isKinematic}},{key:"wrappedBody",get:function(){return this._wrappedBody}},{key:"filterData",get:function(){return this._filterData}},{key:"isInScene",get:function(){return-1!==this._index}},{key:"impl",get:function(){return this._initActor(),this.isStatic?this._staticActor:this._dynamicActor}},{key:"reference",set:function(t){this._ref=t?this._ref+1:this._ref-1,0===this._ref&&this.destroy()}},{key:"enabled",set:function(t){if(t)this._index<0&&(this._index=this.wrappedWorld.wrappedBodies.length,this.wrappedWorld.addActor(this));else if(this._index>=0){var e=this.wrappedShapes,i=this.wrappedBody;(0===e.length&&null==i||0===e.length&&null!=i&&!i.isEnabled)&&(this._index=-1,this.clearForces(),this.clearVelocity(),this.wrappedWorld.removeActor(this))}}}]),i}();nt.idCounter=0,nt.sharedBodesMap=new Map;var ot,rt=new e,at=function(){function i(t){this.impl=null,this.event=void 0,this.event=t}var s=i.prototype;return s.getLocalPointOnA=function(e){et(this.impl,e,this.event.impl),t.subtract(e,e,this.colliderA.node.worldPosition)},s.getLocalPointOnB=function(e){et(this.impl,e,this.event.impl),t.subtract(e,e,this.colliderB.node.worldPosition)},s.getWorldPointOnA=function(t){et(this.impl,t,this.event.impl)},s.getWorldPointOnB=function(t){et(this.impl,t,this.event.impl)},s.getLocalNormalOnA=function(i){this.getWorldNormalOnA(i),e.conjugate(rt,this.colliderA.node.worldRotation),t.transformQuat(i,i,rt)},s.getLocalNormalOnB=function(i){this.getWorldNormalOnB(i),e.conjugate(rt,this.colliderB.node.worldRotation),t.transformQuat(i,i,rt)},s.getWorldNormalOnA=function(e){it(this.impl,e,this.event.impl),this.isBodyA||t.negate(e,e)},s.getWorldNormalOnB=function(t){it(this.impl,t,this.event.impl)},r(i,[{key:"isBodyA",get:function(){return this.colliderA.uuid===this.event.selfCollider.uuid}}]),i}(),ct=function(t){a(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this)||this).scene=void 0,e.callback=yt,e.wrappedBodies=[],e._isNeedFetch=!1,function(t){if(!N.foundation){var e=w.PX_PHYSICS_VERSION,i=new w.PxDefaultAllocator,s=new w.PxDefaultErrorCallback,n=N.foundation=w.PxCreateFoundation(e,i,s);N.pvd=null;var o=new w.PxTolerancesScale;N.physics=w.physics=w.PxCreatePhysics(e,n,o,!1,N.pvd),N.cooking=w.PxCreateCooking(e,n,new w.PxCookingParams(o)),w.PxInitExtensions(N.physics,N.pvd),N.singleResult=new w.PxRaycastHit,(N.mutipleResults=new w.PxRaycastHitVector).resize(N.mutipleResultSize,N.singleResult),N.queryfilterData=new w.PxQueryFilterData,N.simulationCB=w.PxSimulationEventCallback.implement(t.callback.eventCallback),N.queryFilterCB=w.PxQueryFilterCallback.implement(t.callback.queryCallback)}var r=w.getDefaultSceneDesc(N.physics.getTolerancesScale(),0,N.simulationCB);t.scene=N.physics.createScene(r)}(l(e)),e}return e.setAllowSleep=function(){},e.setDefaultMaterial=function(){},e.setGravity=function(t){this.scene.setGravity(t)},e.destroy=function(){this.wrappedBodies.length&&c("You should destroy all physics component first."),this.scene.release()},e.step=function(t){if(this._simulate(t),!w.MULTI_THREAD){this._fetchResults();for(var e=0;e<this.wrappedBodies.length;e++)this.wrappedBodies[e].syncPhysicsToScene()}},e._simulate=function(t){var e;this._isNeedFetch||(e=t,this.scene.simulate(e,!0),this._isNeedFetch=!0)},e._fetchResults=function(){this._isNeedFetch&&(this.scene.fetchResults(!0),this._isNeedFetch=!1)},e.syncSceneToPhysics=function(){for(var t=0;t<this.wrappedBodies.length;t++)this.wrappedBodies[t].syncSceneToPhysics()},e.syncPhysicsToScene=function(){this._fetchResults();for(var t=0;t<this.wrappedBodies.length;t++)this.wrappedBodies[t].syncPhysicsToScene()},e.syncAfterEvents=function(){for(var t=0;t<this.wrappedBodies.length;t++)this.wrappedBodies[t].syncSceneWithCheck()},e.getSharedBody=function(t,e){return nt.getSharedBody(t,this,e)},e.addActor=function(t){this.wrappedBodies.indexOf(t)<0&&(X(this.scene,t.impl),this.wrappedBodies.push(t))},e.removeActor=function(t){var e=this.wrappedBodies.indexOf(t);e>=0&&(this.scene.removeActor(t.impl,!0),n(this.wrappedBodies,e))},e.addConstraint=function(){},e.removeConstraint=function(){},e.raycast=function(t,e,i,s){return function(t,e,i,s,n){var o=i.maxDistance,r=M.ePOSITION|M.eNORMAL,a=P.QUERY_FILTER|(i.queryTrigger?0:P.QUERY_CHECK_TRIGGER),c=B.eSTATIC|B.eDYNAMIC|B.ePREFILTER|B.eNO_BLOCK,l=N.queryfilterData,h=N.queryFilterCB,d=N.mutipleResults;l.setWords(i.mask>>>0,0),l.setWords(a,3),l.setFlags(c);var u=d,p=t.scene.raycastMultiple(e.o,e.d,o,r,u,u.size(),l,h,null);if(p>0){for(var _=0;_<p;_++){var y=u.get(_),E=U(y.getShape()).collider,f=s.add();f._assign(y.position,y.distance,E,y.normal),n.push(f)}return!0}return-1===p&&console.error("not enough memory."),!1}(this,t,e,i,s)},e.raycastClosest=function(t,e,i){return function(t,e,i,s){i.maxDistance;var n=M.ePOSITION|M.eNORMAL,o=P.QUERY_FILTER|(i.queryTrigger?0:P.QUERY_CHECK_TRIGGER)|P.QUERY_SINGLE_HIT,r=B.eSTATIC|B.eDYNAMIC|B.ePREFILTER,a=N.queryfilterData,c=N.queryFilterCB;a.setWords(i.mask>>>0,0),a.setWords(o,3),a.setFlags(r);var l=N.singleResult;if(t.scene.raycastSingle(e.o,e.d,i.maxDistance,n,l,a,c,null)){var h=U(l.getShape()).collider;return s._assign(l.position,l.distance,h,l.normal),!0}return!1}(this,t,e,i)},e.emitEvents=function(){yt.emitTriggerEvent(),yt.emitCollisionEvent()},r(i,[{key:"impl",get:function(){return this.scene}}]),i}(N),lt=new O,ht=new O,dt=[],ut=new O,pt=[],_t=[],yt={eventCallback:{onContactBegin:function(t,e,i,s,n){var o=U(t),r=U(e);yt.onCollision("onCollisionEnter",o,r,i,s,n)},onContactEnd:function(t,e,i,s,n){var o=U(t),r=U(e);yt.onCollision("onCollisionExit",o,r,i,s,n)},onContactPersist:function(t,e,i,s,n){var o=U(t),r=U(e);yt.onCollision("onCollisionStay",o,r,i,s,n)},onTriggerBegin:function(t,e){var i=U(t),s=U(e);yt.onTrigger("onTriggerEnter",i,s,!0)},onTriggerEnd:function(t,e){var i=U(t),s=U(e);yt.onTrigger("onTriggerExit",i,s,!1)}},queryCallback:{preFilter:function(t,e){var i=t.word3,s=e.getFlags();return i&P.QUERY_CHECK_TRIGGER&&s.isSet(w.ShapeFlag.eTRIGGER_SHAPE)?w.QueryHitType.eNONE:i&P.QUERY_SINGLE_HIT?w.QueryHitType.eBLOCK:w.QueryHitType.eTOUCH},preFilterForByteDance:function(t,e){var i=t.word3;return i&P.QUERY_CHECK_TRIGGER&&e&w.ShapeFlag.eTRIGGER_SHAPE?w.QueryHitType.eNONE:i&P.QUERY_SINGLE_HIT?w.QueryHitType.eBLOCK:w.QueryHitType.eTOUCH}},onTrigger:function(t,e,i,s){var n;e&&i&&(e.collider.needTriggerEvent||i.collider.needTriggerEvent)&&(dt.length>0?((n=dt.pop()).a=e,n.b=i,n.times=0):n={a:e,b:i,times:0},s?lt.set(e.id,i.id,n):ht.set(e.id,i.id,n))},emitTriggerEvent:function(){for(var t=ht.getLength();t--;){var e=ht.getKeyByIndex(t),i=ht.getDataByKey(e);dt.push(i);var s=lt.getDataByKey(e);s&&(dt.push(s),lt.set(i.a.id,i.b.id,null));var n=i.a.collider,o=i.b.collider;if(n&&o){var r="onTriggerExit";m.type=r,n.needTriggerEvent&&(m.selfCollider=n,m.otherCollider=o,n.emit(r,m)),o.needTriggerEvent&&(m.selfCollider=o,m.otherCollider=n,o.emit(r,m))}}for(ht.reset(),t=lt.getLength();t--;){var a=lt.getKeyByIndex(t),c=lt.getDataByKey(a),l=c.a.collider,h=c.b.collider;if(l&&l.isValid&&h&&h.isValid){var d=c.times++?"onTriggerStay":"onTriggerEnter";m.type=d,l.needTriggerEvent&&(m.selfCollider=l,m.otherCollider=h,l.emit(d,m)),h.needTriggerEvent&&(m.selfCollider=h,m.otherCollider=l,h.emit(d,m))}else dt.push(c),lt.set(c.a.id,c.b.id,null)}},onCollision:function(t,e,i,s,n,o){if(e&&i&&(e.collider.needCollisionEvent||i.collider.needCollisionEvent))if(pt.length>0){var r=pt.pop();r.type=t,r.a=e,r.b=i,r.contactCount=s,r.buffer=n,r.offset=o,ut.set(e.id,i.id,r)}else{var a={type:t,a:e,b:i,contactCount:s,buffer:n,offset:o};ut.set(e.id,i.id,a)}},emitCollisionEvent:function(){for(var t=ut.getLength();t--;){var e=ut.getKeyByIndex(t),i=ut.getDataByKey(e);pt.push(i);var s=i.a.collider,n=i.b.collider;if(s&&s.isValid&&n&&n.isValid){S.type=i.type,S.impl=i.buffer;var o=i.contactCount,r=(i.buffer,i.offset),a=S.contacts;_t.push.apply(_t,a),a.length=0;for(var c=0;c<o;c++)if(_t.length>0){var l=_t.pop();l.colliderA=s,l.colliderB=n,l.impl=st(c,r),a.push(l)}else{var h=new at(S);h.colliderA=s,h.colliderB=n,h.impl=st(c,r),a.push(h)}s.needCollisionEvent&&(S.selfCollider=s,S.otherCollider=n,s.emit(S.type,S)),n.needCollisionEvent&&(S.selfCollider=n,S.otherCollider=s,n.emit(S.type,S))}}ut.reset()}},Et=new t,ft=function(){function e(){this.isSleepy=!1,this._isEnabled=!1,this._isUsingCCD=!1}var i=e.prototype;return i.initialize=function(t){this._rigidBody=t,this._sharedBody=E.instance.physicsWorld.getSharedBody(t.node,this),this._sharedBody.reference=!0},i.onEnable=function(){this._isEnabled=!0,this.setMass(this._rigidBody.mass),this.setType(this._rigidBody.type),this.setAllowSleep(this._rigidBody.allowSleep),this.setLinearDamping(this._rigidBody.linearDamping),this.setAngularDamping(this._rigidBody.angularDamping),this.setLinearFactor(this._rigidBody.linearFactor),this.setAngularFactor(this._rigidBody.angularFactor),this.useGravity(this._rigidBody.useGravity),this._sharedBody.enabled=!0},i.onDisable=function(){this._isEnabled=!1,this._sharedBody.enabled=!1},i.onDestroy=function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null},i.setType=function(t){this._sharedBody.setType(t)},i.setMass=function(t){this.isStatic||this._sharedBody.setMass(t)},i.setLinearDamping=function(t){this._sharedBody.setLinearDamping(t)},i.setAngularDamping=function(t){this._sharedBody.setAngularDamping(t)},i.useGravity=function(t){this.isStatic||this.impl.setActorFlag(w.ActorFlag.eDISABLE_GRAVITY,!t)},i.useCCD=function(t){this.isStatic||(this.impl.setRigidBodyFlag(w.RigidBodyFlag.eENABLE_CCD,t),this._isUsingCCD=t)},i.isUsingCCD=function(){return this._isUsingCCD},i.setLinearFactor=function(t){this.isStatic||(this.impl.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_LINEAR_X,!t.x),this.impl.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_LINEAR_Y,!t.y),this.impl.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_LINEAR_Z,!t.z))},i.setAngularFactor=function(t){this.isStatic||(this.impl.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_ANGULAR_X,!t.x),this.impl.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_ANGULAR_Y,!t.y),this.impl.setRigidDynamicLockFlag(w.RigidDynamicLockFlag.eLOCK_ANGULAR_Z,!t.z))},i.setAllowSleep=function(t){if(!this.isStaticOrKinematic){var e=this.impl.getSleepThreshold(),i=t?Math.max(0,e-.001):e+4294967295;this.impl.setWakeCounter(i)}},i.wakeUp=function(){this.isInScene&&!this.isStatic&&this.impl.wakeUp()},i.sleep=function(){this.isInScene&&!this.isStatic&&this.impl.putToSleep()},i.clearState=function(){this.isInScene&&!this.isStatic&&(this.clearForces(),this.clearVelocity())},i.clearForces=function(){this.isInScene&&!this.isStatic&&this._sharedBody.clearForces()},i.clearVelocity=function(){this.isStatic||this._sharedBody.clearVelocity()},i.setSleepThreshold=function(t){this.isStatic||this.impl.setSleepThreshold(t)},i.getSleepThreshold=function(){return this.isStatic?0:this.impl.getSleepThreshold()},i.getLinearVelocity=function(e){this.isStatic||t.copy(e,this.impl.getLinearVelocity())},i.setLinearVelocity=function(t){this.isStaticOrKinematic||this.impl.setLinearVelocity(t,!0)},i.getAngularVelocity=function(e){this.isStatic||t.copy(e,this.impl.getAngularVelocity())},i.setAngularVelocity=function(t){this.isStaticOrKinematic||this.impl.setAngularVelocity(t,!0)},i.applyForce=function(e,i){if(this.isInScene&&!this.isStaticOrKinematic){this._sharedBody.syncSceneToPhysics();var s=i||t.ZERO;q(!0,this.impl,e,s)}},i.applyLocalForce=function(e,i){if(this.isInScene&&!this.isStaticOrKinematic){this._sharedBody.syncSceneToPhysics();var s=i||t.ZERO;q(!1,this.impl,e,s)}},i.applyImpulse=function(e,i){if(this.isInScene&&!this.isStaticOrKinematic){this._sharedBody.syncSceneToPhysics();var s=i||t.ZERO;z(!0,this.impl,e,s)}},i.applyLocalImpulse=function(e,i){if(this.isInScene&&!this.isStaticOrKinematic){this._sharedBody.syncSceneToPhysics();var s=i||t.ZERO;z(!1,this.impl,e,s)}},i.applyTorque=function(t){this.isInScene&&!this.isStaticOrKinematic&&j(this.impl,t)},i.applyLocalTorque=function(e){this.isInScene&&!this.isStaticOrKinematic&&(this._sharedBody.syncSceneToPhysics(),t.transformQuat(Et,e,this._sharedBody.node.worldRotation),j(this.impl,Et))},i.setGroup=function(t){this._sharedBody.setGroup(t)},i.getGroup=function(){return this._sharedBody.getGroup()},i.addGroup=function(t){this._sharedBody.addGroup(t)},i.removeGroup=function(t){this._sharedBody.removeGroup(t)},i.setMask=function(t){this._sharedBody.setMask(t)},i.getMask=function(){return this._sharedBody.getMask()},i.addMask=function(t){this._sharedBody.addMask(t)},i.removeMask=function(t){this._sharedBody.removeMask(t)},r(e,[{key:"impl",get:function(){return this._sharedBody.impl}},{key:"isAwake",get:function(){return!(!this.isInScene||this.isStatic||this.impl.isSleeping())}},{key:"isSleeping",get:function(){return!(this.isInScene&&!this.isStatic)||this.impl.isSleeping()}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"isStatic",get:function(){return!this.impl||this._sharedBody.isStatic}},{key:"isStaticOrKinematic",get:function(){return!this.impl||this._sharedBody.isStatic||this._sharedBody.isKinematic}},{key:"isInScene",get:function(){return this._sharedBody.isInScene}}]),e}();!function(t){t[t.SPHERE=0]="SPHERE",t[t.BOX=1]="BOX",t[t.CAPSULE=2]="CAPSULE",t[t.CYLINDER=3]="CYLINDER",t[t.CONE=4]="CONE",t[t.PLANE=5]="PLANE",t[t.TERRAIN=6]="TERRAIN",t[t.MESH=7]="MESH"}(ot||(ot={}));var mt=function(){function i(t){this.id=void 0,this.type=void 0,this._impl=null,this._collider=null,this._flags=void 0,this._rotation=new e(0,0,0,1),this._index=-1,this._word3=0,this._isEnabled=!1,this.type=t,this.id=i.idCounter++}var n=i.prototype;return n.initialize=function(t){var e,i;this._collider=t,this._flags=(e=(t.isTrigger?w.PxShapeFlag.eTRIGGER_SHAPE.value:w.PxShapeFlag.eSIMULATION_SHAPE.value)|w.PxShapeFlag.eSCENE_QUERY_SHAPE.value,new w.PxShapeFlags(e)),this._sharedBody=E.instance.physicsWorld.getSharedBody(t.node),this._sharedBody.reference=!0,this.onComponentSet(),(i=this._impl)&&i.$$&&(w.IMPL_PTR[i.$$.ptr]=this)},n.setIndex=function(t){this._index=t},n.onComponentSet=function(){},n.updateScale=function(){},n.onLoad=function(){this.setMaterial(this._collider.sharedMaterial),this.setCenter(this._collider.center)},n.onEnable=function(){this.addToBody(),this._isEnabled=!0,this._sharedBody.enabled=!0},n.onDisable=function(){this.removeFromBody(),this._isEnabled=!1,this._sharedBody.enabled=!1},n.onDestroy=function(){var t;this._sharedBody.reference=!1,this._impl&&((t=this._impl)&&t.$$&&(w.IMPL_PTR[t.$$.ptr]=null,delete w.IMPL_PTR[t.$$.ptr]),this._impl.release(),this._impl=null),this._flags=null,this._collider=null},n.setMaterial=function(t){null==t&&(t=E.instance.defaultMaterial);var e,i=this.getSharedMaterial(t);this._impl.setMaterials((e=i,w.VECTOR_MAT.size()>0?w.VECTOR_MAT.set(0,e):w.VECTOR_MAT.push_back(e),w.VECTOR_MAT))},n.getSharedMaterial=function(t){if(!w.CACHE_MAT[t.id]){var e=N.physics.createMaterial(t.friction,t.friction,t.restitution);return e.setFrictionCombineMode(w.CombineMode.eMULTIPLY),e.setRestitutionCombineMode(w.CombineMode.eMULTIPLY),w.CACHE_MAT[t.id]=e,e}var i=w.CACHE_MAT[t.id];return i.setStaticFriction(t.friction),i.setDynamicFriction(t.friction),i.setRestitution(t.restitution),i},n.setAsTrigger=function(t){t?(this._impl.setFlag(w.ShapeFlag.eSIMULATION_SHAPE,!t),this._impl.setFlag(w.ShapeFlag.eTRIGGER_SHAPE,t)):(this._impl.setFlag(w.ShapeFlag.eTRIGGER_SHAPE,t),this._impl.setFlag(w.ShapeFlag.eSIMULATION_SHAPE,!t)),this._index>=0&&(this._sharedBody.removeShape(this),this._sharedBody.addShape(this))},n.setCenter=function(i){var s=Y.translation,n=Y.rotation;t.multiply(s,i,this._collider.node.worldScale),e.copy(n,this._rotation);var o=V(s,n);this._impl.setLocalPose(o),this._collider.enabled&&!this._collider.isTrigger&&this._sharedBody.updateCenterOfMass()},n.getAABB=function(t){!function(t,e,i,n){void 0===i&&(i=1.01);var o=t.getWorldBounds(e,i);s.fromPoints(n,o.minimum,o.maximum)}(this.impl,this._sharedBody.impl,1,t)},n.getBoundingSphere=function(t){s.toBoundingSphere(t,this._collider.worldBounds)},n.setGroup=function(t){this._sharedBody.setGroup(t)},n.getGroup=function(){return this._sharedBody.getGroup()},n.addGroup=function(t){this._sharedBody.addGroup(t)},n.removeGroup=function(t){this._sharedBody.removeGroup(t)},n.setMask=function(t){this._sharedBody.setMask(t)},n.getMask=function(){return this._sharedBody.getMask()},n.addMask=function(t){this._sharedBody.addMask(t)},n.removeMask=function(t){this._sharedBody.removeMask(t)},n.updateFilterData=function(t){this._word3=P.DETECT_CONTACT_CCD,this._collider.needTriggerEvent&&(this._word3|=P.DETECT_TRIGGER_EVENT),this._collider.needCollisionEvent&&(this._word3|=P.DETECT_CONTACT_EVENT|P.DETECT_CONTACT_POINT),t.word2=this.id,t.word3=this._word3,this.setFilerData(t)},n.updateEventListener=function(){this._sharedBody&&this.updateFilterData(this._sharedBody.filterData)},n.updateByReAdd=function(){this._isEnabled&&(this.removeFromBody(),this.addToBody())},n.setFilerData=function(t){this._impl.setQueryFilterData(t),this._impl.setSimulationFilterData(t)},n.addToBody=function(){this._sharedBody.addShape(this)},n.removeFromBody=function(){this._sharedBody.removeShape(this)},r(i,[{key:"impl",get:function(){return this._impl}},{key:"collider",get:function(){return this._collider}},{key:"attachedRigidBody",get:function(){return null}}],[{key:"MESH_SCALE",get:function(){return this._MESH_SCALE||(this._MESH_SCALE=new w.MeshScale(t.ZERO,e.IDENTITY)),this._MESH_SCALE}}]),i}();mt._MESH_SCALE=void 0,mt.idCounter=0;var St=function(t){function e(){var i;return i=t.call(this,ot.SPHERE)||this,e.SPHERE_GEOMETRY||(e.SPHERE_GEOMETRY=new w.SphereGeometry(.5)),i}a(e,t);var i=e.prototype;return i.updateRadius=function(){this.updateScale()},i.onComponentSet=function(){this.updateGeometry();var t=this.getSharedMaterial(this.collider.sharedMaterial);this._impl=N.physics.createShape(e.SPHERE_GEOMETRY,t,!0,this._flags)},i.updateScale=function(){this.updateGeometry(),this._impl.setGeometry(e.SPHERE_GEOMETRY),this.setCenter(this._collider.center)},i.updateGeometry=function(){var t=this.collider,i=Math.abs(h(this.collider.node.worldScale));e.SPHERE_GEOMETRY.setRadius(Math.max(1e-4,t.radius*i))},r(e,[{key:"collider",get:function(){return this._collider}}]),e}(mt);St.SPHERE_GEOMETRY=void 0;var gt=function(t){function e(){var i;return i=t.call(this,ot.BOX)||this,e.BOX_GEOMETRY||(f.set(.5,.5,.5),e.BOX_GEOMETRY=new w.BoxGeometry(f)),i}a(e,t);var i=e.prototype;return i.updateSize=function(){this.updateScale()},i.onComponentSet=function(){this.updateGeometry();var t=this.getSharedMaterial(this._collider.sharedMaterial);this._impl=N.physics.createShape(e.BOX_GEOMETRY,t,!0,this._flags)},i.updateScale=function(){this.updateGeometry(),this._impl.setGeometry(e.BOX_GEOMETRY),this.setCenter(this._collider.center)},i.updateGeometry=function(){var t=this.collider,i=t.node.worldScale;f.set(t.size).multiplyScalar(.5).multiply(i),e.BOX_GEOMETRY.setHalfExtents(g(f))},r(e,[{key:"collider",get:function(){return this._collider}}]),e}(mt);gt.BOX_GEOMETRY=void 0;var Tt=function(t){function i(){var e;return e=t.call(this,ot.CAPSULE)||this,i.CAPSULE_GEOMETRY||(i.CAPSULE_GEOMETRY=new w.CapsuleGeometry(.5,.5)),e}a(i,t);var s=i.prototype;return s.setCylinderHeight=function(){this.updateScale()},s.setDirection=function(){this.updateScale()},s.setRadius=function(){this.updateScale()},s.onComponentSet=function(){this.updateGeometry();var t=this.getSharedMaterial(this._collider.sharedMaterial);this._impl=N.physics.createShape(i.CAPSULE_GEOMETRY,t,!0,this._flags)},s.updateScale=function(){this.updateGeometry(),this._impl.setGeometry(i.CAPSULE_GEOMETRY),this.setCenter(this._collider.center)},s.updateGeometry=function(){var t=this.collider,s=t.node.worldScale,n=t.direction,o=.5,r=.5;n===v.Y_AXIS?(o=t.radius*Math.abs(d(s.x,s.z)),r=t.cylinderHeight/2*Math.abs(s.y),e.fromEuler(this._rotation,0,0,90)):n===v.X_AXIS?(o=t.radius*Math.abs(d(s.y,s.z)),r=t.cylinderHeight/2*Math.abs(s.x),e.fromEuler(this._rotation,0,0,0)):(o=t.radius*Math.abs(d(s.x,s.y)),r=t.cylinderHeight/2*Math.abs(s.z),e.fromEuler(this._rotation,0,90,0)),i.CAPSULE_GEOMETRY.setRadius(Math.max(1e-4,o)),i.CAPSULE_GEOMETRY.setHalfHeight(Math.max(1e-4,r))},r(i,[{key:"collider",get:function(){return this._collider}}]),i}(mt);Tt.CAPSULE_GEOMETRY=void 0;var Ct=function(i){function s(){var t;return t=i.call(this,ot.PLANE)||this,s.PLANE_GEOMETRY||(s.PLANE_GEOMETRY=new w.PlaneGeometry),t}a(s,i);var n=s.prototype;return n.setNormal=function(){this.setCenter()},n.setConstant=function(){this.setCenter()},n.setCenter=function(){var i=this.collider,s=Y.translation,n=Y.rotation;t.scaleAndAdd(s,i.center,i.normal,i.constant),e.rotationTo(n,t.UNIT_X,i.normal);var o=V(s,n);this._impl.setLocalPose(o)},n.onComponentSet=function(){var t=this.collider,e=this.getSharedMaterial(t.sharedMaterial);this._impl=N.physics.createShape(s.PLANE_GEOMETRY,e,!0,this._flags),this.setCenter()},n.updateScale=function(){this.setCenter()},r(s,[{key:"collider",get:function(){return this._collider}}]),s}(mt);Ct.PLANE_GEOMETRY=void 0;var At=function(i){function s(){var t;return(t=i.call(this,ot.MESH)||this).geometry=void 0,t}a(s,i);var n=s.prototype;return n.setMesh=function(i){if(i&&i.renderingSubMeshes.length>0&&null==this._impl){var s=N.physics,n=this.collider,o=this.getSharedMaterial(n.sharedMaterial),r=mt.MESH_SCALE;if(r.setScale(t.ONE),r.setRotation(e.IDENTITY),n.convex){if(null==w.MESH_CONVEX[i._uuid]){var a=N.cooking,c=i.readAttribute(0,u.ATTR_POSITION);w.MESH_CONVEX[i._uuid]=Z(c,a,s)}var l=w.MESH_CONVEX[i._uuid];this.geometry=new w.ConvexMeshGeometry(l,r,tt(0,!0))}else{if(null==w.MESH_STATIC[i._uuid]){var h=N.cooking,d=i.readAttribute(0,u.ATTR_POSITION),p=i.readIndices(0);w.MESH_STATIC[i._uuid]=function(t,e,i,s){for(var n=t.length,o=e.length,r=new w.PxVec3Vector,a=0;a<n;a+=3)r.push_back({x:t[a],y:t[a+1],z:t[a+2]});for(var c=new w.PxU16Vector,l=0;l<o;l+=3)c.push_back(e[l]),c.push_back(e[l+1]),c.push_back(e[l+2]);var h=i.createTriMeshExt(r,c,s);return r.delete(),c.delete(),h}(d,p,h,s)}var _=w.MESH_STATIC[i._uuid];this.geometry=new w.TriangleMeshGeometry(_,r,tt(0,!1))}this.updateGeometry(),this._impl=s.createShape(this.geometry,o,!0,this._flags),this.updateByReAdd()}},n.onComponentSet=function(){this.setMesh(this.collider.mesh)},n.updateScale=function(){this.updateGeometry(),this.setCenter(this._collider.center)},n.updateGeometry=function(){var t=mt.MESH_SCALE;t.setScale(this.collider.node.worldScale),t.setRotation(e.IDENTITY),this.geometry.setScale(t)},n.setMaterial=function(t){this._impl&&i.prototype.setMaterial.call(this,t)},n.setCenter=function(t){this._impl&&i.prototype.setCenter.call(this,t)},n.setAsTrigger=function(t){this._impl&&i.prototype.setAsTrigger.call(this,t)},n.setFilerData=function(t){this._impl&&i.prototype.setFilerData.call(this,t)},n.addToBody=function(){this._impl&&i.prototype.addToBody.call(this)},n.removeFromBody=function(){this._impl&&i.prototype.removeFromBody.call(this)},r(s,[{key:"collider",get:function(){return this._collider}}]),s}(mt),vt=function(t){function e(){return t.call(this,ot.TERRAIN)||this}a(e,t);var i=e.prototype;return i.setTerrain=function(t){if(t&&null==this._impl){var i=N.physics,s=this.collider;if(null==w.TERRAIN_STATIC[t._uuid]){var n=N.cooking;w.TERRAIN_STATIC[t._uuid]=function(t,e,i,s){for(var n=t.getVertexCountI(),o=t.getVertexCountJ(),r=new w.PxHeightFieldSampleVector,a=0;a<n;a++)for(var c=0;c<o;c++){var l=new w.PxHeightFieldSample;l.height=t.getHeight(a,c)/e,r.push_back(l)}return i.createHeightFieldExt(n,o,r,s)}(t,e.heightScale,n,i)}var o=w.TERRAIN_STATIC[t._uuid],r=this.getSharedMaterial(s.sharedMaterial),a=function(t,e,i,s,n){return new w.PxHeightFieldGeometry(t,new w.PxMeshGeometryFlags(0),i,s,n)}(o,0,e.heightScale,t.tileSize,t.tileSize);this._impl=i.createShape(a,r,!0,this._flags),this.updateByReAdd()}},i.onComponentSet=function(){this.setTerrain(this.collider.terrain)},i.updateScale=function(){this.setCenter(this._collider.center)},i.setCenter=function(t){this._impl&&this._impl.setLocalPose(V(t,this._rotation))},i.setMaterial=function(e){this._impl&&t.prototype.setMaterial.call(this,e)},i.setAsTrigger=function(e){this._impl&&t.prototype.setAsTrigger.call(this,e)},i.setFilerData=function(e){this._impl&&t.prototype.setFilerData.call(this,e)},i.addToBody=function(){this._impl&&t.prototype.addToBody.call(this)},i.removeFromBody=function(){this._impl&&t.prototype.removeFromBody.call(this)},r(e,[{key:"collider",get:function(){return this._collider}}]),e}(mt);vt.heightScale=2e-4;var Rt=function(i){function s(){var t;return(t=i.call(this,ot.CYLINDER)||this).geometry=void 0,t}a(s,i);var n=s.prototype;return n.setRadius=function(){this.updateGeometry()},n.setHeight=function(){this.updateGeometry()},n.setDirection=function(){this.updateGeometry()},n.onComponentSet=function(){var i=this.collider,n=N.physics;if(!s.CONVEX_MESH){var o=N.cooking,r=R(.5,.5,2,{radialSegments:32,heightSegments:1});s.CONVEX_MESH=Z(r.positions,o,n)}var a=mt.MESH_SCALE;a.setScale(t.ONE),a.setRotation(e.IDENTITY);var c=s.CONVEX_MESH,l=this.getSharedMaterial(i.sharedMaterial);this.geometry=new w.ConvexMeshGeometry(c,a,tt(0,!0)),this.updateGeometry(),this._impl=n.createShape(this.geometry,l,!0,this._flags)},n.updateScale=function(){this.updateGeometry(),this.setCenter(this._collider.center)},n.updateGeometry=function(){var i=this.collider,s=i.radius,n=i.height,o=i.direction,r=Y.translation;t.copy(r,i.node.worldScale),r.y*=Math.max(1e-4,n/2);var a=Math.max(1e-4,s/.5);r.x*=a,r.z*=a;var c=Y.rotation;switch(o){case v.X_AXIS:e.fromEuler(c,0,0,90);break;case v.Y_AXIS:default:e.copy(c,e.IDENTITY);break;case v.Z_AXIS:e.fromEuler(c,90,0,0)}var l=mt.MESH_SCALE;l.setScale(r),l.setRotation(c),this.geometry.setScale(l),e.copy(this._rotation,c)},r(s,[{key:"collider",get:function(){return this._collider}}]),s}(mt);Rt.CONVEX_MESH=void 0;var It=function(i){function s(){var t;return(t=i.call(this,ot.CONE)||this).geometry=void 0,t}a(s,i);var n=s.prototype;return n.setRadius=function(){this.updateGeometry()},n.setHeight=function(){this.updateGeometry()},n.setDirection=function(){this.updateGeometry()},n.onComponentSet=function(){var i=this.collider,n=N.physics;if(!s.CONVEX_MESH){var o=N.cooking,r=R(0,.5,1,{radialSegments:32,heightSegments:1});s.CONVEX_MESH=Z(r.positions,o,n)}var a=mt.MESH_SCALE;a.setScale(t.ONE),a.setRotation(e.IDENTITY);var c=s.CONVEX_MESH,l=this.getSharedMaterial(i.sharedMaterial);this.geometry=new w.ConvexMeshGeometry(c,a,tt(0,!0)),this.updateGeometry(),this._impl=n.createShape(this.geometry,l,!0,this._flags)},n.updateScale=function(){this.updateGeometry(),this.setCenter(this._collider.center)},n.updateGeometry=function(){var i=this.collider,s=i.radius,n=i.height,o=i.direction,r=Y.translation;t.copy(r,i.node.worldScale),r.y*=Math.max(1e-4,n/1);var a=Math.max(1e-4,s/.5);r.x*=a,r.z*=a;var c=Y.rotation;switch(o){case v.X_AXIS:e.fromEuler(c,0,0,90);break;case v.Y_AXIS:default:e.copy(c,e.IDENTITY);break;case v.Z_AXIS:e.fromEuler(c,90,0,0)}var l=mt.MESH_SCALE;l.setScale(r),l.setRotation(c),this.geometry.setScale(l),e.copy(this._rotation,c)},r(s,[{key:"collider",get:function(){return this._collider}}]),s}(mt);It.CONVEX_MESH=void 0;var Ot=function(){function t(){}var e=t.prototype;return e.setConnectedBody=function(){},e.setEnableCollision=function(t){this._impl.setConstraintFlag(8,t)},e.initialize=function(t){this._com=t,this._rigidBody=t.attachedBody,this.onComponentSet(),this.setEnableCollision(this._com.enableCollision),this._impl.$$&&(w.IMPL_PTR[this._impl.$$.ptr]=this)},e.onComponentSet=function(){},e.updateScale0=function(){},e.updateScale1=function(){},e.onEnable=function(){var t=this._rigidBody.body.sharedBody,e=this._com.connectedBody;if(t.addJoint(this,0),e){var i=e.body.sharedBody;$(this._impl,t.impl,i.impl),i.addJoint(this,1)}else $(this._impl,t.impl,null)},e.onDisable=function(){$(this._impl,t.tempActor,null),this._rigidBody.body.sharedBody.removeJoint(this,0);var e=this.constraint.connectedBody;e&&e.body.sharedBody.removeJoint(this,1)},e.onDestroy=function(){this._impl.$$&&(w.IMPL_PTR[this._impl.$$.ptr]=null,delete w.IMPL_PTR[this._impl.$$.ptr]),this._impl.release(),this._com=null,this._rigidBody=null,this._impl=null},r(t,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}],[{key:"tempActor",get:function(){return this._tempActor||(this._tempActor=N.physics.createRigidDynamic(b)),this._tempActor}}]),t}();Ot._tempActor=void 0;var Pt=function(i){function s(){return i.apply(this,arguments)||this}a(s,i);var n=s.prototype;return n.setPivotA=function(){var i=this.constraint,s=Y.translation,n=Y.rotation;t.multiply(s,i.node.worldScale,i.pivotA),e.copy(n,e.IDENTITY),this._impl.setLocalPose(0,V(s,n)),i.connectedBody||this.setPivotB(i.pivotB)},n.setPivotB=function(){var i=this.constraint,s=i.connectedBody,n=Y.translation,o=Y.rotation;if(t.copy(n,i.pivotB),e.copy(o,e.IDENTITY),s)t.multiply(n,s.node.worldScale,i.pivotB);else{var r=i.node;t.multiply(n,r.worldScale,i.pivotA),t.add(n,n,r.worldPosition),t.add(n,n,i.pivotB),e.multiply(o,o,r.worldRotation)}this._impl.setLocalPose(1,V(n,o))},n.onComponentSet=function(){this._impl=w.createDistanceJoint(Ot.tempActor,b,null,b),this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB)},n.updateScale0=function(){this.setPivotA(this.constraint.pivotA)},n.updateScale1=function(){this.setPivotB(this.constraint.pivotB)},r(s,[{key:"constraint",get:function(){return this._com}}]),s}(Ot),Mt=function(i){function s(){return i.apply(this,arguments)||this}a(s,i);var n=s.prototype;return n.setPivotA=function(){var i=this.constraint,s=Y.translation,n=Y.rotation;t.multiply(s,i.node.worldScale,i.pivotA),e.rotationTo(n,t.UNIT_X,i.axis),this._impl.setLocalPose(0,V(s,n)),i.connectedBody||this.setPivotB(i.pivotB)},n.setPivotB=function(){var i=this.constraint,s=i.connectedBody,n=Y.translation,o=Y.rotation;if(e.rotationTo(o,t.UNIT_X,i.axis),s)t.multiply(n,s.node.worldScale,i.pivotB);else{var r=i.node;t.multiply(n,r.worldScale,i.pivotA),t.add(n,n,r.worldPosition),t.add(n,n,i.pivotB),e.multiply(o,o,r.worldRotation)}this._impl.setLocalPose(1,V(n,o))},n.setAxis=function(){this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB)},n.onComponentSet=function(){this._impl=w.createRevoluteJoint(Ot.tempActor,b,null,b),this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB)},n.updateScale0=function(){this.setPivotA(this.constraint.pivotA)},n.updateScale1=function(){this.setPivotB(this.constraint.pivotB)},r(s,[{key:"constraint",get:function(){return this._com}}]),s}(Ot);p.once(_.EVENT_ENGINE_INITED,(function(){T.register("physx",{PhysicsWorld:ct,RigidBody:ft,BoxShape:gt,SphereShape:St,CapsuleShape:Tt,TrimeshShape:At,CylinderShape:Rt,ConeShape:It,TerrainShape:vt,PlaneShape:Ct,PointToPointConstraint:Pt,HingeConstraint:Mt})}))}}}));

System.register(["./json-asset-7bb011fd.js"],(function(t){"use strict";var e,i,s,n,r,h,a,u,_,c,l,o,f,x,d,g;return{setters:[function(t){e=t.ew,i=t.fH,s=t.ao,n=t.dl,r=t.l,h=t.gE,a=t.fj,u=t.ej,_=t.eq,c=t.f,l=t.cT,o=t.cg,f=t.c2,x=t.ce,d=t.dd,g=t.dk}],execute:function(){var v=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var i=new p;i.initWithSize(t,e),this._texture=i,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,i=t.texture,s=this._innerTextureInfos[i.getId()],n=e.x,h=e.y;if(s)n+=s.x,h+=s.y;else{var a=i.width,u=i.height;if(this._x+a+2>this._width&&(this._x=2,this._y=this._nexty),this._y+u+2>this._nexty&&(this._nexty=this._y+u+2),this._nexty>this._height)return null;r.internal.dynamicAtlasManager.textureBleeding&&((a<=8||u<=8)&&(this._texture.drawTextureAt(i.image,this._x-1,this._y-1),this._texture.drawTextureAt(i.image,this._x-1,this._y+1),this._texture.drawTextureAt(i.image,this._x+1,this._y-1),this._texture.drawTextureAt(i.image,this._x+1,this._y+1)),this._texture.drawTextureAt(i.image,this._x-1,this._y),this._texture.drawTextureAt(i.image,this._x+1,this._y),this._texture.drawTextureAt(i.image,this._x,this._y-1),this._texture.drawTextureAt(i.image,this._x,this._y+1)),this._texture.drawTextureAt(i.image,this._x,this._y),this._innerTextureInfos[i.getId()]={x:this._x,y:this._y,texture:i},this._count++,n+=this._x,h+=this._y,this._x+=a+2}var _={x:n,y:h,texture:this._texture};return this._innerSpriteFrames.push(t),_},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var s=t[e];s.isValid&&s._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),p=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.initWithSize=function(t,e,s){void 0===s&&(s=i.RGBA8888),this.reset({width:t,height:e,format:s})},r.drawTextureAt=function(t,e,i){var n=this.getGFXTexture();if(t&&n){var r=this._getGFXDevice();if(r){var h=new s;h.texOffset.x=e,h.texOffset.y=i,h.texExtent.width=t.width,h.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],n,[h])}else console.warn("Unable to get device")}},n}(n),y=function(){function t(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var e=t.prototype;return e.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new v(this._textureSize,this._textureSize),this._atlases.push(t)),t},e.beforeSceneLoad=function(){this.reset()},e.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=t.texture.getSamplerInfo();if(e.minFilter!==h.LINEAR||e.magFilter!==h.LINEAR||e.mipFilter!==h.NONE)return null;var i=this._atlases[this._atlasIndex];i||(i=this.newAtlas());var s=i.insertSpriteFrame(t);return s||this._atlasIndex===this._maxAtlasCount?s:(i=this.newAtlas()).insertSpriteFrame(t)},e.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},e.deleteAtlasSpriteFrame=function(t){if(t._original){for(var e,i=this._atlases.length-1;i>=0;i--)e=this._atlases[i],a.array.fastRemove(e._innerSpriteFrames,t);var s=t._original._texture;this.deleteAtlasTexture(s)}},e.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},e.packToDynamicAtlas=function(t,e){if(!e._original&&e.packable){var i=this.insertSpriteFrame(e);i&&e._setDynamicAtlasFrame(i)}},u(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),r.director.on(r.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),r.director.off(r.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),t}();y.instance=void 0;var m,S=t("d",y.instance=new y);r.internal.dynamicAtlasManager=S;var w=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],F=t("S",_("cc.SpriteFrame")(m=function(t){function i(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.uvHash=0,e.unbiasUV=[],e.uvSliced=[],e._rect=new o,e._offset=new f,e._originalSize=new x,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e}e(i,t),i.createWithImage=function(t){var e=t instanceof g?t:new g(t),s=new n;s.image=e;var r=new i;return r.texture=s,r};var s=i.prototype;return s.textureLoaded=function(){return!!this.texture},s.isRotated=function(){return this._rotated},s.setRotated=function(t){this.rotated=t},s.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},s.setRect=function(t){this.rect=t},s.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},s.setOriginalSize=function(t){this.originalSize=t},s.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},s.setOffset=function(t){this.offset=t},s.getGFXTexture=function(){return this._texture.getGFXTexture()},s.getGFXSampler=function(){return this._texture.getGFXSampler()},s.getHash=function(){return this._texture.getHash()},s.getSamplerInfo=function(){return this._texture.getSamplerInfo()},s.reset=function(t,e){void 0===e&&(e=!1);var i=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,i=!0),t&&(t.texture&&(this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),i=!0),i&&this.texture&&this._calculateUV()},s.checkRect=function(t){var e=this._rect,i=e.x,s=e.y;return this._rotated?(i+=e.height,s+=e.width):(i+=e.width,s+=e.height),i>t.width?(c(3300,this.name+"/"+t.name,i,t.width),!1):!(s>t.height&&(c(3301,this.name+"/"+t.name,s,t.height),1))},s.destroy=function(){return this._packable&&S&&S.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},s._calculateSlicedUV=function(){var t=this._rect,e=this.texture,i=e.width,s=e.height,n=this._capInsets[0],r=this._capInsets[2],h=t.width-n-r,a=this._capInsets[1],u=this._capInsets[3],_=t.height-a-u,c=this.uvSliced;if(c.length=0,this._rotated){w[0].u=t.x/i,w[1].u=(t.x+u)/i,w[2].u=(t.x+u+_)/i,w[3].u=(t.x+t.height)/i,w[3].v=t.y/s,w[2].v=(t.y+n)/s,w[1].v=(t.y+n+h)/s,w[0].v=(t.y+t.width)/s;for(var l=0;l<4;++l)for(var o=w[l],f=0;f<4;++f){var x=w[3-f];c.push({u:o.u,v:x.v})}}else{w[0].u=t.x/i,w[1].u=(t.x+n)/i,w[2].u=(t.x+n+h)/i,w[3].u=(t.x+t.width)/i,w[3].v=t.y/s,w[2].v=(t.y+a)/s,w[1].v=(t.y+a+_)/s,w[0].v=(t.y+t.height)/s;for(var d=0;d<4;++d)for(var g=w[d],v=0;v<4;++v){var p=w[v];c.push({u:p.u,v:g.v})}}},s._calculateUV=function(){var t=this._rect,e=this.uv,i=this.unbiasUV,s=this.texture,n=s.width,r=s.height;if(this._rotated){var h=0===n?0:t.x/n,a=0===n?1:(t.x+t.height)/n,u=0===r?0:t.y/r,_=0===r?1:(t.y+t.width)/r;this._isFlipUVX&&this._isFlipUVY?(e[0]=a,e[1]=_,e[2]=a,e[3]=u,e[4]=h,e[5]=_,e[6]=h,e[7]=u):this._isFlipUVX?(e[0]=a,e[1]=u,e[2]=a,e[3]=_,e[4]=h,e[5]=u,e[6]=h,e[7]=_):this._isFlipUVY?(e[0]=h,e[1]=_,e[2]=h,e[3]=u,e[4]=a,e[5]=_,e[6]=a,e[7]=u):(e[0]=h,e[1]=u,e[2]=h,e[3]=_,e[4]=a,e[5]=u,e[6]=a,e[7]=_);var c=0===n?0:t.x/n,o=0===n?1:(t.x+t.height)/n,f=0===r?0:t.y/r,x=0===r?1:(t.y+t.width)/r;this._isFlipUVX&&this._isFlipUVY?(i[0]=o,i[1]=x,i[2]=o,i[3]=f,i[4]=c,i[5]=x,i[6]=c,i[7]=f):this._isFlipUVX?(i[0]=o,i[1]=f,i[2]=o,i[3]=x,i[4]=c,i[5]=f,i[6]=c,i[7]=x):this._isFlipUVY?(i[0]=c,i[1]=x,i[2]=c,i[3]=f,i[4]=o,i[5]=x,i[6]=o,i[7]=f):(i[0]=c,i[1]=f,i[2]=c,i[3]=x,i[4]=o,i[5]=f,i[6]=o,i[7]=x)}else{var d=0===n?0:t.x/n,g=0===n?1:(t.x+t.width)/n,v=0===r?1:(t.y+t.height)/r,p=0===r?0:t.y/r;this._isFlipUVX&&this._isFlipUVY?(e[0]=g,e[1]=p,e[2]=d,e[3]=p,e[4]=g,e[5]=v,e[6]=d,e[7]=v):this._isFlipUVX?(e[0]=g,e[1]=v,e[2]=d,e[3]=v,e[4]=g,e[5]=p,e[6]=d,e[7]=p):this._isFlipUVY?(e[0]=d,e[1]=p,e[2]=g,e[3]=p,e[4]=d,e[5]=v,e[6]=g,e[7]=v):(e[0]=d,e[1]=v,e[2]=g,e[3]=v,e[4]=d,e[5]=p,e[6]=g,e[7]=p);var y=0===n?0:t.x/n,m=0===n?1:(t.x+t.width)/n,S=0===r?1:(t.y+t.height)/r,w=0===r?0:t.y/r;this._isFlipUVX&&this._isFlipUVY?(i[0]=m,i[1]=w,i[2]=y,i[3]=w,i[4]=m,i[5]=S,i[6]=y,i[7]=S):this._isFlipUVX?(i[0]=m,i[1]=S,i[2]=y,i[3]=S,i[4]=m,i[5]=w,i[6]=y,i[7]=w):this._isFlipUVY?(i[0]=y,i[1]=w,i[2]=m,i[3]=w,i[4]=y,i[5]=S,i[6]=m,i[7]=S):(i[0]=y,i[1]=S,i[2]=m,i[3]=S,i[4]=y,i[5]=w,i[6]=m,i[7]=w)}for(var F="",U=0;U<e.length;U++)F+=e[U];this.uvHash=l(F,666);var I=this.vertices;if(I){I.nu.length=0,I.nv.length=0;for(var V=0;V<I.u.length;V++)I.nu[V]=I.u[V]/n,I.nv[V]=I.v[V]/r}this._calculateSlicedUV()},s._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},s._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},s._checkPackable=function(){var t=S;if(t){var e=this._texture;if(e instanceof n&&!e.isCompressed){var i=this.width,s=this.height;!e.image||i>t.maxFrameSize||s>t.maxFrameSize?this._packable=!1:e.image&&e.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},s._serialize=function(){return null},s._deserialize=function(t){var e=t,i=e.rect;i&&(this._rect=new o(i.x,i.y,i.width,i.height));var s=e.offset;e.offset&&(this._offset=new f(s.x,s.y));var n=e.originalSize;e.originalSize&&(this._originalSize=new x(n.width,n.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable;var r=e.capInsets;r&&(this._capInsets[0]=r[0],this._capInsets[1]=r[1],this._capInsets[2]=r[2],this._capInsets[3]=r[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},s.clone=function(){var t,e,s,n,r,h,a,u,_=new i,c=this.vertices;return _.vertices=c?{x:c.x,y:c.y,triangles:c.triangles,nu:null===(t=c.nu)||void 0===t?void 0:t.slice(0),u:null===(e=c.u)||void 0===e?void 0:e.slice(0),nv:null===(s=c.nv)||void 0===s?void 0:s.slice(0),v:null===(n=c.v)||void 0===n?void 0:n.slice(0)}:null,(r=_.uv).splice.apply(r,[0,_.uv.length].concat(this.uv)),_.uvHash=this.uvHash,(h=_.unbiasUV).splice.apply(h,[0,_.unbiasUV.length].concat(this.unbiasUV)),(a=_.uvSliced).splice.apply(a,[0,_.uvSliced.length].concat(this.uvSliced)),_._rect.set(this._rect),_._offset.set(this._offset),_._originalSize.set(this._originalSize),_._rotated=this._rotated,(u=_._capInsets).splice.apply(u,[0,_._capInsets.length].concat(this._capInsets)),_._atlasUuid=this._atlasUuid,_._texture=this._texture,_._isFlipUVX=this._isFlipUVX,_._isFlipUVY=this._isFlipUVY,_},s._refreshTexture=function(t){this._texture=t;var e=this._texture,i={},s=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(e)||(i.rect=new o(0,0,e.width,e.height),s=!0),(0===this._originalSize.width||0===this._originalSize.height||s)&&(i.originalSize=new x(e.width,e.height),s=!0),s&&(this.reset(i),this.onLoaded()),this._checkPackable()},s.initDefault=function(e){t.prototype.initDefault.call(this,e);var i=new n;i.initDefault(),this._refreshTexture(i),this._calculateUV()},s.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},s._calculateTillingOffset=function(){this._rotated?(this.tillingOffset[0]=this.uv[4]-this.uv[0],this.tillingOffset[1]=this.uv[3]-this.uv[5],this.tillingOffset[2]=this.uv[0],this.tillingOffset[3]=this.uv[5],this.tillingOffset[0]=-this.tillingOffset[0]):(this.tillingOffset[0]=this.uv[2]-this.uv[0],this.tillingOffset[1]=this.uv[1]-this.uv[5],this.tillingOffset[2]=this.uv[4],this.tillingOffset[3]=this.uv[5])},s._calculateSlicedData=function(){var t=this._rect,e=this._capInsets[0],i=this._capInsets[2],s=t.width-e-i,n=this._capInsets[1],r=this._capInsets[3],h=t.height-n-r,a=this.slicedData;a.length=0,a[0]=e/t.width,a[1]=n/t.height,a[2]=(e+s)/t.width,a[3]=(n+h)/t.height},u(i,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?this.reset({texture:t},!0):console.warn("Error Texture in "+this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}}]),i}(d))||m);r.SpriteFrame=F}}}));

System.register(["./json-asset-7bb011fd.js","./index-07e0e256.js","./sprite-frame-ace45b09.js","./sprite-57cea86a.js","./renderable-2d-0c3bee97.js","./graphics-74958146.js","./vertex-format-25c59854.js","./deprecated-f955a6ea.js","./deprecated-7a0f85e1.js"],(function(t){"use strict";var e,r,a,i,n,s,o,h,u,c,l,f,d,v,p,_,x,g,y,m,S,D,w,T,C,B,M,b,E,P,L,F,R,A,O,H,I,N,k,z,U,V,W,Z,q,G,X,j,K,Y,Q,J,$,tt,et,rt,at,it,nt,st,ot,ht,ut,ct,lt,ft,dt,vt;return{setters:[function(t){e=t.c4,r=t.cb,a=t.ci,i=t.cg,n=t.ce,s=t.c2,o=t.fM,h=t.fu,u=t.W,c=t.l,l=t.t,f=t.c,d=t.f,v=t.e8,p=t.e9,_=t.gU,x=t.gX,g=t.fj,y=t.ea,m=t.gY,S=t.dA,D=t.ej,w=t.gl,T=t.gZ,C=t.aY,B=t.R,M=t.dp,b=t.C,E=t.P,P=t.au,L=t.z,F=t.G,R=t.d},function(t){A=t.w,O=t.x},function(t){H=t.d,I=t.S},function(t){N=t.h,k=t.O,z=t.e,U=t.i,V=t.H,W=t.V,Z=t.j,q=t.k,G=t.c,X=t.s,j=t.f,K=t.d,Y=t.g,Q=t.B,J=t.a,$=t.T},function(t){tt=t.S,et=t.a},function(t){rt=t.L,at=t.a,it=t.P,nt=t.b,st=t.G},function(t){ot=t.c,ht=t.g},function(t){ut=t.L,ct=t.c,lt=t.a,ft=t.e,dt=t.M,vt=t.D},function(){}],execute:function(){t("e",kt);var pt=new e,_t=new r;function xt(t,r,i,n){var s=i.data,o=r.acquireBufferBatch(),h=o.byteOffset>>2,u=i.vertexCount,c=o.indicesOffset,l=o.vertexOffset;o.request(u,i.indicesCount)||(o=r.currBufferBatch,h=0,c=0,l=0);var f=o.vData,d=o.iData;t.getWorldMatrix(_t);for(var v=0;v<u;v++){var p=s[v];e.set(pt,p.x,p.y,0),e.transformMat4(pt,pt,_t),f[h++]=pt.x,f[h++]=pt.y,f[h++]=pt.z,f[h++]=p.u,f[h++]=p.v,a.toArray(f,n,h),h+=4}for(var _=0,x=u/4;_<x;_++){var g=l+4*_;d[c++]=g,d[c++]=g+1,d[c++]=g+2,d[c++]=g+1,d[c++]=g+3,d[c++]=g+2}}var gt=function(t,e,r){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=r};function yt(t,e,r,a,i){var n=0,s=null;if(i===function(t,e,r,a){for(var i=0,n=e,s=r-a;n<r;n+=a)i+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return i}(t,e,r,a)>0)for(n=e;n<r;n+=a)s=It(n,t[n],t[n+1],s);else for(n=r-a;n>=e;n-=a)s=It(n,t[n],t[n+1],s);return s&&Rt(s,s.next)&&(Nt(s),s=s.next),s}function mt(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var r=t,a=!1;do{if(a=!1,r.steiner||!Rt(r,r.next)&&0!==Ft(r.prev,r,r.next))r=r.next;else{if(Nt(r),(r=e=r.prev)===r.next)return null;a=!0}}while(a||r!==e);return e}function St(t,e,r,a,i,n,s){if(void 0===s&&(s=0),t){!s&&n&&function(t,e,r,a){var i=t;do{null===i.z&&(i.z=bt(i.x,i.y,e,r,a)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e=0,r=null,a=null,i=null,n=null,s=0,o=0,h=0,u=1;do{for(r=t,t=null,n=null,s=0;r;){for(s++,a=r,o=0,e=0;e<u&&(o++,a=a.nextZ);e++);for(h=u;o>0||h>0&&a;)0===o?(i=a,a=a.nextZ,h--):0!==h&&a?r.z<=a.z?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,h--):(i=r,r=r.nextZ,o--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;r=a}n.nextZ=null,u*=2}while(s>1)}(i)}(t,a,i,n);for(var o=t,h=null,u=null;t.prev!==t.next;)if(h=t.prev,u=t.next,n?wt(t,a,i,n):Dt(t))e.push(h.i/r),e.push(t.i/r),e.push(u.i/r),Nt(t),t=u.next,o=u.next;else if((t=u)===o){s?1===s?St(t=Tt(t,e,r),e,r,a,i,n,2):2===s&&Ct(t,e,r,a,i,n):St(mt(t),e,r,a,i,n,1);break}}}function Dt(t){var e=t.prev,r=t,a=t.next;if(Ft(e,r,a)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Pt(e.x,e.y,r.x,r.y,a.x,a.y,i.x,i.y)&&Ft(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function wt(t,e,r,a){var i=t.prev,n=t,s=t.next;if(Ft(i,n,s)>=0)return!1;for(var o=i.x<n.x?i.x<s.x?i.x:s.x:n.x<s.x?n.x:s.x,h=i.y<n.y?i.y<s.y?i.y:s.y:n.y<s.y?n.y:s.y,u=i.x>n.x?i.x>s.x?i.x:s.x:n.x>s.x?n.x:s.x,c=i.y>n.y?i.y>s.y?i.y:s.y:n.y>s.y?n.y:s.y,l=bt(o,h,e,r,a),f=bt(u,c,e,r,a),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&Pt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Ft(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=l;){if(d!==t.prev&&d!==t.next&&Pt(i.x,i.y,n.x,n.y,s.x,s.y,d.x,d.y)&&Ft(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function Tt(t,e,r){var a=t;do{var i=a.prev,n=a.next.next;!Rt(i,n)&&At(i,a,a.next,n)&&Ot(i,n)&&Ot(n,i)&&(e.push(i.i/r),e.push(a.i/r),e.push(n.i/r),Nt(a),Nt(a.next),a=t=n),a=a.next}while(a!==t);return a}function Ct(t,e,r,a,i,n){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Lt(s,o)){var h=Ht(s,o);return s=mt(s,s.next),h=mt(h,h.next),St(s,e,r,a,i,n),void St(h,e,r,a,i,n)}o=o.next}s=s.next}while(s!==t)}function Bt(t,e){return t.x-e.x}function Mt(t,e){if(e=function(t,e){var r=e,a=t.x,i=t.y,n=-1/0,s=null;do{if(i<=r.y&&i>=r.next.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=a&&o>n){if(n=o,o===a){if(i===r.y)return r;if(i===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(a===n)return s.prev;var h,u=s,c=s.x,l=s.y,f=1/0;for(r=s.next;r!==u;)a>=r.x&&r.x>=c&&Pt(i<l?a:n,i,c,l,i<l?n:a,i,r.x,r.y)&&((h=Math.abs(i-r.y)/(a-r.x))<f||h===f&&r.x>s.x)&&Ot(r,t)&&(s=r,f=h),r=r.next;return s}(t,e)){var r=Ht(e,t);mt(r,r.next)}}function bt(t,e,r,a,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)/i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Et(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function Pt(t,e,r,a,i,n,s,o){return(i-s)*(e-o)-(t-s)*(n-o)>=0&&(t-s)*(a-o)-(r-s)*(e-o)>=0&&(r-s)*(n-o)-(i-s)*(a-o)>=0}function Lt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&At(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Ot(t,e)&&Ot(e,t)&&function(t,e){var r=t,a=!1,i=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(a=!a),r=r.next}while(r!==t);return a}(t,e)}function Ft(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Rt(t,e){return t.x===e.x&&t.y===e.y}function At(t,e,r,a){return!!(Rt(t,e)&&Rt(r,a)||Rt(t,a)&&Rt(r,e))||Ft(t,e,r)>0!=Ft(t,e,a)>0&&Ft(r,a,t)>0!=Ft(r,a,e)>0}function Ot(t,e){return Ft(t.prev,t,t.next)<0?Ft(t,e,t.next)>=0&&Ft(t,t.prev,e)>=0:Ft(t,e,t.prev)<0||Ft(t,t.next,e)<0}function Ht(t,e){var r=new gt(t.i,t.x,t.y),a=new gt(e.i,e.x,e.y),i=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,a.next=r,r.prev=a,n.next=a,a.prev=n,a}function It(t,e,r,a){var i=new gt(t,e,r);return a?(i.next=a.next,i.prev=a,a.next.prev=i,a.next=i):(i.prev=i,i.next=i),i}function Nt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function kt(t,e,r){r=r||3;var a=e?e.length:0,i=a?e[0]*r:t.length,n=yt(t,0,i,r,!0),s=[];if(!n)return s;var o=0,h=0,u=0,c=0,l=0,f=0,d=0;if(a&&(n=function(t,e,r,a){var i,n=[],s=0,o=null;for(s=0,i=e.length;s<i;s++)(o=yt(t,e[s]*a,s<i-1?e[s+1]*a:t.length,a,!1))&&(o===o.next&&(o.steiner=!0),n.push(Et(o)));if(n.sort(Bt),!r)return r;for(s=0;s<n.length;s++)Mt(n[s],r),r=mt(r,r.next);return r}(t,e,n,r)),t.length>80*r){o=u=t[0],h=c=t[1];for(var v=r;v<i;v+=r)(l=t[v])<o&&(o=l),(f=t[v+1])<h&&(h=f),l>u&&(u=l),f>c&&(c=f);d=Math.max(u-o,c-h)}return St(n,s,r,o,h,d),s}for(var zt=Math.PI,Ut=Math.min,Vt=Math.max,Wt=Math.ceil,Zt=Math.acos,qt=Math.cos,Gt=Math.sin,Xt=Math.atan2,jt=null,Kt=null,Yt=new a,Qt=[],Jt=0;Jt<4;Jt++)Qt.push(new e);function $t(t,e,r){return t<e?e:t>r?r:t}var te={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!Kt)return null;var r=Kt.getRenderDataList(),a=r[Kt.dataOffset];if(!a)return null;var i=a,n=i?i.vertexStart+e:0;return(n>65535||3*n>131070)&&(++Kt.dataOffset,Kt.dataOffset<r.length?a=r[Kt.dataOffset]:(a=Kt.requestRenderData(),r[Kt.dataOffset]=a),i=a),i&&i.vertexCount<n&&i.request(e,3*e),a},stroke:function(t){a.copy(Yt,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){a.copy(Yt,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e=.5*t.lineWidth,r=t.lineCap,a=t.lineJoin,i=t.miterLimit;if(Kt=t.impl){var n,s,o,h,u=(n=e,s=zt,o=Kt.tessTol,h=2*Zt(n/(n+o)),Vt(2,Wt(s/h)));this._calculateJoins(Kt,e,a,i);for(var c=Kt.paths,l=0,f=Kt.pathOffset,d=Kt.pathLength;f<d;f++){var v=c[f],p=v.points.length;a===rt.ROUND?l+=2*(p+v.bevel*(u+2)+1):l+=2*(p+5*v.bevel+1),v.closed||(r===at.ROUND?l+=2*(2*u+2):l+=12)}var _=jt=this.getRenderData(t,l);if(_){for(var x=_.vData,g=_.iData,y=Kt.pathOffset,m=Kt.pathLength;y<m;y++){var S=c[y],D=S.points,w=D.length,T=_.vertexStart,C=void 0,B=void 0,M=0,b=0,E=S.closed;if(E?(C=D[w-1],B=D[0],M=0,b=w):(C=D[0],B=D[1],M=1,b=w-1),B=B||C,!E){var P=new it(B.x,B.y);P.subtract(C),P.normalize();var L=P.x,F=P.y;r===at.BUTT?this._buttCapStart(C,L,F,e,0):r===at.SQUARE?this._buttCapStart(C,L,F,e,e):r===at.ROUND&&this._roundCapStart(C,L,F,e,u)}for(var R=M;R<b;++R)a===rt.ROUND?this._roundJoin(C,B,e,e,u):0!=(B.flags&(nt.PT_BEVEL|nt.PT_INNERBEVEL))?this._bevelJoin(C,B,e,e):(this._vSet(B.x+B.dmx*e,B.y+B.dmy*e,1),this._vSet(B.x-B.dmx*e,B.y-B.dmy*e,-1)),C=B,B=D[R+1];if(E){var A=8*T;this._vSet(x[A],x[A+1],1),this._vSet(x[A+8],x[A+8+1],-1)}else{var O=new it(B.x,B.y);O.subtract(C),O.normalize();var H=O.x,I=O.y;r===at.BUTT?this._buttCapEnd(B,H,I,e,0):r===at.SQUARE?this._buttCapEnd(B,H,I,e,e):r===at.ROUND&&this._roundCapEnd(B,H,I,e,u)}for(var N=_.indicesStart,k=T+2,z=_.vertexStart;k<z;k++)g[N++]=k-2,g[N++]=k-1,g[N++]=k;_.indicesStart=N}jt=null,Kt=null}}},_expandFill:function(t){if(Kt=t.impl){for(var e=Kt.paths,r=0,a=Kt.pathOffset,i=Kt.pathLength;a<i;a++)r+=e[a].points.length;var n=jt=this.getRenderData(t,r);if(n){for(var s=n,o=s.vData,h=s.iData,u=Kt.pathOffset,c=Kt.pathLength;u<c;u++){var l=e[u],f=l.points,d=f.length;if(0!==d){for(var v=n.vertexStart,p=0;p<d;++p)this._vSet(f[p].x,f[p].y);var _=n.indicesStart;if(l.complex){for(var x=[],g=v,y=n.vertexStart;g<y;g++){var m=8*g;x.push(o[m++]),x.push(o[m++]),x.push(o[m++])}var S=kt(x,null,3);if(!S||0===S.length)continue;for(var D=0,w=S.length;D<w;D++)h[_++]=S[D]+v}else for(var T=v,C=v+2,B=s.vertexStart;C<B;C++)h[_++]=T,h[_++]=C-1,h[_++]=C;s.indicesStart=_}}jt=null,Kt=null}}},_calculateJoins:function(t,e,r,a){var i=0;e>0&&(i=1/e);for(var n=t.paths,s=t.pathOffset,o=t.pathLength;s<o;s++){var h=n[s],u=h.points,c=u.length,l=u[c-1],f=u[0];h.bevel=0;for(var d=0;d<c;d++){var v,p,_=l.dy,x=-l.dx,g=f.dy,y=-f.dx;if(f.dmx=.5*(_+g),f.dmy=.5*(x+y),(v=f.dmx*f.dmx+f.dmy*f.dmy)>1e-6){var m=1/v;m>600&&(m=600),f.dmx*=m,f.dmy*=m}f.dx*l.dy-l.dx*f.dy>0&&(f.flags|=nt.PT_LEFT),v*(p=Vt(11,Ut(l.len,f.len)*i))*p<1&&(f.flags|=nt.PT_INNERBEVEL),f.flags&nt.PT_CORNER&&(v*a*a<1||r===rt.BEVEL||r===rt.ROUND)&&(f.flags|=nt.PT_BEVEL),0!=(f.flags&(nt.PT_BEVEL|nt.PT_INNERBEVEL))&&h.bevel++,l=f,f=u[d+1]}}},_flattenPaths:function(t){for(var e=t.paths,r=t.pathOffset,a=t.pathLength;r<a;r++){var i=e[r],n=i.points,s=n[n.length-1],o=n[0];n.length>2&&s.equals(o)&&(i.closed=!0,n.pop(),s=n[n.length-1]);for(var h=0,u=n.length;h<u;h++){var c=new it(o.x,o.y);c.subtract(s),s.len=c.length(),(c.x||c.y)&&c.normalize(),s.dx=c.x,s.dy=c.y,s=o,o=n[h+1]}}},_chooseBevel:function(t,e,r,a){var i=r.x,n=r.y,s=0,o=0,h=0,u=0;return 0!==t?(s=i+e.dy*a,o=n-e.dx*a,h=i+r.dy*a,u=n-r.dx*a):(s=h=i+r.dmx*a,o=u=n+r.dmy*a),[s,o,h,u]},_buttCapStart:function(t,e,r,a,i){var n=t.x-e*i,s=t.y-r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_buttCapEnd:function(t,e,r,a,i){var n=t.x+e*i,s=t.y+r*i,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapStart:function(t,e,r,a,i){for(var n=t.x,s=t.y,o=r,h=-e,u=0;u<i;u++){var c=u/(i-1)*zt,l=qt(c)*a,f=Gt(c)*a;this._vSet(n-o*l-e*f,s-h*l-r*f,1),this._vSet(n,s,0)}this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1)},_roundCapEnd:function(t,e,r,a,i){var n=t.x,s=t.y,o=r,h=-e;this._vSet(n+o*a,s+h*a,1),this._vSet(n-o*a,s-h*a,-1);for(var u=0;u<i;u++){var c=u/(i-1)*zt,l=qt(c)*a,f=Gt(c)*a;this._vSet(n,s,0),this._vSet(n-o*l+e*f,s-h*l+r*f,1)}},_roundJoin:function(t,e,r,a,i){var n=t.dy,s=-t.dx,o=e.dy,h=-e.dx,u=e.x,c=e.y;if(0!=(e.flags&nt.PT_LEFT)){var l=this._chooseBevel(e.flags&nt.PT_INNERBEVEL,t,e,r),f=l[0],d=l[1],v=l[2],p=l[3],_=Xt(-s,-n),x=Xt(-h,-o);x>_&&(x-=2*zt),this._vSet(f,d,1),this._vSet(u-n*a,e.y-s*a,-1);for(var g=$t(Wt((_-x)/zt)*i,2,i),y=0;y<g;y++){var m=_+y/(g-1)*(x-_),S=u+qt(m)*a,D=c+Gt(m)*a;this._vSet(u,c,0),this._vSet(S,D,-1)}this._vSet(v,p,1),this._vSet(u-o*a,c-h*a,-1)}else{var w=this._chooseBevel(e.flags&nt.PT_INNERBEVEL,t,e,-a),T=w[0],C=w[1],B=w[2],M=w[3],b=Xt(s,n),E=Xt(h,o);E<b&&(E+=2*zt),this._vSet(u+n*a,c+s*a,1),this._vSet(T,C,-1);for(var P=$t(Wt((E-b)/zt)*i,2,i),L=0;L<P;L++){var F=b+L/(P-1)*(E-b),R=u+qt(F)*r,A=c+Gt(F)*r;this._vSet(R,A,1),this._vSet(u,c,0)}this._vSet(u+o*a,c+h*a,1),this._vSet(B,M,-1)}},_bevelJoin:function(t,e,r,a){var i=0,n=0,s=0,o=0,h=0,u=0,c=0,l=0,f=t.dy,d=-t.dx,v=e.dy,p=-e.dx;if(e.flags&nt.PT_LEFT){var _=this._chooseBevel(e.flags&nt.PT_INNERBEVEL,t,e,r);h=_[0],u=_[1],c=_[2],l=_[3],this._vSet(h,u,1),this._vSet(e.x-f*a,e.y-d*a,-1),this._vSet(c,l,1),this._vSet(e.x-v*a,e.y-p*a,-1)}else{var x=this._chooseBevel(e.flags&nt.PT_INNERBEVEL,t,e,-a);i=x[0],n=x[1],s=x[2],o=x[3],this._vSet(e.x+f*r,e.y+d*r,1),this._vSet(i,n,-1),this._vSet(e.x+v*r,e.y+p*r,1),this._vSet(s,o,-1)}},_vSet:function(t,e,r){if(void 0===r&&(r=0),jt){var i=jt,n=8*i.vertexStart,s=i.vData;s[n++]=t,s[n++]=e,s[n++]=0,a.toArray(s,Yt,n),n+=4,s[n++]=r,i.vertexStart++}}},ee=t("g",{getAssembler:function(){return te}});st.Assembler=ee;var re=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},ae=new i,ie=null,ne=null,se=[],oe=[],he=[],ue=[],ce=new n,le=new n,fe=new s,de=null,ve=0,pe=0,_e=0,xe=0,ge=0,ye=1,me=null,Se="",De=0,we=0,Te=0,Ce=0,Be=0,Me=0,be=0,Ee=!1,Pe=0,Le=0,Fe=0,Re={updateRenderData:function(t){t.renderData&&ie!==t&&(t.renderData.vertDirty&&(ne=(ie=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),ie.actualFontSize=De,ne.setContentSize(le),ie.renderData.vertDirty=ie.renderData.uvDirty=!1,ie.markForUpdateRenderData(!1),ie=null,this._resetProperties()),t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame))},_updateFontScale:function(){ye=De/we},_updateFontFamily:function(t){var e=t.font;me=e.spriteFrame,de=e.fntConfig,N.fontAtlas=e.fontDefDictionary,H.packToDynamicAtlas(t,me)},_updateLabelInfo:function(){N.hash="",N.margin=0},_updateProperties:function(t){Se=t.string.toString(),De=t.fontSize,we=de?de.fontSize:t.fontSize,Te=t.horizontalAlign,Ce=t.verticalAlign,Be=t.spacingX,be=t.overflow,Me=t._lineHeight;var e=ne.contentSize;le.width=e.width,le.height=e.height,be===k.NONE?(Ee=!1,le.width+=2*N.margin,le.height+=2*N.margin):be===k.RESIZE_HEIGHT?(Ee=!0,le.height+=2*N.margin):Ee=t.enableWrapText,N.lineHeight=Me,N.fontSize=De,this._setupBMFontOverflowMetrics()},_resetProperties:function(){de=null,me=null,N.hash="",N.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=Se,e=t.length,r=de.kerningDict,a=se,i=-1,n=0;n<e;++n){var s=t.charCodeAt(n),o=r[i<<16|65535&s]||0;a[n]=n<e-1?o:0,i=s}},_multilineTextWrap:function(t){for(var e=Se.length,r=0,a=0,i=0,n=0,s=0,o=0,h=0,u=null,c=0;c<e;){var l=Se.charAt(c);if("\n"!==l){for(var f=t(Se,c,e),d=o,v=h,p=s,_=a,x=!1,g=0;g<f;++g){var y=c+g;if("\r"!==(l=Se.charAt(y)))if(u=N.fontAtlas.getLetterDefinitionForChar(l,N)){var m=_+u.offsetX*ye-N.margin;if(Ee&&Fe>0&&a>0&&m+u.w*ye>Fe&&!z(l)){he.push(s),s=0,r++,a=0,i-=Me*this._getFontScale()+0,x=!0;break}fe.x=m,fe.y=i-u.offsetY*ye,this._recordLetterInfo(fe,l,y,r),y+1<se.length&&y<e-1&&(_+=se[y+1]),_+=u.xAdvance*ye+Be,p=fe.x+u.w*ye,d<fe.y&&(d=fe.y),v>fe.y-u.h*ye&&(v=fe.y-u.h*ye)}else this._recordPlaceholderInfo(y,l),console.log("Can't find letter definition in texture atlas "+de.atlasName+" for letter:"+l);else this._recordPlaceholderInfo(y,l)}x||(a=_,o<d&&(o=d),h>v&&(h=v),n<(s=p)&&(n=s),c+=f)}else he.push(s),s=0,r++,a=0,i-=Me*this._getFontScale()+0,this._recordPlaceholderInfo(c,l),c++}return he.push(s),pe=(ve=r+1)*Me*this._getFontScale(),ve>1&&(pe+=0*(ve-1)),le.width=Pe,le.height=Le,Pe<=0&&(le.width=parseFloat(n.toFixed(2))+2*N.margin),Le<=0&&(le.height=parseFloat(pe.toFixed(2))+2*N.margin),xe=le.height,ge=0,o>0&&(xe=le.height+o),h<-pe&&(ge=pe+h),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return be===k.SHRINK?ye:1},_getFirstWordLen:function(t,e,r){var a=t.charAt(e);if(U(a)||"\n"===a||z(a))return 1;var i=1,n=N.fontAtlas.getLetterDefinitionForChar(a,N);if(!n)return i;for(var s=n.xAdvance*ye+Be,o=e+1;o<r&&(a=t.charAt(o),n=N.fontAtlas.getLetterDefinitionForChar(a,N));++o){if(s+n.offsetX*ye+n.w*ye>Fe&&!z(a)&&Fe>0)return i;if(s+=n.xAdvance*ye+Be,"\n"===a||z(a)||U(a))break;i++}return i},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=oe.length){var r=new re;oe.push(r)}oe[t].char=e,oe[t].hash=""+e.charCodeAt(0)+N.hash,oe[t].valid=!1},_recordLetterInfo:function(t,e,r,a){if(r>=oe.length){var i=new re;oe.push(i)}var n=""+e.charCodeAt(0)+N.hash;oe[r].line=a,oe[r].char=e,oe[r].hash=n,oe[r].valid=N.fontAtlas.getLetter(n).valid,oe[r].x=t.x,oe[r].y=t.y},_alignText:function(){pe=0,he.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),be===k.SHRINK&&De>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||be===k.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),De=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,r=0|De,a=0;e<r;){var i=a=e+r+1>>1;if(i<=0)break;ye=i/we,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?r=a-1:e=a}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return pe>le.height},_isHorizontalClamp:function(){for(var t=!1,e=0,r=Se.length;e<r;++e){var a=oe[e];if(a.valid){var i=N.fontAtlas.getLetterDefinitionForChar(a.char,N);if(!i)continue;var n=a.x+i.w*ye,s=a.line;if(Pe>0)if(Ee){if(he[s]>le.width&&(n>le.width||n<0)){t=!0;break}}else if(n>le.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var r=he[e],a=t>le.width||t<0;return Ee?r>le.width&&a:a},_updateQuads:function(){if(!ie)return!1;var t=me?me.texture:N.fontAtlas.getTexture(),e=ie.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var r=ne.anchorPoint,a=le,i=r.x*a.width,n=r.y*a.height,s=!0,o=0,h=Se.length;o<h;++o){var u=oe[o];if(u.valid){var c=N.fontAtlas.getLetter(u.hash);if(c){ae.height=c.h,ae.width=c.w,ae.x=c.u,ae.y=c.v;var l=u.y+_e;if(Le>0){if(l>xe){var f=l-xe;ae.y+=f,ae.height-=f,l-=f}l-c.h*ye<ge&&be===k.CLAMP&&(ae.height=l<ge?0:(l-ge)/ye)}var d=u.line,v=u.x+c.w/2*ye+ue[d];if(Pe>0&&this._isHorizontalClamped(v,d))if(be===k.CLAMP)ae.width=0;else if(be===k.SHRINK){if(le.width>c.w){s=!1;break}ae.width=0}if(ae.height>0&&ae.width>0){var p=this._determineRect(),_=u.x+ue[u.line];this.appendQuad(ie,t,ae,p,_-i,l-n,ye)}}else console.warn("Can't find letter in this bitmap-font")}}return s},appendQuad:function(){},_determineRect:function(){var t=me.isRotated(),e=me.getOriginalSize(),r=me.getRect(),a=me.getOffset(),i=a.x+(e.width-r.width)/2,n=a.y-(e.height-r.height)/2;if(t){var s=ae.x;ae.x=r.x+r.height-ae.y-ae.height-n,ae.y=s+r.y-i,ae.y<0&&(ae.height+=n)}else ae.x+=r.x-i,ae.y+=r.y+n;return t},_computeAlignmentOffset:function(){switch(ue.length=0,Te){case V.LEFT:for(var t=0;t<ve;++t)ue.push(0);break;case V.CENTER:for(var e=0,r=he.length;e<r;e++)ue.push((le.width-he[e])/2);break;case V.RIGHT:for(var a=0,i=he.length;a<i;a++)ue.push(le.width-he[a])}if(_e=le.height,Ce!==W.TOP){var n=le.height-pe+Me*this._getFontScale()-we*ye;Ce===W.BOTTOM?_e-=n:_e-=n/2}},_setupBMFontOverflowMetrics:function(){var t=le.width,e=le.height;be===k.RESIZE_HEIGHT&&(e=0),be===k.NONE&&(t=0,e=0),Pe=t,Le=e,ce.width=t,ce.height=e,Fe=t}},Ae=new a(255,255,255,255),Oe={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){var r=t.node;Ae.set(t.color),Ae.a=255*r._uiProps.opacity,xt(r,e,t.renderData,Ae)},appendQuad:function(t,e,r,a,i,n,s){var o=t.renderData;if(o){var h=o.dataLength;o.dataLength+=4,o.vertexCount=o.dataLength,o.indicesCount=o.dataLength/2*3;var u=o.data,c=e.width,l=e.height,f=r.width,d=r.height,v=0,p=0,_=0,x=0;a?(v=r.x/c,x=(r.x+d)/c,p=(r.y+f)/l,_=r.y/l,u[h].u=v,u[h].v=_,u[h+1].u=v,u[h+1].v=p,u[h+2].u=x,u[h+2].v=_,u[h+3].u=x,u[h+3].v=p):(v=r.x/c,x=(r.x+f)/c,p=(r.y+d)/l,_=r.y/l,u[h].u=v,u[h].v=p,u[h+1].u=x,u[h+1].v=p,u[h+2].u=v,u[h+2].v=_,u[h+3].u=x,u[h+3].v=_),u[h].x=i,u[h].y=n-d*s,u[h+1].x=i+f*s,u[h+1].y=n-d*s,u[h+2].x=i,u[h+2].y=n,u[h+3].x=i+f*s,u[h+3].y=n}}};o(Oe,Re);var He=null,Ie=h(Re,{getAssemblerData:function(){return He||(He=new Z(1024,1024)),He.getTexture()},_updateFontFamily:function(t){N.fontAtlas=He,N.fontFamily=this._getFontFamily(t);var e=t.getComponent(ut);e&&e.enabled?(N.isOutlined=!0,N.margin=e.width,N.out=e.color.clone(),N.out.a=e.color.a*t.color.a/255):(N.isOutlined=!1,N.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e},_updateLabelInfo:function(t){N.fontDesc=this._getFontDesc(),N.color=t.color,N.hash=q(N)},_getFontDesc:function(){return N.fontSize.toString()+"px "+N.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),Ne=new a(255,255,255,255),ke={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var r=t.node;Ne.a=255*r._uiProps.opacity,xt(r,e,t.renderData,Ne)}},appendQuad:Oe.appendQuad};o(ke,Ie);var ze=G.Overflow,Ue=Y(),Ve=(1/255).toFixed(3),We=null,Ze=null,qe=null,Ge="",Xe="",je=0,Ke=0,Ye=[],Qe=new n,Je=0,$e=0,tr=0,er=new a,rr="",ar=ze.NONE,ir=!1,nr=null,sr=a.BLACK.clone(),or=null,hr=a.BLACK.clone(),ur=new i,cr=n.ZERO.clone(),lr=n.ZERO.clone(),fr=s.ZERO.clone(),dr=s.ZERO.clone(),vr=0,pr=0,_r=!1,xr=!1,gr=!1,yr=["left","center","right"],mr={getAssemblerData:function(){return G._canvasPool.get()},resetAssemblerData:function(t){t&&G._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData){if(t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(t),this.updateOpacity(t),this._calDynamicAtlas(t),t.actualFontSize=je,e.setContentSize(Qe),this.updateVertexData(t),this.updateUvs(t),t.markForUpdateRenderData(!1),We=null,Ze=null,qe=null}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},updateVertexData:function(){},updateUvs:function(){},updateOpacity:function(t){for(var e=t.renderData.vData,r=5,a=t.node._uiProps.opacity,i=0;i<4;i++)e[r+3]=a,r+=9},_updateFontFamily:function(t){rr=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},_updateProperties:function(t,e){var r=t.assemblerData;r&&(We=r.context,Ze=r.canvas,qe=t.spriteFrame,Xe=t.string.toString(),je=t.fontSize,Ke=je,ar=t.overflow,lr.width=Qe.width=e.width,lr.height=Qe.height=e.height,pr=t.underlineHeight,Je=t.lineHeight,$e=t.horizontalAlign,tr=t.verticalAlign,er=t.color,t.node._uiProps.opacity,_r=t.isBold,xr=t.isItalic,gr=t.isUnderline,ir=ar!==ze.NONE&&(ar===ze.RESIZE_HEIGHT||t.enableWrapText),(nr=(nr=ut&&t.getComponent(ut))&&nr.enabled&&nr.width>0?nr:null)&&sr.set(nr.color),(or=(or=ct&&t.getComponent(ct))&&or.enabled?or:null)&&hr.set(or.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,r=0,a=0,i=0;if(cr.width=cr.height=0,nr&&(t=e=r=a=i=nr.width,cr.width=cr.height=2*i),or){var n=or.blur+i,s=or.offset.x,o=or.offset.y;r=Math.max(r,-s+n),a=Math.max(a,s+n),t=Math.max(t,o+n),e=Math.max(e,-o+n)}if(xr){var h=Ke*Math.tan(.20943951);a+=h,cr.width+=h}ur.x=r,ur.y=t,ur.width=r+a,ur.height=t+e},_calculateFillTextStartPosition:function(){var t=0;$e===V.RIGHT?t=Qe.width-ur.width:$e===V.CENTER&&(t=(Qe.width-ur.width)/2);var e=this._getLineHeight()*(Ye.length-1),r=je*(1-K/2);if(tr!==W.TOP){var a=e+ur.height+je-Qe.height;tr===W.BOTTOM?r-=a+=K/2*je:r-=a/2}r+=Ue*je,fr.set(t+ur.x,r+ur.y)},_updateTexture:function(t){if(We&&Ze){We.clearRect(0,0,Ze.width,Ze.height),We.font=Ge,this._calculateFillTextStartPosition();var e=this._getLineHeight();We.lineJoin="round",nr?(We.fillStyle="rgba("+sr.r+", "+sr.g+", "+sr.b+", "+Ve+")",We.fillRect(0,0,Ze.width,Ze.height)):t._srcBlendFactor===u.SRC_ALPHA&&(We.fillStyle="rgba("+er.r+", "+er.g+", "+er.b+", "+Ve+")",We.fillRect(0,0,Ze.width,Ze.height)),We.fillStyle="rgb("+er.r+", "+er.g+", "+er.b+")";var r=fr.x,a=0;this._drawTextEffect(fr,e);for(var i=0;i<Ye.length;++i)a=fr.y+i*e,nr&&We.strokeText(Ye[i],r,a),We.fillText(Ye[i],r,a);or&&(We.shadowColor="transparent"),this._uploadTexture(t)}},_uploadTexture:function(t){if(t.cacheMode===G.CacheMode.BITMAP){var e=t.ttfSpriteFrame;H.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}var r;qe&&Ze&&(r=qe instanceof I?qe.texture:qe,0!==Ze.width&&0!==Ze.height&&(r.reset({width:Ze.width,height:Ze.height,mipmapLevel:1}),r.uploadData(Ze),qe instanceof I&&(qe.rect=new i(0,0,Ze.width,Ze.height),qe._calculateUV()),t.renderData&&(t.renderData.textureDirty=!0),c.director.root&&c.director.root.batcher2D&&c.director.root.batcher2D._releaseDescriptorSetCache(r.getHash())))},_calDynamicAtlas:function(t){if(t.cacheMode===G.CacheMode.BITMAP){var e=t.ttfSpriteFrame;H.packToDynamicAtlas(t,e),t.renderData.uvDirty=!0}},_setupOutline:function(){We.strokeStyle="rgba("+sr.r+", "+sr.g+", "+sr.b+", "+sr.a/255+")",We.lineWidth=2*nr.width},_setupShadow:function(){We.shadowColor="rgba("+hr.r+", "+hr.g+", "+hr.b+", "+hr.a/255+")",We.shadowBlur=or.blur,We.shadowOffsetX=or.offset.x,We.shadowOffsetY=-or.offset.y},_drawTextEffect:function(t,e){if(or||nr||gr){var r=Ye.length>1&&or,a=this._measureText(We,Ge),i=0,n=0;or&&this._setupShadow(),nr&&this._setupOutline();for(var s=0;s<Ye.length;++s)i=t.x,n=t.y+s*e,r&&(nr&&We.strokeText(Ye[s],i,n),We.fillText(Ye[s],i,n)),gr&&(vr=a(Ye[s]),$e===V.RIGHT?dr.x=t.x-vr:$e===V.CENTER?dr.x=t.x-vr/2:dr.x=t.x,dr.y=n+Ke/8,We.fillRect(dr.x,dr.y,vr,pr));r&&(We.shadowColor="transparent")}},_updateLabelDimensions:function(){Qe.width=Math.min(Qe.width,2048),Qe.height=Math.min(Qe.height,2048);var t=!1;Ze.width!==Qe.width&&(Ze.width=Qe.width,t=!0),Ze.height!==Qe.height&&(Ze.height=Qe.height,t=!0),t&&(We.font=Ge),We.textAlign=yr[$e],We.textBaseline="alphabetic"},_getFontDesc:function(){var t=je.toString()+"px ";return t+=rr,_r&&(t="bold "+t),xr&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===Je?je:Je*je/Ke)},_calculateParagraphLength:function(t,e){for(var r,a=[],i=l(t);!(r=i()).done;){var n=r.value,s=X(e,n,Ge);a.push(s)}return a},_measureText:function(t,e){return function(r){return X(t,r,e)}},_calculateShrinkFont:function(t){if(We){var e=this._calculateParagraphLength(t,We),r=0,a=0,i=0;if(ir){var n=lr.width,s=lr.height;if(n<0||s<0)return;a=s+1;for(var o=0,h=0|je+1,u=0;o<h;){if((u=o+h+1>>1)<=0){f(4003);break}je=u,Ge=this._getFontDesc(),We.font=Ge;var c=this._getLineHeight();for(a=0,r=0;r<t.length;++r){var l=X(We,t[r],Ge);a+=j(t[r],l,n,this._measureText(We,Ge)).length*c}a>s?h=u-1:o=u}0===o?f(4003):(je=o,Ge=this._getFontDesc(),We.font=Ge)}else{for(a=t.length*this._getLineHeight(),r=0;r<t.length;++r)i<e[r]&&(i=e[r]);var d=(Qe.width-ur.width)/i,v=Qe.height/a;je=Ke*Math.min(1,d,v)|0,Ge=this._getFontDesc(),We.font=Ge}}},_calculateWrapText:function(t){if(ir&&We){Ye=[];for(var e=lr.width,r=0;r<t.length;++r){var a=X(We,t[r],Ge),i=j(t[r],a,e,this._measureText(We,Ge));Ye=Ye.concat(i)}}},_calculateLabelFont:function(){if(We){var t=Xe.split("\n");switch(Ye=t,Ge=this._getFontDesc(),We.font=Ge,ar){case ze.NONE:for(var e=0,r=0,a=0;a<t.length;++a){var i=X(We,t[a],Ge);e=e>i?e:i}r=(Ye.length+K)*this._getLineHeight();var n=parseFloat(e.toFixed(2)),s=parseFloat(r.toFixed(2));Qe.width=n+ur.width,Qe.height=s+ur.height,lr.width=n+cr.width,lr.height=s+cr.height;break;case ze.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case ze.CLAMP:this._calculateWrapText(t);break;case ze.RESIZE_HEIGHT:this._calculateWrapText(t);var o=(Ye.length+K)*this._getLineHeight();Qe.height=o+ur.height,lr.height=o+cr.height}}}},Sr=a.WHITE.clone(),Dr={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var r=e.vData=new Float32Array(36);r[3]=r[21]=r[22]=r[31]=0,r[4]=r[12]=r[13]=r[30]=1;for(var i=5,n=0;n<4;n++)a.toArray(r,Sr,i),i+=9;return e},fillBuffers:function(t,e){var r=t.renderData,a=r.data,i=t.node,n=e.acquireBufferBatch(),s=n.byteOffset>>2,o=n.indicesOffset,h=n.vertexOffset;n.request()||(n=e.currBufferBatch,o=0,h=0,s=0);var u=n.vData,c=n.iData,l=r.vData,f=a[0],d=a[3];i.updateWorldTransform();var v=i._pos,p=i._rot,_=i._scale,x=f.x*_.x,g=d.x*_.x,y=f.y*_.y,m=d.y*_.y,S=p.x,D=p.y,w=p.z,T=p.w,C=S*D,B=w*T,M=S*S-D*D,b=T*T-w*w,E=b+M,P=2*(C-B),L=b-M,F=2*(C+B),R=v.x,A=v.y;l[0]=E*x+P*y+R,l[1]=L*y+F*x+A,l[9]=E*g+P*y+R,l[10]=L*y+F*g+A,l[18]=E*x+P*m+R,l[19]=L*m+F*x+A,l[27]=E*g+P*m+R,l[28]=L*m+F*g+A,u.set(l,s),c[o++]=h,c[o++]=h+1,c[o++]=h+2,c[o++]=h+2,c[o++]=h+1,c[o++]=h+3},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=r.width,i=r.height,n=r.anchorX*a,s=r.anchorY*i,o=e.data;o[0].x=-n,o[0].y=-s,o[3].x=a-n,o[3].y=i-s}},updateUvs:function(t){var e=t.renderData;if(e){var r=e.vData;if(r&&e.uvDirty){var a=t.ttfSpriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1}}}};o(Dr,mr);var wr=t("l",{getAssembler:function(t){var e=Dr;return t.font instanceof Q?e=Oe:t.cacheMode===G.CacheMode.CHAR&&(e=ke),e}});G.Assembler=wr;var Tr=J.FillType,Cr=new r,Br=new a(255,255,255,255),Mr={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame;H.packToDynamicAtlas(t,e);var r=t.renderData;if(r&&e){r.updateRenderData(t,e);var a=r.uvDirty,i=r.vertDirty;if(!a&&!i)return;var n=t.fillStart,s=t.fillRange;s<0&&(n+=s,s=-s),s=(s=(s=n+s)>1?1:s)<0?0:s;var o=(n=(n=n>1?1:n)<0?0:n)+(s=(s-=n)<0?0:s);o=o>1?1:o,a&&this.updateUVs(t,n,o),i&&(this.updateVertexData&&this.updateVertexData(t,n,o),this.updateWorldVertexData(t))}},updateUVs:function(t,e,r){var a=t.spriteFrame,i=t.renderData,n=i.data,s=a.width,o=a.height,h=a.getRect(),u=0,c=0,l=0,f=0,v=0,p=0,_=0,x=0,g=0,y=0;switch(a.isRotated()?(u=h.x/s,c=(h.y+h.width)/o,l=v=u,_=g=(h.x+h.height)/s,p=y=c,f=x=h.y/o):(u=h.x/s,c=(h.y+h.height)/o,l=_=u,v=g=(h.x+h.width)/s,f=p=c,x=y=h.y/o),t.fillType){case Tr.HORIZONTAL:n[0].u=l+(v-l)*e,n[0].v=f+(p-f)*e,n[1].u=l+(v-l)*r,n[1].v=f+(p-f)*r,n[2].u=_+(g-_)*e,n[2].v=x+(y-x)*e,n[3].u=_+(g-_)*r,n[3].v=x+(y-x)*r;break;case Tr.VERTICAL:n[0].u=l+(_-l)*e,n[0].v=f+(x-f)*e,n[1].u=v+(g-v)*e,n[1].v=p+(y-p)*e,n[2].u=l+(_-l)*r,n[2].v=f+(x-f)*r,n[3].u=v+(g-v)*r,n[3].v=p+(y-p)*r;break;default:d(2626)}i.uvDirty=!1},updateVertexData:function(t,e,r){var a=t.renderData,i=a.data,n=t.node._uiProps.uiTransformComp,s=n.width,o=n.height,h=n.anchorX*s,u=n.anchorY*o,c=-h,l=-u,f=s-h,v=o-u,p=0;switch(t.fillType){case Tr.HORIZONTAL:p=c+(f-c)*r,c+=(f-c)*e,f=p;break;case Tr.VERTICAL:p=l+(v-l)*r,l+=(v-l)*e,v=p;break;default:d(2626)}i[4].x=c,i[4].y=l,i[5].x=f,i[5].y=l,i[6].x=c,i[6].y=v,i[7].x=f,i[7].y=v,a.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var r,a=e.data,i=l(a);!(r=i()).done;)r.value.z=0;return e},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(Cr);for(var i=0;i<4;i++){var n=a[i+4],s=a[i];e.transformMat4(s,n,Cr)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var r=t.node;Br.set(t.color),Br.a=255*r._uiProps.opacity,function(t,e,r,i){var n=r.data,s=e.acquireBufferBatch(),o=s.byteOffset>>2,h=r.vertexCount,u=s.indicesOffset,c=s.vertexOffset;s.request(h,r.indicesCount)||(s=e.currBufferBatch,o=0,u=0,c=0);for(var l=s.vData,f=0;f<h;f++){var d=n[f];l[o++]=d.x,l[o++]=d.y,l[o++]=d.z,l[o++]=d.u,l[o++]=d.v,a.toArray(l,i,o),o+=4}var v=s.iData;v[u++]=c,v[u++]=c+1,v[u++]=c+2,v[u++]=c+1,v[u++]=c+3,v[u++]=c+2}(0,e,t.renderData,Br)},updateColor:function(){}},br=2*Math.PI,Er=1e-6,Pr=new a(255,255,255,255),Lr=[new s,new s,new s,new s],Fr=new Array(4),Rr=new Array(8),Ar=[new s,new s,new s,new s],Or=[new s,new s,new s,new s],Hr=new s,Ir=[new s,new s,new s,new s];function Nr(t,e,r,a,i,n,s){var o=Math.sin(n);o=Math.abs(o)>Er?o:0;var h=Math.cos(n),u=0,c=0;if(0!==(h=Math.abs(h)>Er?h:0)){if(u=o/h,(t-i.x)*h>0){var l=i.y+u*(t-i.x);s[0].x=t,s[0].y=l}if((e-i.x)*h>0){var f=i.y+u*(e-i.x);s[2].x=e,s[2].y=f}}if(0!==o){if(c=h/o,(a-i.y)*o>0){var d=i.x+c*(a-i.y);s[3].x=d,s[3].y=a}if((r-i.y)*o>0){var v=i.x+c*(r-i.y);s[1].x=v,s[1].y=r}}}function kr(t,e){var r=e.x-t.x,a=e.y-t.y;if(0===r&&0===a)return 0;if(0===r)return a>0?.5*Math.PI:1.5*Math.PI;var i=Math.atan(a/r);return r<0&&(i+=Math.PI),i}function zr(t,e,r,a,i){var n=Fr,s=n[0],o=n[1],h=n[2],u=n[3];t[e].x=r.x,t[e].y=r.y,t[e+1].x=a.x,t[e+1].y=a.y,t[e+2].x=i.x,t[e+2].y=i.y,Ur((r.x-s)/(h-s),(r.y-o)/(u-o),t,e),Ur((a.x-s)/(h-s),(a.y-o)/(u-o),t,e+1),Ur((i.x-s)/(h-s),(i.y-o)/(u-o),t,e+2)}function Ur(t,e,r,a){var i=Rr,n=i[0]+(i[2]-i[0])*t,s=i[4]+(i[6]-i[4])*t,o=i[1]+(i[3]-i[1])*t,h=i[5]+(i[7]-i[5])*t,u=r[a];u.u=n+(s-n)*e,u.v=o+(h-o)*e}for(var Vr={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;H.packToDynamicAtlas(t,e);var r,a,i,n,o,h,u,c,f,d=t.renderData;if(d&&e){if(d.vertDirty||d.uvDirty){var v=d.data,p=t.fillStart,_=t.fillRange;for(_<0&&(p+=_,_=-_);p>=1;)p-=1;for(;p<0;)p+=1;var x=(p*=br)+(_*=br);!function(t){var e=t.node._uiProps.uiTransformComp,r=e.width,a=e.height,i=e.anchorX*r,n=e.anchorY*a,o=-i,h=-n,u=r-i,c=a-n,f=Fr;f[0]=o,f[1]=h,f[2]=u,f[3]=c;var d=t.fillCenter,v=Hr.x=Math.min(Math.max(0,d.x),1)*(u-o)+o,p=Hr.y=Math.min(Math.max(0,d.y),1)*(c-h)+h;Lr[0].x=Lr[3].x=o,Lr[1].x=Lr[2].x=u,Lr[0].y=Lr[1].y=h,Lr[2].y=Lr[3].y=c;for(var _,x=l(Ir);!(_=x()).done;){var g=_.value;s.set(g,0,0)}v!==f[0]&&s.set(Ir[0],3,0),v!==f[2]&&s.set(Ir[2],1,2),p!==f[1]&&s.set(Ir[1],0,1),p!==f[3]&&s.set(Ir[3],2,3)}(t),a=(r=e).width,i=r.height,n=r.getRect(),o=0,h=0,u=0,c=0,f=Rr,r.isRotated()?(o=n.x/a,h=(n.x+n.height)/a,u=n.y/i,c=(n.y+n.width)/i,f[0]=f[2]=o,f[4]=f[6]=h,f[3]=f[7]=c,f[1]=f[5]=u):(o=n.x/a,h=(n.x+n.width)/a,u=n.y/i,c=(n.y+n.height)/i,f[0]=f[4]=o,f[2]=f[6]=h,f[1]=f[3]=c,f[5]=f[7]=u),Nr(Fr[0],Fr[2],Fr[1],Fr[3],Hr,p,Ar),Nr(Fr[0],Fr[2],Fr[1],Fr[3],Hr,p+_,Or);for(var g=0,y=0;y<4;++y){var m=Ir[y];if(m)if(_>=br)d.dataLength=g+3,zr(v,g,Hr,Lr[m.x],Lr[m.y]),g+=3;else{var S=kr(Hr,Lr[m.x]),D=kr(Hr,Lr[m.y]);D<S&&(D+=br),S-=br,D-=br;for(var w=0;w<3;++w)S>=x||(S>=p?(d.dataLength=g+3,zr(v,g,Hr,Lr[m.x],D>=x?Or[y]:Lr[m.y]),g+=3):D>p&&(D<=x?(d.dataLength=g+3,zr(v,g,Hr,Ar[y],Lr[m.y]),g+=3):(d.dataLength=g+3,zr(v,g,Hr,Ar[y],Or[y]),g+=3))),S+=br,D+=br}}d.indicesCount=d.vertexCount=g,d.vertDirty=d.uvDirty=!1}d.updateRenderData(t,e)}},fillBuffers:function(t,r){var i=t.node,n=t.renderData;Pr.set(t.color),Pr.a=255*i._uiProps.opacity,function(t,r,i,n){var s=i.data,o=r.acquireBufferBatch(),h=o.byteOffset>>2,u=i.vertexCount,c=o.indicesOffset,l=o.vertexOffset;o.request(u,i.indicesCount)||(o=r.currBufferBatch,h=0,c=0,l=0);var f=o.vData;t.getWorldMatrix(_t);for(var d=0;d<u;d++){var v=s[d];e.set(pt,v.x,v.y,0),e.transformMat4(pt,pt,_t),f[h++]=pt.x,f[h++]=pt.y,f[h++]=pt.z,f[h++]=v.u,f[h++]=v.v,a.toArray(f,n,h),h+=4}for(var p=o.iData,_=0;_<i.dataLength;_++)p[c+_]=l+_}(i,r,n,Pr)},updateColor:function(){}},Wr=[],Zr=0;Zr<4;Zr++)Wr.push(new e);for(var qr={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame;H.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&(r.vertDirty&&this.updateVertexData(t),r.uvDirty&&this.updateUvs(t),r.updateRenderData(t,e))},updateWorldVerts:function(t,e){var r=t.renderData.data,a=t.node,i=r[0],n=r[3],s=a.worldMatrix,o=s.m00,h=s.m01,u=s.m04,c=s.m05,l=1===o&&0===h&&0===u&&1===c,f=s.m12,d=s.m13,v=i.x,p=n.x,_=i.y,x=n.y;if(l){var g=v+f,y=p+f,m=_+d,S=x+d;e[0]=g,e[1]=m,e[9]=y,e[10]=m,e[18]=g,e[19]=S,e[27]=y,e[28]=S}else{var D=o*v,w=o*p,T=h*v,C=h*p,B=u*_+f,M=u*x+f,b=c*_+d,E=c*x+d;e[0]=D+B,e[1]=T+b,e[9]=w+B,e[10]=C+b,e[18]=D+M,e[19]=T+E,e[27]=w+M,e[28]=C+E}},fillBuffers:function(t,e){if(null!==t){var r=t.renderData.vData;t.node.hasChangedFlags&&this.updateWorldVerts(t,r);var a=e.acquireBufferBatch(),i=a.byteOffset>>2,n=a.indicesOffset,s=a.vertexOffset;a.request()||(a=e.currBufferBatch,i=0,n=0,s=0);var o=a.vData,h=a.iData;o.set(r,i);var u=s,c=s+1,l=s+2,f=s+3;h[n++]=u,h[n++]=c,h[n++]=l,h[n++]=l,h[n++]=c,h[n++]=f}},updateVertexData:function(t){var e=t.renderData;if(e){var r=t.node._uiProps.uiTransformComp,a=e.data,i=r.width,n=r.height,s=r.anchorX*i,o=r.anchorY*n,h=0,u=0,c=0,l=0;if(t.trim)h=-s,u=-o,c=i-s,l=n-o;else{var f=t.spriteFrame,d=f.getOriginalSize(),v=f.getRect(),p=d.width,_=d.height,x=v.width,g=v.height,y=f.getOffset(),m=i/p,S=n/_,D=y.x+(p-x)/2,w=y.x-(p-x)/2;h=D*m-s,u=(y.y+(_-g)/2)*S-o,c=i+w*m-s,l=n+(y.y-(_-g)/2)*S-o}a[0].x=h,a[0].y=u,a[3].x=c,a[3].y=l,e.vertDirty=!1,this.updateWorldVerts(t,e.vData)}},updateUvs:function(t){var e=t.renderData,r=e.vData,a=t.spriteFrame.uv;r[3]=a[0],r[4]=a[1],r[12]=a[2],r[13]=a[3],r[21]=a[4],r[22]=a[5],r[30]=a[6],r[31]=a[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,r=5,a=t.color,i=a.r/255,n=a.g/255,s=a.b/255,o=t.node._uiProps.opacity,h=0;h<4;h++)e[r]=i,e[r+1]=n,e[r+2]=s,e[r+3]=o,r+=9}},Gr=new e,Xr=new r,jr={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame;H.packToDynamicAtlas(t,e);var r=t.renderData;r&&e&&(r.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t)),r.updateRenderData(t,e))},updateVertexData:function(t){var e=t.renderData,r=e.data,a=t.node._uiProps.uiTransformComp,i=a.width,n=a.height,s=a.anchorX*i,o=a.anchorY*n,h=t.spriteFrame,u=h.insetLeft,c=h.insetRight,l=h.insetTop,f=h.insetBottom,d=i-u-c,v=n-l-f,p=i/(u+c),_=n/(l+f);p=Number.isNaN(p)||p>1?1:p,_=Number.isNaN(_)||_>1?1:_,d=d<0?0:d,v=v<0?0:v,r[0].x=-s,r[0].y=-o,r[1].x=u*p-s,r[1].y=f*_-o,r[2].x=r[1].x+d,r[2].y=r[1].y+v,r[3].x=i-s,r[3].y=n-o,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var r=e.acquireBufferBatch(),i=t.renderData,n=i.data,s=r.byteOffset>>2,o=i.vertexCount,h=r.indicesOffset,u=r.vertexOffset,c=t.spriteFrame.uvSliced;r.request(o,i.indicesCount)||(r=e.currBufferBatch,s=0,h=0,u=0);for(var l=r.vData,f=r.iData,d=4;d<20;++d){var v=n[d],p=c[d-4];l[s++]=v.x,l[s++]=v.y,l[s++]=v.z,l[s++]=p.u,l[s++]=p.v,a.toArray(l,n[d].color,s),s+=4}for(var _=0;_<3;++_)for(var x=0;x<3;++x){var g=u+4*_+x;f[h++]=g,f[h++]=g+1,f[h++]=g+4,f[h++]=g+1,f[h++]=g+5,f[h++]=g+4}},updateWorldVertexData:function(t){var r=t.node,a=t.renderData.data;r.getWorldMatrix(Xr);for(var i=0;i<4;++i)for(var n=a[i],s=0;s<4;++s){var o=a[s],h=a[4+4*i+s];e.set(Gr,o.x,n.y,0),e.transformMat4(h,Gr,Xr)}},updateColor:function(t){for(var e=t.renderData.data,r=t.color,a=r.r,i=r.g,n=r.b,s=255*t.node._uiProps.opacity,o=4;o<20;o++)e[o].color.r=a,e[o].color.g=i,e[o].color.b=n,e[o].color.a=s}},Kr=[],Yr=0;Yr<4;Yr++)Kr.push(new e);var Qr={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,r=t.spriteFrame;if(r&&e&&(e.updateRenderData(t,r),e.uvDirty||e.vertDirty)){var a=t.node._uiProps.uiTransformComp,i=Math.abs(a.width),n=Math.abs(a.height),s=r.getRect(),o=r.insetLeft,h=r.insetRight,u=s.width-o-h,c=r.insetTop,l=r.insetBottom,f=s.height-c-l,d=i-o-h,v=n-c-l;d=d>0?d:0,v=v>0?v:0;var p=0===u?d:d/u,_=0===f?v:v/f,x=Math.ceil(_+2),g=Math.ceil(p+2);e.dataLength=Math.max(8,x+1,g+1),this.updateVerts(t,d,v,x,g),e.vertexCount=x*g*4,e.indicesCount=x*g*6,e.uvDirty=!1,e.vertDirty=!1,this.updateColor(t)}},fillBuffers:function(t,e){var r=t.node,i=t.node._uiProps.uiTransformComp,n=Math.abs(i.width),s=Math.abs(i.height),o=t.renderData,h=e.acquireBufferBatch(),u=h.indicesOffset,c=h.byteOffset>>2,l=h.vertexOffset,f=o.vertexCount,d=o.indicesCount,v=h.vData,p=h.iData;h.request(f,d)||(h=e.currBufferBatch,c=0,u=0,l=0);var _=t.spriteFrame,x=_.isRotated(),g=_.uv,y=t.spriteFrame.uvSliced,m=_.getRect(),S=_.insetLeft,D=_.insetRight,w=m.width-S-D,T=_.insetTop,C=_.insetBottom,B=m.height-T-C,M=n-S-D,b=s-T-C;M=M>0?M:0,b=b>0?b:0;var E=0===w?M:M/w,P=0===B?b:b/B,L=Math.ceil(P+2),F=Math.ceil(E+2),R=r.worldMatrix,A=o.data;this.fillVertices(v,c,R,L,F,A);for(var O=0,H=0,I=[],N=[],k=0,z=L;k<z;++k){H=b>B?b>=k*B?1:P%1:P;for(var U=0,V=F;U<V;++U){O=M>w?M>=U*w?1:E%1:E;var W=c+3,Z=W+1;x?(0===k?(I[0]=y[0].u,I[1]=y[0].u,I[2]=y[4].u+(y[8].u-y[4].u)*H):k<L-1?(I[0]=y[4].u,I[1]=y[4].u,I[2]=y[4].u+(y[8].u-y[4].u)*H):k===L-1&&(I[0]=y[8].u,I[1]=y[8].u,I[2]=y[12].u),0===U?(N[0]=y[0].v,N[1]=y[1].v+(y[2].v-y[1].v)*O,N[2]=y[0].v):U<F-1?(N[0]=y[1].v,N[1]=y[1].v+(y[2].v-y[1].v)*O,N[2]=y[1].v):U===F-1&&(N[0]=y[2].v,N[1]=y[3].v,N[2]=y[2].v),I[3]=I[2],N[3]=N[1]):(0===U?(I[0]=y[0].u,I[1]=y[1].u+(y[2].u-y[1].u)*O,I[2]=g[0]):U<F-1?(I[0]=y[1].u,I[1]=y[1].u+(y[2].u-y[1].u)*O,I[2]=y[1].u):U===F-1&&(I[0]=y[2].u,I[1]=y[3].u,I[2]=y[2].u),0===k?(N[0]=y[0].v,N[1]=y[0].v,N[2]=y[4].v+(y[8].v-y[4].v)*H):k<L-1?(N[0]=y[4].v,N[1]=y[4].v,N[2]=y[4].v+(y[8].v-y[4].v)*H):k===L-1&&(N[0]=y[8].v,N[1]=y[8].v,N[2]=y[12].v),I[3]=I[1],N[3]=N[2]),v[W]=I[0],v[Z]=N[0],v[W+9]=I[1],v[Z+9]=N[1],v[W+18]=I[2],v[Z+18]=N[2],v[W+27]=I[3],v[Z+27]=N[3],a.toArray(v,A[0].color,Z+1),a.toArray(v,A[0].color,Z+9+1),a.toArray(v,A[0].color,Z+18+1),a.toArray(v,A[0].color,Z+27+1),c+=36}}for(var q=0;q<d;q+=6)p[u++]=l,p[u++]=l+1,p[u++]=l+2,p[u++]=l+1,p[u++]=l+3,p[u++]=l+2,l+=4},fillVertices:function(t,r,a,i,n,s){for(var o=0,h=0,u=0,c=0,l=0,f=i;l<f;++l){u=s[l].y,c=s[l+1].y;for(var d=0,v=n;d<v;++d){o=s[d].x,h=s[d+1].x,e.set(Kr[0],o,u,0),e.set(Kr[1],h,u,0),e.set(Kr[2],o,c,0),e.set(Kr[3],h,c,0);for(var p=0;p<4;p++){var _=Kr[p];e.transformMat4(_,_,a);var x=9*p;t[r+x]=_.x,t[r+x+1]=_.y,t[r+x+2]=_.z}r+=36}}},updateVerts:function(t,e,r,a,i){var n,s,o=t.node._uiProps.uiTransformComp,h=t.renderData.data,u=t.spriteFrame,c=u.getRect(),l=Math.abs(o.width),f=Math.abs(o.height),d=o.anchorX*l,v=o.anchorY*f,p=u.insetLeft,_=u.insetRight,x=c.width-p-_,g=u.insetTop,y=u.insetBottom,m=c.height-g-y,S=o.width/(p+_)>1?1:o.width/(p+_),D=o.height/(g+y)>1?1:o.height/(g+y);n=x>0?Math.floor(1e3*e)/1e3%x==0?x:e%x:e,s=m>0?Math.floor(1e3*r)/1e3%m==0?m:r%m:r;for(var w=0;w<=i;w++)0===w?h[w].x=-d:w>0&&w<i?h[w].x=1===w?p*S+Math.min(x,e)-d:x>0?w===i-1?p+n+x*(w-2)-d:p+Math.min(x,e)+x*(w-2)-d:p+e-d:w===i&&(h[w].x=Math.min(p+e+_,l)-d);for(var T=0;T<=a;T++)0===T?h[T].y=-v:T>0&&T<a?h[T].y=1===T?y*D+Math.min(m,r)-v:m>0?T===a-1?y+s+(T-2)*m-v:y+Math.min(m,r)+(T-2)*m-v:y+r-v:T===a&&(h[T].y=Math.min(y+r+g,f)-v)},updateColor:function(t){var e=t.renderData.data,r=e.length;if(0!==r)for(var a=t.color,i=a.r,n=a.g,s=a.b,o=255*t.node._uiProps.opacity,h=0;h<r;h++)e[h].color.r=i,e[h].color.g=n,e[h].color.b=s,e[h].color.a=o}},Jr=J.Type,$r=J.FillType,ta=t("s",{getAssembler:function(t){var e=qr,r=t;switch(r.type){case Jr.SLICED:e=jr;break;case Jr.TILED:e=Qr;break;case Jr.FILLED:e=r.fillType===$r.RADIAL?Vr:Mr}return e}});J.Assembler=ta;var ea=tt.sharedManager,ra={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===ft.IMAGE_STENCIL&&(qr.updateRenderData(t),qr.updateColor(t))},fillBuffers:function(t,e){(t.type!==ft.IMAGE_STENCIL||t.spriteFrame)&&(ea.pushMask(t),e.finishMergeBatches(),function(t,e){ea.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(ea.enterLevel(t),t.type===ft.IMAGE_STENCIL){qr.fillBuffers(t,e);var r=t.graphics.getMaterialInstance(0);e.forceMergeBatches(r,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),ea.enableMask())}},aa={fillBuffers:function(){ea.exitMask()}},ia={getAssembler:function(){return ra}},na={getAssembler:function(){return aa}};lt.Assembler=ia,lt.PostAssembler=na,new(function(){function t(){this._isListDirty=!1,this._inDispatchCount=0,this._pointerEventProcessorList=[],this._processorListToAdd=[],this._processorListToRemove=[],v.on(p.EventType.MOUSE_DOWN,this.dispatchEventMouse,this),v.on(p.EventType.MOUSE_MOVE,this.dispatchEventMouse,this),v.on(p.EventType.MOUSE_UP,this.dispatchEventMouse,this),v.on(p.EventType.MOUSE_WHEEL,this.dispatchEventMouse,this),v.on(p.EventType.TOUCH_START,this.dispatchEventTouch,this),v.on(p.EventType.TOUCH_MOVE,this.dispatchEventTouch,this),v.on(p.EventType.TOUCH_END,this.dispatchEventTouch,this),v.on(p.EventType.TOUCH_CANCEL,this.dispatchEventTouch,this),_.callbacksInvoker.on(x.ADD_POINTER_EVENT_PROCESSOR,this.addPointerEventProcessor,this),_.callbacksInvoker.on(x.REMOVE_POINTER_EVENT_PROCESSOR,this.removePointerEventProcessor,this)}var e=t.prototype;return e.addPointerEventProcessor=function(t){0===this._inDispatchCount?(this._pointerEventProcessorList.push(t),this._isListDirty=!0):this._processorListToAdd.push(t)},e.removePointerEventProcessor=function(t){0===this._inDispatchCount?(g.array.remove(this._pointerEventProcessorList,t),this._isListDirty=!0):this._processorListToRemove.push(t)},e.dispatchEventMouse=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,r=e.length,a=!0,i=0;i<r;++i){var n=e[i];if(n.isEnabled&&n.shouldHandleEventMouse&&n._handleEventMouse(t)&&(a=!1,!t.preventSwallow))break}var s=y[t.type];a&&s&&v._eventTarget.emit(s,t),--this._inDispatchCount<=0&&this._updatePointerEventProcessorList()},e.dispatchEventTouch=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,r=e.length,a=t.touch,i=!0,n=0;n<r;++n){var s=e[n];if(s.isEnabled&&s.shouldHandleEventTouch)if(t.type===m.TOUCH_START){if(s._handleEventTouch(t)&&(s.claimedTouchIdList.push(a.getID()),i=!1,!t.preventSwallow))break}else if(s.claimedTouchIdList.length>0){var o=s.claimedTouchIdList.indexOf(a.getID());if(-1!==o&&(s._handleEventTouch(t),t.type!==m.TOUCH_END&&t.type!==m.TOUCH_CANCEL||g.array.removeAt(s.claimedTouchIdList,o),i=!1,!t.preventSwallow))break}}var h=y[t.type];i&&h&&v._eventTarget.emit(h,t.touch,t),--this._inDispatchCount<=0&&this._updatePointerEventProcessorList()},e._updatePointerEventProcessorList=function(){for(var t=this._processorListToAdd,e=t.length,r=0;r<e;++r)this.addPointerEventProcessor(t[r]);t.length=0;for(var a=this._processorListToRemove,i=a.length,n=0;n<i;++n)this.removePointerEventProcessor(a[n]);a.length=0},e._sortPointerEventProcessorList=function(){if(this._isListDirty){for(var t=this._pointerEventProcessorList,e=t.length,r=0;r<e;++r){var a=t[r],i=a.node._uiProps.uiTransformComp;a.cachedCameraPriority=i.cameraPriority}t.sort(this._sortByPriority),this._isListDirty=!1}},e._sortByPriority=function(t,e){var r=t.node,a=e.node;if(!(e&&a&&a.activeInHierarchy&&a._uiProps.uiTransformComp))return-1;if(!(t&&r&&r.activeInHierarchy&&r._uiProps.uiTransformComp))return 1;if(t.cachedCameraPriority!==e.cachedCameraPriority)return e.cachedCameraPriority-t.cachedCameraPriority;for(var i=r,n=a,s=!1;(null===(o=i.parent)||void 0===o?void 0:o._id)!==(null===(h=n.parent)||void 0===h?void 0:h._id);){var o,h,u,c,l,f;i=null===(null===(u=i)||void 0===u||null===(c=u.parent)||void 0===c?void 0:c.parent)?(s=!0)&&a:i&&i.parent,n=null===(null===(l=n)||void 0===l||null===(f=l.parent)||void 0===f?void 0:f.parent)?(s=!0)&&r:n&&n.parent}if(i._id===n._id){if(i._id===a._id)return-1;if(i._id===r._id)return 1}var d=i?i.getSiblingIndex():0,v=n?n.getSiblingIndex():0;return s?d-v:v-d},t}());var sa=new C(null),oa=new r,ha=t("B",function(){var t=e.prototype;function e(t){var e=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new B((function(){return new dt(e)}),128,(function(t){return t.destroy()})),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._emptyMaterial=new M,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currHash=0,this._descriptorSetCache=new ca,this._root=t,this.device=t.device,this._batches=new b(64),this._drawBatchPool=new E((function(){return new vt}),128,(function(t){return t.destroy(e)}))}return t.acquireBufferBatch=function(t){void 0===t&&(t=ot);var e=t===ot?36:ht(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},t.registerCustomBuffer=function(t,e){var r;t instanceof dt?r=t:(r=this._bufferBatchPool.add()).initialize(t,e||this._recreateMeshBuffer.bind(this,t));var a=r.vertexFormatBytes,i=this._customMeshBuffers.get(a);return i||(i=[],this._customMeshBuffers.set(a,i)),i.push(r),r},t.unRegisterCustomBuffer=function(t){var e=this._customMeshBuffers.get(t.vertexFormatBytes);if(e)for(var r=0;r<e.length;r++)if(e[r]===t){e.splice(r,1);break}var a=this._bufferBatchPool.data.indexOf(t);-1!==a&&(t.reset(),this._bufferBatchPool.removeAt(a))},t.initialize=function(){return!0},t.destroy=function(){for(var t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy();for(var e,r=l(this._meshBuffers.keys());!(e=r()).done;){var a=e.value,i=this._meshBuffers.get(a);i&&i.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy(),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),tt.sharedManager.destroy()},t.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},t.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,r=0;r<e.length;r++){var a=e[r];if(a.visibility&t.layer)return a}return null},t.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var r=t[e];r.enabledInHierarchy&&this._recursiveScreenNode(r.node)}var a=0;if(this._batches.length)for(var i=0;i<this._batches.length;++i){var n=this._batches.array[i];if(n.renderScene){if(n.model)for(var s=n.model.subModels,o=0;o<s.length;o++)s[o].priority=a++;else n.descriptorSet=this._descriptorSetCache.getDescriptorSet(n);n.renderScene.addBatch(n)}}},t.uploadBuffers=function(){this._batches.length>0&&(this._meshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._customMeshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._descriptorSetCache.update())},t.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._currHash=0,this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._meshBufferUseCount.clear(),this._batches.clear(),tt.sharedManager.reset(),this._descriptorSetCache.reset()},t.commitComp=function(t,e,r,a){var i,n=t,s=t.renderData,o=0;s&&(o=s.dataHash,i=s.material),n.stencilStage=tt.sharedManager.stage;var h=n.stencilStage;if(this._currHash!==o||0===o||this._currMaterial!==i||this._currDepthStencilStateStage!==h)if(this.autoMergeBatches(this._currComponent),s){this._currHash=s.dataHash,this._currScene=s.renderScene,this._currComponent=n,this._currTransform=a,this._currMaterial=s.material,this._currBlendTargetHash=s.blendHash,this._currDepthStencilStateStage=h,this._currLayer=s.layer;var u=s.frame;u?(this._currTexture=u.getGFXTexture(),this._currSampler=u.getGFXSampler(),this._currTextureHash=s.textureHash,this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)}else this._currHash=o,this._currScene=n._getRenderScene(),this._currComponent=n,this._currTransform=a,this._currMaterial=n.getRenderMaterial(0),this._currBlendTargetHash=n.blendHash,this._currDepthStencilStateStage=h,this._currLayer=n.node.layer,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0);r&&r.fillBuffers(n,this)},t.commitModel=function(t,e,r){var a;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var i=0;r&&(t.stencilStage!==et.ENABLED&&t.stencilStage!==et.DISABLED||(t.stencilStage=tt.sharedManager.stage),a=tt.sharedManager.getStencilStage(t.stencilStage,r),i=tt.sharedManager.getStencilHash(t.stencilStage));var n=c.director.getTotalFrames();e&&(e.updateTransform(n),e.updateUBOs(n));for(var s=0;s<e.subModels.length;s++){var o=this._drawBatchPool.alloc(),h=e.subModels[s];o.renderScene=t._getRenderScene(),o.visFlags=t.node.layer,o.model=e,o.bufferBatch=null,o.texture=null,o.sampler=null,o.useLocalData=null,a||(a=null),o.fillPasses(r,a,i,null,0,h.patches,this),o.inputAssembler=h.inputAssembler,o.model.visFlags=o.visFlags,o.descriptorSet=h.descriptorSet,this._batches.push(o)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currLayer=0},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,r=null==e?void 0:e.recordBatch(),a=this._currMaterial;if(r&&a&&e){var i,n,s=0,o=0;t&&(i=-1===t.blendHash?null:t.getBlendState(),o=t.blendHash,n=null!==t.customMaterial?tt.sharedManager.getStencilStage(t.stencilStage,a):tt.sharedManager.getStencilStage(t.stencilStage),s=tt.sharedManager.getStencilHash(t.stencilStage));var h=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();h.renderScene=this._currScene,h.visFlags=this._currLayer,h.bufferBatch=e,h.texture=this._currTexture,h.sampler=this._currSampler,h.inputAssembler=r,h.useLocalData=this._currTransform,h.textureHash=this._currTextureHash,h.samplerHash=this._currSamplerHash,h.fillPasses(this._currMaterial,n,s,i,o,null,this),this._batches.push(h),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,S.__isWebIOS14OrIPadOS14Env&&!this._currIsStatic&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,r){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=r.node.layer,this._currScene=r._getRenderScene(),this.autoMergeBatches(r)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.flushMaterial=function(t){this._currMaterial=t},t.walk=function(t,e){void 0===e&&(e=0);var r=t.children.length;if(this._preProcess(t),r>0&&!t._static)for(var a=t.children,i=0;i<a.length;++i){var n=a[i];this.walk(n,e)}this._postProcess(t),e+=1},t._preProcess=function(t){if(t._uiProps.opacityDirty){var e,r=1;if(null===(e=t.parent)||void 0===e?void 0:e._uiProps){r=t.parent._uiProps.opacity;var a=t._uiProps.uiComp;a&&a.markColorDirty&&(r*=a.color.a/255,a.markColorDirty())}t._uiProps.opacityDirty=!1,t._uiProps.applyOpacity(r)}var i=t._uiProps.uiComp;t._uiProps.uiTransformComp&&i&&i.enabledInHierarchy&&i.updateAssembler(this)},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._recreateMeshBuffer.bind(this,t));var r=ht(t),a=this._meshBuffers.get(r);return a||(a=[],this._meshBuffers.set(r,a)),a.push(e),e},t._recreateMeshBuffer=function(t,e,r){this.autoMergeBatches(),this._requireBufferBatch(t,e,r)},t._requireBufferBatch=function(t,e,r){var a=ht(t),i=this._meshBuffers.get(a);i||(i=[],this._meshBuffers.set(a,i));var n=this._meshBufferUseCount.get(a)||0;(e&&r||S.__isWebIOS14OrIPadOS14Env)&&n++,this._currMeshBuffer=i[n],this._currMeshBuffer||(this._currMeshBuffer=this._createMeshBuffer(t)),this._meshBufferUseCount.set(a,n),e&&r&&this._currMeshBuffer.request(e,r)},t._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},t._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},D(e,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),e}()),ua=function(){function t(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=c.director.root.device;this._localData=new Float32Array(w.COUNT),this._localBuffer=t.createBuffer(new P(L.UNIFORM|L.TRANSFER_DST,F.HOST|F.DEVICE,w.SIZE,w.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=c.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,sa.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(sa),this._descriptorSet.bindBuffer(w.BINDING,this._localBuffer);var r=T.SAMPLER_SPRITE;this._descriptorSet.bindTexture(r,t.texture),this._descriptorSet.bindSampler(r,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.updateLocal=function(){this._transform&&this.uploadLocalData()},e.equals=function(t,e,r){return this._transform===t&&this._textureHash===e&&this._samplerHash===r},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&t.updateWorldTransform(),this._transformUpdate){var e=t._mat;r.toArray(this._localData,e,w.MAT_WORLD_OFFSET),r.inverseTranspose(oa,e);var a=r.determinant(oa),i=1/Math.sqrt(a);r.multiplyScalar(oa,oa,i),r.toArray(this._localData,oa,w.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},D(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t}(),ca=function(){function t(){this._descriptorSetCache=new Map,this._dsCacheHashByTexture=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new E((function(){return new ua}),16,(function(t){return t.destroy()}))}var e=t.prototype;return e.getDescriptorSet=function(t){var e,r=c.director.root;if(t.useLocalData){for(var a=this._localDescriptorSetCache,i=0,n=a.length;i<n;i++){var s=a[i];if(s.equals(t.useLocalData,t.textureHash,t.samplerHash))return s.descriptorSet}var o=this._localCachePool.alloc();return o.initialize(t),this._localDescriptorSetCache.push(o),o.descriptorSet}if(e=t.textureHash^t.samplerHash,this._descriptorSetCache.has(e))return this._descriptorSetCache.get(e);sa.layout=t.passes[0].localSetLayout;var h=r.device.createDescriptorSet(sa),u=T.SAMPLER_SPRITE;return h.bindTexture(u,t.texture),h.bindSampler(u,t.sampler),h.update(),this._descriptorSetCache.set(e,h),this._dsCacheHashByTexture.set(t.textureHash,e),h},e.update=function(){this._localDescriptorSetCache.forEach((function(t){t.updateLocal()}))},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){var e=this._dsCacheHashByTexture.get(t);e&&this._descriptorSetCache.has(e)&&(this._descriptorSetCache.get(e).destroy(),this._descriptorSetCache.delete(e),this._dsCacheHashByTexture.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.destroy()})),this._descriptorSetCache.clear(),this._dsCacheHashByTexture.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy()},t}();c.internal.Batcher2D=ha;var la,fa=null,da=-1,va="BES bswy:->@123",pa=Object.create(null),_a=[],xa=3e3;function ga(){for(var t=!0,e=Date.now(),r=_a.length-1;r>=0;r--){var a=_a[r],i=a.fontFamilyName;if(e-a.startTime>xa)R(4933,i),a.onComplete(null,i),_a.splice(r,1);else{var n=a.refWidth,s="40px "+i;fa.font=s,n!==X(fa,va,s)?(_a.splice(r,1),a.onComplete(null,i)):t=!1}}t&&(clearInterval(da),da=-1)}function ya(t,e,r){var a=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var r,a=t.lastIndexOf("/");return-1!==(r=-1===a?t.substring(0,e)+"_LABEL":t.substring(a+1,e)+"_LABEL").indexOf(" ")&&(r='"'+r+'"'),r}(t);if(pa[a])r(null,a);else{if(!fa){var i=document.createElement("canvas");i.width=100,i.height=100,fa=i.getContext("2d")}var n=X(fa,va,"40px "+a),s=document.createElement("style");s.type="text/css";var o="";Number.isNaN(a)?o+="@font-face { font-family:"+a+"; src:":o+='@font-face { font-family:"'+a+'"; src:',o+='url("'+t+'");',s.textContent=o+"}",document.body.appendChild(s);var h,u,c,l,f,d,v=document.createElement("div"),p=v.style;if(p.fontFamily=a,v.innerHTML=".",p.position="absolute",p.left="-100px",p.top="-100px",document.body.appendChild(v),function(){if(void 0===la)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);la=t?parseInt(t[1],10)>42:!e}else la=!1;return la}())h=Date.now(),u=a,c=r,l=new Promise((function(t,e){!function r(){Date.now()-h>=xa?e():document.fonts.load("40px "+u).then((function(e){e.length>=1?t():setTimeout(r,100)}),(function(){e()}))}()})),f=null,d=new Promise((function(t,e){f=setTimeout(e,xa)})),Promise.race([d,l]).then((function(){f&&(clearTimeout(f),f=null),c(null,u)}),(function(){R(4933,u),c(null,u)}));else{var _={fontFamilyName:a,refWidth:n,onComplete:r,startTime:Date.now()};_a.push(_),-1===da&&(da=setInterval(ga,100))}pa[a]=s}}function ma(t,e,r,a){var i=new $;i._nativeUrl=t,i._nativeAsset=e,a(null,i)}A.register({".font":ya,".eot":ya,".ttf":ya,".woff":ya,".svg":ya,".ttc":ya}),O.register({".font":ma,".eot":ma,".ttf":ma,".woff":ma,".svg":ma,".ttc":ma}),c.UI={MeshBuffer:dt,spriteAssembler:ta,graphicsAssembler:ee,labelAssembler:wr}}}}));

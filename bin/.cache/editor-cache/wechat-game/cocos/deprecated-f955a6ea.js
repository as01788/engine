System.register(["./json-asset-7bb011fd.js","./index-07e0e256.js","./spot-light-44c8b89f.js","./texture-buffer-pool-2b0fe4d4.js","./deprecated-229f0693.js","./renderable-component-0ffd84e0.js","./sprite-frame-ace45b09.js","./sprite-57cea86a.js","./renderable-2d-0c3bee97.js","./graphics-74958146.js","./vertex-format-25c59854.js","./deprecated-7a0f85e1.js"],(function(t){"use strict";var e,i,n,s,r,o,a,h,l,c,u,p,f,_,d,y,g,m,b,v,C,S,x,D,A,T,O,E,I,w,L,R,B,F,M,k,P,z,H,W,j,U,N,G,V,X,Y,q,Q,Z,J,$,K,tt,et,it,nt,st,rt,ot,at,ht,lt,ct,ut,pt,ft,_t,dt,yt,gt,mt,bt,vt;return{setters:[function(t){e=t.cb,i=t.c2,n=t.cJ,s=t.eq,r=t.ev,o=t.ew,a=t.cZ,h=t.ci,l=t.c4,c=t.dQ,u=t.l,p=t.au,f=t.z,_=t.G,d=t.dg,y=t.a4,g=t.ej,m=t.er,b=t.gw,v=t.gF,C=t.gU,S=t.fV,x=t.gg,D=t.fW,A=t.eu,T=t.fS,O=t.gG,E=t.gx,I=t.es,w=t.ey,L=t.cn,R=t.et,B=t.t,F=t.fT,M=t.gR,k=t.dO,P=t.gO,z=t.gS,H=t.dH,W=t.d,j=t.gP,U=t.gi,N=t.aN,G=t.gV,V=t.dJ,X=t.bR,Y=t.ez,q=t.gW,Q=t.fj},function(t){Z=t.d},function(t){J=t.o,$=t.i},function(){},function(){},function(){},function(t){K=t.S},function(t){tt=t.c,et=t.H,it=t.F,nt=t.b,st=t.S,t.T,rt=t.a,ot=t.f,at=t.d,ht=t.i,lt=t.e,ct=t.V},function(t){ut=t.a,pt=t.R,ft=t.I,_t=t.U},function(t){dt=t.G},function(t){yt=t.g,gt=t.a,mt=t.b,bt=t.c},function(t){vt=t.U}],execute:function(){var Ct,St,xt,Dt,At,Tt,Ot,Et,It,wt,Lt,Rt,Bt,Ft,Mt,kt,Pt,zt,Ht,Wt,jt,Ut,Nt,Gt,Vt;t("e",void 0);var Xt,Yt=new e,qt=new i,Qt=new e,Zt=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(Xt||(Xt=t("e",{}))),n(Xt);var Jt=t("a",(Ct=s("cc.Mask"),St=S(),xt=x(110),Dt=D(),At=r(Xt),Tt=A(),Ot=T(),Et=A(),It=T(),wt=O(),Lt=r(K),Rt=O(),Bt=O(),Ft=E(),Mt=O(),kt=O(),Ct(Pt=St(Pt=xt(Pt=Dt((Vt=Gt=function(t){function n(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,I(e,"_type",Ht,w(e)),I(e,"_inverted",Wt,w(e)),I(e,"_segments",jt,w(e)),I(e,"_spriteFrame",Ut,w(e)),I(e,"_alphaThreshold",Nt,w(e)),e._graphics=null,e._clearModelMesh=null,e._instanceMaterialType=ft.ADD_COLOR,e}o(n,t);var s=n.prototype;return s.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},s.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics(),this._enableGraphics()},s.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},s.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},s.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearModel&&this._clearModelMesh&&(Z.root.destroyModel(this._clearModel),this._clearModelMesh.destroy()),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},s.isHit=function(t){var n=this.node._uiProps.uiTransformComp,s=n.contentSize,r=s.width,o=s.height,a=qt;this.node.getWorldMatrix(Yt),e.invert(Qt,Yt),i.transformMat4(a,t,Qt);var h=n.anchorPoint;a.x+=h.x*r,a.y+=h.y*o;var l=!1;if(this.type===Xt.RECT||this.type===Xt.GRAPHICS_STENCIL)l=a.x>=0&&a.y>=0&&a.x<=r&&a.y<=o;else if(this.type===Xt.ELLIPSE){var c=r/2,u=o/2,p=a.x-.5*r,f=a.y-.5*o;l=p*p/(c*c)+f*f/(u*u)<1}return this._inverted&&(l=!l),l},s._render=function(t){t.commitComp(this,null,this._assembler,null)},s._postRender=function(t){this._postAssembler&&t.commitComp(this,null,this._postAssembler,null)},s._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},s._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==Xt.IMAGE_STENCIL||null!==this._spriteFrame)},s._flushAssembler=function(){var t=n.Assembler.getAssembler(this),e=n.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==e&&(this._postAssembler=e),this._useRenderData()},s._createGraphics=function(){if(!this._graphics){var t=this._graphics=new dt;t._objFlags|=a.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=h.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},s._updateGraphics=function(){if(this._graphics&&(this._type===Xt.RECT||this._type===Xt.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,n=i.width,s=i.height,r=t.anchorPoint,o=-n*r.x,a=-s*r.y;if(this._type===Xt.RECT)e.rect(o,a,n,s);else if(this._type===Xt.ELLIPSE){for(var h=function(t,e,i){Zt.length=0;for(var n=2*Math.PI/i,s=0;s<i;++s)Zt.push(new l(e.x*Math.cos(n*s)+t.x,e.y*Math.sin(n*s)+t.y,0));return Zt}(new l(o+n/2,a+s/2,0),new l(n/2,s/2,0),this._segments),c=0;c<h.length;++c){var u=h[c];0===c?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},s._createClearModel=function(){if(!this._clearModel){var t=c.get("default-clear-stencil");this._clearStencilMtl=new J({parent:t,owner:this,subModelIdx:0}),this._clearModel=Z.root.createModel($),this._clearModel.node=this._clearModel.transform=this.node;var e=yt(gt),i=u.director.root.device,n=i.createBuffer(new p(f.VERTEX|f.TRANSFER_DST,_.DEVICE,4*e,e)),s=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);n.update(s);var r=i.createBuffer(new p(f.INDEX|f.TRANSFER_DST,_.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new Uint16Array([0,1,2,2,1,3]);r.update(o),this._clearModelMesh=new d([n],gt,y.TRIANGLE_LIST,r),this._clearModelMesh.subMeshIdx=0,this._clearModel.initSubModel(0,this._clearModelMesh,this._clearStencilMtl)}},s._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=ut.DISABLED,this._type===Xt.IMAGE_STENCIL?(t=c.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=c.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},s._enableGraphics=function(){this._graphics&&(this._graphics._renderFlag=this._graphics._canRender())},s._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},s._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},s._useRenderData=function(){this._type!==Xt.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},g(n,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==Xt.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.stencilStage=ut.DISABLED,this._graphics&&(this._graphics.stencilStage=ut.DISABLED)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=L(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===Xt.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===Xt.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),n}(pt),Gt.Type=Xt,m((zt=Vt).prototype,"type",[At,Tt,Ot],Object.getOwnPropertyDescriptor(zt.prototype,"type"),zt.prototype),m(zt.prototype,"inverted",[Et,It],Object.getOwnPropertyDescriptor(zt.prototype,"inverted"),zt.prototype),m(zt.prototype,"segments",[wt],Object.getOwnPropertyDescriptor(zt.prototype,"segments"),zt.prototype),m(zt.prototype,"spriteFrame",[Lt,Rt],Object.getOwnPropertyDescriptor(zt.prototype,"spriteFrame"),zt.prototype),m(zt.prototype,"alphaThreshold",[Bt,Ft,b],Object.getOwnPropertyDescriptor(zt.prototype,"alphaThreshold"),zt.prototype),m(zt.prototype,"color",[v,Mt],Object.getOwnPropertyDescriptor(zt.prototype,"color"),zt.prototype),m(zt.prototype,"customMaterial",[v,kt],Object.getOwnPropertyDescriptor(zt.prototype,"customMaterial"),zt.prototype),Ht=m(zt.prototype,"_type",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xt.RECT}}),Wt=m(zt.prototype,"_inverted",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jt=m(zt.prototype,"_segments",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),Ut=m(zt.prototype,"_spriteFrame",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nt=m(zt.prototype,"_alphaThreshold",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Pt=zt))||Pt)||Pt)||Pt)||Pt));C._maskComp=Jt,u.Mask=Jt;var $t,Kt,te,ee,ie,ne,se,re,oe,ae,he,le,ce,ue,pe,fe,_e,de,ye,ge,me,be,ve,Ce,Se,xe,De,Ae,Te,Oe,Ee,Ie,we,Le,Re,Be,Fe,Me,ke,Pe,ze,He,We,je,Ue,Ne,Ge,Ve=/^(click)(\s)*=|(param)(\s)*=/,Xe=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,Ye=t("H",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var n=t.indexOf(">",e),s=-1;if(n>=0&&(s=t.lastIndexOf("<",n))<e-1&&(s=t.indexOf("<",n+1),n=t.indexOf(">",s+1)),s<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var r=t.substring(e,s),o=t.substring(s+1,n);""===o&&(r=t.substring(e,n+1)),this._processResult(r),-1===n?n=s:"/"===t.charAt(s+1)?this._stack.pop():this._addToStack(o),e=n+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),n="",s=0,r="";if(i){if(n=i[0],""===(t=t.substring(n.length).trim()))return e;switch(s=t.indexOf(" "),n[0]){case"c":e.color=s>-1?t.substring(0,s).trim():t;break;case"s":e.size=parseInt(t)}return s>-1&&(r=t.substring(s+1).trim(),e.event=this._processEventHandler(r)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("br")&&"/"===n[n.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="";if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("img")&&"/"===n[n.length-1]){var a;i=Xe.exec(t);for(var h=!1;i;){if(n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),a=(s=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,s):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(s).trim(),a.endsWith("/")&&(a=a.slice(0,-1)),"src"===n){switch(a.charCodeAt(0)){case 34:case 39:h=!0,a=a.slice(1,-1)}e.isImage=!0,e.src=a}else if("height"===n)e.imageHeight=parseInt(a);else if("width"===n)e.imageWidth=parseInt(a);else if("align"===n){switch(a.charCodeAt(0)){case 34:case 39:a=a.slice(1,-1)}e.imageAlign=a.toLowerCase()}else"offset"===n?e.imageOffset=a:"click"===n&&(e.event=this._processEventHandler(n+"="+a));e.event&&"param"===n&&(e.event[n]=a.replace(/^"|"$/g,"")),i=Xe.exec(t)}return h&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var l={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var c,u=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=u.exec(t);i;)n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),c=(s=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,s):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(s).trim(),"click"===n?e.event=this._processEventHandler(n+"="+c):"color"===n?l.color=c:"width"===n&&(l.width=parseInt(c)),e.event&&"param"===n&&(e.event[n]=c.replace(/^"|"$/g,"")),i=u.exec(t)}e.outline=l}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(n=i[0],t=t.substring(n.length).trim(),n[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e={},i=0,n=!1,s=Ve.exec(t);s;){var r=s[0],o="";if(n=!1,'"'===(t=t.substring(r.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else{var a=/(\S)+/.exec(t);i=(o=a?a[0]:"").length}n&&(e[r=r.substring(0,r.length-1).trim()]=o),t=t.substring(i).trim(),s=Ve.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=B(this._specialSymbolArray);!(e=i()).done;){var n=e.value,s=n[0],r=n[1];t=t.replace(s,r)}return t},t}()),qe=t("L",($t=s("cc.LabelOutline"),Kt=S(),te=x(110),ee=D(),ie=M(tt),ne=T(),se=T(),$t(re=Kt(re=te(re=ee(re=ie(re=F((le=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,I(e,"_color",ae,w(e)),I(e,"_width",he,w(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(tt);t&&t.updateRenderData(!0)},g(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(k),ae=m((oe=le).prototype,"_color",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h(0,0,0,255)}}),he=m(oe.prototype,"_width",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),m(oe.prototype,"color",[ne],Object.getOwnPropertyDescriptor(oe.prototype,"color"),oe.prototype),m(oe.prototype,"width",[se],Object.getOwnPropertyDescriptor(oe.prototype,"width"),oe.prototype),re=oe))||re)||re)||re)||re)||re)||re)),Qe=new Ye,Ze="RICHTEXT_CHILD",Je="RICHTEXT_Image_CHILD",$e=new P((function(t){if(!u.isValid(t.node))return!1;var e=t.node.getComponent(qe);return e&&(e.width=0),!0}),20),Ke=new P((function(t){return u.isValid(t.node)}),10);function ti(t){return{node:new H(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function ei(t,e){var i;t===Ze?i=$e._get():t===Je&&(i=Ke._get());var n=(i=i||ti(t)).node;return n||(n=new H(t)),n.hideFlags|=a.Flags.DontSave|a.Flags.HideInHierarchy,t===Je?(i.comp=n.getComponent(rt)||n.addComponent(rt),i.comp.spriteFrame=e,i.comp.type=rt.Type.SLICED,i.comp.sizeMode=rt.SizeMode.CUSTOM):(i.comp=n.getComponent(tt)||n.addComponent(tt),i.comp.string=e,i.comp.horizontalAlign=et.LEFT,i.comp.verticalAlign=ct.TOP),n.setPosition(0,0,0),n._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=n,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var ii,ni=t("R",(ce=s("cc.RichText"),ue=S(),pe=x(110),fe=D(),_e=T(),de=r(et),ye=T(),ge=T(),me=T(),be=r(it),ve=T(),Ce=T(),Se=r(nt),xe=T(),De=T(),Ae=T(),Te=r(st),Oe=T(),Ee=T(),ce(Ie=ue(Ie=pe(Ie=fe(Ie=F((Ge=Ne=function(t){function e(){var e;return e=t.call(this)||this,I(e,"_lineHeight",Le,w(e)),I(e,"_string",Re,w(e)),I(e,"_horizontalAlign",Be,w(e)),I(e,"_fontSize",Fe,w(e)),I(e,"_maxWidth",Me,w(e)),I(e,"_fontFamily",ke,w(e)),I(e,"_font",Pe,w(e)),I(e,"_isSystemFontUsed",ze,w(e)),I(e,"_userDefinedFont",He,w(e)),I(e,"_cacheMode",We,w(e)),I(e,"_imageAtlas",je,w(e)),I(e,"_handleTouchEvent",Ue,w(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}o(e,t);var i=e.prototype;return i.onLoad=function(){this.node.on(z.LAYER_CHANGED,this._applyLayer,this)},i.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},i.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},i.start=function(){this._onTTFLoaded(),this.node.on(z.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i.onRestore=function(){},i.onDestroy=function(){for(var t,e=B(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),i.type===Ze?$e.put(i):i.type===Je&&Ke.put(i)}this.node.off(z.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(z.LAYER_CHANGED,this._applyLayer,this)},i._addEventListeners=function(){this.node.on(z.TOUCH_END,this._onTouchEnded,this)},i._removeEventListeners=function(){this.node.off(z.TOUCH_END,this._onTouchEnded,this)},i._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},i._createFontLabel=function(t){return ei(Ze,t)},i._createImage=function(t){return ei(Je,t)},i._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},i._measureText=function(t,e){var i=this,n=function(e){var n;return 0===i._labelSegmentsCache.length?(n=i._createFontLabel(e),i._labelSegmentsCache.push(n)):(n=i._labelSegmentsCache[0]).node.getComponent(tt).string=e,n.styleIndex=t,i._applyTextAttribute(n),n.node._uiProps.uiTransformComp.contentSize.width};return e?n(e):n},i._onTouchEnded=function(t){for(var e,i=this,n=this.node.getComponents(k),s=function(){var s=e.value,r=s.clickHandler,o=s.clickParam;r&&i._containsTouchLocation(s,t.touch.getUILocation())&&(n.forEach((function(e){var i=e[r];e.enabledInHierarchy&&i&&i.call(e,t,o)})),t.propagationStopped=!0)},r=B(this._segments);!(e=r()).done;)s()},i._containsTouchLocation=function(t,e){var i=t.node.getComponent(_t);return!!i&&i.getBoundingBoxToWorld().contains(e)},i._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if(i.name===Ze||i.name===Je){i.parent===this.node?i.parent=null:t.splice(e,1);var n=ti(i.name);n.node=i,i.name===Ze?(n.comp=i.getComponent(tt),$e.put(n)):(n.comp=i.getComponent(rt),Ke.put(n))}}t.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},i._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];i.name!==Ze&&i.name!==Je||(i.active=t)}},i._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var n=(i=this._labelSegmentsCache.pop()).node.getComponent(tt);n&&(n.string=t)}return i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this.node.addChild(i.node),this._applyTextAttribute(i),this._segments.push(i),i},i._updateRichTextWithMaxWidth=function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this._maxWidth)for(var s=0;this._lineOffsetX<=this._maxWidth;){var r=this._getFirstWordLen(t,s,t.length),o=t.substr(s,r),a=this._measureText(i,o);if(!(this._lineOffsetX+a<=this._maxWidth)){if(s>0){var h=t.substr(0,s);this._addLabelSegment(h,i),t=t.substr(s,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,s+=r}if(n>this._maxWidth)for(var l=ot(t,n,this._maxWidth,this._measureText(i)),c=0;c<l.length;++c){var u=l[c],p=this._addLabelSegment(u,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=p.width,l.length>1&&c<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},i._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},i._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},i._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;var s=i.style,r=n.style;if(s){if(r){if(!!r.outline!=!!s.outline)return!0;if(s.size!==r.size||s.italic!==r.italic||s.isImage!==r.isImage)return!0;if(s.src!==r.src||s.imageAlign!==r.imageAlign||s.imageHeight!==r.imageHeight||s.imageWidth!==r.imageWidth||s.imageOffset!==r.imageOffset)return!0}else if(s.size||s.italic||s.isImage||s.outline)return!0}else if(r&&(r.size||r.italic||r.isImage||r.outline))return!0}return!1},i._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,n=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(n){var s=this._createImage(n);switch(s.comp,e.imageAlign){case"top":s.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":s.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:s.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}e.imageOffset&&(s.imageOffset=e.imageOffset),s.node.layer=this.node.layer,this.node.addChild(s.node),this._segments.push(s);var r=n.rect.clone(),o=1,a=r.width,h=r.height,l=e.imageWidth||0,c=e.imageHeight||0;c>0?(a*=o=c/h,h*=o):(a*=o=this._lineHeight/h,h*=o),l>0&&(a=l),this._maxWidth>0?(this._lineOffsetX+a>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=a):(this._lineOffsetX+=a,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),s.node._uiProps.uiTransformComp.setContentSize(a,h),s.lineCount=this._lineCount,s.clickHandler="",s.clickParam="";var u=e.event;u&&(s.clickHandler=u.click,s.clickParam=u.param)}else W(4400)}},i._updateRichText=function(){if(this.enabledInHierarchy){var t=Qe.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var s=this._textArray[n],r=s.text;if(void 0!==r){if(""===r){if(s.style&&s.style.isNewLine){this._updateLineInfo();continue}if(s.style&&s.style.isImage&&this._imageAtlas){this._addRichTextImageElement(s);continue}}for(var o=r.split("\n"),a=0;a<o.length;++a){var h=o[a];if(""!==h)if(i=!1,this._maxWidth>0){var l=this._measureText(n,h);this._updateRichTextWithMaxWidth(h,l,n),o.length>1&&a<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,n),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&a<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(r)&&a===o.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+at)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},i._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(ht(n)||lt(n))return 1;for(var s=1,r=e+1;r<i&&(n=t.charAt(r),!lt(n)&&!ht(n));++r)s++;return s},i._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,n=this.node._uiProps.uiTransformComp,s=n.anchorX,r=n.anchorY,o=0;o<this._segments.length;++o){var a=this._segments[o],h=a.lineCount;h>e&&(t=0,e=h);var l=this._labelWidth*(.5*this._horizontalAlign-s);switch(this._horizontalAlign){case et.LEFT:break;case et.CENTER:l-=this._linesWidth[h-1]/2;break;case et.RIGHT:l-=this._linesWidth[h-1]}var c=a.node.position;if(a.node.setPosition(t+l,this._lineHeight*(i-h)-this._labelHeight*r,c.z),h===e&&(t+=a.node._uiProps.uiTransformComp.width),a.node.getComponent(rt)){var u=a.node.position.clone(),p=this._lineHeight,f=this._lineHeight*(1+at);switch(a.node._uiProps.uiTransformComp.anchorY){case 1:u.y+=p+(f-p)/2;break;case.5:u.y+=f/2;break;default:u.y+=(f-p)/2}if(a.imageOffset){var _=a.imageOffset.split(",");if(1===_.length&&_[0]){var d=parseFloat(_[0]);Number.isInteger(d)&&(u.y+=d)}else if(2===_.length){var y=parseFloat(_[0]),g=parseFloat(_[1]);Number.isInteger(y)&&(u.x+=y),Number.isInteger(g)&&(u.y+=g)}}a.node.position=u}var m=a.node.getComponent(qe);if(m){var b=a.node.position.clone();b.y-=m.width,a.node.position=b}}},i._convertLiteralColorValue=function(t){var e=t.toUpperCase();return h[e]?h[e]:(new h).fromHEX(t)},i._applyTextAttribute=function(t){var e=t.node.getComponent(tt);if(e){this._resetLabelState(e);var i,n=t.styleIndex;if(this._textArray[n]&&(i=this._textArray[n].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var s=t.node.getComponent(qe);s||(s=t.node.addComponent(qe)),s.color=this._convertLiteralColorValue(i.outline.color),s.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var r=i.event;r&&(t.clickHandler=r.click||"",t.clickParam=r.param||"")}e.cacheMode=this._cacheMode,this._font instanceof it&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var o=e._assembler;o&&o.updateRenderData(e)}},i._applyLayer=function(){for(var t,e=B(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},i._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=h.WHITE,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},g(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(vt),Ne.HorizontalAlign=et,Ne.VerticalAlign=ct,m((we=Ge).prototype,"string",[j,_e],Object.getOwnPropertyDescriptor(we.prototype,"string"),we.prototype),m(we.prototype,"horizontalAlign",[de,ye],Object.getOwnPropertyDescriptor(we.prototype,"horizontalAlign"),we.prototype),m(we.prototype,"fontSize",[ge],Object.getOwnPropertyDescriptor(we.prototype,"fontSize"),we.prototype),m(we.prototype,"fontFamily",[me],Object.getOwnPropertyDescriptor(we.prototype,"fontFamily"),we.prototype),m(we.prototype,"font",[be,ve],Object.getOwnPropertyDescriptor(we.prototype,"font"),we.prototype),m(we.prototype,"useSystemFont",[Ce],Object.getOwnPropertyDescriptor(we.prototype,"useSystemFont"),we.prototype),m(we.prototype,"cacheMode",[Se,xe],Object.getOwnPropertyDescriptor(we.prototype,"cacheMode"),we.prototype),m(we.prototype,"maxWidth",[De],Object.getOwnPropertyDescriptor(we.prototype,"maxWidth"),we.prototype),m(we.prototype,"lineHeight",[Ae],Object.getOwnPropertyDescriptor(we.prototype,"lineHeight"),we.prototype),m(we.prototype,"imageAtlas",[Te,Oe],Object.getOwnPropertyDescriptor(we.prototype,"imageAtlas"),we.prototype),m(we.prototype,"handleTouchEvent",[Ee],Object.getOwnPropertyDescriptor(we.prototype,"handleTouchEvent"),we.prototype),Le=m(we.prototype,"_lineHeight",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Re=m(we.prototype,"_string",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),Be=m(we.prototype,"_horizontalAlign",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return et.LEFT}}),Fe=m(we.prototype,"_fontSize",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Me=m(we.prototype,"_maxWidth",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ke=m(we.prototype,"_fontFamily",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),Pe=m(we.prototype,"_font",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=m(we.prototype,"_isSystemFontUsed",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),He=m(we.prototype,"_userDefinedFont",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),We=m(we.prototype,"_cacheMode",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nt.NONE}}),je=m(we.prototype,"_imageAtlas",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=m(we.prototype,"_handleTouchEvent",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ie=we))||Ie)||Ie)||Ie)||Ie)||Ie)),si=t("U",s("cc.UIMeshRenderer")(ii=S()(ii=x(110)(ii=D()(ii=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._models=null,e._modelComponent=null,e}o(e,t);var i=e.prototype;return i.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},i.onEnable=function(){t.prototype.onEnable.call(this)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},i.updateAssembler=function(t){if(this._models){this._modelComponent._detachFromScene();for(var e,i=B(this._models);!(e=i()).done;){var n=e.value;t.commitModel.call(t,this,n,this._modelComponent.material)}return!0}return!1},i.update=function(){this._fitUIRenderQueue()},i._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var n=i.passes,s=n.length,r=0;r<s;r++)n[r]._priority=U.MAX-11,i.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},r)}},g(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(vt))||ii)||ii)||ii)||ii),ri=t("M",function(t){function e(e){var i;return(i=t.call(this)||this).vData=null,i.iData=null,i.byteStart=0,i.byteOffset=0,i.indicesStart=0,i.indicesOffset=0,i.vertexStart=0,i.vertexOffset=0,i.lastByteOffset=1,i._attributes=null,i._vertexBuffers=[],i._indexBuffer=null,i._iaInfo=null,i._batcher=void 0,i._dirty=!1,i._vertexFormatBytes=0,i._initVDataCount=0,i._initIDataCount=1536,i._outOfCallback=null,i._hInputAssemblers=[],i._nextFreeIAHandle=0,i._lastUsedVDataSize=0,i._lastUsedIDataSize=0,i._batcher=e,i}o(e,t);var i=e.prototype;return i.initialize=function(t,e){this._outOfCallback=e;var i=mt(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var n=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new p(f.VERTEX|f.TRANSFER_DST,_.HOST|_.DEVICE,n,n)));var s=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new p(f.INDEX|f.TRANSFER_DST,_.HOST|_.DEVICE,s,s))),this._attributes=t,this._iaInfo=new N(this.attributes,this.vertexBuffers,this.indexBuffer),this.vData&&this.iData||this._reallocBuffer()},i.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,n=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var s=this.vData.byteLength,r=this.iData.length;if(i>s||n>r){for(;s<i||r<n;)this._initVDataCount*=2,this._initIDataCount*=2,s=4*this._initVDataCount,r=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},i.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},i.tryShrink=function(){if(!this._dirty&&this.vData&&this.iData&&this.vData.byteLength>>2>this._lastUsedVDataSize&&this.iData.length>>2>this._lastUsedIDataSize){var t=Math.max(256*this._vertexFormatBytes,this._initVDataCount>>1),e=Math.max(1536,this._initIDataCount>>1);t===this._initVDataCount&&e===this._initIDataCount||(this._initIDataCount=e,this._initVDataCount=t,this._reallocBuffer())}},i.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var e=0;e<this._hInputAssemblers.length;e++)this._hInputAssemblers[e].destroy();this._hInputAssemblers.length=0,t.prototype.destroy.call(this)},i.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return null;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(this._batcher.device.createInputAssembler(this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++];return e.firstIndex=this.indicesStart,e.indexCount=t,e},i.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e),this._lastUsedVDataSize=this.byteOffset,this._lastUsedIDataSize=this.indicesOffset,this._dirty=!1}},i._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},i._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),n=0,s=e.length;n<s;n++)i[n]=e[n]},i._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,n=0,s=e.length;n<s;n++)i[n]=e[n]},g(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),e}(G));ri.OPACITY_OFFSET=8;var oi,ai,hi,li,ci,ui,pi,fi,_i,di,yi,gi,mi,bi,vi,Ci,Si,xi,Di,Ai,Ti,Oi,Ei,Ii,wi,Li,Ri,Bi,Fi,Mi,ki,Pi=V.Enum.NONE|V.Enum.UI_3D,zi=t("D",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=Pi,this._inputAssember=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this.bufferBatch=null,this.inputAssembler=null,this.descriptorSet=null,this.camera=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=Pi,this.renderScene=null},e.fillPasses=function(t,e,i,n,s,r){if(t){var o=t.passes;if(!o)return;var a=0;this._shaders.length=o.length;for(var h=0;h<o.length;h++){this._passes[h]||(this._passes[h]=new X(u.director.root));var l=o[h],c=this._passes[h];l.update(),e||(e=l.depthStencilState,i=0),n||(n=l.blendState,s=0),-1===s&&(s=0),a=i<<16|s,c._initPassFromTarget(l,e,n,a),this._shaders[h]=c.getShaderVariant(r)}}},g(t,[{key:"native",get:function(){return this._nativeObj}},{key:"inputAssembler",get:function(){return this._inputAssember},set:function(t){this._inputAssember=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),Hi=t("b",(oi=s("cc.UIStaticBatch"),ai=S(),hi=D(),li=x(110),ci=O(),oi(ui=ai(ui=hi(ui=li((fi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._init=!1,e._meshBuffer=null,e._dirty=!0,e._lastMeshBuffer=null,e._uiDrawBatchList=[],e}o(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._getBatcher();if(t){var e=bt,i=new ri(t);i.initialize(e,this._arrivalMaxBuffer.bind(this)),this._meshBuffer=i}},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},i.updateAssembler=function(t){t.currIsStatic=!0,this._dirty&&(t.finishMergeBatches(),this._lastMeshBuffer=t.currBufferBatch,t.currBufferBatch=this._meshBuffer,t.currStaticRoot=this),this._init&&(t.finishMergeBatches(),t.commitStaticBatch(this))},i.postUpdateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),t.currBufferBatch=this._lastMeshBuffer,t.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers()),t.currIsStatic=!1},i.markAsDirty=function(){this._getBatcher()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},i._requireDrawBatch=function(){var t=new zi;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},i._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},i._getBatcher=function(){return Z.root&&Z.root.batcher2D?Z.root.batcher2D:(W(9301),null)},i._arrivalMaxBuffer=function(){var t=this._getBatcher();t&&t.autoMergeBatches(),W(9300)},g(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(pt),m((pi=fi).prototype,"color",[v,ci],Object.getOwnPropertyDescriptor(pi.prototype,"color"),pi.prototype),ui=pi))||ui)||ui)||ui)||ui)),Wi=(t("c",(_i=s("cc.LabelShadow"),di=S(),yi=x(110),gi=D(),mi=M(tt),bi=T(),vi=T(),Ci=T(),_i(Si=di(Si=yi(Si=gi(Si=mi(Si=F((Oi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,I(e,"_color",Di,w(e)),I(e,"_offset",Ai,w(e)),I(e,"_blur",Ti,w(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(tt);t&&t.updateRenderData(!0)},g(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(k),Di=m((xi=Oi).prototype,"_color",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h(0,0,0,255)}}),Ai=m(xi.prototype,"_offset",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(2,2)}}),Ti=m(xi.prototype,"_blur",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),m(xi.prototype,"color",[bi],Object.getOwnPropertyDescriptor(xi.prototype,"color"),xi.prototype),m(xi.prototype,"offset",[vi],Object.getOwnPropertyDescriptor(xi.prototype,"offset"),xi.prototype),m(xi.prototype,"blur",[Ci],Object.getOwnPropertyDescriptor(xi.prototype,"blur"),xi.prototype),Si=xi))||Si)||Si)||Si)||Si)||Si)||Si)),t("d",(Ei=s("cc.UIOpacity"),Ii=S(),wi=x(110),Li=D(),Ri=T(),Ei(Bi=Ii(Bi=wi(Bi=Li(Bi=F((ki=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,I(e,"_opacity",Mi,w(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},i.onDisable=function(){this.node._uiProps.localOpacity=1},g(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=q(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),e}(k),m((Fi=ki).prototype,"opacity",[Y,Ri],Object.getOwnPropertyDescriptor(Fi.prototype,"opacity"),Fi.prototype),Mi=m(Fi.prototype,"_opacity",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Bi=Fi))||Bi)||Bi)||Bi)||Bi)||Bi)));u.MaskComponent=Jt,Q.setClassAlias(Jt,"cc.MaskComponent"),u.LabelComponent=tt,Q.setClassAlias(tt,"cc.LabelComponent"),u.LabelOutlineComponent=qe,Q.setClassAlias(qe,"cc.LabelOutlineComponent"),u.RichTextComponent=ni,Q.setClassAlias(ni,"cc.RichTextComponent"),u.SpriteComponent=rt,Q.setClassAlias(rt,"cc.SpriteComponent"),u.UIModelComponent=si,Q.setClassAlias(si,"cc.UIModelComponent"),u.GraphicsComponent=dt,Q.setClassAlias(dt,"cc.GraphicsComponent"),Q.setClassAlias(Hi,"cc.UIStaticBatchComponent"),Q.setClassAlias(Wi,"cc.UIOpacityComponent")}}}));

{"version":3,"sources":["../../../../../../../../../cocos/particle/animator/optimized-curve.ts"],"names":["integrateKeyframe","coef","integrateKeyframeTwice","repeat","evalOptCurve","OptimizedKey","CURVE_MODE_CONSTANT","CURVE_MODE_RANDOM_CONSTANT","CURVE_MODE_CURVE","CURVE_MODE_RANDOM_CURVE","UNIFORM_CURVE_KEY_NUM","OptimizedCurve","constructUniform","optimizedKeys","integral","coefUniform","timeUniform","integralUniform","Array","buildCurve","animationCurve","multiplier","keyNum","keyFrames","length","i","keyToAdd","optKey","push","splice","coefficient","value","time","endTime","keyOffset","unshift","calcOptimizedKey","Math","min","index","Float32Array","updateKeyUniform","evaluate","integrateOnce","deltaT","prevIntegral","updateIntegralUniform","evaluateIntegral","t","ts","prevInt","dt","integrateTwice","evaluateIntegralTwice"],"mappings":"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"}
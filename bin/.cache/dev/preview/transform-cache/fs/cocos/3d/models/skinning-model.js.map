{"version":3,"sources":["../../../../../../../../../cocos/3d/models/skinning-model.ts"],"names":["getRelevantBuffers","outIndices","outBuffers","jointMaps","targetJoint","i","length","idxMap","index","j","push","JSB","AABB","BufferUsageBit","MemoryUsageBit","BufferInfo","Mat4","Vec3","UBOSkinning","ModelType","uploadJointData","MorphModel","deleteTransform","getTransform","getWorldMatrix","BatchingSchemes","NativeSkinningModel","warnID","myPatches","name","value","v3_min","v3_max","v3_1","v3_2","m4_1","ab_1","SkinningModel","uploadAnimation","_buffers","_dataArray","_joints","_bufferIndices","type","SKINNING","_init","_nativeObj","destroy","bindSkeleton","skeleton","skinningRoot","mesh","target","transform","boneSpaceBounds","getBoneSpaceBounds","struct","_ensureEnoughBuffers","jointBufferIndices","nativeJoints","joints","bound","getChildByPath","bindpose","bindposes","indices","buffers","currParent","parent","transParents","node","local","world","stamp","parents","setIndicesAndJoints","updateTransform","root","hasChangedFlags","_dirtyFlags","updateWorldTransform","_localDataUpdated","set","Infinity","worldMatrix","getBoundary","min","max","worldBounds","_worldBounds","_modelBounds","fromPoints","_mat","_pos","_rot","_scale","_updateNativeBounds","updateUBOs","multiply","b","update","initSubModel","idx","subMeshData","mat","original","vertexBuffers","iaInfo","jointMappedBuffers","getMacroPatches","subModelIndex","superMacroPatches","concat","_updateLocalDescriptors","submodelIdx","descriptorSet","updateLocalDescriptors","buffer","bindBuffer","BINDING","_updateInstancedAttributes","attributes","pass","batchingScheme","NONE","count","_device","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","SIZE","Float32Array","COUNT","setBuffers"],"mappings":"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"}
{"version":3,"sources":["../../../../../../../../../cocos/3d/models/baked-skinning-model.ts"],"names":["JSB","BufferUsageBit","MemoryUsageBit","BufferInfo","INST_JOINT_ANIM_INFO","UBOSkinningAnimation","UBOSkinningTexture","UNIFORM_JOINT_TEXTURE_BINDING","ModelType","jointTextureSamplerInfo","MorphModel","legacyCC","NativeBakedSkinningModel","myPatches","name","value","BakedSkinningModel","uploadedAnim","undefined","_jointsMedium","_skeleton","_mesh","_dataPoolManager","_instAnimInfoIdx","type","BAKED_SKINNING","director","root","dataPoolManager","jointTextureInfo","Float32Array","animInfo","jointAnimationInfo","getData","buffer","texture","boundsInfo","_init","_nativeObj","destroy","_applyJointTexture","_applyNativeJointMedium","bindSkeleton","skeleton","skinningRoot","mesh","transform","resMgr","uuid","_device","createBuffer","UNIFORM","TRANSFER_DST","DEVICE","SIZE","updateTransform","stamp","skelBound","data","worldBounds","_worldBounds","node","_mat","_pos","_rot","_scale","updateUBOs","info","idx","view","instancedAttributes","views","dirty","update","forEach","bound","push","animInfoKey","setJointMedium","_updateModelBounds","aabb","_modelBounds","updateModelBounds","uploadAnimation","anim","jointTexturePool","getSequencePoseTexture","bounds","get","hash","getDefaultPoseTexture","oldTex","releaseHandle","handle","width","joints","length","pixelOffset","updateInstancedJointTextureInfo","tex","i","_subModels","descriptorSet","bindTexture","getMacroPatches","subModelIndex","patches","concat","_updateLocalDescriptors","submodelIdx","bindBuffer","BINDING","sampler","getSampler","bindSampler","_setInstAnimInfoIdx","setAnimInfoIdx","_updateInstancedAttributes","attributes","pass","_getInstancedAttributeIndex"],"mappings":"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"}
{"version":3,"sources":["../../../../../../../../../cocos/2d/renderer/draw-batch-gpu.ts"],"names":["pack2","a","b","Math","min","EPSILON","floor","legacyCC","Label","Sprite","Vec3","Vec2","Vec4","Color","TransformBit","SpriteType","DrawBatch2D","DrawBatch2DGPU","_vec4PerUI","_numPerUBO","capacityDirty","_device","_dcIndex","director","root","device","fillBuffers","renderComp","UBOManager","material","batcher","node","updateWorldTransform","t","_pos","r","_rot","s","_scale","_tempRect","_uiProps","uiTransformComp","checkAndUpdateRect","add","_tempPosition","_anchorCache","mode","fillType","frame","to","spriteFrame","tillingOffset","type","SIMPLE","SLICED","_calculateSlicedData","_slicedCache","_packageSlicedData","slicedData","rotated","TILED","calculateTiledData","_tiledCache","FILLED","start","fillStart","range","fillRange","end","x","y","z","fillCenter","w","max","trim","tillingOffsetWithTrim","c","color","_tempcolor","set","g","opacity","capabilities","maxVertexUniformVectors","passes","shaderInfo","builtins","statistics","CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS","localBuffer","upload","_rectWithScale","fillDrawCall","dc","_drawCalls","bufferHash","hash","bufferUboIndex","prevUBOIndex","drawcallPool","alloc","bufferView","getBufferView","setDynamicOffsets","uniformBufferStride","drawInfo","firstIndex","prevInstanceID","indexCount","length","_pushDrawCall","updateBuffer","bufferInfo","hasChangedFlags","_rectDirty","RS","updateDataTRSByDirty","instanceID","UBOIndex","updateDataByDirty","spriteData","frameData","val","_tempAnchor"],"mappings":"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"}
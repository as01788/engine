{"version":3,"sources":["../../../../../../../../../cocos/2d/renderer/render-uniform-buffer.ts"],"names":["murmurhash2_32_gc","BufferInfo","BufferUsageBit","BufferViewInfo","MemoryUsageBit","UILocalBuffer","device","hash","UIPerUBO","vec4PerUI","poolIndex","_device","_vec4PerUI","_UIPerUBO","_uniformBufferStride","_uniformBufferElementCount","_uniformBuffer","_firstUniformBufferView","_uniformBufferData","_prevUBOIndex","_prevInstanceID","alignment","capabilities","uboOffsetAlignment","unalignedStride","Float32Array","BYTES_PER_ELEMENT","Math","ceil","createBuffer","UNIFORM","TRANSFER_DST","DEVICE","UBO_COUNT","checkFull","updateIndex","destroy","upload","t","r","s","to","c","mode","uvExtra","fillType","data","offset","x","y","z","min","w","b","getBufferView","updateBuffer","update","reset","updateDataTRSByDirty","instanceID","UBOIndex","updateDataByDirty","UILocalUBOManger","_localBuffers","_element","i","length","key","push","value","pool","_createLocalBuffer","currentIdx","localBufferPool","localBuffer","res","j","capacity","idx"],"mappings":"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"}
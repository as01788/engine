{"version":3,"sources":["../../../../../../../../../cocos/2d/renderer/mesh-buffer.ts"],"names":["BufferUsageBit","MemoryUsageBit","InputAssemblerInfo","BufferInfo","ScalableContainer","getComponentPerVertex","MeshBuffer","batcher","vData","iData","byteStart","byteOffset","indicesStart","indicesOffset","vertexStart","vertexOffset","lastByteOffset","_attributes","_vertexBuffers","_indexBuffer","_iaInfo","_batcher","_dirty","_vertexFormatBytes","_initVDataCount","_initIDataCount","_outOfCallback","_hInputAssemblers","_nextFreeIAHandle","_lastUsedVDataSize","_lastUsedIDataSize","initialize","attrs","outOfCallback","formatBytes","Float32Array","BYTES_PER_ELEMENT","vbStride","vertexBuffers","length","push","device","createBuffer","VERTEX","TRANSFER_DST","HOST","DEVICE","ibStride","Uint16Array","indexBuffer","INDEX","attributes","_reallocBuffer","request","vertexCount","indicesCount","call","byteLength","indicesLength","reset","tryShrink","vDataCount","Math","max","iDataCount","destroy","i","recordBatch","vCount","createInputAssembler","ia","firstIndex","indexCount","uploadBuffers","verticesData","buffer","indicesData","size","resize","update","_reallocVData","_reallocIData","copyOldData","oldVData","Uint8Array","newData","l","oldIData","OPACITY_OFFSET"],"mappings":"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"}
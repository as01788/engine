{"version":3,"sources":["../../../../../../../../../cocos/core/asset-manager/release-manager.ts"],"names":["visitAsset","asset","deps","_uuid","push","visitComponent","comp","props","Object","getOwnPropertyNames","i","length","propName","value","Array","isArray","j","val","Asset","constructor","keys","visitNode","node","_components","_children","descendOpRef","refs","exclude","op","depends","dependUtil","getDeps","l","dependAsset","assets","get","uuid","refCount","includes","checkCircularReference","create","_temp","EDITOR","TEST","isValid","Cache","references","callInNextTick","js","ReleaseManager","_persistNodeDeps","_toDelete","_eventListener","init","clear","_addPersistNodeRef","addRef","add","_removePersistNodeRef","has","decRef","remove","_autoRelease","oldScene","newScene","persistNodes","childs","autoReleaseAssets","dependencies","_depends","persistDeps","sceneDeps","key","dep","tryRelease","force","_free","_freeAssets","bind","forEach","destroy","dependant","dependance","deref","array","fastRemoveAt"],"mappings":"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"}
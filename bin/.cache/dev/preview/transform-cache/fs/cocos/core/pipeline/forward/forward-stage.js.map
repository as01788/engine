{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/forward/forward-stage.ts"],"names":["ccclass","displayOrder","type","serializable","SetIndex","getPhaseID","renderQueueClearFunc","convertRenderQueue","renderQueueSortFunc","ClearFlagBit","Color","Rect","RenderBatchedQueue","RenderInstancedQueue","RenderStage","ForwardStagePriority","RenderAdditiveLightQueue","BatchingSchemes","RenderQueueDesc","RenderQueueSortMode","PlanarShadowQueue","UIPhase","renderProfiler","colors","ForwardStage","_renderQueues","_renderArea","_batchedQueue","_instancedQueue","_phaseID","_clearFlag","_uiPhase","initialize","info","renderQueues","activate","pipeline","flow","i","length","_additiveLightQueue","_pipeline","_planarQueue","destroy","render","camera","clear","device","forEach","renderObjects","pipelineSceneData","m","p","k","ro","subModels","model","subModel","passes","pass","phase","batchingScheme","INSTANCING","instancedBuffer","getInstancedBuffer","merge","instancedAttributes","queue","add","VB_MERGING","batchedBuffer","getBatchedBuffer","insertRenderPass","cmdBuff","commandBuffers","pipelineUBO","updateShadowUBO","uploadBuffers","gatherLightPasses","gatherShadowPasses","clearFlag","COLOR","x","clearColor","y","z","w","generateRenderArea","swapchain","window","framebuffer","renderPass","getRenderPass","beginRenderPass","clearDepth","clearStencil","bindDescriptorSet","GLOBAL","descriptorSet","recordCommandBuffer","profiler","endRenderPass","initInfo","name","priority","FORWARD","tag","isTransparent","sortMode","FRONT_TO_BACK","stages","BACK_TO_FRONT"],"mappings":"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"}
{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/render-additive-light-queue.ts"],"names":["cullSphereLight","light","model","worldBounds","intersect","aabbWithAABB","aabb","cullSpotLight","aabbFrustum","frustum","getLightPassIndices","subModels","lightPassIndices","length","hasValidLightPass","j","passes","lightPassIndex","k","phase","_phaseID","push","BatchingSchemes","PipelineStateManager","Vec3","nextPow2","Mat4","Color","BufferUsageBit","MemoryUsageBit","BufferInfo","BufferViewInfo","Pool","RenderBatchedQueue","RenderInstancedQueue","getPhaseID","LightType","SetIndex","UBOForwardLight","UBOShadow","UNIFORM_SHADOWMAP_BINDING","UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING","supportsFloatTexture","updatePlanarPROJ","ShadowType","_lightPassPool","subModel","passIdx","dynamicOffsets","lights","_vec4Array","Float32Array","_dynamicOffsets","_lightIndices","_matShadowView","_matShadowViewProj","_lightPassIndices","RenderAdditiveLightQueue","pipeline","_pipeline","_device","_lightPasses","_shadowUBO","COUNT","_lightBufferCount","_lightBufferStride","_lightBufferElementCount","_lightBuffer","_firstLightBufferView","_lightBufferData","_instancedQueue","_batchedQueue","_lightMeterScale","device","alignment","capabilities","uboOffsetAlignment","Math","ceil","SIZE","BYTES_PER_ELEMENT","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","clear","i","lp","freeArray","destroy","descriptorSetMap","globalDSManager","keys","key","descriptorSet","get","getBuffer","BINDING","getTexture","gatherLightPasses","camera","cmdBuff","validPunctualLights","pipelineSceneData","_updateUBOs","_updateLightDescriptorSet","renderObjects","ro","_lightCulling","lightPassIdx","pass","isTransparent","blendState","targets","blend","bindBuffer","update","_addRenderQueue","uploadBuffers","recordCommandBuffer","renderPass","shader","shaders","ia","inputAssembler","pso","getOrCreatePipelineState","matDS","localDS","bindPipelineState","bindDescriptorSet","MATERIAL","bindInputAssembler","getOrCreateDescriptorSet","GLOBAL","LOCAL","draw","l","isCulled","type","SPHERE","SPOT","batchingScheme","INSTANCING","idx","buffer","getInstancedBuffer","merge","instancedAttributes","queue","add","VB_MERGING","getBatchedBuffer","alloc","sceneData","shadowInfo","shadows","shadowFrameBufferMap","mainLight","scene","linear","packing","matShadowProj","matShadowInvProj","SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET","size","x","y","pcf","bias","SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET","normalBias","toArray","shadowColor","SHADOW_COLOR_OFFSET","invert","node","getWorldMatrix","perspective","angle","aspect","range","clone","multiply","MAT_LIGHT_VIEW_OFFSET","MAT_LIGHT_VIEW_PROJ_OFFSET","SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET","saturation","SHADOW_PROJ_DEPTH_INFO_OFFSET","m10","m14","m11","m15","SHADOW_INV_PROJ_DEPTH_INFO_OFFSET","SHADOW_PROJ_INFO_OFFSET","m00","m05","has","texture","colorTextures","bindTexture","updateBuffer","exposure","isHDR","resize","initialize","offset","position","set","LIGHT_POS_OFFSET","enabled","ShadowMap","LIGHT_SIZE_RANGE_ANGLE_OFFSET","color","useColorTemperature","tempRGB","colorTemperatureRGB","z","luminance","LIGHT_COLOR_OFFSET","spotAngle","direction","LIGHT_DIR_OFFSET"],"mappings":"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"}
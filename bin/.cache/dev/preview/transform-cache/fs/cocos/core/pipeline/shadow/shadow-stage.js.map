{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/shadow/shadow-stage.ts"],"names":["ccclass","Color","Rect","RenderStage","ForwardStagePriority","RenderShadowMapBatchedQueue","SetIndex","colors","ShadowStage","_shadowFrameBuffer","_renderArea","_light","_globalDS","setUsage","globalDS","light","shadowFrameBuffer","destroy","_additiveShadowQueue","clear","clearFramebuffer","camera","w","clearColor","pipeline","_pipeline","cmdBuff","commandBuffers","renderPass","beginRenderPass","clearDepth","clearStencil","endRenderPass","render","pipelineSceneData","shadowInfo","shadows","shadingScale","descriptorSet","pipelineUBO","updateShadowUBOLight","gatherLightPasses","vp","viewport","shadowMapSize","size","x","y","width","height","device","bindDescriptorSet","GLOBAL","recordCommandBuffer","activate","flow","initInfo","name","priority","FORWARD","tag"],"mappings":";;;;;;;;;;;AA8BSA,MAAAA,O,0BAAAA,O;;AACAC,MAAAA,K,eAAAA,K;AAAOC,MAAAA,I,eAAAA,I;;AACWC,MAAAA,W,kBAAAA,W;;AAClBC,MAAAA,oB,WAAAA,oB;;AACAC,MAAAA,2B,kCAAAA,2B;;AAEAC,MAAAA,Q,aAAAA,Q;;;AAKHC,MAAAA,M,GAAkB,CAAC,IAAIN,KAAJ,CAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAD,C;AAExB;AACA;AACA;AACA;;6BAEaO,W,WADZR,OAAO,CAAC,aAAD,C;;;;;;;;;;;gBAyBIS,kB,GAAyC,I;gBACzCC,W,GAAc,IAAIR,IAAJ,E;gBACdS,M,GAAuB,I;gBACvBC,S,GAAkC,I;;;;;;AAhB1C;AACJ;AACA;AACA;AACA;AACA;eACWC,Q,GAAP,kBAAiBC,QAAjB,EAA0CC,KAA1C,EAAwDC,iBAAxD,EAAwF;AACpF,eAAKJ,SAAL,GAAiBE,QAAjB;AACA,eAAKH,MAAL,GAAcI,KAAd;AACA,eAAKN,kBAAL,GAA0BO,iBAA1B;AACH,S;;eAQMC,O,GAAP,mBAAkB;AAAA;;AACd,eAAKR,kBAAL,GAA0B,IAA1B;AACA,eAAKG,SAAL,GAAiB,IAAjB;AACA,eAAKD,MAAL,GAAc,IAAd;AAEA,wCAAKO,oBAAL,gFAA2BC,KAA3B;AACH,S;;eAEMC,gB,GAAP,0BAAyBC,MAAzB,EAAyC;AACrC,cAAI,CAAC,KAAKV,MAAN,IAAgB,CAAC,KAAKF,kBAA1B,EAA8C;AAAE;AAAS;;AACzDF,UAAAA,MAAM,CAAC,CAAD,CAAN,CAAUe,CAAV,GAAcD,MAAM,CAACE,UAAP,CAAkBD,CAAhC;AACA,cAAME,QAAQ,GAAG,KAAKC,SAAtB;AACA,cAAMC,OAAO,GAAGF,QAAQ,CAACG,cAAT,CAAwB,CAAxB,CAAhB;AACA,cAAMC,UAAU,GAAG,KAAKnB,kBAAL,CAAwBmB,UAA3C;AAEAF,UAAAA,OAAO,CAACG,eAAR,CAAwBD,UAAxB,EAAoC,KAAKnB,kBAAzC,EAA6D,KAAKC,WAAlE,EACIH,MADJ,EACYc,MAAM,CAACS,UADnB,EAC+BT,MAAM,CAACU,YADtC;AAEAL,UAAAA,OAAO,CAACM,aAAR;AACH,S;;eAEMC,M,GAAP,gBAAeZ,MAAf,EAA+B;AAC3B,cAAMG,QAAQ,GAAG,KAAKC,SAAtB;AACA,cAAMS,iBAAiB,GAAGV,QAAQ,CAACU,iBAAnC;AACA,cAAMC,UAAU,GAAGD,iBAAiB,CAACE,OAArC;AACA,cAAMC,YAAY,GAAGH,iBAAiB,CAACG,YAAvC;AACA,cAAMC,aAAa,GAAG,KAAK1B,SAA3B;AACA,cAAMc,OAAO,GAAGF,QAAQ,CAACG,cAAT,CAAwB,CAAxB,CAAhB;;AAEA,cAAI,CAAC,KAAKhB,MAAN,IAAgB,CAAC,KAAKF,kBAA1B,EAA8C;AAAE;AAAS;;AACzD,eAAKgB,SAAL,CAAec,WAAf,CAA2BC,oBAA3B,CAAgDF,aAAhD,EAA+D,KAAK3B,MAApE;;AACA,eAAKO,oBAAL,CAA0BuB,iBAA1B,CAA4CH,aAA5C,EAA2DjB,MAA3D,EAAmE,KAAKV,MAAxE,EAAgFe,OAAhF;;AAEA,cAAMgB,EAAE,GAAGrB,MAAM,CAACsB,QAAlB;AACA,cAAMC,aAAa,GAAGT,UAAU,CAACU,IAAjC;AACA,eAAKnC,WAAL,CAAiBoC,CAAjB,GAAqBJ,EAAE,CAACI,CAAH,GAAOF,aAAa,CAACE,CAA1C;AACA,eAAKpC,WAAL,CAAiBqC,CAAjB,GAAqBL,EAAE,CAACK,CAAH,GAAOH,aAAa,CAACG,CAA1C;AACA,eAAKrC,WAAL,CAAiBsC,KAAjB,GAA0BN,EAAE,CAACM,KAAH,GAAWJ,aAAa,CAACE,CAAzB,GAA6BT,YAAvD;AACA,eAAK3B,WAAL,CAAiBuC,MAAjB,GAA0BP,EAAE,CAACO,MAAH,GAAYL,aAAa,CAACG,CAA1B,GAA8BV,YAAxD;AAEA,cAAMa,MAAM,GAAG1B,QAAQ,CAAC0B,MAAxB;AACA,cAAMtB,UAAU,GAAG,KAAKnB,kBAAL,CAAwBmB,UAA3C;AAEAF,UAAAA,OAAO,CAACG,eAAR,CAAwBD,UAAxB,EAAoC,KAAKnB,kBAAzC,EAA6D,KAAKC,WAAlE,EACIH,MADJ,EACYc,MAAM,CAACS,UADnB,EAC+BT,MAAM,CAACU,YADtC;AAEAL,UAAAA,OAAO,CAACyB,iBAAR,CAA0B7C,QAAQ,CAAC8C,MAAnC,EAA2Cd,aAA3C;;AAEA,eAAKpB,oBAAL,CAA0BmC,mBAA1B,CAA8CH,MAA9C,EAAsDtB,UAAtD,EAAkEF,OAAlE;;AAEAA,UAAAA,OAAO,CAACM,aAAR;AACH,S;;eAEMsB,Q,GAAP,kBAAiB9B,QAAjB,EAA4C+B,IAA5C,EAA8D;AAC1D,iCAAMD,QAAN,YAAe9B,QAAf,EAAyB+B,IAAzB;;AACA,eAAKrC,oBAAL,GAA4B,IAAIb,2BAAJ,CAAgCmB,QAAhC,CAA5B;AACH,S;;;QAnF4BrB,W,WAKfqD,Q,GAA6B;AACvCC,QAAAA,IAAI,EAAE,aADiC;AAEvCC,QAAAA,QAAQ,EAAEtD,oBAAoB,CAACuD,OAFQ;AAGvCC,QAAAA,GAAG,EAAE;AAHkC,O"}
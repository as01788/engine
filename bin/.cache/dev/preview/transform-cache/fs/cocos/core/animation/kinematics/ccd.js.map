{"version":3,"sources":["../../../../../../../../../../cocos/core/animation/kinematics/ccd.ts"],"names":["ccdIK","links","target","epsilon","maxIterations","forward","nLinks","length","u","Vec3","v","axis","correctiveRot","Quat","currentPos","currentRot","endFactorPos","iEndFactor","endFactor","iteration","iLink","result","correct","IterationResult","INTERRUPTED","DONE","linkIndex","current","getWorldPosition","subtract","normalize","cross","cosTheta","dot","theta","Math","acos","DUMP_BIAS","fromAxisAngle","getWorldRotation","multiply","setWorldRotation","distance","THETA_ERROR","UNFINISHED"],"mappings":"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"}
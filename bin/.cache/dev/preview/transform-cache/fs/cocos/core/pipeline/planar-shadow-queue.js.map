{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/planar-shadow-queue.ts"],"names":["AABB","intersect","SetIndex","PipelineStateManager","RenderInstancedQueue","ShadowType","Layers","_ab","PlanarShadowQueue","pipeline","_pendingModels","_castModels","_instancedQueue","_pipeline","gatherShadowPasses","camera","cmdBuff","pipelineSceneData","pipelineUBO","shadows","clear","length","enabled","type","Planar","scene","frustum","shadowVisible","visibility","BitMask","DEFAULT","mainLight","models","i","model","node","castShadow","push","instancedBuffer","instancingMaterial","passes","getInstancedBuffer","queue","add","worldBounds","transform","matLight","aabbFrustum","isInstancingEnabled","subModels","m","subModel","merge","instancedAttributes","planarInstanceShader","uploadBuffers","recordCommandBuffer","device","renderPass","pass","material","descriptorSet","bindDescriptorSet","MATERIAL","modelCount","j","shader","planarShader","ia","inputAssembler","pso","getOrCreatePipelineState","bindPipelineState","LOCAL","bindInputAssembler","draw"],"mappings":"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"}
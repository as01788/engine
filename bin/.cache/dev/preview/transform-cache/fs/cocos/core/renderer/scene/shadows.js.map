{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/shadows.ts"],"names":["JSB","Material","Sphere","Color","Mat4","Vec3","Vec2","legacyCC","Enum","NativeShadow","ShadowSize","Low_256x256","Medium_512x512","High_1024x1024","Ultra_2048x2048","ShadowType","Planar","ShadowMap","PCFType","HARD","SOFT","SOFT_2X","SHADOW_TYPE_NONE","Shadows","fixedSphere","maxReceived","firstSetCSM","shadowCameraFar","matShadowView","matShadowProj","matShadowViewProj","_normal","_shadowColor","_matLight","_material","_instancingMaterial","_size","_enabled","_distance","_type","_near","_far","_invisibleOcclusionRange","_shadowDistance","_orthoSize","_pcf","_shadowMapDirty","_bias","_normalBias","_fixedArea","_saturation","_nativeObj","getPlanarShader","patches","initialize","effectName","planarPass","passes","getShaderVariant","getPlanarInstanceShader","defines","USE_INSTANCING","instancePass","_setEnable","val","enabled","_setType","shadowType","shadowsInfo","near","far","invisibleOcclusionRange","shadowDistance","orthoSize","size","pcf","normal","distance","shadowColor","bias","normalBias","fixedArea","type","saturation","activate","_updatePipeline","_updatePlanarInfo","root","director","pipeline","macros","CC_ENABLE_DIR_SHADOW","onGlobalPipelineStateChanged","_destroy","destroy","copy","color","nearValue","farValue","set","pcfType","shadowMapDirty","MAX_FAR","COEFFICIENT_OF_EXPANSION","Math","sqrt"],"mappings":"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"}
{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/scene-culling.ts"],"names":["getRenderObject","model","camera","depth","node","Vec3","subtract","_tempVec3","worldPosition","position","dot","forward","ro","roPool","alloc","getDirShadowRenderObject","dirShadowPool","getCastShadowRenderObject","castShadowPool","getShadowWorldMatrix","pipeline","rotation","dir","out","shadows","pipelineSceneData","negate","_dir_negate","distance","fixedSphere","radius","Shadows","COEFFICIENT_OF_EXPANSION","multiplyScalar","_vec3_p","add","center","set","Mat4","fromRT","_mat4_trans","updateSphereLight","light","pos","n","normal","d","NdL","lx","x","ly","y","lz","z","nx","ny","nz","m","matLight","m00","m01","m02","m03","m04","m05","m06","m07","m08","m09","m10","m11","m12","m13","m14","m15","pipelineUBO","updateShadowUBORange","UBOShadow","MAT_LIGHT_PLANE_PROJ_OFFSET","updateDirLight","direction","scale","updatePlanarPROJ","shadowInfo","shadowUBO","toArray","validPunctualLightsCulling","sceneData","validPunctualLights","length","scene","spotLights","i","baked","Sphere","_sphere","range","intersect","sphereFrustum","frustum","push","sphereLights","getCameraWorldMatrix","cameraNode","getWorldPosition","getWorldRotation","QuantizeDirLightShadowCamera","dirLight","device","invisibleOcclusionRange","shadowMapWidth","size","Frustum","split","_validFrustum","shadowDistance","_lightViewFrustum","clone","_matShadowTrans","_focus","invert","_matShadowView","_matShadowViewInv","shadowViewArbitaryPos","transform","AABB","fromPoints","_castLightViewBounds","mergeFrustum","r","halfExtents","_shadowPos","transformMat4","orthoSizeMin","vertices","_cameraBoundingSphere","mergePoints","orthoSizeMax","orthoSize","shadowCameraFar","halfOrthoSize","ortho","_matShadowProj","capabilities","clipSpaceMinZ","clipSpaceSignY","multiply","_matShadowViewProjArbitaryPos","_projPos","invActualSize","_texelSize","modX","modY","_projSnap","_matShadowViewProjArbitaryPosInv","_snap","createOrtho","updatePlanes","_matShadowViewProj","matShadowView","matShadowProj","matShadowViewProj","sceneCulling","mainLight","skybox","renderObjects","freeArray","castShadowObjects","_castBoundsInited","dirShadowObjects","enabled","SHADOW_COLOR_OFFSET","shadowColor","type","ShadowType","ShadowMap","_dirLightFrustum","Planar","clearFlag","SKYBOX_FLAG","models","visibility","castShadow","firstSetCSM","worldBounds","_castWorldBounds","copy","merge","layer","visFlags","fixedArea","_ab","aabbFrustum","Vec2","Pool","create","accurate"],"mappings":"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"}
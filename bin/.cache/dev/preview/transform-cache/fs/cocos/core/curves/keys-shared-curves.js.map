{"version":3,"sources":["../../../../../../../../../cocos/core/curves/keys-shared-curves.ts"],"names":["binarySearchEpsilon","ccclass","serializable","assertIsTrue","approx","lerp","Quat","ExtrapolationMode","QuatInterpolationMode","RealInterpolationMode","DEFAULT_EPSILON","DefaultFloatArray","Float32Array","KeysSharedCurves","times","_times","nKeyframes","length","_keyframesCount","from","EPSILON","lastDiff","mayBeOptimized","iFrame","curDiff","Math","abs","_optimized","matchTimes","firstTime","diff","every","t","iKeyframe","getFirstTime","getLastTime","calculateLocation","time","out","optimized","keyframesCount","div","previous","floor","ratio","index","iNext","iPrev","prevTime","globalLocation","KeySharedRealCurves","allowedForCurve","curve","postExtrapolation","CLAMP","preExtrapolation","Array","values","value","interpolationMode","LINEAR","matchCurve","keyFramesCount","addCurve","_curves","push","map","evaluate","curves","nCurves","iCurve","lastTime","iLastFrame","curveValues","cacheQuat1","cacheQuat2","KeySharedQuatCurves","SLERP","toArray","getKeyframeValue","fromArray","q1","q2","slerp"],"mappings":"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"}
{"version":3,"sources":["../../../../../../../../../../cocos/core/pipeline/deferred/lighting-stage.ts"],"names":["ccclass","displayOrder","type","serializable","localDescriptorSetLayout","UBODeferredLight","SetIndex","UBOForwardLight","getPhaseID","Color","Rect","BufferUsageBit","MemoryUsageBit","BufferInfo","BufferViewInfo","DescriptorSetLayoutInfo","DescriptorSetInfo","ClearFlagBit","RenderStage","DeferredStagePriority","PlanarShadowQueue","Material","PipelineStateManager","intersect","Sphere","Vec3","Vec4","renderQueueClearFunc","convertRenderQueue","renderQueueSortFunc","RenderQueueDesc","UIPhase","colors","LightingStage","_deferredLitsBufs","_maxDeferredLights","LIGHTS_PER_PASS","_lightMeterScale","_descriptorSet","_renderArea","_uiPhase","_phaseID","_renderQueues","initialize","info","gatherLights","camera","pipeline","_pipeline","cmdBuff","commandBuffers","sphereLights","scene","spotLights","_sphere","create","_vec4Array","Float32Array","exposure","idx","elementLen","length","fieldLen","i","light","set","position","x","y","z","range","sphereFrustum","frustum","toArray","_lightBufferData","color","useColorTemperature","tempRGB","colorTemperatureRGB","pipelineSceneData","isHDR","luminance","size","spotAngle","direction","offset","updateBuffer","activate","flow","device","renderQueues","totalSize","BYTES_PER_ELEMENT","Math","ceil","capabilities","uboOffsetAlignment","createBuffer","UNIFORM","TRANSFER_DST","HOST","DEVICE","deferredLitsBufView","layoutInfo","bindings","_descriptorSetLayout","createDescriptorSetLayout","createDescriptorSet","bindBuffer","BINDING","_planarQueue","_deferredMaterial","deferredLightingMaterial","destroy","render","sceneData","renderObjects","update","gatherShadowPasses","dynamicOffsets","bindDescriptorSet","LOCAL","generateRenderArea","clearFlag","COLOR","clearColor","w","deferredData","getPipelineRenderData","framebuffer","outputFrameBuffer","renderPass","pipelineUBO","updateShadowUBO","beginRenderPass","clearDepth","clearStencil","setScissor","generateScissor","setViewport","generateViewport","GLOBAL","descriptorSet","lightingMat","pass","passes","shader","getShaderVariant","bindTexture","gbufferRenderTargets","bindSampler","sampler","MATERIAL","inputAssembler","quadIAOffscreen","pso","getOrCreatePipelineState","bindPipelineState","bindInputAssembler","draw","forEach","m","p","k","ro","subModels","model","subModel","phase","insertRenderPass","recordCommandBuffer","endRenderPass","initInfo","name","priority","LIGHTING","tag"],"mappings":"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"}
{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/instanced-buffer.ts"],"names":["UNIFORM_LIGHTMAP_TEXTURE_BINDING","BufferUsageBit","MemoryUsageBit","InputAssemblerInfo","Attribute","BufferInfo","INITIAL_CAPACITY","MAX_CAPACITY","InstancedBuffer","pass","instances","hasPendingModels","dynamicOffsets","_device","device","destroy","i","length","instance","vb","ia","merge","subModel","attrs","passIdx","shaderImplant","stride","buffer","sourceIA","inputAssembler","lightingMap","descriptorSet","getTexture","shader","shaders","indexBuffer","count","capacity","newSize","oldData","data","Uint8Array","set","resize","createBuffer","VERTEX","TRANSFER_DST","HOST","DEVICE","vertexBuffers","slice","attributes","attr","newAttr","name","format","isNormalized","push","iaInfo","createInputAssembler","uploadBuffers","cmdBuff","instanceCount","updateBuffer","clear"],"mappings":"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"}
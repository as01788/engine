{"version":3,"sources":["../../../../../../../../../../cocos/core/gfx/webgl2/webgl2-swapchain.ts"],"names":["initStates","gl","activeTexture","TEXTURE0","pixelStorei","PACK_ALIGNMENT","UNPACK_ALIGNMENT","UNPACK_FLIP_Y_WEBGL","bindFramebuffer","FRAMEBUFFER","enable","SCISSOR_TEST","CULL_FACE","cullFace","BACK","frontFace","CCW","polygonOffset","DEPTH_TEST","depthMask","depthFunc","LESS","stencilFuncSeparate","FRONT","ALWAYS","stencilOpSeparate","KEEP","stencilMaskSeparate","disable","STENCIL_TEST","SAMPLE_ALPHA_TO_COVERAGE","BLEND","blendEquationSeparate","FUNC_ADD","blendFuncSeparate","ONE","ZERO","colorMask","blendColor","getExtension","ext","prefixes","i","length","_ext","getExtensions","res","EXT_texture_filter_anisotropic","EXT_color_buffer_half_float","EXT_color_buffer_float","WEBGL_multi_draw","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_debug_renderer_info","OES_texture_half_float_linear","OES_texture_float_linear","useVAO","getContext","canvas","context","webGLCtxAttribs","alpha","macro","ENABLE_TRANSPARENT_CANVAS","antialias","EDITOR","ENABLE_WEBGL_ANTIALIAS","depth","stencil","premultipliedAlpha","preserveDrawingBuffer","powerPreference","failIfMajorPerformanceCaveat","err","warnID","warn","debug","WebGL2StateCache","WebGL2Texture","Format","TextureInfo","TextureFlagBit","TextureType","TextureUsageBit","BufferTextureCopy","Swapchain","WebGL2DeviceManager","eventWebGLContextLost","WebGL2Swapchain","stateCache","nullTex2D","nullTexCube","_canvas","_webGL2ContextLostHandler","_extensions","initialize","info","windowHandle","_onWebGLContextLost","bind","addEventListener","instance","capabilities","maxTextureUnits","maxUniformBufferBindings","maxVertexAttributes","colorFmt","RGBA8","depthStencilFmt","DEPTH_STENCIL","depthBits","getParameter","DEPTH_BITS","stencilBits","STENCIL_BITS","DEPTH","_colorTexture","initAsSwapchainTexture","swapchain","format","width","height","_depthStencilTexture","createTexture","TEX2D","SAMPLED","NONE","CUBE","nullTexRegion","texExtent","nullTexBuff","Uint8Array","size","fill","copyBuffersToTexture","texSubres","layerCount","destroy","removeEventListener","resize","surfaceTransform","event"],"mappings":";;;;;;;;;;;;;AAoCA,WAASA,UAAT,CAAqBC,EAArB,EAAiD;AAC7CA,IAAAA,EAAE,CAACC,aAAH,CAAiBD,EAAE,CAACE,QAApB;AACAF,IAAAA,EAAE,CAACG,WAAH,CAAeH,EAAE,CAACI,cAAlB,EAAkC,CAAlC;AACAJ,IAAAA,EAAE,CAACG,WAAH,CAAeH,EAAE,CAACK,gBAAlB,EAAoC,CAApC;AACAL,IAAAA,EAAE,CAACG,WAAH,CAAeH,EAAE,CAACM,mBAAlB,EAAuC,KAAvC;AAEAN,IAAAA,EAAE,CAACO,eAAH,CAAmBP,EAAE,CAACQ,WAAtB,EAAmC,IAAnC,EAN6C,CAQ7C;;AACAR,IAAAA,EAAE,CAACS,MAAH,CAAUT,EAAE,CAACU,YAAb;AACAV,IAAAA,EAAE,CAACS,MAAH,CAAUT,EAAE,CAACW,SAAb;AACAX,IAAAA,EAAE,CAACY,QAAH,CAAYZ,EAAE,CAACa,IAAf;AACAb,IAAAA,EAAE,CAACc,SAAH,CAAad,EAAE,CAACe,GAAhB;AACAf,IAAAA,EAAE,CAACgB,aAAH,CAAiB,GAAjB,EAAsB,GAAtB,EAb6C,CAe7C;;AACAhB,IAAAA,EAAE,CAACS,MAAH,CAAUT,EAAE,CAACiB,UAAb;AACAjB,IAAAA,EAAE,CAACkB,SAAH,CAAa,IAAb;AACAlB,IAAAA,EAAE,CAACmB,SAAH,CAAanB,EAAE,CAACoB,IAAhB;AAEApB,IAAAA,EAAE,CAACqB,mBAAH,CAAuBrB,EAAE,CAACsB,KAA1B,EAAiCtB,EAAE,CAACuB,MAApC,EAA4C,CAA5C,EAA+C,MAA/C;AACAvB,IAAAA,EAAE,CAACwB,iBAAH,CAAqBxB,EAAE,CAACsB,KAAxB,EAA+BtB,EAAE,CAACyB,IAAlC,EAAwCzB,EAAE,CAACyB,IAA3C,EAAiDzB,EAAE,CAACyB,IAApD;AACAzB,IAAAA,EAAE,CAAC0B,mBAAH,CAAuB1B,EAAE,CAACsB,KAA1B,EAAiC,MAAjC;AACAtB,IAAAA,EAAE,CAACqB,mBAAH,CAAuBrB,EAAE,CAACa,IAA1B,EAAgCb,EAAE,CAACuB,MAAnC,EAA2C,CAA3C,EAA8C,MAA9C;AACAvB,IAAAA,EAAE,CAACwB,iBAAH,CAAqBxB,EAAE,CAACa,IAAxB,EAA8Bb,EAAE,CAACyB,IAAjC,EAAuCzB,EAAE,CAACyB,IAA1C,EAAgDzB,EAAE,CAACyB,IAAnD;AACAzB,IAAAA,EAAE,CAAC0B,mBAAH,CAAuB1B,EAAE,CAACa,IAA1B,EAAgC,MAAhC;AAEAb,IAAAA,EAAE,CAAC2B,OAAH,CAAW3B,EAAE,CAAC4B,YAAd,EA3B6C,CA6B7C;;AACA5B,IAAAA,EAAE,CAAC2B,OAAH,CAAW3B,EAAE,CAAC6B,wBAAd;AACA7B,IAAAA,EAAE,CAAC2B,OAAH,CAAW3B,EAAE,CAAC8B,KAAd;AACA9B,IAAAA,EAAE,CAAC+B,qBAAH,CAAyB/B,EAAE,CAACgC,QAA5B,EAAsChC,EAAE,CAACgC,QAAzC;AACAhC,IAAAA,EAAE,CAACiC,iBAAH,CAAqBjC,EAAE,CAACkC,GAAxB,EAA6BlC,EAAE,CAACmC,IAAhC,EAAsCnC,EAAE,CAACkC,GAAzC,EAA8ClC,EAAE,CAACmC,IAAjD;AACAnC,IAAAA,EAAE,CAACoC,SAAH,CAAa,IAAb,EAAmB,IAAnB,EAAyB,IAAzB,EAA+B,IAA/B;AACApC,IAAAA,EAAE,CAACqC,UAAH,CAAc,GAAd,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,GAA7B;AACH;;AAED,WAASC,YAAT,CAAuBtC,EAAvB,EAAmDuC,GAAnD,EAAqE;AACjE,QAAMC,QAAQ,GAAG,CAAC,EAAD,EAAK,SAAL,EAAgB,MAAhB,CAAjB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,QAAQ,CAACE,MAA7B,EAAqC,EAAED,CAAvC,EAA0C;AACtC,UAAME,IAAI,GAAG3C,EAAE,CAACsC,YAAH,CAAgBE,QAAQ,CAACC,CAAD,CAAR,GAAcF,GAA9B,CAAb;;AACA,UAAII,IAAJ,EAAU;AACV;AACI,eAAOA,IAAP;AACH;AACJ;;AACD,WAAO,IAAP;AACH;;AAEM,WAASC,aAAT,CAAwB5C,EAAxB,EAAoD;AACvD,QAAM6C,GAAsB,GAAG;AAC3BC,MAAAA,8BAA8B,EAAER,YAAY,CAACtC,EAAD,EAAK,gCAAL,CADjB;AAE3B+C,MAAAA,2BAA2B,EAAET,YAAY,CAACtC,EAAD,EAAK,6BAAL,CAFd;AAG3BgD,MAAAA,sBAAsB,EAAEV,YAAY,CAACtC,EAAD,EAAK,wBAAL,CAHT;AAI3BiD,MAAAA,gBAAgB,EAAEX,YAAY,CAACtC,EAAD,EAAK,kBAAL,CAJH;AAK3BkD,MAAAA,6BAA6B,EAAEZ,YAAY,CAACtC,EAAD,EAAK,+BAAL,CALhB;AAM3BmD,MAAAA,4BAA4B,EAAEb,YAAY,CAACtC,EAAD,EAAK,8BAAL,CANf;AAO3BoD,MAAAA,8BAA8B,EAAEd,YAAY,CAACtC,EAAD,EAAK,gCAAL,CAPjB;AAQ3BqD,MAAAA,6BAA6B,EAAEf,YAAY,CAACtC,EAAD,EAAK,+BAAL,CARhB;AAS3BsD,MAAAA,6BAA6B,EAAEhB,YAAY,CAACtC,EAAD,EAAK,+BAAL,CAThB;AAU3BuD,MAAAA,kCAAkC,EAAEjB,YAAY,CAACtC,EAAD,EAAK,oCAAL,CAVrB;AAW3BwD,MAAAA,mBAAmB,EAAElB,YAAY,CAACtC,EAAD,EAAK,qBAAL,CAXN;AAY3ByD,MAAAA,kBAAkB,EAAEnB,YAAY,CAACtC,EAAD,EAAK,oBAAL,CAZL;AAa3B0D,MAAAA,yBAAyB,EAAEpB,YAAY,CAACtC,EAAD,EAAK,2BAAL,CAbZ;AAc3B2D,MAAAA,6BAA6B,EAAErB,YAAY,CAACtC,EAAD,EAAK,+BAAL,CAdhB;AAe3B4D,MAAAA,wBAAwB,EAAEtB,YAAY,CAACtC,EAAD,EAAK,0BAAL,CAfX;AAgB3B6D,MAAAA,MAAM,EAAE;AAhBmB,KAA/B;AAmBA,WAAOhB,GAAP;AACH;;AAEM,WAASiB,UAAT,CAAqBC,MAArB,EAA+E;AAClF,QAAIC,OAAsC,GAAG,IAA7C;;AACA,QAAI;AACA,UAAMC,eAAuC,GAAG;AAC5CC,QAAAA,KAAK,EAAEC,KAAK,CAACC,yBAD+B;AAE5CC,QAAAA,SAAS,EAAEC,MAAM,IAAIH,KAAK,CAACI,sBAFiB;AAG5CC,QAAAA,KAAK,EAAE,IAHqC;AAI5CC,QAAAA,OAAO,EAAE,IAJmC;AAK5CC,QAAAA,kBAAkB,EAAE,KALwB;AAM5CC,QAAAA,qBAAqB,EAAE,KANqB;AAO5CC,QAAAA,eAAe,EAAE,SAP2B;AAQ5CC,QAAAA,4BAA4B,EAAE;AARc,OAAhD;AAWAb,MAAAA,OAAO,GAAGD,MAAM,CAACD,UAAP,CAAkB,QAAlB,EAA4BG,eAA5B,CAAV;AACH,KAbD,CAaE,OAAOa,GAAP,EAAY;AACV,aAAO,IAAP;AACH;;AAED,WAAOd,OAAP;AACH;;;mBA3CepB,a;gBAuBAkB;;;;;AApFPQ,MAAAA,M,mCAAAA,M;;AACAH,MAAAA,K,oBAAAA,K;AAAOY,MAAAA,M,oBAAAA,M;AAAQC,MAAAA,I,oBAAAA,I;AAAMC,MAAAA,K,oBAAAA,K;;AACrBC,MAAAA,gB,uBAAAA,gB;;AACAC,MAAAA,a,oBAAAA,a;;AACAC,MAAAA,M,iBAAAA,M;AAAQC,MAAAA,W,iBAAAA,W;AAAaC,MAAAA,c,iBAAAA,c;AAAgBC,MAAAA,W,iBAAAA,W;AAC1CC,MAAAA,e,iBAAAA,e;AAAiBC,MAAAA,iB,iBAAAA,iB;;AACZC,MAAAA,S,oBAAAA,S;;AACmBC,MAAAA,mB,mBAAAA,mB;;;AAEtBC,MAAAA,qB,GAAwB,kB;;iCAiGjBC,e;;;;;;;;;;;gBAKFC,U,GAA+B,IAAIZ,gBAAJ,E;gBAC/Ba,S,GAA2B,I;gBAC3BC,W,GAA6B,I;gBAE5BC,O,GAAoC,I;gBACpCC,yB,GAA6D,I;gBAC7DC,W,GAAwC,I;;;;;;eAEzCC,U,GAAP,oBAAmBC,IAAnB,EAAwC;AACpC,eAAKJ,OAAL,GAAeI,IAAI,CAACC,YAApB;AAEA,eAAKJ,yBAAL,GAAiC,KAAKK,mBAAL,CAAyBC,IAAzB,CAA8B,IAA9B,CAAjC;;AACA,eAAKP,OAAL,CAAaQ,gBAAb,CAA8Bb,qBAA9B,EAAqD,KAAKW,mBAA1D;;AAEA,cAAMvG,EAAE,GAAG2F,mBAAmB,CAACe,QAApB,CAA6B1G,EAAxC;AAEA,eAAK8F,UAAL,CAAgBM,UAAhB,CACIT,mBAAmB,CAACe,QAApB,CAA6BC,YAA7B,CAA0CC,eAD9C,EAEIjB,mBAAmB,CAACe,QAApB,CAA6BC,YAA7B,CAA0CE,wBAF9C,EAGIlB,mBAAmB,CAACe,QAApB,CAA6BC,YAA7B,CAA0CG,mBAH9C;AAMA,eAAKX,WAAL,GAAmBvD,aAAa,CAAC5C,EAAD,CAAhC,CAdoC,CAgBpC;;AACAD,UAAAA,UAAU,CAACC,EAAD,CAAV;AAEA,cAAM+G,QAAQ,GAAG3B,MAAM,CAAC4B,KAAxB;AACA,cAAIC,eAAe,GAAG7B,MAAM,CAAC8B,aAA7B;AAEA,cAAMC,SAAS,GAAGnH,EAAE,CAACoH,YAAH,CAAgBpH,EAAE,CAACqH,UAAnB,CAAlB;AACA,cAAMC,WAAW,GAAGtH,EAAE,CAACoH,YAAH,CAAgBpH,EAAE,CAACuH,YAAnB,CAApB;AAEA,cAAIJ,SAAS,IAAIG,WAAjB,EAA8BL,eAAe,GAAG7B,MAAM,CAAC8B,aAAzB,CAA9B,KACK,IAAIC,SAAJ,EAAeF,eAAe,GAAG7B,MAAM,CAACoC,KAAzB;AAEpB,eAAKC,aAAL,GAAqB,IAAItC,aAAJ,EAArB,CA5BoC,CA6BpC;;AACA,eAAKsC,aAAL,CAAmBC,sBAAnB,CAA0C;AACtCC,YAAAA,SAAS,EAAE,IAD2B;AAEtCC,YAAAA,MAAM,EAAEb,QAF8B;AAGtCc,YAAAA,KAAK,EAAExB,IAAI,CAACwB,KAH0B;AAItCC,YAAAA,MAAM,EAAEzB,IAAI,CAACyB;AAJyB,WAA1C;;AAOA,eAAKC,oBAAL,GAA4B,IAAI5C,aAAJ,EAA5B,CArCoC,CAsCpC;;AACA,eAAK4C,oBAAL,CAA0BL,sBAA1B,CAAiD;AAC7CC,YAAAA,SAAS,EAAE,IADkC;AAE7CC,YAAAA,MAAM,EAAEX,eAFqC;AAG7CY,YAAAA,KAAK,EAAExB,IAAI,CAACwB,KAHiC;AAI7CC,YAAAA,MAAM,EAAEzB,IAAI,CAACyB;AAJgC,WAAjD,EAvCoC,CA8CpC;;;AACA,eAAK/B,SAAL,GAAiBJ,mBAAmB,CAACe,QAApB,CAA6BsB,aAA7B,CAA2C,IAAI3C,WAAJ,CACxDE,WAAW,CAAC0C,KAD4C,EAExDzC,eAAe,CAAC0C,OAFwC,EAGxD9C,MAAM,CAAC4B,KAHiD,EAIxD,CAJwD,EAKxD,CALwD,EAMxD1B,cAAc,CAAC6C,IANyC,CAA3C,CAAjB;AASA,eAAKnC,WAAL,GAAmBL,mBAAmB,CAACe,QAApB,CAA6BsB,aAA7B,CAA2C,IAAI3C,WAAJ,CAC1DE,WAAW,CAAC6C,IAD8C,EAE1D5C,eAAe,CAAC0C,OAF0C,EAG1D9C,MAAM,CAAC4B,KAHmD,EAI1D,CAJ0D,EAK1D,CAL0D,EAM1D1B,cAAc,CAAC6C,IAN2C,EAO1D,CAP0D,CAA3C,CAAnB;AAUA,cAAME,aAAa,GAAG,IAAI5C,iBAAJ,EAAtB;AACA4C,UAAAA,aAAa,CAACC,SAAd,CAAwBT,KAAxB,GAAgC,CAAhC;AACAQ,UAAAA,aAAa,CAACC,SAAd,CAAwBR,MAAxB,GAAiC,CAAjC;AAEA,cAAMS,WAAW,GAAG,IAAIC,UAAJ,CAAe,KAAKzC,SAAL,CAAe0C,IAA9B,CAApB;AACAF,UAAAA,WAAW,CAACG,IAAZ,CAAiB,CAAjB;AACA/C,UAAAA,mBAAmB,CAACe,QAApB,CAA6BiC,oBAA7B,CAAkD,CAACJ,WAAD,CAAlD,EAAiE,KAAKxC,SAAtE,EAAiF,CAACsC,aAAD,CAAjF;AAEAA,UAAAA,aAAa,CAACO,SAAd,CAAwBC,UAAxB,GAAqC,CAArC;AACAlD,UAAAA,mBAAmB,CAACe,QAApB,CAA6BiC,oBAA7B,CACI,CAACJ,WAAD,EAAcA,WAAd,EAA2BA,WAA3B,EAAwCA,WAAxC,EAAqDA,WAArD,EAAkEA,WAAlE,CADJ,EAEI,KAAKvC,WAFT,EAEsB,CAACqC,aAAD,CAFtB;AAIH,S;;eAEMS,O,GAAP,mBAAwB;AACpB,cAAI,KAAK7C,OAAL,IAAgB,KAAKC,yBAAzB,EAAoD;AAChD,iBAAKD,OAAL,CAAa8C,mBAAb,CAAiCnD,qBAAjC,EAAwD,KAAKM,yBAA7D;;AACA,iBAAKA,yBAAL,GAAiC,IAAjC;AACH;;AAED,cAAI,KAAKH,SAAT,EAAoB;AAChB,iBAAKA,SAAL,CAAe+C,OAAf;AACA,iBAAK/C,SAAL,GAAiB,IAAjB;AACH;;AAED,cAAI,KAAKC,WAAT,EAAsB;AAClB,iBAAKA,WAAL,CAAiB8C,OAAjB;AACA,iBAAK9C,WAAL,GAAmB,IAAnB;AACH;;AAED,eAAKG,WAAL,GAAmB,IAAnB;AACA,eAAKF,OAAL,GAAe,IAAf;AACH,S;;eAEM+C,M,GAAP,gBAAenB,KAAf,EAA8BC,MAA9B,EAA8CmB,gBAA9C,EAAkF;AAC9E,cAAI,KAAKxB,aAAL,CAAmBI,KAAnB,KAA6BA,KAA7B,IAAsC,KAAKJ,aAAL,CAAmBK,MAAnB,KAA8BA,MAAxE,EAAgF;AAC5E7C,YAAAA,KAAK,0BAAwB4C,KAAxB,SAAiCC,MAAjC,CAAL;AACA,iBAAK7B,OAAL,CAAc4B,KAAd,GAAsBA,KAAtB;AACA,iBAAK5B,OAAL,CAAc6B,MAAd,GAAuBA,MAAvB;;AACA,iBAAKL,aAAL,CAAmBuB,MAAnB,CAA0BnB,KAA1B,EAAiCC,MAAjC;;AACA,iBAAKC,oBAAL,CAA0BiB,MAA1B,CAAiCnB,KAAjC,EAAwCC,MAAxC;AACH;AACJ,S;;eAEOvB,mB,GAAR,6BAA6B2C,KAA7B,EAA2C;AACvCnE,UAAAA,MAAM,CAAC,KAAD,CAAN;AACAC,UAAAA,IAAI,CAACkE,KAAD,CAAJ,CAFuC,CAGvC;AACA;AACH,S;;;;eAhID,eAAkB;AACd,mBAAO,KAAK/C,WAAZ;AACH;;;;QAHgCT,S"}
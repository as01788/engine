{"version":3,"sources":["../../../../../../../../../cocos/core/pipeline/batched-buffer.ts"],"names":["BufferUsageBit","Format","MemoryUsageBit","InputAssemblerInfo","Attribute","BufferInfo","Mat4","UBOLocalBatched","BatchedBuffer","pass","batches","dynamicOffsets","_device","device","destroy","i","length","batch","j","vbs","vbIdx","ia","ubo","merge","subModel","passIdx","model","flatBuffers","subMesh","vbSize","vbIdxSize","vbCount","count","passes","shader","shaders","descriptorSet","isBatchExist","mergeCount","BATCHING_COUNT","vb","stride","flatBuff","batchVB","vbBuf","vbDatas","size","resize","Uint8Array","set","buffer","vbIdxBuf","vbIdxData","Float32Array","BYTES_PER_ELEMENT","start","end","toArray","uboData","transform","worldMatrix","MAT_WORLDS_OFFSET","bindBuffer","BINDING","update","vertexCount","totalVBs","newVB","createBuffer","VERTEX","TRANSFER_DST","HOST","DEVICE","push","fill","attributes","inputAssembler","attrs","Array","a","R32F","iaInfo","createInputAssembler","UNIFORM","SIZE","COUNT","clear"],"mappings":"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"}
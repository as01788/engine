{"version":3,"sources":["../../../../../../../../../../cocos/core/renderer/scene/skybox.ts"],"names":["JSB","builtinResMgr","Material","UNIFORM_ENVIRONMENT_BINDING","UNIFORM_DIFFUSEMAP_BINDING","MaterialInstance","legacyCC","NaitveSkybox","skybox_mesh","skybox_material","Skybox","_envmapLDR","_envmapHDR","_diffuseMapLDR","_diffuseMapHDR","_globalDSManager","_model","_default","_enabled","_useIBL","_useHDR","_useDiffuseMap","_nativeObj","_setEnabled","val","enabled","_setUseIBL","useIBL","_setUseHDR","useHDR","_setUseDiffuseMap","useDiffuseMap","initialize","skyboxInfo","applyDiffuseMap","setEnvMaps","envmapHDR","envmapLDR","root","director","isHDR","pipeline","pipelineSceneData","ambient","groundAlbedo","w","mipmapLevel","_updateGlobalBinding","_updatePipeline","setDiffuseMaps","diffuseMapHDR","diffuseMapLDR","activate","globalDSManager","get","createModel","renderer","scene","Model","_initLocalDescriptors","_initWorldBoundDescriptors","model","isRGBE","envmap","mat","effectName","defines","USE_RGBE_CUBEMAP","parent","utils","createMesh","primitives","box","width","height","length","initSubModel","renderingSubMeshes","diffuseMap","recompileShaders","setSubModelMaterial","useIBLValue","useDiffuseMapValue","useHDRValue","macros","CC_USE_IBL","CC_USE_DIFFUSEMAP","CC_USE_HDR","onGlobalPipelineStateChanged","device","texture","getGFXTexture","sampler","getSampler","getSamplerInfo","bindSampler","bindTexture","update","_destroy","destroy"],"mappings":"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"}
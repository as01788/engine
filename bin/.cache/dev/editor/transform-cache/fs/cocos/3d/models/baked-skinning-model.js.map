{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/3d/models/baked-skinning-model.ts"],"names":["myPatches","name","value","BakedSkinningModel","MorphModel","constructor","uploadedAnim","undefined","_jointsMedium","_skeleton","_mesh","_dataPoolManager","_instAnimInfoIdx","type","ModelType","BAKED_SKINNING","legacyCC","director","root","dataPoolManager","jointTextureInfo","Float32Array","animInfo","jointAnimationInfo","getData","buffer","texture","boundsInfo","_init","JSB","_nativeObj","NativeBakedSkinningModel","destroy","_applyJointTexture","_applyNativeJointMedium","bindSkeleton","skeleton","skinningRoot","mesh","transform","resMgr","uuid","_device","createBuffer","BufferInfo","BufferUsageBit","UNIFORM","TRANSFER_DST","MemoryUsageBit","DEVICE","UBOSkinningTexture","SIZE","updateTransform","stamp","skelBound","data","worldBounds","_worldBounds","node","_mat","_pos","_rot","_scale","updateUBOs","info","idx","view","instancedAttributes","views","dirty","update","forEach","bound","push","native","animInfoKey","setJointMedium","_updateModelBounds","aabb","_modelBounds","updateModelBounds","uploadAnimation","anim","jointTexturePool","getSequencePoseTexture","bounds","get","hash","getDefaultPoseTexture","oldTex","releaseHandle","handle","width","joints","length","pixelOffset","updateInstancedJointTextureInfo","tex","i","_subModels","descriptorSet","bindTexture","UNIFORM_JOINT_TEXTURE_BINDING","getMacroPatches","subModelIndex","patches","concat","_updateLocalDescriptors","submodelIdx","bindBuffer","BINDING","UBOSkinningAnimation","sampler","getSampler","jointTextureSamplerInfo","bindSampler","_setInstAnimInfoIdx","setAnimInfoIdx","_updateInstancedAttributes","attributes","pass","_getInstancedAttributeIndex","INST_JOINT_ANIM_INFO"],"mappings":"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"}
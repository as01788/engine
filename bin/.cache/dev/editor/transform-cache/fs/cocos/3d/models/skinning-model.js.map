{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/3d/models/skinning-model.ts"],"names":["myPatches","name","value","getRelevantBuffers","outIndices","outBuffers","jointMaps","targetJoint","i","length","idxMap","index","j","push","v3_min","Vec3","v3_max","v3_1","v3_2","m4_1","Mat4","ab_1","AABB","SkinningModel","MorphModel","constructor","uploadAnimation","_buffers","_dataArray","_joints","_bufferIndices","type","ModelType","SKINNING","_init","JSB","_nativeObj","NativeSkinningModel","destroy","bindSkeleton","skeleton","skinningRoot","mesh","target","transform","boneSpaceBounds","getBoneSpaceBounds","struct","_ensureEnoughBuffers","jointBufferIndices","nativeJoints","joints","bound","getChildByPath","bindpose","bindposes","indices","buffers","currParent","parent","transParents","node","native","local","world","stamp","parents","setIndicesAndJoints","updateTransform","root","hasChangedFlags","_dirtyFlags","updateWorldTransform","_localDataUpdated","set","Infinity","worldMatrix","getBoundary","min","max","worldBounds","_worldBounds","_modelBounds","fromPoints","_mat","_pos","_rot","_scale","_updateNativeBounds","updateUBOs","multiply","b","update","initSubModel","idx","subMeshData","mat","original","vertexBuffers","iaInfo","jointMappedBuffers","getMacroPatches","subModelIndex","superMacroPatches","concat","_updateLocalDescriptors","submodelIdx","descriptorSet","updateLocalDescriptors","buffer","bindBuffer","UBOSkinning","BINDING","_updateInstancedAttributes","attributes","pass","batchingScheme","BatchingSchemes","NONE","count","_device","createBuffer","BufferInfo","BufferUsageBit","UNIFORM","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","SIZE","Float32Array","COUNT","setBuffers"],"mappings":";;;;;;;AA8BA;;AAKA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AA9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAoBA,MAAMA,SAAwB,GAAG,CAC7B;AAAEC,EAAAA,IAAI,EAAE,iBAAR;AAA2BC,EAAAA,KAAK,EAAE;AAAlC,CAD6B,CAAjC;;AAIA,SAASC,kBAAT,CAA6BC,UAA7B,EAAmDC,UAAnD,EAAyEC,SAAzE,EAAgGC,WAAhG,EAAqH;AACjH,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,SAAS,CAACG,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACvC,UAAME,MAAM,GAAGJ,SAAS,CAACE,CAAD,CAAxB;AACA,QAAIG,KAAK,GAAG,CAAC,CAAb;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAAM,CAACD,MAA3B,EAAmCG,CAAC,EAApC,EAAwC;AACpC,UAAIF,MAAM,CAACE,CAAD,CAAN,KAAcL,WAAlB,EAA+B;AAAEI,QAAAA,KAAK,GAAGC,CAAR;AAAW;AAAQ;AACvD;;AACD,QAAID,KAAK,IAAI,CAAb,EAAgB;AACZN,MAAAA,UAAU,CAACQ,IAAX,CAAgBL,CAAhB;AACAJ,MAAAA,UAAU,CAACS,IAAX,CAAgBF,KAAhB;AACH;AACJ;AACJ;;AAWD,MAAMG,MAAM,GAAG,IAAIC,YAAJ,EAAf;AACA,MAAMC,MAAM,GAAG,IAAID,YAAJ,EAAf;AACA,MAAME,IAAI,GAAG,IAAIF,YAAJ,EAAb;AACA,MAAMG,IAAI,GAAG,IAAIH,YAAJ,EAAb;AACA,MAAMI,IAAI,GAAG,IAAIC,YAAJ,EAAb;AACA,MAAMC,IAAI,GAAG,IAAIC,WAAJ,EAAb;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMC,aAAN,SAA4BC,sBAA5B,CAAuC;AAO1CC,EAAAA,WAAW,GAAI;AACX;AADW,SANRC,eAMQ,GANU,IAMV;AAAA,SAJPC,QAIO,GAJc,EAId;AAAA,SAHPC,UAGO,GAHsB,EAGtB;AAAA,SAFPC,OAEO,GAFiB,EAEjB;AAAA,SADPC,cACO,GAD2B,IAC3B;AAEX,SAAKC,IAAL,GAAYC,iBAAUC,QAAtB;AACH;;AAESC,EAAAA,KAAK,GAAI;AACf,QAAIC,0BAAJ,EAAS;AACL,WAAKC,UAAL,GAAkB,IAAIC,2BAAJ,EAAlB;AACH;AACJ;;AAEMC,EAAAA,OAAO,GAAI;AACd,SAAKC,YAAL;;AACA,QAAI,KAAKZ,QAAL,CAAclB,MAAlB,EAA0B;AACtB,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKmB,QAAL,CAAclB,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,aAAKmB,QAAL,CAAcnB,CAAd,EAAiB8B,OAAjB;AACH;;AACD,WAAKX,QAAL,CAAclB,MAAd,GAAuB,CAAvB;AACH;;AACD,UAAM6B,OAAN;AACH;;AAEMC,EAAAA,YAAY,CAAEC,QAAyB,GAAG,IAA9B,EAAoCC,YAAyB,GAAG,IAAhE,EAAsEC,IAAiB,GAAG,IAA1F,EAAgG;AAC/G,SAAK,IAAIlC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKqB,OAAL,CAAapB,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC1C,oDAAgB,KAAKqB,OAAL,CAAarB,CAAb,EAAgBmC,MAAhC;AACH;;AACD,SAAKb,cAAL,GAAsB,IAAtB;AAA4B,SAAKD,OAAL,CAAapB,MAAb,GAAsB,CAAtB;;AAC5B,QAAI,CAAC+B,QAAD,IAAa,CAACC,YAAd,IAA8B,CAACC,IAAnC,EAAyC;AAAE;AAAS;;AACpD,SAAKE,SAAL,GAAiBH,YAAjB;AACA,UAAMI,eAAe,GAAGH,IAAI,CAACI,kBAAL,CAAwBN,QAAxB,CAAxB;AACA,UAAMlC,SAAS,GAAGoC,IAAI,CAACK,MAAL,CAAYzC,SAA9B;;AACA,SAAK0C,oBAAL,CAA0B1C,SAAS,IAAIA,SAAS,CAACG,MAAvB,IAAiC,CAA3D;;AACA,SAAKqB,cAAL,GAAsBY,IAAI,CAACO,kBAA3B;AACA,UAAMC,YAA+B,GAAG,EAAxC;;AACA,SAAK,IAAIvC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG6B,QAAQ,CAACW,MAAT,CAAgB1C,MAA5C,EAAoDE,KAAK,EAAzD,EAA6D;AACzD,YAAMyC,KAAK,GAAGP,eAAe,CAAClC,KAAD,CAA7B;AACA,YAAMgC,MAAM,GAAGF,YAAY,CAACY,cAAb,CAA4Bb,QAAQ,CAACW,MAAT,CAAgBxC,KAAhB,CAA5B,CAAf;;AACA,UAAI,CAACyC,KAAD,IAAU,CAACT,MAAf,EAAuB;AAAE;AAAW;;AACpC,YAAMC,SAAS,GAAG,2CAAaD,MAAb,EAAqBF,YAArB,CAAlB;AACA,YAAMa,QAAQ,GAAGd,QAAQ,CAACe,SAAT,CAAmB5C,KAAnB,CAAjB;AACA,YAAM6C,OAAiB,GAAG,EAA1B;AACA,YAAMC,OAAiB,GAAG,EAA1B;;AACA,UAAI,CAACnD,SAAL,EAAgB;AAAEkD,QAAAA,OAAO,CAAC3C,IAAR,CAAaF,KAAb;AAAqB8C,QAAAA,OAAO,CAAC5C,IAAR,CAAa,CAAb;AAAkB,OAAzD,MAA+D;AAAEV,QAAAA,kBAAkB,CAACqD,OAAD,EAAUC,OAAV,EAAmBnD,SAAnB,EAA8BK,KAA9B,CAAlB;AAAyD;;AAC1H,WAAKkB,OAAL,CAAahB,IAAb,CAAkB;AAAE2C,QAAAA,OAAF;AAAWC,QAAAA,OAAX;AAAoBL,QAAAA,KAApB;AAA2BT,QAAAA,MAA3B;AAAmCW,QAAAA,QAAnC;AAA6CV,QAAAA;AAA7C,OAAlB;;AACA,UAAIT,0BAAJ,EAAS;AACL,YAAIuB,UAA8C,GAAGd,SAAS,CAACe,MAA/D;AACA,cAAMC,YAAoC,GAAG,EAA7C;;AACA,eAAOF,UAAP,EAAmB;AACfE,UAAAA,YAAY,CAAC/C,IAAb,CAAkB;AAAEgD,YAAAA,IAAI,EAAEH,UAAU,CAACG,IAAX,CAAgBC,MAAxB;AAAgCC,YAAAA,KAAK,EAAEL,UAAU,CAACK,KAAlD;AAAyDC,YAAAA,KAAK,EAAEN,UAAU,CAACK,KAA3E;AAAkFE,YAAAA,KAAK,EAAEP,UAAU,CAACO;AAApG,WAAlB;AACAP,UAAAA,UAAU,GAAGA,UAAU,CAACC,MAAxB;AACH;;AACDT,QAAAA,YAAY,CAACrC,IAAb,CAAkB;AAAE2C,UAAAA,OAAF;AACdC,UAAAA,OADc;AAEdL,UAAAA,KAAK,EAAEA,KAAK,CAACU,MAFC;AAGdnB,UAAAA,MAAM,EAAEA,MAAM,CAACmB,MAHD;AAIdR,UAAAA,QAJc;AAKdV,UAAAA,SAAS,EAAE;AAAEiB,YAAAA,IAAI,EAAEjB,SAAS,CAACiB,IAAV,CAAeC,MAAvB;AAA+BC,YAAAA,KAAK,EAAEnB,SAAS,CAACmB,KAAhD;AAAuDC,YAAAA,KAAK,EAAEpB,SAAS,CAACoB,KAAxE;AAA+EC,YAAAA,KAAK,EAAErB,SAAS,CAACqB;AAAhG,WALG;AAMdC,UAAAA,OAAO,EAAEN;AANK,SAAlB;AAQH;AACJ;;AACD,QAAIzB,0BAAJ,EAAS;AACJ,WAAKC,UAAN,CAA0C+B,mBAA1C,CAA8D,KAAKrC,cAAnE,EAAmFoB,YAAnF;AACH;AACJ;;AAEMkB,EAAAA,eAAe,CAAEH,KAAF,EAAiB;AACnC,UAAMI,IAAI,GAAG,KAAKzB,SAAlB,CADmC,CAEnC;;AACA,QAAIyB,IAAI,CAACC,eAAL,IAAwBD,IAAI,CAACE,WAAjC,EAA8C;AAC1CF,MAAAA,IAAI,CAACG,oBAAL;AACA,WAAKC,iBAAL,GAAyB,IAAzB;AACH,KANkC,CAOnC;;;AACA1D,iBAAK2D,GAAL,CAAS5D,MAAT,EAAkB6D,QAAlB,EAA6BA,QAA7B,EAAwCA,QAAxC;;AACA5D,iBAAK2D,GAAL,CAAS1D,MAAT,EAAiB,CAAC2D,QAAlB,EAA4B,CAACA,QAA7B,EAAuC,CAACA,QAAxC;;AACA,SAAK,IAAInE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKqB,OAAL,CAAapB,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC1C,YAAM;AAAE4C,QAAAA,KAAF;AAASR,QAAAA;AAAT,UAAuB,KAAKf,OAAL,CAAarB,CAAb,CAA7B;AACA,YAAMoE,WAAW,GAAG,6CAAehC,SAAf,EAA0BqB,KAA1B,CAApB;;AACA3C,kBAAKsB,SAAL,CAAevB,IAAf,EAAqB+B,KAArB,EAA4BwB,WAA5B;;AACAvD,MAAAA,IAAI,CAACwD,WAAL,CAAiB5D,IAAjB,EAAuBC,IAAvB;;AACAH,mBAAK+D,GAAL,CAAShE,MAAT,EAAiBA,MAAjB,EAAyBG,IAAzB;;AACAF,mBAAKgE,GAAL,CAAS/D,MAAT,EAAiBA,MAAjB,EAAyBE,IAAzB;AACH;;AACD,UAAM8D,WAAW,GAAG,KAAKC,YAAzB;;AACA,QAAI,KAAKC,YAAL,IAAqBF,WAAzB,EAAsC;AAClC1D,kBAAK6D,UAAL,CAAgB,KAAKD,YAArB,EAAmCpE,MAAnC,EAA2CE,MAA3C,EADkC,CAElC;;;AACA,WAAKkE,YAAL,CAAkBtC,SAAlB,CAA4ByB,IAAI,CAACe,IAAjC,EAAuCf,IAAI,CAACgB,IAA5C,EAAkDhB,IAAI,CAACiB,IAAvD,EAA6DjB,IAAI,CAACkB,MAAlE,EAA0E,KAAKN,YAA/E;;AACA,WAAKO,mBAAL;AACH;AACJ;;AAEMC,EAAAA,UAAU,CAAExB,KAAF,EAAiB;AAC9B,UAAMwB,UAAN,CAAiBxB,KAAjB;;AACA,SAAK,IAAIzD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKqB,OAAL,CAAapB,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC1C,YAAM;AAAEgD,QAAAA,OAAF;AAAWC,QAAAA,OAAX;AAAoBb,QAAAA,SAApB;AAA+BU,QAAAA;AAA/B,UAA4C,KAAKzB,OAAL,CAAarB,CAAb,CAAlD;;AACAY,mBAAKsE,QAAL,CAAcvE,IAAd,EAAoByB,SAAS,CAACoB,KAA9B,EAAqCV,QAArC;;AACA,WAAK,IAAIqC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,OAAO,CAAChD,MAA5B,EAAoCkF,CAAC,EAArC,EAAyC;AACrC,qDAAgB,KAAK/D,UAAL,CAAgB6B,OAAO,CAACkC,CAAD,CAAvB,CAAhB,EAA6CnC,OAAO,CAACmC,CAAD,CAAP,GAAa,EAA1D,EAA8DxE,IAA9D,EAAoEX,CAAC,KAAK,CAA1E;AACH;AACJ;;AACD,SAAK,IAAImF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhE,QAAL,CAAclB,MAAlC,EAA0CkF,CAAC,EAA3C,EAA+C;AAC3C,WAAKhE,QAAL,CAAcgE,CAAd,EAAiBC,MAAjB,CAAwB,KAAKhE,UAAL,CAAgB+D,CAAhB,CAAxB;AACH;;AACD,WAAO,IAAP;AACH;;AAEME,EAAAA,YAAY,CAAEC,GAAF,EAAeC,WAAf,EAA8CC,GAA9C,EAA6D;AAC5E,UAAMC,QAAQ,GAAGF,WAAW,CAACG,aAA7B;AACA,UAAMC,MAAM,GAAGJ,WAAW,CAACI,MAA3B;AACAA,IAAAA,MAAM,CAACD,aAAP,GAAuBH,WAAW,CAACK,kBAAnC;AACA,UAAMP,YAAN,CAAmBC,GAAnB,EAAwBC,WAAxB,EAAqCC,GAArC;AACAG,IAAAA,MAAM,CAACD,aAAP,GAAuBD,QAAvB;AACH;;AAEMI,EAAAA,eAAe,CAAEC,aAAF,EAA+C;AACjE,UAAMC,iBAAiB,GAAG,MAAMF,eAAN,CAAsBC,aAAtB,CAA1B;;AACA,QAAIC,iBAAJ,EAAuB;AACnB,aAAOvG,SAAS,CAACwG,MAAV,CAAiBD,iBAAjB,CAAP;AACH;;AACD,WAAOvG,SAAP;AACH;;AAEMyG,EAAAA,uBAAuB,CAAEC,WAAF,EAAuBC,aAAvB,EAAqD;AAC/E,UAAMF,uBAAN,CAA8BC,WAA9B,EAA2CC,aAA3C;;AACA,QAAIxE,0BAAJ,EAAS;AACJ,WAAKC,UAAN,CAA0CwE,sBAA1C,CAAiEF,WAAjE,EAA8EC,aAA9E;;AACA;AACH;;AACD,UAAME,MAAM,GAAG,KAAKlF,QAAL,CAAc,KAAKG,cAAL,CAAqB4E,WAArB,CAAd,CAAf;;AACA,QAAIG,MAAJ,EAAY;AAAEF,MAAAA,aAAa,CAACG,UAAd,CAAyBC,oBAAYC,OAArC,EAA8CH,MAA9C;AAAwD;AACzE;;AAESI,EAAAA,0BAA0B,CAAEC,UAAF,EAA2BC,IAA3B,EAAuC;AACvE,QAAIA,IAAI,CAACC,cAAL,KAAwBC,wBAAgBC,IAA5C,EAAkD;AAC9C;AACA,yBAAO,IAAP,EAAa,KAAKzD,IAAL,CAAU5D,IAAvB;AACH;;AACD,UAAMgH,0BAAN,CAAiCC,UAAjC,EAA6CC,IAA7C;AACH;;AAEOnE,EAAAA,oBAAoB,CAAEuE,KAAF,EAAiB;AACzC,SAAK,IAAI/G,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+G,KAApB,EAA2B/G,CAAC,EAA5B,EAAgC;AAC5B,UAAI,CAAC,KAAKmB,QAAL,CAAcnB,CAAd,CAAL,EAAuB;AACnB,aAAKmB,QAAL,CAAcnB,CAAd,IAAmB,KAAKgH,OAAL,CAAaC,YAAb,CAA0B,IAAIC,kBAAJ,CACzCC,uBAAeC,OAAf,GAAyBD,uBAAeE,YADC,EAEzCC,uBAAeC,IAAf,GAAsBD,uBAAeE,MAFI,EAGzCjB,oBAAYkB,IAH6B,EAIzClB,oBAAYkB,IAJ6B,CAA1B,CAAnB;AAMH;;AACD,UAAI,CAAC,KAAKrG,UAAL,CAAgBpB,CAAhB,CAAL,EAAyB;AACrB,aAAKoB,UAAL,CAAgBpB,CAAhB,IAAqB,IAAI0H,YAAJ,CAAiBnB,oBAAYoB,KAA7B,CAArB;AACH;AACJ;;AACD,QAAIhG,0BAAJ,EAAS;AACJ,WAAKC,UAAN,CAA0CgG,UAA1C,CAAqD,KAAKzG,QAA1D;AACH;AACJ;;AAtKyC"}
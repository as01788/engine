{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/particle/animator/optimized-curve.ts"],"names":["CURVE_MODE_CONSTANT","CURVE_MODE_RANDOM_CONSTANT","CURVE_MODE_CURVE","CURVE_MODE_RANDOM_CURVE","UNIFORM_CURVE_KEY_NUM","integrateKeyframe","coef","integrateKeyframeTwice","OptimizedCurve","constructor","constructUniform","optimizedKeys","integral","coefUniform","timeUniform","integralUniform","Array","buildCurve","animationCurve","multiplier","keyNum","keyFrames","length","i","keyToAdd","optKey","OptimizedKey","push","splice","coefficient","value","time","endTime","keyOffset","unshift","calcOptimizedKey","Math","min","index","Float32Array","updateKeyUniform","evaluate","integrateOnce","deltaT","prevIntegral","updateIntegralUniform","evaluateIntegral","t","ts","prevInt","dt","integrateTwice","evaluateIntegralTwice"],"mappings":"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"}
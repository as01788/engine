{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/gfx/webgl/webgl-device.ts"],"names":["WebGLDevice","Device","_swapchain","_context","gl","extensions","stateCache","nullTex2D","nullTexCube","initialize","info","WebGLDeviceManager","setInstance","_gfxAPI","API","WEBGL","_bindingMappingInfo","bindingMappingInfo","bufferOffsets","length","push","samplerOffsets","canvas","console","error","_queue","createQueue","QueueInfo","QueueType","GRAPHICS","_cmdBuff","createCommandBuffer","CommandBufferInfo","_caps","maxVertexAttributes","getParameter","MAX_VERTEX_ATTRIBS","maxVertexUniformVectors","MAX_VERTEX_UNIFORM_VECTORS","maxFragmentUniformVectors","MAX_FRAGMENT_UNIFORM_VECTORS","maxTextureUnits","MAX_TEXTURE_IMAGE_UNITS","maxVertexTextureUnits","MAX_VERTEX_TEXTURE_IMAGE_UNITS","maxTextureSize","MAX_TEXTURE_SIZE","maxCubeMapTextureSize","MAX_CUBE_MAP_TEXTURE_SIZE","getSupportedExtensions","extStr","ext","exts","WEBGL_debug_renderer_info","_renderer","UNMASKED_RENDERER_WEBGL","_vendor","UNMASKED_VENDOR_WEBGL","RENDERER","VENDOR","version","VERSION","_features","fill","EXT_sRGB","Feature","FORMAT_SRGB","EXT_blend_minmax","BLEND_MINMAX","WEBGL_color_buffer_float","COLOR_FLOAT","EXT_color_buffer_half_float","COLOR_HALF_FLOAT","OES_texture_float","TEXTURE_FLOAT","OES_texture_half_float","TEXTURE_HALF_FLOAT","OES_texture_float_linear","TEXTURE_FLOAT_LINEAR","OES_texture_half_float_linear","TEXTURE_HALF_FLOAT_LINEAR","FORMAT_RGB8","OES_element_index_uint","ELEMENT_INDEX_UINT","ANGLE_instanced_arrays","INSTANCED_ARRAYS","WEBGL_draw_buffers","MULTIPLE_RENDER_TARGETS","compressedFormat","WEBGL_compressed_texture_etc1","FORMAT_ETC1","WEBGL_compressed_texture_etc","FORMAT_ETC2","WEBGL_compressed_texture_s3tc","FORMAT_DXT","WEBGL_compressed_texture_pvrtc","FORMAT_PVRTC","WEBGL_compressed_texture_astc","FORMAT_ASTC","destroy","flushCommands","cmdBuffs","acquire","swapchains","present","queue","_numDrawCalls","numDrawCalls","_numInstances","numInstances","_numTris","numTris","clear","Ctor","type","CommandBufferType","PRIMARY","WebGLPrimaryCommandBuffer","WebGLCommandBuffer","cmdBuff","createSwapchain","swapchain","WebGLSwapchain","createBuffer","buffer","WebGLBuffer","createTexture","texture","WebGLTexture","createDescriptorSet","descriptorSet","WebGLDescriptorSet","createShader","shader","WebGLShader","createInputAssembler","inputAssembler","WebGLInputAssembler","createRenderPass","renderPass","WebGLRenderPass","createFramebuffer","framebuffer","WebGLFramebuffer","createDescriptorSetLayout","descriptorSetLayout","WebGLDescriptorSetLayout","createPipelineLayout","pipelineLayout","WebGLPipelineLayout","createPipelineState","pipelineState","WebGLPipelineState","WebGLQueue","getSampler","hash","Sampler","computeHash","_samplers","has","set","WebGLSampler","get","getGlobalBarrier","GlobalBarrier","_globalBarriers","getTextureBarrier","TextureBarrier","_textureBarriers","copyBuffersToTexture","buffers","regions","gpuTexture","copyTextureToBuffers","copyTexImagesToTexture","texImages"],"mappings":"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"}
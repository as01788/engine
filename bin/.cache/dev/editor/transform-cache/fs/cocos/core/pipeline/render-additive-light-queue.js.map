{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/pipeline/render-additive-light-queue.ts"],"names":["_lightPassPool","Pool","subModel","passIdx","dynamicOffsets","lights","_vec4Array","Float32Array","_dynamicOffsets","_lightIndices","_matShadowView","Mat4","_matShadowViewProj","cullSphereLight","light","model","worldBounds","intersect","aabbWithAABB","aabb","cullSpotLight","aabbFrustum","frustum","_phaseID","_lightPassIndices","getLightPassIndices","subModels","lightPassIndices","length","hasValidLightPass","j","passes","lightPassIndex","k","phase","push","RenderAdditiveLightQueue","constructor","pipeline","_pipeline","_device","_lightPasses","_shadowUBO","UBOShadow","COUNT","_lightBufferCount","_lightBufferStride","_lightBufferElementCount","_lightBuffer","_firstLightBufferView","_lightBufferData","_instancedQueue","_batchedQueue","_lightMeterScale","device","RenderInstancedQueue","RenderBatchedQueue","alignment","capabilities","uboOffsetAlignment","Math","ceil","UBOForwardLight","SIZE","BYTES_PER_ELEMENT","createBuffer","BufferInfo","BufferUsageBit","UNIFORM","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","BufferViewInfo","clear","i","lp","freeArray","destroy","descriptorSetMap","globalDSManager","keys","key","descriptorSet","get","getBuffer","BINDING","getTexture","UNIFORM_SHADOWMAP_BINDING","UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING","delete","gatherLightPasses","camera","cmdBuff","validPunctualLights","pipelineSceneData","_updateUBOs","_updateLightDescriptorSet","renderObjects","ro","_lightCulling","lightPassIdx","pass","isTransparent","blendState","targets","blend","bindBuffer","update","_addRenderQueue","uploadBuffers","recordCommandBuffer","renderPass","shader","shaders","ia","inputAssembler","pso","PipelineStateManager","getOrCreatePipelineState","matDS","localDS","bindPipelineState","bindDescriptorSet","SetIndex","MATERIAL","bindInputAssembler","getOrCreateDescriptorSet","GLOBAL","LOCAL","draw","l","isCulled","type","LightType","SPHERE","SPOT","batchingScheme","BatchingSchemes","INSTANCING","idx","buffer","getInstancedBuffer","merge","instancedAttributes","queue","add","VB_MERGING","getBatchedBuffer","alloc","sceneData","shadowInfo","shadows","shadowFrameBufferMap","mainLight","scene","linear","packing","matShadowProj","matShadowInvProj","SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET","size","x","y","pcf","bias","SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET","normalBias","Color","toArray","shadowColor","SHADOW_COLOR_OFFSET","invert","node","getWorldMatrix","perspective","angle","aspect","range","clone","multiply","MAT_LIGHT_VIEW_OFFSET","MAT_LIGHT_VIEW_PROJ_OFFSET","SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET","saturation","SHADOW_PROJ_DEPTH_INFO_OFFSET","m10","m14","m11","m15","SHADOW_INV_PROJ_DEPTH_INFO_OFFSET","SHADOW_PROJ_INFO_OFFSET","m00","m05","has","texture","colorTextures","bindTexture","updateBuffer","exposure","isHDR","resize","initialize","offset","Vec3","position","set","LIGHT_POS_OFFSET","enabled","ShadowType","ShadowMap","LIGHT_SIZE_RANGE_ANGLE_OFFSET","color","useColorTemperature","tempRGB","colorTemperatureRGB","z","luminance","LIGHT_COLOR_OFFSET","spotAngle","direction","LIGHT_DIR_OFFSET"],"mappings":"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"}
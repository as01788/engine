{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/pipeline/instanced-buffer.ts"],"names":["INITIAL_CAPACITY","MAX_CAPACITY","InstancedBuffer","constructor","pass","instances","hasPendingModels","dynamicOffsets","_device","device","destroy","i","length","instance","vb","ia","merge","subModel","attrs","passIdx","shaderImplant","stride","buffer","sourceIA","inputAssembler","lightingMap","descriptorSet","getTexture","UNIFORM_LIGHTMAP_TEXTURE_BINDING","shader","shaders","indexBuffer","count","capacity","newSize","oldData","data","Uint8Array","set","resize","createBuffer","BufferInfo","BufferUsageBit","VERTEX","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","vertexBuffers","slice","attributes","attr","newAttr","Attribute","name","format","isNormalized","push","iaInfo","InputAssemblerInfo","createInputAssembler","uploadBuffers","cmdBuff","instanceCount","updateBuffer","clear"],"mappings":"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"}
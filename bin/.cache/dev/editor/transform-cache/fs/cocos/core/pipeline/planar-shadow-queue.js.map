{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/pipeline/planar-shadow-queue.ts"],"names":["_ab","AABB","PlanarShadowQueue","constructor","pipeline","_pendingModels","_castModels","_instancedQueue","RenderInstancedQueue","_pipeline","gatherShadowPasses","camera","cmdBuff","pipelineSceneData","pipelineUBO","shadows","clear","length","enabled","type","ShadowType","Planar","scene","frustum","shadowVisible","visibility","Layers","BitMask","DEFAULT","mainLight","models","i","model","node","castShadow","push","instancedBuffer","instancingMaterial","passes","getInstancedBuffer","queue","add","worldBounds","transform","matLight","intersect","aabbFrustum","isInstancingEnabled","subModels","m","subModel","merge","instancedAttributes","planarInstanceShader","uploadBuffers","recordCommandBuffer","device","renderPass","pass","material","descriptorSet","bindDescriptorSet","SetIndex","MATERIAL","modelCount","j","shader","planarShader","ia","inputAssembler","pso","PipelineStateManager","getOrCreatePipelineState","bindPipelineState","LOCAL","bindInputAssembler","draw"],"mappings":"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"}
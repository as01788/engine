{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/pipeline/shadow/shadow-stage.ts"],"names":["colors","Color","ShadowStage","RenderStage","_shadowFrameBuffer","_renderArea","Rect","_light","_globalDS","setUsage","globalDS","light","shadowFrameBuffer","destroy","_additiveShadowQueue","clear","clearFramebuffer","camera","w","clearColor","pipeline","_pipeline","cmdBuff","commandBuffers","renderPass","beginRenderPass","clearDepth","clearStencil","endRenderPass","render","pipelineSceneData","shadowInfo","shadows","shadingScale","descriptorSet","pipelineUBO","updateShadowUBOLight","gatherLightPasses","vp","viewport","shadowMapSize","size","x","y","width","height","device","bindDescriptorSet","SetIndex","GLOBAL","recordCommandBuffer","activate","flow","RenderShadowMapBatchedQueue","initInfo","name","priority","ForwardStagePriority","FORWARD","tag"],"mappings":"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"}
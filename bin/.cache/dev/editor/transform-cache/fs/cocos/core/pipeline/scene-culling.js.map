{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/pipeline/scene-culling.ts"],"names":["_tempVec3","Vec3","_dir_negate","_vec3_p","_shadowPos","_mat4_trans","Mat4","_castLightViewBounds","AABB","_castWorldBounds","_castBoundsInited","_sphere","Sphere","create","_cameraBoundingSphere","_validFrustum","Frustum","accurate","_lightViewFrustum","_dirLightFrustum","_matShadowTrans","_matShadowView","_matShadowViewInv","_matShadowProj","_matShadowViewProj","_matShadowViewProjArbitaryPos","_matShadowViewProjArbitaryPosInv","_projPos","_texelSize","Vec2","_projSnap","_snap","_focus","_ab","roPool","Pool","model","depth","dirShadowPool","castShadowPool","getRenderObject","camera","node","subtract","worldPosition","position","dot","forward","ro","alloc","getDirShadowRenderObject","getCastShadowRenderObject","getShadowWorldMatrix","pipeline","rotation","dir","out","shadows","pipelineSceneData","negate","distance","fixedSphere","radius","Shadows","COEFFICIENT_OF_EXPANSION","multiplyScalar","add","center","set","fromRT","updateSphereLight","light","pos","n","normal","d","NdL","lx","x","ly","y","lz","z","nx","ny","nz","m","matLight","m00","m01","m02","m03","m04","m05","m06","m07","m08","m09","m10","m11","m12","m13","m14","m15","pipelineUBO","updateShadowUBORange","UBOShadow","MAT_LIGHT_PLANE_PROJ_OFFSET","updateDirLight","direction","scale","updatePlanarPROJ","shadowInfo","shadowUBO","toArray","validPunctualLightsCulling","sceneData","validPunctualLights","length","spotLights","scene","i","baked","range","intersect","sphereFrustum","frustum","push","sphereLights","getCameraWorldMatrix","cameraNode","getWorldPosition","getWorldRotation","QuantizeDirLightShadowCamera","dirLight","device","invisibleOcclusionRange","shadowMapWidth","size","split","shadowDistance","clone","invert","shadowViewArbitaryPos","transform","fromPoints","mergeFrustum","r","halfExtents","transformMat4","orthoSizeMin","vertices","mergePoints","orthoSizeMax","orthoSize","shadowCameraFar","halfOrthoSize","ortho","capabilities","clipSpaceMinZ","clipSpaceSignY","multiply","invActualSize","modX","modY","createOrtho","updatePlanes","matShadowView","matShadowProj","matShadowViewProj","sceneCulling","mainLight","skybox","renderObjects","freeArray","castShadowObjects","dirShadowObjects","enabled","SHADOW_COLOR_OFFSET","shadowColor","type","ShadowType","ShadowMap","Planar","clearFlag","SKYBOX_FLAG","models","visibility","castShadow","firstSetCSM","worldBounds","copy","merge","layer","visFlags","fixedArea","aabbFrustum"],"mappings":"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"}
{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/pipeline/deferred/deferred-pipeline.ts"],"names":["PIPELINE_TYPE","DeferredRenderData","PipelineRenderData","gbufferFrameBuffer","gbufferRenderTargets","DeferredPipeline","RenderTextureConfig","RenderPipeline","_gbufferRenderPass","_lightingRenderPass","initialize","info","_flows","length","shadowFlow","ShadowFlow","initInfo","push","mainFlow","MainFlow","activate","swapchain","EDITOR","console","_macros","CC_PIPELINE_TYPE","_pipelineSceneData","DeferredPipelineSceneData","_activeRenderer","destroy","_destroyUBOs","_destroyQuadInputAssembler","_destroyDeferredData","rpIter","_renderPasses","values","rpRes","next","done","value","_commandBuffers","getPipelineRenderData","_pipelineRenderData","_generateDeferredRenderData","device","commandBuffer","sampler","globalDSManager","pointSampler","_descriptorSet","bindSampler","UNIFORM_SHADOWMAP_BINDING","bindTexture","builtinResMgr","get","getGFXTexture","UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING","update","inputAssemblerDataOffscreen","PipelineInputAssemblerData","_createQuadInputAssembler","quadIB","quadVB","quadIA","_quadIB","_quadVBOffscreen","_quadIAOffscreen","inputAssemblerDataOnscreen","_quadVBOnscreen","_quadIAOnscreen","colorAttachment0","ColorAttachment","format","Format","RGBA16F","loadOp","LoadOp","CLEAR","storeOp","StoreOp","STORE","colorAttachment1","colorAttachment2","colorAttachment3","depthStencilAttachment","DepthStencilAttachment","DEPTH_STENCIL","depthLoadOp","depthStoreOp","stencilLoadOp","stencilStoreOp","renderPassInfo","RenderPassInfo","createRenderPass","colorAttachment","RGBA8","endAccesses","AccessType","COLOR_ATTACHMENT_WRITE","LOAD","DISCARD","beginAccesses","DEPTH_STENCIL_ATTACHMENT_WRITE","_width","width","_height","height","getBuffer","UBOGlobal","BINDING","UBOShadow","UBOCamera","getTexture","deferredData","outputFrameBuffer","outputDepth","i","outputRenderTargets","_destroyBloomData","_ensureEnoughSize","cameras","newWidth","newHeight","window","Math","max","data","sceneData","pipelineSceneData","createTexture","TextureInfo","TextureType","TEX2D","TextureUsageBit","COLOR_ATTACHMENT","SAMPLED","shadingScale","DEPTH_STENCIL_ATTACHMENT","createFramebuffer","FramebufferInfo","on","PipelineEventType","ATTACHMENT_SCALE_CAHNGED","val","linearSampler","applyFramebufferRatio","serializable"],"mappings":"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"}
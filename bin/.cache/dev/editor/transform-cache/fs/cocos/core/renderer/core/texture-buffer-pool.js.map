{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/renderer/core/texture-buffer-pool.ts"],"names":["nearestPOT","num","roundUp","n","alignment","Math","ceil","TextureBufferPool","constructor","device","_device","_format","Format","UNKNOWN","_formatSize","_chunks","_chunkCount","_handles","_region0","BufferTextureCopy","_region1","_region2","_roundUpFn","_bufferViewCtor","Uint8Array","_channels","_alignment","initialize","info","formatInfo","FormatInfos","format","size","count","roundUpFn","inOrderFree","alloc","_McDonaldAlloc","destroy","i","chunk","texture","length","chunkIdx","index","start","undefined","_findAvailableSpace","handle","end","push","targetSize","sqrt","texLength","max","newChunk","createChunk","texHandle","free","splice","texSize","createTexture","TextureInfo","TextureType","TEX2D","TextureUsageBit","SAMPLED","TRANSFER_DST","update","buffer","buffers","regions","remainSize","byteLength","offsetX","width","offsetY","floor","copySize","min","begin","texOffset","x","y","texExtent","height","copyBuffersToTexture","isFound","handles","filter","h","sort","a","b"],"mappings":"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"}
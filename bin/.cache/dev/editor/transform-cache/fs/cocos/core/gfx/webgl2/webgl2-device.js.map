{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/gfx/webgl2/webgl2-device.ts"],"names":["WebGL2Device","Device","_swapchain","_context","gl","extensions","stateCache","nullTex2D","nullTexCube","initialize","info","WebGL2DeviceManager","setInstance","_gfxAPI","API","WEBGL2","_bindingMappingInfo","bindingMappingInfo","bufferOffsets","length","push","samplerOffsets","canvas","console","error","_queue","createQueue","QueueInfo","QueueType","GRAPHICS","_cmdBuff","createCommandBuffer","CommandBufferInfo","_caps","maxVertexAttributes","getParameter","MAX_VERTEX_ATTRIBS","maxVertexUniformVectors","MAX_VERTEX_UNIFORM_VECTORS","maxFragmentUniformVectors","MAX_FRAGMENT_UNIFORM_VECTORS","maxTextureUnits","MAX_TEXTURE_IMAGE_UNITS","maxVertexTextureUnits","MAX_VERTEX_TEXTURE_IMAGE_UNITS","maxUniformBufferBindings","MAX_UNIFORM_BUFFER_BINDINGS","maxUniformBlockSize","MAX_UNIFORM_BLOCK_SIZE","maxTextureSize","MAX_TEXTURE_SIZE","maxCubeMapTextureSize","MAX_CUBE_MAP_TEXTURE_SIZE","uboOffsetAlignment","UNIFORM_BUFFER_OFFSET_ALIGNMENT","getSupportedExtensions","extStr","ext","exts","WEBGL_debug_renderer_info","_renderer","UNMASKED_RENDERER_WEBGL","_vendor","UNMASKED_VENDOR_WEBGL","RENDERER","VENDOR","version","VERSION","_features","fill","Feature","TEXTURE_FLOAT","TEXTURE_HALF_FLOAT","FORMAT_R11G11B10F","FORMAT_SRGB","FORMAT_RGB8","ELEMENT_INDEX_UINT","INSTANCED_ARRAYS","MULTIPLE_RENDER_TARGETS","BLEND_MINMAX","EXT_color_buffer_float","COLOR_FLOAT","COLOR_HALF_FLOAT","OES_texture_float_linear","TEXTURE_FLOAT_LINEAR","OES_texture_half_float_linear","TEXTURE_HALF_FLOAT_LINEAR","compressedFormat","WEBGL_compressed_texture_etc1","FORMAT_ETC1","WEBGL_compressed_texture_etc","FORMAT_ETC2","WEBGL_compressed_texture_s3tc","FORMAT_DXT","WEBGL_compressed_texture_pvrtc","FORMAT_PVRTC","WEBGL_compressed_texture_astc","FORMAT_ASTC","destroy","it","_samplers","values","res","next","done","value","flushCommands","cmdBuffs","acquire","swapchains","present","queue","_numDrawCalls","numDrawCalls","_numInstances","numInstances","_numTris","numTris","clear","Ctor","type","CommandBufferType","PRIMARY","WebGL2PrimaryCommandBuffer","WebGL2CommandBuffer","cmdBuff","createSwapchain","swapchain","WebGL2Swapchain","createBuffer","buffer","WebGL2Buffer","createTexture","texture","WebGL2Texture","createDescriptorSet","descriptorSet","WebGL2DescriptorSet","createShader","shader","WebGL2Shader","createInputAssembler","inputAssembler","WebGL2InputAssembler","createRenderPass","renderPass","WebGL2RenderPass","createFramebuffer","framebuffer","WebGL2Framebuffer","createDescriptorSetLayout","descriptorSetLayout","WebGL2DescriptorSetLayout","createPipelineLayout","pipelineLayout","WebGL2PipelineLayout","createPipelineState","pipelineState","WebGL2PipelineState","WebGL2Queue","getSampler","hash","Sampler","computeHash","has","set","WebGL2Sampler","get","getGlobalBarrier","GlobalBarrier","_globalBarriers","getTextureBarrier","TextureBarrier","_textureBarriers","copyBuffersToTexture","buffers","regions","gpuTexture","copyTextureToBuffers","copyTexImagesToTexture","texImages"],"mappings":"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"}
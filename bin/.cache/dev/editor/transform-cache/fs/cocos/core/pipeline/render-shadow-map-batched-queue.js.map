{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/core/pipeline/render-shadow-map-batched-queue.ts"],"names":["_matShadowView","Mat4","_matShadowProj","_matShadowViewProj","_ab","AABB","_phaseID","_shadowPassIndices","getShadowPassIndex","subModels","shadowPassIndices","length","hasShadowPass","j","passes","shadowPassIndex","k","phase","push","RenderShadowMapBatchedQueue","constructor","pipeline","_pipeline","_subModelsArray","_passArray","_shaderArray","_instancedQueue","_batchedQueue","RenderInstancedQueue","RenderBatchedQueue","gatherLightPasses","globalDS","camera","light","cmdBuff","clear","pipelineSceneData","shadowInfo","shadows","dirShadowObjects","castShadowObjects","enabled","type","ShadowType","ShadowMap","LightType","DIRECTIONAL","i","ro","model","add","SPOT","invert","node","getWorldMatrix","perspective","angle","aspect","range","multiply","worldBounds","transform","intersect","aabbFrustum","frustum","subModel","shadowPassIdx","pass","batchingScheme","BatchingSchemes","INSTANCING","buffer","getInstancedBuffer","merge","instancedAttributes","queue","VB_MERGING","getBatchedBuffer","shader","shaders","uploadBuffers","recordCommandBuffer","device","renderPass","ia","inputAssembler","pso","PipelineStateManager","getOrCreatePipelineState","descriptorSet","bindPipelineState","bindDescriptorSet","SetIndex","MATERIAL","LOCAL","bindInputAssembler","draw"],"mappings":"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"}
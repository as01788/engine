{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/particle-2d/motion-streak-2d-assembler.ts"],"names":["_tangent","Vec2","_normal","_vec2","normal","out","dir","x","y","computeMiter","miter","lineA","lineB","halfThick","maxMultiple","add","normalize","multiple","dot","Math","min","MotionStreakAssembler","createData","comp","renderData","requestRenderData","dataLength","vertexCount","indicesCount","update","dt","stroke","node","matrix","worldMatrix","tx","m12","ty","m13","points","cur","length","point","difx","dify","minSeg","MotionStreak","Point","unshift","setPoint","time","fadeTime","verticesCount","updateRenderDataCache","color","cr","r","cg","g","cb","b","ca","a","prev","distance","subtract","setDir","data","findLast","i","p","splice","progress","next","da","c","offset","u","v","_val","passDirty","updatePass","nodeDirty","updateNode","textureDirty","texture","updateTexture","material","getRenderMaterial","hashDirty","updateHash","updateRenderData","fillBuffers","renderer","dataList","buffer","acquireBufferBatch","vertexOffset","byteOffset","indicesOffset","vertexId","isRecreate","request","currBufferBatch","vBuf","vData","iBuf","iData","vert","z","Color","toArray","l","start","MotionStreakAssemblerManager","getAssembler","Assembler"],"mappings":"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"}
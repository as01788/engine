{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/2d/renderer/render-uniform-buffer.ts"],"names":["UILocalBuffer","prevUBOIndex","_prevUBOIndex","uniformBufferStride","_uniformBufferStride","prevInstanceID","_prevInstanceID","constructor","device","hash","UIPerUBO","vec4PerUI","poolIndex","_device","_vec4PerUI","_UIPerUBO","_uniformBufferElementCount","_uniformBuffer","_firstUniformBufferView","_uniformBufferData","alignment","capabilities","uboOffsetAlignment","unalignedStride","Float32Array","BYTES_PER_ELEMENT","Math","ceil","createBuffer","BufferInfo","BufferUsageBit","UNIFORM","TRANSFER_DST","MemoryUsageBit","DEVICE","UBO_COUNT","BufferViewInfo","checkFull","updateIndex","destroy","upload","t","r","s","to","c","mode","uvExtra","fillType","data","offset","x","y","z","min","w","b","getBufferView","updateBuffer","update","reset","updateDataTRSByDirty","instanceID","UBOIndex","updateDataByDirty","UILocalUBOManger","_localBuffers","_element","i","length","key","push","value","pool","_createLocalBuffer","currentIdx","localBufferPool","localBuffer","res","j","capacity","idx"],"mappings":"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"}
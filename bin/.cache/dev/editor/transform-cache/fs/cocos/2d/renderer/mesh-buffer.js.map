{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/2d/renderer/mesh-buffer.ts"],"names":["MeshBuffer","ScalableContainer","attributes","_attributes","vertexBuffers","_vertexBuffers","indexBuffer","_indexBuffer","constructor","batcher","vData","iData","byteStart","byteOffset","indicesStart","indicesOffset","vertexStart","vertexOffset","lastByteOffset","_iaInfo","_batcher","_dirty","_vertexFormatBytes","_initVDataCount","_initIDataCount","_outOfCallback","_hInputAssemblers","_nextFreeIAHandle","_lastUsedVDataSize","_lastUsedIDataSize","vertexFormatBytes","initialize","attrs","outOfCallback","formatBytes","Float32Array","BYTES_PER_ELEMENT","vbStride","length","push","device","createBuffer","BufferInfo","BufferUsageBit","VERTEX","TRANSFER_DST","MemoryUsageBit","HOST","DEVICE","ibStride","Uint16Array","INDEX","InputAssemblerInfo","_reallocBuffer","request","vertexCount","indicesCount","call","byteLength","indicesLength","reset","tryShrink","vDataCount","Math","max","iDataCount","destroy","i","recordBatch","vCount","createInputAssembler","ia","firstIndex","indexCount","uploadBuffers","verticesData","buffer","indicesData","size","resize","update","_reallocVData","_reallocIData","copyOldData","oldVData","Uint8Array","newData","l","oldIData","OPACITY_OFFSET"],"mappings":";;;;;;;AA6BA;;AACA;;AAEA;;AAhCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAMO,MAAMA,UAAN,SAAyBC,oCAAzB,CAA2C;AAGhC,MAAVC,UAAU,GAAI;AAAE,WAAO,KAAKC,WAAZ;AAA0B;;AAC7B,MAAbC,aAAa,GAAI;AAAE,WAAO,KAAKC,cAAZ;AAA6B;;AACrC,MAAXC,WAAW,GAAI;AAAE,WAAO,KAAKC,YAAZ;AAA2B;;AAgChDC,EAAAA,WAAW,CAAEC,OAAF,EAAqB;AAC5B;AAD4B,SA9BzBC,KA8ByB,GA9BI,IA8BJ;AAAA,SA7BzBC,KA6ByB,GA7BG,IA6BH;AAAA,SA3BzBC,SA2ByB,GA3Bb,CA2Ba;AAAA,SA1BzBC,UA0ByB,GA1BZ,CA0BY;AAAA,SAzBzBC,YAyByB,GAzBV,CAyBU;AAAA,SAxBzBC,aAwByB,GAxBT,CAwBS;AAAA,SAvBzBC,WAuByB,GAvBX,CAuBW;AAAA,SAtBzBC,YAsByB,GAtBV,CAsBU;AAAA,SArBzBC,cAqByB,GArBR,CAqBQ;AAAA,SAnBxBf,WAmBwB,GAnBG,IAmBH;AAAA,SAlBxBE,cAkBwB,GAlBG,EAkBH;AAAA,SAjBxBE,YAiBwB,GAjBD,IAiBC;AAAA,SAhBxBY,OAgBwB,GAhBM,IAgBN;AAAA,SAXxBC,QAWwB;AAAA,SAVxBC,MAUwB,GAVf,KAUe;AAAA,SATxBC,kBASwB,GATH,CASG;AAAA,SARxBC,eAQwB,GARN,CAQM;AAAA,SAPxBC,eAOwB,GAPN,MAAM,CAOA;AAAA,SANxBC,cAMwB,GAN+B,IAM/B;AAAA,SALxBC,iBAKwB,GALc,EAKd;AAAA,SAJxBC,iBAIwB,GAJJ,CAII;AAAA,SAHxBC,kBAGwB,GAHH,CAGG;AAAA,SAFxBC,kBAEwB,GAFH,CAEG;AAE5B,SAAKT,QAAL,GAAgBX,OAAhB;AACH;;AAEoB,MAAjBqB,iBAAiB,GAAY;AAC7B,WAAO,KAAKR,kBAAZ;AACH;;AAEMS,EAAAA,UAAU,CAAEC,KAAF,EAAsBC,aAAtB,EAA2E;AACxF,SAAKR,cAAL,GAAsBQ,aAAtB;AACA,UAAMC,WAAW,GAAG,yCAAsBF,KAAtB,CAApB;AACA,SAAKV,kBAAL,GAA0BY,WAAW,GAAGC,YAAY,CAACC,iBAArD;AACA,SAAKb,eAAL,GAAuB,MAAM,KAAKD,kBAAlC;AACA,UAAMe,QAAQ,GAAGF,YAAY,CAACC,iBAAb,GAAiCF,WAAlD;;AAEA,QAAI,CAAC,KAAK9B,aAAL,CAAmBkC,MAAxB,EAAgC;AAC5B,WAAKlC,aAAL,CAAmBmC,IAAnB,CAAwB,KAAKnB,QAAL,CAAcoB,MAAd,CAAqBC,YAArB,CAAkC,IAAIC,iBAAJ,CACtDC,sBAAeC,MAAf,GAAwBD,sBAAeE,YADe,EAEtDC,sBAAeC,IAAf,GAAsBD,sBAAeE,MAFiB,EAGtDX,QAHsD,EAItDA,QAJsD,CAAlC,CAAxB;AAMH;;AAED,UAAMY,QAAQ,GAAGC,WAAW,CAACd,iBAA7B;;AAEA,QAAI,CAAC,KAAK9B,WAAV,EAAuB;AACnB,WAAKC,YAAL,GAAoB,KAAKa,QAAL,CAAcoB,MAAd,CAAqBC,YAArB,CAAkC,IAAIC,iBAAJ,CAClDC,sBAAeQ,KAAf,GAAuBR,sBAAeE,YADY,EAElDC,sBAAeC,IAAf,GAAsBD,sBAAeE,MAFa,EAGlDC,QAHkD,EAIlDA,QAJkD,CAAlC,CAApB;AAMH;;AAED,SAAK9C,WAAL,GAAmB6B,KAAnB;AACA,SAAKb,OAAL,GAAe,IAAIiC,yBAAJ,CAAuB,KAAKlD,UAA5B,EAAwC,KAAKE,aAA7C,EAA4D,KAAKE,WAAjE,CAAf,CA5BwF,CA8BxF;;AACA,QAAI,CAAC,KAAKI,KAAN,IAAe,CAAC,KAAKC,KAAzB,EAAgC;AAC5B,WAAK0C,cAAL;AACH,KAjCuF,CAkCxF;;AACH;;AAEMC,EAAAA,OAAO,CAAEC,WAAW,GAAG,CAAhB,EAAmBC,YAAY,GAAG,CAAlC,EAAqC;AAC/C,SAAKtC,cAAL,GAAsB,KAAKL,UAA3B;AACA,UAAMA,UAAU,GAAG,KAAKA,UAAL,GAAkB0C,WAAW,GAAG,KAAKjC,kBAAxD;AACA,UAAMP,aAAa,GAAG,KAAKA,aAAL,GAAqByC,YAA3C;;AAEA,QAAID,WAAW,GAAG,KAAKtC,YAAnB,GAAkC,KAAtC,EAA6C;AACzC,UAAI,KAAKQ,cAAT,EAAyB;AACrB,aAAKA,cAAL,CAAoBgC,IAApB,CAAyB,KAAKrC,QAA9B,EAAwCmC,WAAxC,EAAqDC,YAArD;AACH;;AACD,aAAO,KAAP;AACH;;AAED,QAAIE,UAAU,GAAG,KAAKhD,KAAL,CAAYgD,UAA7B;AACA,QAAIC,aAAa,GAAG,KAAKhD,KAAL,CAAY2B,MAAhC;;AACA,QAAIzB,UAAU,GAAG6C,UAAb,IAA2B3C,aAAa,GAAG4C,aAA/C,EAA8D;AAC1D,aAAOD,UAAU,GAAG7C,UAAb,IAA2B8C,aAAa,GAAG5C,aAAlD,EAAiE;AAC7D,aAAKQ,eAAL,IAAwB,CAAxB;AACA,aAAKC,eAAL,IAAwB,CAAxB;AAEAkC,QAAAA,UAAU,GAAG,KAAKnC,eAAL,GAAuB,CAApC;AACAoC,QAAAA,aAAa,GAAG,KAAKnC,eAArB;AACH;;AAED,WAAK6B,cAAL;AACH;;AAED,SAAKpC,YAAL,IAAqBsC,WAArB;AACA,SAAKxC,aAAL,IAAsByC,YAAtB;AACA,SAAK3C,UAAL,GAAkBA,UAAlB;AAEA,SAAKQ,MAAL,GAAc,IAAd;AACA,WAAO,IAAP;AACH;;AAEMuC,EAAAA,KAAK,GAAI;AACZ,SAAKhD,SAAL,GAAiB,CAAjB;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACA,SAAKC,YAAL,GAAoB,CAApB;AACA,SAAKC,aAAL,GAAqB,CAArB;AACA,SAAKC,WAAL,GAAmB,CAAnB;AACA,SAAKC,YAAL,GAAoB,CAApB;AACA,SAAKC,cAAL,GAAsB,CAAtB;AACA,SAAKS,iBAAL,GAAyB,CAAzB;AAEA,SAAKN,MAAL,GAAc,KAAd;AACH;;AAEMwC,EAAAA,SAAS,GAAI;AAChB,QAAI,KAAKxC,MAAL,IAAe,CAAC,KAAKX,KAArB,IAA8B,CAAC,KAAKC,KAAxC,EAA+C;;AAC/C,QAAI,KAAKD,KAAL,CAAWgD,UAAX,IAAyB,CAAzB,GAA6B,KAAK9B,kBAAlC,IAAwD,KAAKjB,KAAL,CAAW2B,MAAX,IAAqB,CAArB,GAAyB,KAAKT,kBAA1F,EAA8G;AAC1G,YAAMiC,UAAU,GAAGC,IAAI,CAACC,GAAL,CAAS,MAAM,KAAK1C,kBAApB,EAAwC,KAAKC,eAAL,IAAwB,CAAhE,CAAnB;AACA,YAAM0C,UAAU,GAAGF,IAAI,CAACC,GAAL,CAAS,MAAM,CAAf,EAAkB,KAAKxC,eAAL,IAAwB,CAA1C,CAAnB;;AACA,UAAIsC,UAAU,KAAK,KAAKvC,eAApB,IAAuC0C,UAAU,KAAK,KAAKzC,eAA/D,EAAgF;AAC5E,aAAKA,eAAL,GAAuByC,UAAvB;AACA,aAAK1C,eAAL,GAAuBuC,UAAvB;;AACA,aAAKT,cAAL;AACH;AACJ;AACJ;;AAEMa,EAAAA,OAAO,GAAI;AACd,SAAK/D,WAAL,GAAmB,IAAnB;AAEA,SAAKC,aAAL,CAAmB,CAAnB,EAAsB8D,OAAtB;AACA,SAAK9D,aAAL,CAAmBkC,MAAnB,GAA4B,CAA5B;AAEA,SAAKhC,WAAL,CAAiB4D,OAAjB;AACA,SAAK3D,YAAL,GAAoB,IAApB;;AAEA,SAAK,IAAI4D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzC,iBAAL,CAAuBY,MAA3C,EAAmD6B,CAAC,EAApD,EAAwD;AACpD,WAAKzC,iBAAL,CAAuByC,CAAvB,EAA0BD,OAA1B;AACH;;AACD,SAAKxC,iBAAL,CAAuBY,MAAvB,GAAgC,CAAhC;AACA,UAAM4B,OAAN;AACH;;AAEME,EAAAA,WAAW,GAA2B;AACzC,UAAMC,MAAM,GAAG,KAAKtD,aAAL,GAAqB,KAAKD,YAAzC;;AACA,QAAI,CAACuD,MAAL,EAAa;AACT,aAAO,IAAP;AACH;;AAED,QAAI,KAAK3C,iBAAL,CAAuBY,MAAvB,IAAiC,KAAKX,iBAA1C,EAA6D;AACzD,WAAKD,iBAAL,CAAuBa,IAAvB,CAA4B,KAAKnB,QAAL,CAAcoB,MAAd,CAAqB8B,oBAArB,CAA0C,KAAKnD,OAA/C,CAA5B;AACH;;AAED,UAAMoD,EAAE,GAAG,KAAK7C,iBAAL,CAAuB,KAAKC,iBAAL,EAAvB,CAAX;AAEA4C,IAAAA,EAAE,CAACC,UAAH,GAAgB,KAAK1D,YAArB;AACAyD,IAAAA,EAAE,CAACE,UAAH,GAAgBJ,MAAhB;AAEA,WAAOE,EAAP;AACH;;AAEMG,EAAAA,aAAa,GAAI;AACpB,QAAI,KAAK7D,UAAL,KAAoB,CAApB,IAAyB,CAAC,KAAKQ,MAAnC,EAA2C;AACvC;AACH;;AAED,UAAMsD,YAAY,GAAG,IAAIxC,YAAJ,CAAiB,KAAKzB,KAAL,CAAYkE,MAA7B,EAAqC,CAArC,EAAwC,KAAK/D,UAAL,IAAmB,CAA3D,CAArB;AACA,UAAMgE,WAAW,GAAG,IAAI3B,WAAJ,CAAgB,KAAKvC,KAAL,CAAYiE,MAA5B,EAAoC,CAApC,EAAuC,KAAK7D,aAA5C,CAApB;;AAEA,QAAI,KAAKF,UAAL,GAAkB,KAAKT,aAAL,CAAmB,CAAnB,EAAsB0E,IAA5C,EAAkD;AAC9C,WAAK1E,aAAL,CAAmB,CAAnB,EAAsB2E,MAAtB,CAA6B,KAAKlE,UAAlC;AACH;;AACD,SAAKT,aAAL,CAAmB,CAAnB,EAAsB4E,MAAtB,CAA6BL,YAA7B;;AAEA,QAAI,KAAK5D,aAAL,GAAqB,CAArB,GAAyB,KAAKT,WAAL,CAAiBwE,IAA9C,EAAoD;AAChD,WAAKxE,WAAL,CAAiByE,MAAjB,CAAwB,KAAKhE,aAAL,GAAqB,CAA7C;AACH;;AACD,SAAKT,WAAL,CAAiB0E,MAAjB,CAAwBH,WAAxB;AACA,SAAKjD,kBAAL,GAA0B,KAAKf,UAA/B;AACA,SAAKgB,kBAAL,GAA0B,KAAKd,aAA/B;AACA,SAAKM,MAAL,GAAc,KAAd;AACH;;AAEOgC,EAAAA,cAAc,GAAI;AACtB,SAAK4B,aAAL,CAAmB,IAAnB;;AACA,SAAKC,aAAL,CAAmB,IAAnB;AACH;;AAEOD,EAAAA,aAAa,CAAEE,WAAF,EAAwB;AACzC,QAAIC,QAAJ;;AACA,QAAI,KAAK1E,KAAT,EAAgB;AACZ0E,MAAAA,QAAQ,GAAG,IAAIC,UAAJ,CAAe,KAAK3E,KAAL,CAAWkE,MAA1B,CAAX;AACH;;AAED,SAAKlE,KAAL,GAAa,IAAIyB,YAAJ,CAAiB,KAAKZ,eAAtB,CAAb;;AAEA,QAAI6D,QAAQ,IAAID,WAAhB,EAA6B;AACzB,YAAMG,OAAO,GAAG,IAAID,UAAJ,CAAe,KAAK3E,KAAL,CAAWkE,MAA1B,CAAhB;;AACA,WAAK,IAAIT,CAAC,GAAG,CAAR,EAAWoB,CAAC,GAAGH,QAAQ,CAAC9C,MAA7B,EAAqC6B,CAAC,GAAGoB,CAAzC,EAA4CpB,CAAC,EAA7C,EAAiD;AAC7CmB,QAAAA,OAAO,CAACnB,CAAD,CAAP,GAAaiB,QAAQ,CAACjB,CAAD,CAArB;AACH;AACJ;AACJ;;AAEOe,EAAAA,aAAa,CAAEC,WAAF,EAAwB;AACzC,UAAMK,QAAQ,GAAG,KAAK7E,KAAtB;AAEA,SAAKA,KAAL,GAAa,IAAIuC,WAAJ,CAAgB,KAAK1B,eAArB,CAAb;;AAEA,QAAIgE,QAAQ,IAAIL,WAAhB,EAA6B;AACzB,YAAMxE,KAAK,GAAG,KAAKA,KAAnB;;AACA,WAAK,IAAIwD,CAAC,GAAG,CAAR,EAAWoB,CAAC,GAAGC,QAAQ,CAAClD,MAA7B,EAAqC6B,CAAC,GAAGoB,CAAzC,EAA4CpB,CAAC,EAA7C,EAAiD;AAC7CxD,QAAAA,KAAK,CAACwD,CAAD,CAAL,GAAWqB,QAAQ,CAACrB,CAAD,CAAnB;AACH;AACJ;AACJ;;AAvO6C;;;AAArCnE,U,CACKyF,c,GAAiB,C"}
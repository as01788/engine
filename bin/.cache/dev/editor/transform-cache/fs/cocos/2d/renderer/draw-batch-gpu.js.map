{"version":3,"sources":["file:///Users/disstian/Documents/CreatorProjects/engine3.3.0/cocos/2d/renderer/draw-batch-gpu.ts"],"names":["EPSILON","pack2","a","b","Math","min","floor","DrawBatch2DGPU","DrawBatch2D","vec4PerUI","val","_vec4PerUI","capacityDirty","constructor","_numPerUBO","_device","_dcIndex","legacyCC","director","root","device","fillBuffers","renderComp","UBOManager","material","batcher","node","updateWorldTransform","_pos","t","_rot","r","_scale","s","_tempRect","_uiProps","uiTransformComp","checkAndUpdateRect","Vec3","add","_tempPosition","_anchorCache","mode","fillType","frame","to","Sprite","Label","spriteFrame","tillingOffset","type","SpriteType","SIMPLE","SLICED","_calculateSlicedData","_slicedCache","_packageSlicedData","slicedData","rotated","TILED","calculateTiledData","_tiledCache","FILLED","start","fillStart","range","fillRange","end","x","y","z","fillCenter","w","max","trim","tillingOffsetWithTrim","c","color","_tempcolor","set","g","opacity","capabilities","maxVertexUniformVectors","passes","shaderInfo","builtins","statistics","CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS","localBuffer","upload","_rectWithScale","fillDrawCall","dc","_drawCalls","bufferHash","hash","bufferUboIndex","prevUBOIndex","drawcallPool","alloc","bufferView","getBufferView","setDynamicOffsets","uniformBufferStride","drawInfo","firstIndex","prevInstanceID","indexCount","length","_pushDrawCall","updateBuffer","bufferInfo","hasChangedFlags","_rectDirty","TransformBit","RS","updateDataTRSByDirty","instanceID","UBOIndex","updateDataByDirty","spriteData","frameData","_tempAnchor","Vec2","Color","Vec4"],"mappings":"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"}